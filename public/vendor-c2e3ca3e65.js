window.$timeStamp&&window.$timeStamp("engine");var _SS="",timeOOO=0;function clamp(t,e,i){return i<t?t:e<i?e:i}function distance(t,e,i,n,r,c,o){var s=o*o,t=t*s+e*o+i,e=n*s+r*o+c;return t*t+e*e}function GuideLine(){this._buf={},this.create=function(){return new Guideline},this.ctor=function(){this._tag=0,this._prepared=!1,this._segments=[]},this.prepare=function(){if(!this._prepared){for(this._arcLength=0,i=0;i<this._segments.length;i++)this._arcLength+=this._segments[i].getArcLength();this._prepared=!0}},this.getArcLength=function(){return this._prepared||this.prepare(),this._arcLength},this.getPointByRate=function(t){if(t<=0)return this._firstp;if(1<=t)return this._lastp;var e=this._buf[t];if(null==e){this._prepared||this.prepare();for(var i=t*this.getArcLength(),n=0;n<this._segments.length-1;n++){var r=i-this._segments[n].getArcLength();if(r<=0)break;i=r}e=this._segments[n].getPointByRate(i/this._segments[n].getArcLength()),Object.keys(this._buf).length<256&&(this._buf[t]=e)}return e},this.setPath=function(t){if(_buf={},null!=t&&0!=t.lenth){this._segments=[];var e,n=(t.length-1)/2;for(i=0;i<n;i++)e=2*i,this._segments.push(new cc.QuadraticBezierCurve(t[e],t[1+e],t[2+e]));this._firstp=this._segments[0]._p0,this._lastp=this._segments[this._segments.length-1]._p2,this._prepared=!1}},this.getRateByPoint=function(t){this._prepared||this.prepare();for(var e=this.getArcLength(),i=0,n=Number.MAX_VALUE,r=0,c={t:0},o=0;o<this._segments.length;o++){var s=this._segments[o].getMinDistance(t,c);s<n&&(r=i+this._segments[o].simpson(c.t),n=s),i+=this._segments[o].getArcLength()}return r/e},this.ctor()}(cc=cc||{})._tmp=cc._tmp||{},cc._LogInfos={},(_p=window).gl,_p.WebGLRenderingContext,_p.DeviceOrientationEvent,_p.DeviceMotionEvent,_p.AudioContext,_p.AudioContext||_p.webkitAudioContext,_p.mozAudioContext,(_p=Object.prototype)._super,_p.ctor,_p=null,cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc._drawingUtil=null,cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,cc.newElement=function(t){return document.createElement(t)},cc.each=function(t,e,i){if(t)if(t instanceof Array){for(var n=0,r=t.length;n<r;n++)if(!1===e.call(i,t[n],n))return}else for(var c in t)if(!1===e.call(i,t[c],c))return},cc.extend=function(i){var t=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];return cc.each(t,function(t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])}),i},cc.isFunction=function(t){return"function"==typeof t},cc.isNumber=function(t){return"number"==typeof t||"[object Number]"===Object.prototype.toString.call(t)},cc.isString=function(t){return"string"==typeof t||"[object String]"===Object.prototype.toString.call(t)},cc.isArray=function(t){return Array.isArray(t)||"object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t)},cc.isUndefined=function(t){return void 0===t},cc.isObject=function(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)},cc.isCrossOrigin=function(t){var e;return t?-1!==(e=t.indexOf("://"))&&(-1===(e=t.indexOf("/",e+3))?t:t.substring(0,e))!==location.origin:(cc.log("invalid URL"),!1)},cc.AsyncPool=function(t,e,i,n,r){var c=this;c._srcObj=t,c._limit=e,c._pool=[],c._iterator=i,c._iteratorTarget=r,c._onEnd=n,c._onEndTarget=r,c._results=t instanceof Array?[]:{},c._errors=t instanceof Array?[]:{},cc.each(t,function(t,e){c._pool.push({index:e,value:t})}),c.size=c._pool.length,c.finishedSize=0,c._workingSize=0,c._limit=c._limit||c.size,c.onIterator=function(t,e){c._iterator=t,c._iteratorTarget=e},c.onEnd=function(t,e){c._onEnd=t,c._onEndTarget=e},c._handleItem=function(){var t,e,i,n=this;0===n._pool.length||n._workingSize>=n._limit||(e=(t=n._pool.shift()).value,i=t.index,n._workingSize++,n._iterator.call(n._iteratorTarget,e,i,function(t,e){n.finishedSize++,n._workingSize--,t?n._errors[this.index]=t:n._results[this.index]=e,n.finishedSize===n.size?n._onEnd&&(t=0===n._errors.length?null:n._errors,n._onEnd.call(n._onEndTarget,t,n._results)):n._handleItem()}.bind(t),n))},c.flow=function(){var t=this;if(0===t._pool.length)t._onEnd&&t._onEnd.call(t._onEndTarget,null,[]);else for(var e=0;e<t._limit;e++)t._handleItem()}},cc.QuadraticBezierCurve=function(t,e,i){this._prepared=!1,this._p0=t,this._p1=e,this._p2=i,this._arcLength=0,this.getP0=function(){return this._p0},this.getP1=function(){return this._p1},this.getP2=function(){return this._p2},this.prepare=function(){this._prepared||(this._ax=parseInt(1e3*(this._p0.X-2*this._p1.X+this._p2.X))/1e3,this._bx=parseInt(2*(this._p1.X-this._p0.X)*1e3)/1e3,this._ay=parseInt(1e3*(this._p0.Y-2*this._p1.Y+this._p2.Y))/1e3,this._by=parseInt(2*(this._p1.Y-this._p0.Y)*1e3)/1e3,this._A=4*(this._ax*this._ax+this._ay*this._ay),this._bf=4*(this._ax*this._bx+this._ay*this._by),this._cf=this._bx*this._bx+this._by*this._by,this._Csqrt=Math.sqrt(this._cf),this._prepared=!0)},this.simpson=function(t){this._prepared||this.prepare();var e=this._A*t;return(this._Csqrt+Math.sqrt(this._cf+t*(this._bf+e))+2*Math.sqrt(4*this._cf+t*(2*this._bf+e)))*t/6},this.getArcLength=function(){return this.simpson(1)},this.getPointByRate=function(t){if(this._prepared||this.prepare(),t<=0)return this._p0;if(1<=t)return this._p2;for(var e=this.getArcLength()*t,i=t;;){var n=this._A*i,r=n*i,c=this._bf*i,o=this._Csqrt+Math.sqrt(this._cf+i*(this._bf+n))+2*Math.sqrt(4*this._cf+i*(2*this._bf+n)),s=i-(o*i/6-e)/((((this._bf+n)/Math.sqrt(this._cf+c/2+r/4)+(this._bf/2+n)/Math.sqrt(this._cf+c+r))*i+o)/6);if(Math.abs(s-i)<1e-4)break;i=s}t=s*s;return{x:this._ax*t+this._bx*s+this._p0.X,y:this._ay*t+this._by*s+this._p0.Y}},this.getMinDistance=function(t,e){this._prepared||this.prepare();var i,n,r=e.t,c=this._ax+this._ay,o=this._bx+this._by,s=this._p0.X+this._p0.Y-(t.x+t.y);return 1e-4<Math.abs(c)?(i=o*o-4*c*s,0<=(i=Math.abs(i)<=1e-4?0:i)?(n=clamp(0,1,n=(-o+(i=Math.sqrt(i)))/(2*c)),i=clamp(0,1,i=(-o-i)/(2*c)),c=distance(this._ax,this._bx,this._p0.X-t.x,this._ay,this._by,this._p0.Y-t.y,n),r=n,(n=distance(this._ax,this._bx,this._p0.X-t.x,this._ay,this._by,this._p0.Y-t.y,i))<c&&(c=n,r=i),e.t=r,c):(e.t=r,Number.MAX_VALUE)):(r=clamp(0,1,r=-s/o),e.t=r,distance(this._ax,this._bx,this._p0.X-t.x,this._ay,this._by,this._p0.Y-t.y,r))}},cc.GuideLine=GuideLine,cc.async={series:function(t,e,n){t=new cc.AsyncPool(t,1,function(t,e,i){t.call(n,i)},e,n);return t.flow(),t},parallel:function(t,e,n){t=new cc.AsyncPool(t,0,function(t,e,i){t.call(n,i)},e,n);return t.flow(),t},waterfall:function(n,e,r){var c=[],o=[null],t=new cc.AsyncPool(n,1,function(t,e,i){c.push(function(t){c=Array.prototype.slice.call(arguments,1),n.length-1===e&&(o=o.concat(c)),i.apply(null,arguments)}),t.apply(r,c)},function(t){if(e)return t?e.call(r,t):void e.apply(r,o)});return t.flow(),t},map:function(t,e,i,n){var r=e,e=("object"==typeof e&&(i=e.cb,n=e.iteratorTarget,r=e.iterator),new cc.AsyncPool(t,0,r,i,n));return e.flow(),e},mapLimit:function(t,e,i,n,r){t=new cc.AsyncPool(t,e,i,n,r);return t.flow(),t}},cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,DIRNAME_RE:/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){t=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(t);return t?t[1]:null},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?"),i=(0<i&&(t=t.substring(0,i)),/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,"")));return i?(i=i[2],e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?i.substring(0,i.length-e.length):i):null},dirname:function(t){t=this.DIRNAME_RE.exec(t);return t?t[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return 0<i&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){var n,r;return 0===e.indexOf(".")?this.changeExtname(t,e):(n=t.indexOf("?"),r="",i=i?this.extname(t):"",0<n&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),t.substring(0,n=n<=0?0:n+1)+e+i+r)},_normalize:function(t){var e;for(t=String(t);t=(e=t).replace(this.normalizeRE,""),e.length!==t.length;);return t}};var imagePool={_pool:new Array(10),_MAX:10,_smallImg:"data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",count:0,get:function(){var t;return 0<this.count?(this.count--,t=this._pool[this.count],this._pool[this.count]=null,t):new Image},put:function(t){var e=this._pool;t instanceof HTMLImageElement&&this.count<this._MAX&&(t.src=this._smallImg,e[this.count]=t,this.count++)}};cc.loader=function(){var s={},a={},r={},c={},h={},l=new RegExp("^(?:https?|ftp)://\\S*$","i");return{_register:a,_urlRegExp:l,resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){var t=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");return t instanceof window.XMLHttpRequest&&this.timeout&&(t.timeout=this.timeout,t.ontimeout=function(){t.abort(),t.onerror&&t.onerror()}),t},_getArgs4Js:function(t){var e=t[0],i=t[1],n=t[2],r=["",null,null];if(1===t.length)r[1]=e instanceof Array?e:[e];else if(2===t.length)"function"==typeof i?(r[1]=e instanceof Array?e:[e],r[2]=i):(r[0]=e||"",r[1]=i instanceof Array?i:[i]);else{if(3!==t.length)throw new Error("arguments error to load js!");r[0]=e||"",r[1]=i instanceof Array?i:[i],r[2]=n}return r},isLoading:function(t){return void 0!==h[t]},loadJs:function(t,e,i){var n=this,r=n._getArgs4Js(arguments),c=r[0],o=r[1],r=r[2];-1<navigator.userAgent.indexOf("Trident/5")?n._loadJs4Dependency(c,o,0,r):cc.async.map(o,function(t,e,i){t=cc.path.join(c,t);if(s[t])return i(null);n._createScript(t,!1,i)},r)},loadJsWithImg:function(t,e,i){var n=this._loadJsImg(),r=this._getArgs4Js(arguments);this.loadJs(r[0],r[1],function(t){if(t)throw new Error(t);n.parentNode.removeChild(n),r[2]&&r[2]()})},_createScript:function(t,e,i){var n=document,r=document.createElement("script");r.async=e,s[t]=!0,cc.game.config.noCache&&"string"==typeof t?this._noCacheRex.test(t)?r.src=t+"&_t="+ +new Date:r.src=t+"?_t="+ +new Date:r.src=t,r.addEventListener("load",function(){r.parentNode.removeChild(r),this.removeEventListener("load",arguments.callee,!1),i()},!1),r.addEventListener("error",function(){r.parentNode.removeChild(r),i("Load "+t+" failed!")},!1),n.body.appendChild(r)},_loadJs4Dependency:function(e,i,n,r){var c;n>=i.length?r&&r():(c=this)._createScript(cc.path.join(e,i[n]),!1,function(t){if(t)return r(t);c._loadJs4Dependency(e,i,n+1,r)})},_loadJsImg:function(){var t,e=document,i=e.getElementById("cocos2d_loadJsImg");return i||(i=document.createElement("img"),cc._loadingImage&&(i.src=cc._loadingImage),(e=e.getElementById(cc.game.config.id)).style.backgroundColor="transparent",e.parentNode.appendChild(i),t=(t=getComputedStyle?getComputedStyle(e):e.currentStyle)||{width:e.width,height:e.height},i.style.left=e.offsetLeft+(parseFloat(t.width)-i.width)/2+"px",i.style.top=e.offsetTop+(parseFloat(t.height)-i.height)/2+"px",i.style.position="absolute"),i},loadTxt:function(t,i){var e,n;cc._isNodeJs?require("fs").readFile(t,function(t,e){t?i(t):i(null,e.toString())}):(e=this.getXMLHttpRequest(),n="load "+t+" failed!",e.open("GET",t,!0),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.onload=function(){4===e.readyState&&(200===e.status?i(null,e.responseText):i({status:e.status,errorMessage:n},null))},e.onerror=function(){i({status:e.status,errorMessage:n},null)},e.send(null))},_loadTxtSync:function(t){var e;return cc._isNodeJs?require("fs").readFileSync(t).toString():((e=this.getXMLHttpRequest()).open("GET",t,!1),e.overrideMimeType&&e.overrideMimeType("text/plain; charset=utf-8"),e.send(null),4===!e.readyState||200!==e.status?null:e.responseText)},loadJson:function(n,r){this.loadTxt(n,function(t,e){if(t)r(t);else{try{var i=JSON.parse(e)}catch(t){throw new Error("parse json ["+n+"] failed : "+t)}r(null,i)}})},_checkIsImageURL:function(t){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(t)},loadImg:function(r,t,e,c){var i={isCrossOrigin:!0},t=(void 0!==e?i.isCrossOrigin=(void 0===t.isCrossOrigin?i:t).isCrossOrigin:void 0!==t&&(e=t),this.getRes(r));if(t)return t.refnum++,e&&e(null,t),null;var o,t=h[r];if(t)return t.callbacks.push(e),t.img;c=c||imagePool.get(),i.isCrossOrigin&&"file://"!==location.origin?c.crossOrigin="Anonymous":c.crossOrigin=null;var s=function(){clearTimeout(o),this.removeEventListener("load",s,!1),this.removeEventListener("error",a,!1);var t=h[r];if(t){for(var e=t.callbacks,i=0;i<e.length;++i){var n=e[i];n&&n(null,c)}t.img=null,delete h[r]}cc._renderType===cc.game.RENDER_TYPE_WEBGL&&imagePool.put(c)},a=function(){};return h[r]={img:c,callbacks:e?[e]:[]},c.addEventListener("load",s),c.addEventListener("error",a),this.timeout&&(o=setTimeout(function(){a.call(c),c.src=""},this.timeout)),c.src=r,c},_loaderLoad:function(t,e,i,n,r,c){var o=this;t.load(i,n,r,function(t,e){t?(cc.log(t),o.cache[n]=null,delete o.cache[n],c({status:520,errorMessage:t},null)):(("mp3"!=(t=n.split("."))[t.length-1]||null==e._element||null==e._element.buffer||e._element.buffer.length<5e4)&&(o.cache[n]=e),c(null,e))})},_loadResIterator:function(t,e,i){var n,r,c=null,o=t.type,s=(o?(o="."+o.toLowerCase(),c=t.src||t.name+o):o=cc.path.extname(c=t),this.getRes(c));return s?(s instanceof cc.Texture2D&&s.refnum++,i(null,s)):(s=null,(s=o?a[o.toLowerCase()]:s)?(r=c,l.test(c)||window.kwaigame&&c.endsWith(".mp3")||(n=s.getBasePath?s.getBasePath():this.resPath,r=this.getUrl(n,c)),cc.game.config.noCache&&"string"==typeof r&&(this._noCacheRex.test(r)?r+="&_t="+ +new Date:r+="?_t="+ +new Date),void this._loaderLoad(s,o,r,c,t,i)):(cc.error("loader for ["+o+"] not exists!"),i()))},_noCacheRex:/\?/,getUrl:function(t,e){var i=cc.path;if(void 0!==t&&void 0===e&&(e=t,n=(n=i.extname(e))?n.toLowerCase():"",t=(n=a[n])&&n.getBasePath?n.getBasePath():this.resPath),(e=cc.path.join(t||"",e)).match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(r[e])return r[e];var n=i.extname(e)||"";e=r[e]=e.substring(0,e.length-n.length)+"_"+cc.sys.language+n}return e},load:function(t,r,e){var c=this,i=arguments.length;if(0===i)throw new Error("arguments error!");3===i?"function"==typeof r&&(r="function"==typeof e?{trigger:r,cb:e}:{cb:r,cbTarget:e}):2===i?"function"==typeof r&&(r={cb:r}):1===i&&(r={}),t instanceof Array||(t=[t]);i=new cc.AsyncPool(t,cc.CONCURRENCY_HTTP_REQUEST_COUNT,function(t,e,i,n){c._loadResIterator(t,e,function(t){var e=Array.prototype.slice.call(arguments,1);r.trigger&&r.trigger.call(r.triggerTarget,e[0],n.size,n.finishedSize),i(t,e[0])})},r.cb,r.cbTarget);return i.flow(),i},_handleAliases:function(t,e){var i,n=[];for(i in t){var r=t[i];n.push(c[i]=r)}this.load(n,e)},loadAliases:function(t,i){var n=this,e=n.getRes(t);e?n._handleAliases(e.filenames,i):n.load(t,function(t,e){n._handleAliases(e[0].filenames,i)})},register:function(t,e){if(t&&e){if("string"==typeof t)return a[t.trim().toLowerCase()]=e;for(var i=0,n=t.length;i<n;i++)a["."+t[i].trim().toLowerCase()]=e}},getRes:function(t){return this.cache[t]||this.cache[c[t]]},_getAliase:function(t){return c[t]},release:function(t){var e=this.cache,i=h[t];i&&(i.img=null,delete h[t]),delete e[t],delete e[c[t]],delete c[t]},releaseAll:function(){var t,e=this.cache;for(t in e)delete e[t];for(t in c)delete c[t]}}}(),cc.formatStr=function(){var t=arguments,e=t.length;if(e<1)return"";var i=t[0],n=!0;"object"==typeof i&&(n=!1);for(var r=1;r<e;++r){var c=t[r];if(n)for(;;){if("number"==typeof c&&i.match(/(%d)|(%s)/)){i=i.replace(/(%d)|(%s)/,c);break}i.match(/%s/)?i=i.replace(/%s/,c):i+="    "+c;break}else i+="    "+c}return i},function(){var t=document.createElement("canvas"),e=document.createElement("canvas"),i=(cc.create3DContext=function(t,e){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=0;r<i.length;++r){try{n=t.getContext(i[r],e)}catch(t){}if(n)break}return n},!!window.wx),n=(cc.sys={},cc.sys);if(n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_UNKNOWN="unkonwn",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.WECHAT_GAME=104,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_WECHAT_GAME="wechatgame",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,i)f=wx.getSystemInfoSync(),n.isMobile=!0,n.platform=n.WECHAT_GAME,n.language=f.language.substr(0,2),"android"===f.platform?n.os=n.OS_ANDROID:"ios"===f.platform&&(n.os=n.OS_IOS),d=/[\d\.]+/.exec(f.system),n.osVersion=d[0],n.osMainVersion=parseInt(n.osVersion),n.browserType=n.BROWSER_TYPE_WECHAT_GAME,n.browserVersion=f.version,d=f.windowWidth,p=f.windowHeight,f=f.pixelRatio||1,n.windowPixelResolution={width:f*d,height:f*p},n.localStorage=window.localStorage,n.capabilities={canvas:!0,opengl:!0,webp:!1};else{var i=window,r=i.navigator,c=document,o=c.documentElement,s=r.userAgent.toLowerCase(),a=(n.isMobile=-1!==s.indexOf("mobile")||-1!==s.indexOf("android"),n.platform=n.isMobile?n.MOBILE_BROWSER:n.DESKTOP_BROWSER,r.language),a=(a=(a=a||r.browserLanguage)?a.split("-")[0]:n.LANGUAGE_ENGLISH,n.language=a,!1),h=!1,l="",_=0,u=/android (\d+(?:\.\d+)+)/i.exec(s)||/android (\d+(?:\.\d+)+)/i.exec(r.platform),u=(u&&(a=!0,l=u[1]||"",_=parseInt(l)||0),(u=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(s))&&(h=!0,l=u[2]||"",_=parseInt(l)||0),n.OS_UNKNOWN),d=(-1!==r.appVersion.indexOf("Win")?u=n.OS_WINDOWS:h?u=n.OS_IOS:-1!==r.appVersion.indexOf("Mac")?u=n.OS_OSX:-1!==r.appVersion.indexOf("X11")&&-1===r.appVersion.indexOf("Linux")?u=n.OS_UNIX:a?u=n.OS_ANDROID:-1!==r.appVersion.indexOf("Linux")&&(u=n.OS_LINUX),n.os=u,n.osVersion=l,n.osMainVersion=_,n.browserType=n.BROWSER_TYPE_UNKNOWN,"micromessenger"===(r=(r=(r=/mqqbrowser|qq|sogou|qzone|liebao|micromessenger|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i.exec(s))||/qqbrowser|chrome|safari|firefox|opr|oupeng|opera/i.exec(s))?r[0]:n.BROWSER_TYPE_UNKNOWN)?r=n.BROWSER_TYPE_WECHAT:"safari"===r&&a?r=n.BROWSER_TYPE_ANDROID:"qq"===r&&(h?r=n.BROWSER_TYPE_SAFARI:s.match(/android.*applewebkit/i)?brwoserType=n.BROWSER_TYPE_ANDROID:r=n.isMobile?n.BROWSER_TYPE_MOBILE_QQ:n.BROWSER_TYPE_QQ),n.browserType=r,n.browserVersion="",u=(u=s.match(/(micromessenger|qq|mx|maxthon|baidu|sogou)(mobile)?(browser)?\/?([\d.]+)/i))||s.match(/(msie |rv:|firefox|chrome|ucbrowser|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i),n.browserVersion=u?u[4]:"",window.innerWidth||document.documentElement.clientWidth),p=window.innerHeight||document.documentElement.clientHeight,f=window.devicePixelRatio||1;n.windowPixelResolution={width:f*d,height:f*p},n._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("WebGL only.")},n._supportCanvasNewBlendModes=((l=t).width=1,l.height=1,(l=l.getContext("2d")).fillStyle="#000",l.fillRect(0,0,1,1),l.globalCompositeOperation="multiply",(_=e).width=1,_.height=1,(a=_.getContext("2d")).fillStyle="#fff",a.fillRect(0,0,1,1),l.drawImage(_,0,0,1,1),0===l.getImageData(0,0,1,1).data[0]),cc.sys.isMobile&&((h=document.createElement("style")).type="text/css",document.body.appendChild(h),h.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");try{var g=n.localStorage=i.localStorage;g.setItem("storage",""),g.removeItem("storage"),g=null}catch(t){function m(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")}n.localStorage={getItem:m,setItem:m,removeItem:m,clear:m}}r=!!t.getContext("2d"),s=n.capabilities={canvas:r,opengl:!0};void 0===o.ontouchstart&&void 0===c.ontouchstart||(s.touches=!0),void 0!==o.onmouseup&&(s.mouse=!0),void 0!==o.onkeyup&&(s.keyboard=!0),(i.DeviceMotionEvent||i.DeviceOrientationEvent)&&(s.accelerometer=!0),n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){return!!t},n.openURL=function(t){window.open(t)}}var t=null,T=(e=null,!(cc.log=cc.warn=cc.error=cc.assert=function(){})),E=null;function y(t){t[cc.game.CONFIG_KEY.engineDir],cc.loader;cc.Class&&(t=t,cc._initDebugSetting&&cc._initDebugSetting(t[cc.game.CONFIG_KEY.debugMode]),cc._engineLoaded=!0,cc.log(cc.ENGINE_VERSION),E)&&E()}function S(){this.removeEventListener("load",S,!1),y(cc.game.config)}cc._engineLoaded=!1,cc.initEngine=function(t,e){var i;T?(i=E,E=function(){i&&i(),e&&e()}):(E=e,!cc.game.config&&t?cc.game.config=t:cc.game.config||cc.game._loadConfig(),t=cc.game.config,cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0,document.body?y(t):cc._addEventListener(window,"load",S,!1),T=!0)}}(),cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:!0,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(t){var e=this;e.config[e.CONFIG_KEY.frameRate]=t,e._intervalId&&window.cancelAnimationFrame(e._intervalId),e._intervalId=0,e._paused=!0,e._setAnimFrame(),e._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&!window.kwaigame&&(cc.audioEngine.stopAllEffects(),cc.audioEngine.pauseMusic()),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&!window.kwaigame&&cc.audioEngine.resumeMusic(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0),cc.audioEngine&&cc.audioEngine.end(),cc.game.onStart()},end:function(){close()},prepare:function(e){var i=this,t=i.config,n=i.CONFIG_KEY;this._loadConfig(),this._prepared?e&&e():this._prepareCalled||(cc._engineLoaded?(this._prepareCalled=!0,this._initRenderer(t[n.width],t[n.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop(),(t=t[n.jsList])?cc.loader.loadJsWithImg(t,function(t){if(t)throw new Error(t);i._prepared=!0,e&&e()}):e&&e()):cc.initEngine(this.config,function(){i.prepare(e)}))},run:function(t,e){"function"==typeof t?cc.game.onStart=t:(t&&("string"==typeof t?(cc.game.config||this._loadConfig(),cc.game.config[cc.game.CONFIG_KEY.id]=t):cc.game.config=t),"function"==typeof e&&(cc.game.onStart=e)),this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date;var t=cc.game.config[cc.game.CONFIG_KEY.frameRate];this._frameTime=1e3/t,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,cc.game._frameTime-(e-cc.game._lastTime)),n=window.setTimeout(function(){t()},i);return cc.game._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director;skip=!0,frameRate=i[n.frameRate],r.setDisplayStats(i[n.showFPS]),t=function(){e._paused||(30===frameRate&&(skip=!skip)||r.mainLoop(),e._intervalId=window.requestAnimFrame(t))},e._intervalId=window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(){this.config?this._initConfig(this.config):document.ccConfig&&this._initConfig(document.ccConfig)},_initConfig:function(t){var e=this.CONFIG_KEY,i=t[e.modules];t[e.showFPS]=void 0===t[e.showFPS]||t[e.showFPS],t[e.engineDir]=t[e.engineDir]||"frameworks/cocos2d-html5",null==t[e.debugMode]&&(t[e.debugMode]=0),t[e.frameRate]=t[e.frameRate]||60,null==t[e.renderMode]&&(t[e.renderMode]=0),null==t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),i&&i.indexOf("core")<0&&i.splice(0,0,"core"),i&&(t[e.modules]=i),this.config=t},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("support err:"+this.config[this.CONFIG_KEY.renderMode]);var i,n,r,c=this.config[cc.game.CONFIG_KEY.id],o=window,s=cc.sys.platform===cc.sys.WECHAT_GAME||!!window.kwaigame;s?(i=document.getElementById("canvas"),this.container=cc.container=r=document.createElement("DIV"),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,this.canvas=cc._canvas=n=i):("CANVAS"===(i=cc.$(c)||cc.$("#"+c)).tagName?(t=t||i.width,e=e||i.height,this.canvas=cc._canvas=n=i,this.container=cc.container=r=document.createElement("DIV"),n.parentNode&&n.parentNode.insertBefore(r,n)):("DIV"!==i.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||i.clientWidth,e=e||i.clientHeight,this.canvas=cc._canvas=n=document.createElement("CANVAS"),this.container=cc.container=r=document.createElement("DIV"),i.appendChild(r)),r.setAttribute("id","Cocos2dGameContainer"),r.appendChild(n),this.frame=r.parentNode===document.body?document.documentElement:r.parentNode,n.addClass("gameCanvas"),n.setAttribute("width",t||480),n.setAttribute("height",e||320),n.setAttribute("tabindex",99)),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(n,{stencil:!0,antialias:!cc.sys.isMobile,alpha:!1,preserveDrawingBuffer:s})),this._renderContext&&(cc.renderer=cc.rendererWebGL,o.gl=this._renderContext,cc.renderer.init(),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=o.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=o.gl.getExtension("OES_element_index_uint")),cc._gameDiv=r,cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.dispatchEvent(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){function e(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)}function i(){cc.eventManager&&cc.game._eventShow&&cc.eventManager.dispatchEvent(cc.game._eventShow)}var t,n,r=window;this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE),this._eventHide.setUserData(this),this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW),this._eventShow.setUserData(this),this.config[this.CONFIG_KEY.registerSystemEvent]&&cc.inputManager.registerSystemEvent(this.canvas),cc.isUndefined(document.hidden)||(t="hidden",n="visibilitychange");t?document.addEventListener(n,function(){(document[t]?e:i)()},!1):(r.addEventListener("blur",e,!1),r.addEventListener("focus",i,!1)),-1<navigator.userAgent.indexOf("MicroMessenger")&&(r.onfocus=function(){i()}),cc.sys.platform===cc.sys.WECHAT_GAME&&(wx.onShow(i),wx.onHide(e)),window.kwaigame&&((n=loadRuntime()).onShow(i),n.onHide(e)),"onpageshow"in window&&"onpagehide"in window&&(r.addEventListener("pagehide",e,!1),r.addEventListener("pageshow",i,!1)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.game.pause()}),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.game.resume()}),document.addEventListener("cloverVisibilityChange",function(t){(t.detail.hidden?e:i)()})}},Function.prototype.bind=Function.prototype.bind||function(t){var e,i,n,r;if(cc.isFunction(this))return e=Array.prototype.slice.call(arguments,1),i=this,r=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))},(n=function(){}).prototype=this.prototype,r.prototype=new n,r;throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")},cc.EventHelper=function(){},cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(t){t.addEventListener=cc.EventHelper.prototype.addEventListener,t.hasEventListener=cc.EventHelper.prototype.hasEventListener,t.removeEventListener=cc.EventHelper.prototype.removeEventListener,t.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(t,e,i){var n;"load"===t&&this._textureLoaded?setTimeout(function(){e.call(i)},0):(void 0===this._listeners&&(this._listeners={}),void 0===(n=this._listeners)[t]&&(n[t]=[]),this.hasEventListener(t,e,i)||n[t].push({callback:e,eventTarget:i}))},hasEventListener:function(t,e,i){if(void 0!==this._listeners){var n=this._listeners;if(void 0!==n[t])for(var r=0,c=n[t].length;r<c;r++){var o=n[t][r];if(o.callback===e&&o.eventTarget===i)return!0}}return!1},removeEventListener:function(t,e,i){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)for(var r=0;r<n.length;){var c=n[r];c.eventTarget===i&&c.callback===e?n.splice(r,1):r++}}},removeEventTarget:function(t,e,i){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n)for(var r=0;r<n.length;)n[r].eventTarget===i?n.splice(r,1):r++}},dispatchEvent:function(t,e){if(void 0!==this._listeners){null==e&&(e=!0);var i=this._listeners[t];if(void 0!==i){for(var n=[],r=i.length,c=0;c<r;c++)n[c]=i[c];for(c=0;c<r;c++)n[c].callback.call(n[c].eventTarget,this);e&&(i.length=0)}}}},cc.EventHelper.prototype.apply(cc.game);(cc=cc||{})._loadingImage="",cc._fpsImage="",cc._loaderImage="",cc.loader.loadBinary=function(t,e){var i=this,n=this.getXMLHttpRequest(),r="load "+t+" failed!";n.open("GET",t,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onload=function(){4===n.readyState&&200===n.status?e(null,i._str2Uint8Array(n.responseText)):e(r)},n.send(null)},cc.loader._str2Uint8Array=function(t){if(!t)return null;for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=255&t.charCodeAt(i);return e},cc.loader.loadBinarySync=function(t){var e=this.getXMLHttpRequest(),i="load "+t+" failed!";e.open("GET",t,!1);return e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null),200!==e.status?(cc.log(i),null):this._str2Uint8Array(e.responseText)},window.Uint8Array=window.Uint8Array||window.Array;var cc=cc||{},ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};!function(){var m=/\b_super\b/;cc.Class=function(){},cc.Class.extend=function(t){var r=this.prototype,i=Object.create(r),e=ClassManager.getNewID(),n=(ClassManager[e]=r,{writable:!0,enumerable:!1,configurable:!0});function c(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}i.__instanceId=null,n.value=c.id=e,Object.defineProperty(i,"__pid",n),c.prototype=i,n.value=c,Object.defineProperty(c.prototype,"constructor",n),this.__getters__&&(c.__getters__=cc.clone(this.__getters__)),this.__setters__&&(c.__setters__=cc.clone(this.__setters__));for(var o=0,s=arguments.length;o<s;++o){var a,h=arguments[o];for(a in h){var l,_,u,d="function"==typeof h[a],p="function"==typeof r[a],f=m.test(h[a]);if(d&&p&&f?(n.value=function(i,n){return function(){var t=this._super,e=(this._super=r[i],n.apply(this,arguments));return this._super=t,e}}(a,h[a]),Object.defineProperty(i,a,n)):d?(n.value=h[a],Object.defineProperty(i,a,n)):i[a]=h[a],d){if(this.__getters__&&this.__getters__[a]){for(var g in u=this.__getters__[a],this.__setters__)if(this.__setters__[g]===u){_=g;break}cc.defineGetterSetter(i,u,h[a],h[_]||i[_],a,_)}if(this.__setters__&&this.__setters__[a]){for(var g in u=this.__setters__[a],this.__getters__)if(this.__getters__[g]===u){l=g;break}cc.defineGetterSetter(i,u,h[l]||i[l],h[a],l,a)}}}}return c.extend=cc.Class.extend,c.implement=function(t){for(var e in t)i[e]=t[e]},c}}(),cc.defineGetterSetter=function(t,e,i,n,r,c){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={enumerable:!1,configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}if(!r&&!c)for(var s=null!=i,a=null!=n,h=Object.getOwnPropertyNames(t),l=0;l<h.length;l++){var _=h[l];if((t.__lookupGetter__?!t.__lookupGetter__(_):!Object.getOwnPropertyDescriptor(t,_))&&"function"==typeof t[_]){var u=t[_];if(s&&u===i&&(r=_,!a||c))break;if(a&&u===n&&(c=_,!s||r))break}}o=t.constructor;r&&(o.__getters__||(o.__getters__={}),o.__getters__[r]=e),c&&(o.__setters__||(o.__setters__={}),o.__setters__[c]=e)},cc.clone=function(t){var e,i=t.constructor?new t.constructor:{};for(e in t){var n=t[e];"object"!=typeof n||!n||n instanceof cc.Node||n instanceof HTMLElement?i[e]=n:i[e]=cc.clone(n)}return i},cc.inject=function(t,e){for(var i in t)e[i]=t[i]},cc.Point=function(t,e){this.x=t||0,this.y=e||0},cc.p=function(t,e){return void 0===t?{x:0,y:0}:void 0===e?{x:t.x,y:t.y}:{x:t,y:e}},cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},cc.Size=function(t,e){this.width=t||0,this.height=e||0},cc.size=function(t,e){return void 0===t?{width:0,height:0}:void 0===e?{width:t.width,height:t.height}:{width:t,height:e}},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Rect=function(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0},cc.rect=function(t,e,i,n){return void 0===t?{x:0,y:0,width:0,height:0}:void 0===e?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:t,y:e,width:i,height:n}},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e||t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,c=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||c<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},cc._txtLoader={load:function(t,e,i,n){cc.loader.loadTxt(t,n)}},cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader),cc._jsonLoader={load:function(t,e,i,n){cc.loader.loadJson(t,n)}},cc.loader.register(["json","ExportJson"],cc._jsonLoader),cc._jsLoader={load:function(t,e,i,n){cc.loader.loadJs(t,n)}},cc.loader.register(["js"],cc._jsLoader),cc._imgLoader={load:function(t,i,e,n){var r=cc.loader.isLoading(t)?function(t,e){if(t)return n(t);t=cc.textureCache.getTextureForKey(i)||cc.textureCache.handleLoadedTexture(i,e);n(null,t)}:function(t,e){if(t)return n(t);t=cc.textureCache.handleLoadedTexture(i,e);n(null,t)};cc.loader.loadImg(t,r)}},cc.loader.register(["png","jpg","bmp","jpeg","gif","ico","tiff","webp"],cc._imgLoader),cc._fontLoader={},cc._binaryLoader={load:function(t,e,i,n){cc.loader.loadBinary(t,n)}},window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.13",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.DIRECTOR_FPS_INTERVAL_LONG=30,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.$=function(t){var e=this===cc?document:this,e=t instanceof HTMLElement?t:e.querySelector(t);return e&&(e.find=e.find||cc.$,e.hasClass=e.hasClass||function(t){return this.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},e.addClass=e.addClass||function(t){return this.hasClass(t)||(this.className&&(this.className+=" "),this.className+=t),this},e.removeClass=e.removeClass||function(t){return this.hasClass(t)&&(this.className=this.className.replace(t,"")),this},e.remove=e.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},e.appendTo=e.appendTo||function(t){return t.appendChild(this),this},e.prependTo=e.prependTo||function(t){return t.childNodes[0]?t.insertBefore(this,t.childNodes[0]):t.appendChild(this),this},e.transforms=e.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},e.position=e.position||{x:0,y:0},e.rotation=e.rotation||0,e.scale=e.scale||{x:1,y:1},e.skew=e.skew||{x:0,y:0},e.translates=function(t,e){return this.position.x=t,this.position.y=e,this.transforms(),this},e.rotate=function(t){return this.rotation=t,this.transforms(),this},e.resize=function(t,e){return this.scale.x=t,this.scale.y=e,this.transforms(),this},e.setSkew=function(t,e){return this.skew.x=t,this.skew.y=e,this.transforms(),this}),e},cc.$.pfx="webkit",cc.$.hd=!0,cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(t){return"translate3d("+t.x+"px, "+t.y+"px, 0) "}:function(t){return"translate("+t.x+"px, "+t.y+"px) "},cc.$.rotate=cc.$.hd?function(t){return"rotateZ("+t+"deg) "}:function(t){return"rotate("+t+"deg) "},cc.$.scale=function(t){return"scale("+t.x+", "+t.y+") "},cc.$.skew=function(t){return"skewX("+-t.x+"deg) skewY("+t.y+"deg)"},cc.$new=function(t){return cc.$(document.createElement(t))},cc.$.findpos=function(t){for(var e=0,i=0;e+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;);return{x:e,y:i}},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.FLT_MIN=parseFloat("1.175494351e-38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.swap=function(t,e,i){var n;!cc.isObject(i)||cc.isUndefined(i.x)||cc.isUndefined(i.y)?cc.log(cc._LogInfos.swap):(n=i[t],i[t]=i[e],i[e]=n)},cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.RAD},cc.radiansToDegrees=function(t){return t*cc.DEG},cc.radiansToDegress=function(t){return cc.log(cc._LogInfos.radiansToDegress),t*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.enableDefaultGLStates=function(){},cc.disableDefaultGLStates=function(){},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.FLT_EPSILON=1.192092896e-7,cc.contentScaleFactor=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.director.getContentScaleFactor()}:function(){return 1},cc.pointPointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.p(t.x*e,t.y*e)},cc.pointPixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.p(t.x/e,t.y/e)},cc._pointPixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.x=t.x/i,e.y=t.y/i},cc.sizePointsToPixels=function(t){var e=cc.contentScaleFactor();return cc.size(t.width*e,t.height*e)},cc.sizePixelsToPoints=function(t){var e=cc.contentScaleFactor();return cc.size(t.width/e,t.height/e)},cc._sizePixelsToPointsOut=function(t,e){var i=cc.contentScaleFactor();e.width=t.width/i,e.height=t.height/i},cc.rectPixelsToPoints=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x/e,t.y/e,t.width/e,t.height/e)}:function(t){return t},cc.rectPointsToPixels=cc.IS_RETINA_DISPLAY_SUPPORTED?function(t){var e=cc.contentScaleFactor();return cc.rect(t.x*e,t.y*e,t.width*e,t.height*e)}:function(t){return t},cc.ONE=1,cc.ZERO=0,cc.SRC_ALPHA=770,cc.SRC_ALPHA_SATURATE=776,cc.SRC_COLOR=768,cc.DST_ALPHA=772,cc.DST_COLOR=774,cc.ONE_MINUS_SRC_ALPHA=771,cc.ONE_MINUS_SRC_COLOR=769,cc.ONE_MINUS_DST_ALPHA=773,cc.ONE_MINUS_DST_COLOR=775,cc.ONE_MINUS_CONSTANT_ALPHA=32772,cc.ONE_MINUS_CONSTANT_COLOR=32770,cc.LINEAR=9729,cc.REPEAT=10497,cc.CLAMP_TO_EDGE=33071,cc.MIRRORED_REPEAT=33648,cc.BLEND_SRC=cc.SRC_ALPHA,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)}),cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA,cc.checkGLErrorDebug=function(){var t;cc.renderMode===cc.game.RENDER_TYPE_WEBGL&&(t=cc._renderContext.getError())&&cc.log(cc._LogInfos.checkGLErrorDebug,t)},cc.ORIENTATION_PORTRAIT=1,cc.ORIENTATION_LANDSCAPE=2,cc.ORIENTATION_AUTO=3,cc.CONCURRENCY_HTTP_REQUEST_COUNT=cc.sys.isMobile?8:0,cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=7,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix",cc.ITEM_SIZE=32,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.arrayVerifyType=function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.log("element type is wrong!"),!1;return!0},cc.arrayRemoveObject=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e){t.splice(i,1);break}},cc.arrayRemoveArray=function(t,e){for(var i=0,n=e.length;i<n;i++)cc.arrayRemoveObject(t,e[i])},cc.arrayAppendObjectsToIndex=function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},cc.copyArray=function(t){for(var e=t.length,i=new Array(e),n=0;n<e;n+=1)i[n]=t[n];return i},cc._tmp.PrototypeColor=function(){var t=cc.color;t._getWhite=function(){return t(255,255,255)},t._getYellow=function(){return t(255,255,0)},t._getBlue=function(){return t(0,0,255)},t._getGreen=function(){return t(0,255,0)},t._getRed=function(){return t(255,0,0)},t._getMagenta=function(){return t(255,0,255)},t._getBlack=function(){return t(0,0,0)},t._getOrange=function(){return t(255,127,0)},t._getGray=function(){return t(166,166,166)},t.WHITE,cc.defineGetterSetter(t,"WHITE",t._getWhite),t.YELLOW,cc.defineGetterSetter(t,"YELLOW",t._getYellow),t.BLUE,cc.defineGetterSetter(t,"BLUE",t._getBlue),t.GREEN,cc.defineGetterSetter(t,"GREEN",t._getGreen),t.RED,cc.defineGetterSetter(t,"RED",t._getRed),t.MAGENTA,cc.defineGetterSetter(t,"MAGENTA",t._getMagenta),t.BLACK,cc.defineGetterSetter(t,"BLACK",t._getBlack),t.ORANGE,cc.defineGetterSetter(t,"ORANGE",t._getOrange),t.GRAY,cc.defineGetterSetter(t,"GRAY",t._getGray),cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)},cc.BlendFunc.DISABLE,cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive)},(cc=cc||{})._tmp=cc._tmp||{},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc._WebGLColor=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc._WebGLColor.BYTES_PER_ELEMENT),this._offset=c||0;r=this._arrayBuffer,c=this._offset;this._view=new Uint8Array(r,c,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,this._view[3]=null==n?255:n,void 0===n&&(this.a_undefined=!0)},cc._WebGLColor.BYTES_PER_ELEMENT=4,(_p=cc._WebGLColor.prototype)._getR=function(){return this._view[0]},_p._setR=function(t){this._view[0]=t<0?0:t},_p._getG=function(){return this._view[1]},_p._setG=function(t){this._view[1]=t<0?0:t},_p._getB=function(){return this._view[2]},_p._setB=function(t){this._view[2]=t<0?0:t},_p._getA=function(){return this._view[3]},_p._setA=function(t){this._view[3]=t<0?0:t},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),cc._tmp.PrototypeColor(),delete cc._tmp.PrototypeColor)}),cc.Color=function(t,e,i,n){this._val=((t=t||0)<<24>>>0)+((e=e||0)<<16)+((i=i||0)<<8)+(n="number"==typeof n?n:255)};(_p=cc.Color.prototype)._getR=function(){return(4278190080&this._val)>>>24},_p._setR=function(t){this._val=16777215&this._val|t<<24>>>0},_p._getG=function(){return(16711680&this._val)>>16},_p._setG=function(t){this._val=4278255615&this._val|t<<16},_p._getB=function(){return(65280&this._val)>>8},_p._setB=function(t){this._val=4294902015&this._val|t<<8},_p._getA=function(){return 255&this._val},_p._setA=function(t){this._val=4294967040&this._val|t},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),cc.color=function(t,e,i,n){return void 0===t?new cc.Color(0,0,0,255):"object"==typeof t?new cc.Color(t.r,t.g,t.b,null==t.a?255:t.a):"string"==typeof t?cc.hexToColor(t):new cc.Color(t,e,i,null==n?255:n)},cc.colorEqual=function(t,e){return t._val===e._val},cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,(_p=cc.Vertex2F.prototype)._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;n=this._arrayBuffer,r=this._offset;this._view=new Float32Array(n,r,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,(_p=cc.Vertex3F.prototype)._getX=function(){return this._view[0]},_p._setX=function(t){this._view[0]=t},_p._getY=function(){return this._view[1]},_p._setY=function(t){this._view[1]=t},_p._getZ=function(){return this._view[2]},_p._setZ=function(t){this._view[2]=t},_p.x,cc.defineGetterSetter(_p,"x",_p._getX,_p._setX),_p.y,cc.defineGetterSetter(_p,"y",_p._getY,_p._setY),_p.z,cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,(_p=cc.Tex2F.prototype)._getU=function(){return this._view[0]},_p._setU=function(t){this._view[0]=t},_p._getV=function(){return this._view[1]},_p._setV=function(t){this._view[1]=t},_p.u,cc.defineGetterSetter(_p,"u",_p._getU,_p._setU),_p.v,cc.defineGetterSetter(_p,"v",_p._getV,_p._setV),cc.Quad2=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=c||0;var r=this._arrayBuffer,c=this._offset,o=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,r,c):new cc.Vertex2F(0,0,r,c),c+=o,this._tr=e?new cc.Vertex2F(e.x,e.y,r,c):new cc.Vertex2F(0,0,r,c),c+=o,this._bl=i?new cc.Vertex2F(i.x,i.y,r,c):new cc.Vertex2F(0,0,r,c),c+=o,this._br=n?new cc.Vertex2F(n.x,n.y,r,c):new cc.Vertex2F(0,0,r,c)},cc.Quad2.BYTES_PER_ELEMENT=32,(_p=cc.Quad2.prototype)._getTL=function(){return this._tl},_p._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},_p._getTR=function(){return this._tr},_p._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},_p._getBL=function(){return this._bl},_p._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},_p._getBR=function(){return this._br},_p._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),cc.Quad3=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=c||0;var r=this._arrayBuffer,c=this._offset,o=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=t?new cc.Vertex3F(t.x,t.y,t.z,r,c):new cc.Vertex3F(0,0,0,r,c),c+=o,this.br=e?new cc.Vertex3F(e.x,e.y,e.z,r,c):new cc.Vertex3F(0,0,0,r,c),c+=o,this.tl=i?new cc.Vertex3F(i.x,i.y,i.z,r,c):new cc.Vertex3F(0,0,0,r,c),c+=o,this.tr=n?new cc.Vertex3F(n.x,n.y,n.z,r,c):new cc.Vertex3F(0,0,0,r,c)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;n=this._arrayBuffer,r=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,n,r):new cc.Vertex3F(0,0,0,n,r),r+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc._WebGLColor(e.r,e.g,e.b,e.a,n,r):new cc._WebGLColor(0,0,0,0,n,r),r+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r):new cc.Tex2F(0,0,n,r)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,(_p=cc.V3F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},_p._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,c){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=c||0;var r=this._arrayBuffer,c=this._offset,o=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,r,c):new cc.V3F_C4B_T2F(null,null,null,r,c),c+=o,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,r,c):new cc.V3F_C4B_T2F(null,null,null,r,c),c+=o,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,r,c):new cc.V3F_C4B_T2F(null,null,null,r,c),c+=o,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,r,c):new cc.V3F_C4B_T2F(null,null,null,r,c)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,(_p=cc.V3F_C4B_T2F_Quad.prototype)._getTL=function(){return this._tl},_p._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBL=function(){return this._bl},_p._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getTR=function(){return this._tr},_p._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getBR=function(){return this._br},_p._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getArrayBuffer=function(){return this._arrayBuffer},_p.tl,cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL),_p.tr,cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR),_p.bl,cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL),_p.br,cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR),_p.arrayBuffer,cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){var e,i,n;return t?(e=t.tl,i=t.bl,n=t.tr,t=t.br,{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:t.vertices.x,y:t.vertices.y,z:t.vertices.z},colors:{r:t.colors.r,g:t.colors.g,b:t.colors.b,a:t.colors.a},texCoords:{u:t.texCoords.u,v:t.texCoords.v}}}):cc.V3F_C4B_T2F_QuadZero()},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;n=this._arrayBuffer,r=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,n,r):new cc.Vertex2F(0,0,n,r),r+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc._WebGLColor(e.r,e.g,e.b,e.a,n,r):new cc._WebGLColor(0,0,0,0,n,r),r+=cc._WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,n,r):new cc.Tex2F(0,0,n,r)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,(_p=cc.V2F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},_p._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},_p._getColor=function(){return this._colors},_p._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},_p._getTexCoords=function(){return this._texCoords},_p._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},_p.vertices,cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices),_p.colors,cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor),_p.texCoords,cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var n=this._arrayBuffer,r=this._offset,c=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r),r+=c,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r),r+=c,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,n,r):new cc.V2F_C4B_T2F(null,null,null,n,r)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,(_p=cc.V2F_C4B_T2F_Triangle.prototype)._getA=function(){return this._a},_p._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getB=function(){return this._b},_p._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p._getC=function(){return this._c},_p._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},_p.a,cc.defineGetterSetter(_p,"a",_p._getA,_p._setA),_p.b,cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),_p.c,cc.defineGetterSetter(_p,"c",_p._getC,_p._setC),cc.vertex2=function(t,e){return new cc.Vertex2F(t,e)},cc.vertex3=function(t,e,i){return new cc.Vertex3F(t,e,i)},cc.tex2=function(t,e){return new cc.Tex2F(t,e)},cc.BlendFunc=function(t,e){this.src=t,this.dst=e},cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");t=parseInt(t);return new cc.Color(t>>16,(t>>8)%256,t%256)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc.FontDefinition=function(t){var e=this;if(e.fontName="Arial",e.fontSize=12,e.textAlign=cc.TEXT_ALIGNMENT_CENTER,e.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP,e.fillStyle=cc.color(255,255,255,255),e.boundingWidth=0,e.boundingHeight=0,e.strokeEnabled=!1,e.strokeStyle=cc.color(255,255,255,255),e.lineWidth=1,e.lineHeight="normal",e.fontStyle="normal",e.fontWeight="normal",e.shadowEnabled=!1,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowOpacity=1,t&&t instanceof Object)for(var i in t)e[i]=t[i]},cc.FontDefinition.prototype._getCanvasFontStr=function(){this.lineHeight.charAt,this.lineHeight;return this.fontStyle+" "+this.fontWeight+" "+this.fontSize*cc.view.getDevicePixelRatio()+"px '"+this.fontName+"'"},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){}),cc.Touches=[],cc.TouchesIntergerDict={},cc.DENSITYDPI_DEVICE="device-dpi",cc.DENSITYDPI_HIGH="high-dpi",cc.DENSITYDPI_MEDIUM="medium-dpi",cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){cc.sys.platform!==cc.sys.WECHAT_GAME&&(this.html=document.getElementsByTagName("html")[0])},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(window.wx&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_WECHAT_GAME),__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:__BrowserGetter.availWidth=function(t){return t.clientWidth},__BrowserGetter.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME:__BrowserGetter.availWidth=function(){return window.innerWidth},__BrowserGetter.availHeight=function(){return window.innerHeight}}{var _currBuffers,_scissorRect=cc.rect();cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var t=this,e=document,i=cc.ContainerStrategy,n=cc.ContentStrategy,e=(__BrowserGetter.init(this),t._frame=cc.container.parentNode===e.body?e.documentElement:cc.container.parentNode,t._frameSize=cc.size(0,0),t._initFrameSize(),cc._canvas.width),r=cc._canvas.height;t._designResolutionSize=cc.size(e,r),t._originalDesignResolutionSize=cc.size(e,r),t._viewPortRect=cc.rect(0,0,e,r),t._visibleRect=cc.rect(0,0,e,r),t._contentTranslateLeftTop={left:0,top:0},t._viewName="Cocos2dHTML5",cc.sys;cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._rpExactFit=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(i.PROPORTION_TO_FRAME,n.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(i.EQUAL_TO_FRAME,n.FIXED_WIDTH),t._targetDensityDPI=cc.DENSITYDPI_HIGH},_resizeEvent:function(){var t=this.setDesignResolutionSize?this:cc.view,e=t._frameSize.width,i=t._frameSize.height,n=t._isRotated;t._initFrameSize(),t._isRotated===n&&t._frameSize.width===e&&t._frameSize.height===i||(t._resizeCallback&&t._resizeCallback.call(),n=t._originalDesignResolutionSize.width,e=t._originalDesignResolutionSize.height,0<n&&t.setDesignResolutionSize(n,e,t._resolutionPolicy))},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._resizeEvent)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._resizeEvent))},setResizeCallback:function(t){!cc.isFunction(t)&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){(t&=cc.ORIENTATION_AUTO)&&(this._orientation=t)},_initFrameSize:function(){var t=this._frameSize,e=__BrowserGetter.availWidth(this._frame),i=__BrowserGetter.availHeight(this._frame),n=i<=e;!cc.sys.isMobile||n&&this._orientation&cc.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;0<t&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){if(cc.sys.platform!==cc.sys.WECHAT_GAME){var i,n,r=document.getElementById("cocosMetaElement"),c=(r&&e&&document.head.removeChild(r),document.getElementsByName("viewport")),c=c?c[0]:null,o=c&&c.content?c.content:"";for(i in(r=r||document.createElement("meta")).id="cocosMetaElement",r.name="viewport",r.content="",t)-1==o.indexOf(i)?o+=","+i+"="+t[i]:e&&(n=new RegExp(i+"s*=s*[^,]+"),o.replace(n,i+"="+t[i]));/^,/.test(o)&&(o=o.substr(1)),r.content=o,c&&(c.content=o),document.head.appendChild(r)}},_adjustViewportMeta:function(){this._isAdjustViewPort&&cc.sys.platform!==cc.sys.WECHAT_GAME&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var t=cc.contentScaleFactor();this._scaleX=t,this._scaleY=t},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},end:function(){},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,this.centerWindow(),cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(t){},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,this._frame.style.width=t+"px",this._frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},centerWindow:function(){},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e,i=this;t instanceof cc.ResolutionPolicy?i._resolutionPolicy=t:(t===(e=cc.ResolutionPolicy).EXACT_FIT&&(i._resolutionPolicy=i._rpExactFit),t===e.SHOW_ALL&&(i._resolutionPolicy=i._rpShowAll),t===e.NO_BORDER&&(i._resolutionPolicy=i._rpNoBorder),t===e.FIXED_HEIGHT&&(i._resolutionPolicy=i._rpFixedHeight),t===e.FIXED_WIDTH&&(i._resolutionPolicy=i._rpFixedWidth))},setDesignResolutionSize:function(t,e,i){var n;0<t||0<e?(this.setResolutionPolicy(i),(i=this._resolutionPolicy)?(i.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._initFrameSize(),this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e,(t=i.apply(this,this._designResolutionSize)).scale&&2===t.scale.length&&(this._scaleX=t.scale[0],this._scaleY=t.scale[1]),t.viewport&&(e=this._viewPortRect,n=this._visibleRect,t=t.viewport,e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,n.x=-e.x/this._scaleX,n.y=-e.y/this._scaleY,n.width=cc._canvas.width/this._scaleX,n.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset)&&cc._renderContext.setOffset(e.x,-e.y),(t=cc.director)._winSizeInPoints.width=this._designResolutionSize.width,t._winSizeInPoints.height=this._designResolutionSize.height,i.postApply(this),cc.winSize.width=t._winSizeInPoints.width,cc.winSize.height=t._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL&&t.setGLDefaultValues(),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.visibleRect&&cc.visibleRect.init(this._visibleRect)):cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2)):cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){cc.sys.platform!==cc.sys.WECHAT_GAME&&(this._setViewportMeta({width:t,"target-densitydpi":cc.DENSITYDPI_DEVICE},!0),document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px"),this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,c=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*c*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*c*r,n*o*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,c=this._scaleX,o=this._scaleY;_scissorRect.x=t,_scissorRect.y=e,_scissorRect.width=i,_scissorRect.height=n,cc._renderContext.scissor(t*c*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*c*r,n*o*r)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){return cc.rect(_scissorRect)},setViewName:function(t){null!=t&&0<t.length&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){t=this._devicePixelRatio*(t-i.left),i=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?{x:this._viewPortRect.width-i,y:t}:{x:t,y:i}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n=this._viewPortRect,r=this._scaleX,c=this._scaleY,o=0;o<t.length;o++)e=(i=t[o])._point,i=i._prevPoint,e.x=(e.x-n.x)/r,e.y=(e.y-n.y)/c,i.x=(i.x-n.x)/r,i.y=(i.y-n.y)/c}}),cc.EGLView._getInstance=function(){return this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container,r=(cc.sys.platform!==cc.sys.WECHAT_GAME&&(cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px"),t._devicePixelRatio=1);t.isRetinaEnabled()&&(r=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*r,n.height=i*r,cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style,t=(t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden",cc.container.style);t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,c){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);t=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return this._result.scale=[r,c],this._result.viewport=t,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),!function(){var t=cc.ContainerStrategy.extend({apply:function(t){var e=t._frameSize.height,i=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.marginLeft=e+"px":i.margin="0px"}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i=t._frameSize.width,n=t._frameSize.height,r=cc.container.style,c=e.width,e=e.height,o=i/c,s=n/e,e=o<s?(a=i,e*o):(a=c*s,n),o=Math.round((i-a)/2),c=Math.round((n-e)/2),a=i-2*o;this._setupContainer(t,a,e=n-2*c),t._isRotated?r.marginLeft=n+"px":r.margin="0px",r.paddingLeft=o+"px",r.paddingRight=o+"px",r.paddingTop=c+"px",r.paddingBottom=c+"px"}}),i=(t.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),t._frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc._canvas.width,cc._canvas.height)}})),t=(cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i,cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,r=i/e.width,e=n/e.height;return this._buildResult(i,n,i,n,r,e)}})),e=cc.ContentStrategy.extend({apply:function(t,e){var i,n=cc._canvas.width,r=cc._canvas.height,c=e.width,e=e.height,o=n/c,s=r/e,a=0,e=o<s?(i=n,e*(a=o)):(i=c*(a=s),r);return this._buildResult(n,r,i,e,a,a)}}),i=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc._canvas.width,c=cc._canvas.height,o=e.width,e=e.height,s=r/o,a=c/e,o=s<a?(n=o*(i=a),c):(n=r,e*(i=s));return this._buildResult(r,c,n,o,i,i)}}),n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,e=n/e.height;return this._buildResult(i,n,i,n,e,e)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i=cc._canvas.width,n=cc._canvas.height,e=i/e.width;return this._buildResult(i,n,i,n,e,e)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new t,cc.ContentStrategy.SHOW_ALL=new e,cc.ContentStrategy.NO_BORDER=new i,cc.ContentStrategy.FIXED_HEIGHT=new n,cc.ContentStrategy.FIXED_WIDTH=new r}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i=this._fnMap,n=0;for(l=i.length;n<l;n++)if((t=i[n])&&t[1]in document){for(n=0,e=t.length;n<e;n++)this._fn[i[0][n]]=t[n];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,e){var i;if(this._supportsFullScreen)return t=t||document.documentElement,e&&(i=this._fn.fullscreenchange,this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)),t[this._fn.requestFullscreen]()},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(e,i){e=e||document.body;var n=cc.game.canvas||e,r=this;this.requestFullScreen(e,i),n.addEventListener(this._touchEvent,function t(){n.removeEventListener(r._touchEvent,t),r.requestFullScreen(e,i)})}},cc.screen.init(),cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,t=t.y,r=t+i,c=n+e;this.topLeft.x=n,this.topLeft.y=r,this.topRight.x=c,this.topRight.y=r,this.top.x=n+e/2,this.top.y=r,this.bottomLeft.x=n,this.bottomLeft.y=t,this.bottomRight.x=c,this.bottomRight.y=t,this.bottom.x=n+e/2,this.bottom.y=t,this.center.x=n+e/2,this.center.y=t+i/2,this.left.x=n,this.left.y=t+i/2,this.right.x=c,this.right.y=t+i/2}},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.inputManager={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=0;e<this._maxTouches;e++){if(!(1&t))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(t){t<0||t>=this._maxTouches||(this._indexBitsUsed&=~(1<<t))},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r,c,o=[],s=this._touchesIntegerDict,a=0,h=t.length;a<h;a++)null==s[r=(n=t[a]).getID()]&&(-1===(i=this._getUnUsedIndex())?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,i):((e=this._touches[i]=new cc.Touch(n._point.x,n._point.y,n.getID()))._setPrevPoint(n._prevPoint),s[r]=i,o.push(e)));0<o.length&&(this._glView._convertTouchesWithScale(o),(c=new cc.EventTouch(o))._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(c))},handleTouchesMove:function(t){for(var e,i,n,r=[],c=this._touches,o=0,s=t.length;o<s;o++)i=(e=t[o]).getID(),null!=(i=this._touchesIntegerDict[i])&&c[i]&&(c[i]._setPoint(e._point),c[i]._setPrevPoint(e._prevPoint),r.push(c[i]));0<r.length&&(this._glView._convertTouchesWithScale(r),(n=new cc.EventTouch(r))._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(n))},handleTouchesEnd:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.EventTouch(t))._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(t))},handleTouchesCancel:function(t){var t=this.getSetOfTouchesEndOrCancel(t);0<t.length&&(this._glView._convertTouchesWithScale(t),(t=new cc.EventTouch(t))._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(t))},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],c=this._touches,o=this._touchesIntegerDict,s=0,a=t.length;s<a;s++)null!=(i=o[n=(e=t[s]).getID()])&&c[i]&&(c[i]._setPoint(e._point),c[i]._setPrevPoint(e._prevPoint),r.push(c[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getHTMLElementPosition:function(t){var e,i,n;return cc.sys.platform===cc.sys.WECHAT_GAME?{left:0,top:0,width:window.innerWidth,height:window.innerHeight}:(e=document.documentElement,i=window,n=null,{left:(n=cc.isFunction(t.getBoundingClientRect)?t.getBoundingClientRect():{left:0,top:0,width:parseInt(t.style.width),height:parseInt(t.style.height)}).left+i.pageXOffset-e.clientLeft,top:n.top+i.pageYOffset-e.clientTop,width:n.width,height:n.height})},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e=e||t},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,t=this._glView.convertToLocationInView(t,e,i),e=new cc.Touch(t.x,t.y);return e._setPrevPoint(n.x,n.y),n.x=t.x,n.y=t.y,e},getMouseEvent:function(t,e,i){var n=this._prevMousePoint,e=(this._glView._convertMouseToLocationInView(t,e),new cc.EventMouse(i));return e.setLocation(t.x,t.y),e._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,e},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(sys.platform===sys.WECHAT_GAME?(e.left=0,e.top=0):(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop),{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,c=[],o=this._glView,s=this._preTouchPoint,a=t.changedTouches.length,h=0;h<a;h++)(r=t.changedTouches[h])&&(n=o.convertToLocationInView(r.clientX,r.clientY,e),null!=r.identifier?(i=new cc.Touch(n.x,n.y,r.identifier),r=this.getPreTouch(i).getLocation(),i._setPrevPoint(r.x,r.y),this.setPreTouch(i)):(i=new cc.Touch(n.x,n.y))._setPrevPoint(s.x,s.y),s.x=n.x,s.y=n.y,c.push(i));return c},registerSystemEvent:function(n){var r,t,e,c;this._isRegisterEvent||(this._glView=cc.view,r=this,t="mouse"in cc.sys.capabilities,e="touches"in cc.sys.capabilities,c=!1,cc.sys.isMobile&&(c=!0),(t=cc.sys.platform===cc.sys.WECHAT_GAME?!(e=!(c=!1)):t)&&(window.addEventListener("mousedown",function(){r._mousePressed=!0},!1),window.addEventListener("mouseup",function(t){var e,i;c||(e=r._mousePressed,r._mousePressed=!1,e&&(e=r.getHTMLElementPosition(n),i=r.getPointByEvent(t,e),cc.rectContainsPoint(new cc.Rect(e.left,e.top,e.width,e.height),i)||(r.handleTouchesEnd([r.getTouchByXY(i.x,i.y,e)]),(i=r.getMouseEvent(i,e,cc.EventMouse.UP)).setButton(t.button),cc.eventManager.dispatchEvent(i))))},!1),n.addEventListener("mousedown",function(t){var e,i;c||(r._mousePressed=!0,e=r.getHTMLElementPosition(n),i=r.getPointByEvent(t,e),r.handleTouchesBegin([r.getTouchByXY(i.x,i.y,e)]),(i=r.getMouseEvent(i,e,cc.EventMouse.DOWN)).setButton(t.button),cc.eventManager.dispatchEvent(i),t.stopPropagation(),t.preventDefault(),n.focus())},!1),n.addEventListener("mouseup",function(t){var e,i;c||(r._mousePressed=!1,e=r.getHTMLElementPosition(n),i=r.getPointByEvent(t,e),r.handleTouchesEnd([r.getTouchByXY(i.x,i.y,e)]),(i=r.getMouseEvent(i,e,cc.EventMouse.UP)).setButton(t.button),cc.eventManager.dispatchEvent(i),t.stopPropagation(),t.preventDefault())},!1),n.addEventListener("mousemove",function(t){var e,i;c||(e=r.getHTMLElementPosition(n),i=r.getPointByEvent(t,e),r.handleTouchesMove([r.getTouchByXY(i.x,i.y,e)]),i=r.getMouseEvent(i,e,cc.EventMouse.MOVE),r._mousePressed?i.setButton(t.button):i.setButton(null),cc.eventManager.dispatchEvent(i),t.stopPropagation(),t.preventDefault())},!1)),e&&(n.addEventListener("touchstart",function(t){var e;t.changedTouches&&((e=r.getHTMLElementPosition(n)).left-=document.body.scrollLeft||0,e.top-=document.body.scrollTop||0,r.handleTouchesBegin(r.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault(),cc.sys.platform!==cc.sys.WECHAT_GAME)&&n.focus()},!1),n.addEventListener("touchmove",function(t){var e;t.changedTouches&&((e=r.getHTMLElementPosition(n)).left-=document.body.scrollLeft||0,e.top-=document.body.scrollTop||0,r.handleTouchesMove(r.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault())},!1),n.addEventListener("touchend",function(t){var e;t.changedTouches&&((e=r.getHTMLElementPosition(n)).left-=document.body.scrollLeft||0,e.top-=document.body.scrollTop||0,r.handleTouchesEnd(r.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault())},!1),n.addEventListener("touchcancel",function(t){var e;t.changedTouches&&((e=r.getHTMLElementPosition(n)).left-=document.body.scrollLeft||0,e.top-=document.body.scrollTop||0,r.handleTouchesCancel(r.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault())},!1)),this._registerKeyboardEvent(),this._isRegisterEvent=!0)},_registerKeyboardEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration))),this._accelCurTime+=t}},cc.AffineTransform=function(t,e,i,n,r,c){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=c},cc.affineTransformMake=function(t,e,i,n,r,c){return{a:t,b:e,c:i,d:n,tx:r,ty:c}},cc.pointApplyAffineTransform=function(t,e,i){var n,t=void 0===i?(i=e,n=t.x,t.y):(n=t,e);return{x:i.a*n+i.c*t+i.tx,y:i.b*n+i.d*t+i.ty}},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),t=cc.rectGetMaxY(t),c=cc.pointApplyAffineTransform(n,i,e),i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,t,e),r=cc.pointApplyAffineTransform(r,t,e),t=Math.min(c.x,i.x,n.x,r.x),e=Math.max(c.x,i.x,n.x,r.x),o=Math.min(c.y,i.y,n.y,r.y),c=Math.max(c.y,i.y,n.y,r.y);return cc.rect(t,o,e-t,c-o)},cc._rectApplyAffineTransformIn=function(t,e){var i=cc.rectGetMinY(t),n=cc.rectGetMinX(t),r=cc.rectGetMaxX(t),c=cc.rectGetMaxY(t),o=cc.pointApplyAffineTransform(n,i,e),i=cc.pointApplyAffineTransform(r,i,e),n=cc.pointApplyAffineTransform(n,c,e),r=cc.pointApplyAffineTransform(r,c,e),c=Math.min(o.x,i.x,n.x,r.x),e=Math.max(o.x,i.x,n.x,r.x),s=Math.min(o.y,i.y,n.y,r.y),o=Math.max(o.y,i.y,n.y,r.y);return t.x=c,t.y=s,t.width=e-c,t.height=o-s,t},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),e=Math.cos(e);return{a:t.a*e+t.c*i,b:t.b*e+t.d*i,c:t.c*e-t.a*i,d:t.d*e-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,c=t.d,o=t.tx,s=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+c*e.c,t.d=r*e.b+c*e.d,t.tx=o*e.a+s*e.c+e.tx,t.ty=o*e.b+s*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pRotate=function(t,e){return cc.p(t.x*e.x-t.y*e.y,t.x*e.y+t.y*e.x)},cc.pUnrotate=function(t,e){return cc.p(t.x*e.x+t.y*e.y,t.y*e.x-t.x*e.y)},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){var n;return i<e&&(n=e,e=i,i=n),t<e?e:t<i?t:i},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){t=cc.pNormalize(t),e=cc.pNormalize(e),t=Math.atan2(t.x*e.y-t.y*e.x,cc.pDot(t,e));return Math.abs(t)<cc.POINT_EPSILON?0:t},cc.pAngle=function(t,e){t=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(t)<cc.POINT_EPSILON?0:t},cc.pRotateByAngle=function(t,e,i){var t=cc.pSub(t,e),n=Math.cos(i),i=Math.sin(i),r=t.x;return t.x=r*n-t.y*i+e.x,t.y=r*i+t.y*n+e.y,t},cc.pLineIntersect=function(t,e,i,n,r){var c,o,s;return!(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y||(c=e.x-t.x,e=e.y-t.y,o=n.x-i.x,n=n.y-i.y,s=t.x-i.x,t=t.y-i.y,i=n*c-o*e,r.x=o*t-n*s,r.y=c*t-e*s,0==i?0!==r.x&&0!==r.y:(r.x=r.x/i,r.y=r.y/i,0)))},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&0<=r.x&&r.x<=1&&0<=r.y&&r.y<=1)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);return cc.pLineIntersect(t,e,i,n,r)?((i=cc.p(0,0)).x=t.x+r.x*(e.x-t.x),i.y=t.y+r.x*(e.y-t.y),i):cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&t.x===e.x&&t.y===e.y},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))},cc.Touch=cc.Class.extend({_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(t,e,i){this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){return cc.log("getId is deprecated. Please use getID instead."),this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.p(t.x,t.y):cc.p(t||0,e||0)}}),cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(t){this._currentTarget=t},ctor:function(t){this._type=t},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}}),cc.Event.TOUCH=0,cc.Event.KEYBOARD=1,cc.Event.ACCELERATION=2,cc.Event.MOUSE=3,cc.Event.FOCUS=4,cc.Event.CUSTOM=6,cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM),this._eventName=t},setUserData:function(t){this._userData=t},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}}),cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE),this._eventType=t},setScrollData:function(t,e){this._scrollX=t,this._scrollY=e},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(t,e){this._x=t,this._y=e},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},_setPrevCursor:function(t,e){this._prevX=t,this._prevY=e},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(t){this._button=t},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}}),cc.EventMouse.NONE=0,cc.EventMouse.DOWN=1,cc.EventMouse.UP=2,cc.EventMouse.MOVE=3,cc.EventMouse.SCROLL=4,cc.EventMouse.BUTTON_LEFT=0,cc.EventMouse.BUTTON_RIGHT=2,cc.EventMouse.BUTTON_MIDDLE=1,cc.EventMouse.BUTTON_4=3,cc.EventMouse.BUTTON_5=4,cc.EventMouse.BUTTON_6=5,cc.EventMouse.BUTTON_7=6,cc.EventMouse.BUTTON_8=7,cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(t){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH),this._touches=t||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(t){this._eventCode=t},_setTouches:function(t){this._touches=t}}),cc.EventTouch.MAX_TOUCHES=5,cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3},cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS),this._widgetGetFocus=e,this._widgetLoseFocus=t}}),cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||""},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.FOCUS=7,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e;var i=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,function(t){null!==i._onCustomEvent&&i._onCustomEvent(t)})},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerCustom.create=function(t,e){return new cc._EventListenerCustom(t,e)},cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){var i=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,function(t){var e=cc.EventMouse;switch(t._eventType){case e.DOWN:i.onMouseDown&&i.onMouseDown(t);break;case e.UP:i.onMouseUp&&i.onMouseUp(t);break;case e.MOVE:i.onMouseMove&&i.onMouseMove(t);break;case e.SCROLL:i.onMouseScroll&&i.onMouseScroll(t)}})},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse},cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne},cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce},cc.EventListener.create=function(t){cc.assert(t&&t.event,cc._LogInfos.EventListener_create);var e,i=t.event,n=(delete t.event,null);for(e in i===cc.EventListener.TOUCH_ONE_BY_ONE?n=new cc._EventListenerTouchOneByOne:i===cc.EventListener.TOUCH_ALL_AT_ONCE?n=new cc._EventListenerTouchAllAtOnce:i===cc.EventListener.MOUSE?n=new cc._EventListenerMouse:i===cc.EventListener.CUSTOM?(n=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):i===cc.EventListener.KEYBOARD?n=new cc._EventListenerKeyboard:i===cc.EventListener.ACCELERATION?(n=new cc._EventListenerAcceleration(t.callback),delete t.callback):i===cc.EventListener.FOCUS&&(n=new cc._EventListenerFocus),t)n[e]=t[e];return n},cc._EventListenerFocus=cc.EventListener.extend({}),cc._EventListenerFocus.LISTENER_ID="__cc_focus_event",cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){(0===t._getFixedPriority()?this._sceneGraphListeners:this._fixedListeners).push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),cc.__getListenerID=function(t){var e=cc.Event,i=t.getType();return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.CUSTOM?t.getEventName():i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i===e.MOUSE?cc._EventListenerMouse.LISTENER_ID:i===e.FOCUS?cc._EventListenerFocus.LISTENER_ID:(i===e.TOUCH&&cc.log(cc._LogInfos.__getListenerID),"")},cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,cc.game.EVENT_SHOW],_setDirtyForNode:function(t){null!=this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t);for(var e=t.getChildren(),i=0,n=e.length;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(i)for(r=0,c=i.length;r<c;r++)i[r]._setPaused(!0);if(!0===e)for(var n=t.getChildren(),r=0,c=n.length;r<c;r++)this.pauseTarget(n[r],!0)},resumeTarget:function(t,e){var i=this._nodeListenersMap[t.__instanceId];if(i)for(r=0,c=i.length;r<c;r++)i[r]._setPaused(!1);if(this._setDirtyForNode(t),!0===e)for(var n=t.getChildren(),r=0,c=n.length;r<c;r++)this.resumeTarget(n[r],!0)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];i||(i=new cc._EventListenerVector,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()?(this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY),null===(i=t._getSceneGraphPriority())&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(i,t),i.isRunning()&&this.resumeTarget(i)):this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,c=i.length;r<c;r++)if(t=n[i[r].__instanceId])for(var o=0,s=t.length;o<s;o++)(e=t[o])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,e):++i},_removeListenersForListenerID:function(t){for(var e,i,n,r=this._listenersMap[t],c=(r&&(e=r.getFixedPriorityListeners(),i=r.getSceneGraphPriorityListeners(),this._removeAllListenersInVector(i),this._removeAllListenersInVector(e),delete this._priorityDirtyFlagMap[t],this._inDispatch||(r.clear(),delete this._listenersMap[t])),this._toAddedListeners),o=0;o<c.length;)(n=c[o])&&n._getListenerID()===t?cc.arrayRemoveObject(c,n):++o},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;(e=i[t]?i[t]:e)!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)&&((e=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(t,e):i[t]=this.DIRTY_SCENE_GRAPH_PRIORITY)},_sortListenersOfSceneGraphPriority:function(t,e){var i,t=this._getListeners(t);t&&(i=t.getSceneGraphPriorityListeners())&&0!==i.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),t.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=cc.eventManager._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[e._getSceneGraphPriority().__instanceId]-i[t._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){t=this._listenersMap[t];if(t){var e=t.getFixedPriorityListeners();if(e&&0!==e.length){e.sort(this._sortListenersOfFixedPriorityAsc);for(var i=0,n=e.length;i<n&&!(0<=e[i]._getFixedPriority());)++i;t.gt0Index=i}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){t=this._listenersMap[t];if(t){var e,i,n,r=t.getFixedPriorityListeners(),c=t.getSceneGraphPriorityListeners(),o=this._toRemovedListeners;if(c)for(e=0;e<c.length;)(i=c[e])._isRegistered()?++e:(cc.arrayRemoveObject(c,i),-1!==(n=o.indexOf(i))&&o.splice(n,1));if(r)for(e=0;e<r.length;)(i=r[e])._isRegistered()?++e:(cc.arrayRemoveObject(r,i),-1!==(n=o.indexOf(i))&&o.splice(n,1));c&&0===c.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()}},_updateListeners:function(t){var e=this._inDispatch;if(cc.assert(0<e,cc._LogInfos.EventManager__updateListeners),!(1<e)){t.getType()===cc.Event.TOUCH?(this._onUpdateListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._onUpdateListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID)):this._onUpdateListeners(cc.__getListenerID(t)),cc.assert(1===e,cc._LogInfos.EventManager__updateListeners_2);var i,n=this._listenersMap,r=this._priorityDirtyFlagMap;for(i in n)n[i].empty()&&(delete r[i],delete n[i]);var c=this._toAddedListeners;if(0!==c.length){for(var o=0,s=c.length;o<s;o++)this._forceAddEventListener(c[o]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i,n,r=t[e],c=this._listenersMap[r._getListenerID()];c&&(n=c.getFixedPriorityListeners(),(c=c.getSceneGraphPriorityListeners())&&-1!==(i=c.indexOf(r))&&c.splice(i,1),n)&&-1!==(i=n.indexOf(r))&&n.splice(i,1)}t.length=0},_onTouchEventCallback:function(t,e){var i,n,r,c,o,s;return!(!t._isRegistered||(i=e.event,n=e.selTouch,i._setCurrentTarget(t._node),r=!1,(o=i.getEventCode())===(s=cc.EventTouch.EventCode).BEGAN?t.onTouchBegan&&(r=t.onTouchBegan(n,i))&&t._registered&&t._claimedTouches.push(n):0<t._claimedTouches.length&&-1!==(c=t._claimedTouches.indexOf(n))&&(r=!0,o===s.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):o===s.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(c,1)):o===s.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered)&&t._claimedTouches.splice(c,1)),i.isStopped()?(cc.eventManager._updateListeners(i),0):!(r&&t._registered&&t.swallowTouches)||(e.needsMutableSet&&e.touches.splice(n,1),0)))},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.copyArray(n),c={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)c.selTouch=n[o],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,c);i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateListeners(t)}},_onTouchesEventCallback:function(t,e){var i,n,r;return!!t._registered&&(i=cc.EventTouch.EventCode,n=e.event,e=e.touches,r=n.getEventCode(),n._setCurrentTarget(t._node),r===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(e,n):r===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(e,n):r===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(e,n):r===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(e,n),!!n.isStopped())&&(cc.eventManager._updateListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(this._nodeListenersMap[t.__instanceId]=i=[]),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.arrayRemoveObject(i,e),0===i.length)&&delete this._nodeListenersMap[t.__instanceId]},_dispatchEventToListeners:function(t,e,i){var n,r,c=!1,o=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),a=0;if(o&&0!==o.length)for(;a<t.gt0Index;++a)if((r=o[a]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}if(s&&!c)for(n=0;n<s.length;n++)if((r=s[n]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}if(o&&!c)for(;a<o.length;++a)if((r=o[a]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){c=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){var i,n=t.getChildren(),r=0,c=n.length,o=this._globalZOrderNodeMap,s=this._nodeListenersMap;if(0<c){for(;r<c&&((i=n[r])&&i.getLocalZOrder()<0);r++)this._visitTarget(i,!1);for(null!=s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));r<c;r++)(i=n[r])&&this._visitTarget(i,!1)}else null!=s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));if(e){var a,h=[];for(a in o)h.push(a);h.sort(this._sortNumberAsc);for(var l,_,u=h.length,d=this._nodePriorityMap,r=0;r<u;r++)for(l=o[h[r]],_=0;_<l.length;_++)d[l[_]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},addListener:function(t,e){if(cc.assert(t&&e,cc._LogInfos.eventManager_addListener_2),t instanceof cc.EventListener){if(t._isRegistered())return void cc.log(cc._LogInfos.eventManager_addListener_4)}else cc.assert(!cc.isNumber(e),cc._LogInfos.eventManager_addListener_3),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.isNumber(e)){if(0===e)return void cc.log(cc._LogInfos.eventManager_addListener);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0);return this._addListener(t),t}},addCustomListener:function(t,e){t=new cc._EventListenerCustom(t,e);return this.addListener(t,1),t},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(e in i){var n,r=i[e],c=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if((n=this._removeListenerInVector(o,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(n=this._removeListenerInVector(c,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[e]),n)break}if(!n)for(var s=this._toAddedListeners,a=0,h=s.length;a<h;a++){var l=s[a];if(l===t){cc.arrayRemoveObject(s,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null!=t)for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(t,r),!0}return!1},_removeListenerInVector:function(t,e){if(null!=t)for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(t,r):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){var i=this;if(t instanceof cc.Node){delete i._nodePriorityMap[t.__instanceId],cc.arrayRemoveObject(i._dirtyNodes,t);var n=i._nodeListenersMap[t.__instanceId];if(n){for(var r=cc.copyArray(n),c=0;c<r.length;c++)i.removeListener(r[c]);r.length=0}var o=i._toAddedListeners;for(c=0;c<o.length;){var s=o[c];s._getSceneGraphPriority()===t?(s._setSceneGraphPriority(null),s._setRegistered(!1),o.splice(c,1)):++c}if(!0===e){var a,h=t.getChildren();for(c=0,a=h.length;c<a;c++)i.removeListeners(h[c],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t,e=this._listenersMap,i=this._internalCustomListenerIDs;for(t in e)-1===i.indexOf(t)&&this._removeListenersForListenerID(t)},setPriority:function(t,e){if(null!=t){var i,n=this._listenersMap;for(i in n){var r=n[i].getFixedPriorityListeners();if(r)if(-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");var e;t.getType()===cc.Event.TOUCH?this._dispatchTouchEvent(t):(e=cc.__getListenerID(t),this._sortEventListeners(e),null!=(e=this._listenersMap[e])&&this._dispatchEventToListeners(e,this._onListenerCallback,t),this._updateListeners(t)),this._inDispatch--}},_onListenerCallback:function(t,e){return e._setCurrentTarget(t._getSceneGraphPriority()),t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){t=new cc.EventCustom(t);t.setUserData(e),this.dispatchEvent(t)}},cc._tmp.PrototypeCCNode=function(){var t=cc.Node.prototype;cc.defineGetterSetter(t,"x",t.getPositionX,t.setPositionX),cc.defineGetterSetter(t,"y",t.getPositionY,t.setPositionY),t.width,cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),t.height,cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight),t.anchorX,cc.defineGetterSetter(t,"anchorX",t._getAnchorX,t._setAnchorX),t.anchorY,cc.defineGetterSetter(t,"anchorY",t._getAnchorY,t._setAnchorY),t.skewX,cc.defineGetterSetter(t,"skewX",t.getSkewX,t.setSkewX),t.skewY,cc.defineGetterSetter(t,"skewY",t.getSkewY,t.setSkewY),t.zIndex,cc.defineGetterSetter(t,"zIndex",t.getLocalZOrder,t.setLocalZOrder),t.vertexZ,cc.defineGetterSetter(t,"vertexZ",t.getVertexZ,t.setVertexZ),t.rotation,cc.defineGetterSetter(t,"rotation",t.getRotation,t.setRotation),t.rotationX,cc.defineGetterSetter(t,"rotationX",t.getRotationX,t.setRotationX),t.rotationY,cc.defineGetterSetter(t,"rotationY",t.getRotationY,t.setRotationY),t.scale,cc.defineGetterSetter(t,"scale",t.getScale,t.setScale),t.scaleX,cc.defineGetterSetter(t,"scaleX",t.getScaleX,t.setScaleX),t.scaleY,cc.defineGetterSetter(t,"scaleY",t.getScaleY,t.setScaleY),t.children,cc.defineGetterSetter(t,"children",t.getChildren),t.childrenCount,cc.defineGetterSetter(t,"childrenCount",t.getChildrenCount),t.parent,cc.defineGetterSetter(t,"parent",t.getParent,t.setParent),t.visible,cc.defineGetterSetter(t,"visible",t.isVisible,t.setVisible),t.running,cc.defineGetterSetter(t,"running",t.isRunning),t.ignoreAnchor,cc.defineGetterSetter(t,"ignoreAnchor",t.isIgnoreAnchorPointForPosition,t.ignoreAnchorPointForPosition),t.tag,t.userData,t.userObject,t.arrivalOrder,t.actionManager,cc.defineGetterSetter(t,"actionManager",t.getActionManager,t.setActionManager),t.scheduler,cc.defineGetterSetter(t,"scheduler",t.getScheduler,t.setScheduler),t.shaderProgram,cc.defineGetterSetter(t,"shaderProgram",t.getShaderProgram,t.setShaderProgram),t.opacity,cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.opacityModifyRGB,cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB),t.cascadeOpacity,cc.defineGetterSetter(t,"cascadeOpacity",t.isCascadeOpacityEnabled,t.setCascadeOpacityEnabled),t.color,cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.cascadeColor,cc.defineGetterSetter(t,"cascadeColor",t.isCascadeColorEnabled,t.setCascadeColorEnabled)},cc.NODE_TAG_INVALID=-1,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,_shaderProgram:null,arrivalOrder:0,_actionManager:null,_scheduler:null,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){var t=this;t._anchorPoint=cc.p(0,0),t._contentSize=cc.size(0,0),t._position=cc.p(0,0),t._normalizedPosition=cc.p(0,0),t._children=[],t._additionalTransform=cc.affineTransformMakeIdentity(),cc.ComponentContainer&&(t._componentContainer=new cc.ComponentContainer(t)),this._realColor=cc.color(255,255,255,255),this._renderCmd=this._createRenderCmd()},init:function(){return!0},_arrayMakeObjectsPerformSelector:function(t,e){if(t&&0!==t.length){var i,n,r=t.length,c=cc.Node._stateCallbackType;switch(e){case c.onEnter:for(i=0;i<r;i++)(n=t[i])&&n.onEnter();break;case c.onExit:for(i=0;i<r;i++)(n=t[i])&&n.onExit();break;case c.onEnterTransitionDidFinish:for(i=0;i<r;i++)(n=t[i])&&n.onEnterTransitionDidFinish();break;case c.cleanup:for(i=0;i<r;i++)(n=t[i])&&n.cleanup();break;case c.updateTransform:for(i=0;i<r;i++)(n=t[i])&&n.updateTransform();break;case c.onExitTransitionDidStart:for(i=0;i<r;i++)(n=t[i])&&n.onExitTransitionDidStart();break;case c.sortAllChildren:for(i=0;i<r;i++)(n=t[i])&&n.sortAllChildren();break;default:cc.assert(0,cc._LogInfos.Node__arrayMakeObjectsPerformSelector)}}},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX!==t&&(this._skewX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY!==t&&(this._skewY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},setLocalZOrder:function(t){this._localZOrder!==t&&(this._localZOrder=t,this._parent&&this._parent.reorderChild(this,t),cc.eventManager._setDirtyForNode(this))},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return this.getLocalZOrder()},setZOrder:function(t){this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation),this._rotationX},setRotation:function(t){this._rotationX===t&&this._rotationY===t||(this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX!==t&&(this._rotationX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY!==t&&(this._rotationY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX},setScale:function(t,e){void 0===e&&(e=t),this._scaleX===t&&this._scaleY===e||(this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX!==t&&(this._scaleX=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY!==t&&(this._scaleY=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._usingNormalizedPosition=!1,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(t,e){var i=this._normalizedPosition;void 0===e?(i.x=t.x,i.y=t.y):(i.x=t,i.y=e),this._normalizedPositionDirty=this._usingNormalizedPosition=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x!==t&&(this._position.x=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y!==t&&(this._position.y=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(t){this.userData=t},getUserObject:function(){return this.userObject},setUserObject:function(t){this.userObject!==t&&(this.userObject=t)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(t){this.arrivalOrder=t},getActionManager:function(){return this._actionManager||cc.director.getActionManager()},setActionManager:function(t){this._actionManager!==t&&(this.stopAllActions(),this._actionManager=t)},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.log(cc._LogInfos.Node_boundingBox),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),cc.eventManager.removeListeners(this),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.cleanup)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(t){for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i]}else cc.log("Invalid name");return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?n=t._name:"string"==typeof i?(n=i,i=void 0):"number"==typeof i&&(r=!0,n=""),cc.assert(t,cc._LogInfos.Node_addChild_3),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival++),this._running&&(t.onEnter(),this._isTransitionFinished)&&t.onEnterTransitionDidFinish(),t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&this._parent.removeChild(this,t=void 0===t?!0:t)},removeFromParentAndCleanup:function(t){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),-1<this._children.indexOf(t)&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log(cc._LogInfos.Node_removeChildByTag_2,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n.onExitTransitionDidStart(),n.onExit()),t&&n.cleanup(),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.parent=null,t._renderCmd.detachFromParent(),cc.arrayRemoveObject(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Node_reorderChild),cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty)},sortAllChildren:function(){if(this._reorderChildDirty){for(var t,e,i=this._children,n=i.length,r=1;r<n;r++){for(e=i[r],t=r-1;0<=t&&(e._localZOrder<i[t]._localZOrder||e._localZOrder===i[t]._localZOrder&&e.arrivalOrder<i[t].arrivalOrder);)i[t+1]=i[t],t--;i[t+1]=e}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnter),this.resume()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pause(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.onExit),this.removeAllComponents()},runAction:function(t){return this.actionManager.addAction(t,this,!this._running),t},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(t){this.actionManager.removeAction(t)},stopActionByTag:function(t){t===cc.ACTION_TAG_INVALID?cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(t,this)},getActionByTag:function(t){return t===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(t,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var c=arguments.length;"function"==typeof t?1===c?(i=cc.REPEAT_FOREVER,n=e=0,r=this.__instanceId):2===c?"number"==typeof e?(i=cc.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,i=cc.REPEAT_FOREVER,n=e=0):3===c?("string"==typeof i?(r=i,i=cc.REPEAT_FOREVER):r=this.__instanceId,n=0):4===c&&(r=this.__instanceId):1===c?(i=cc.REPEAT_FOREVER,n=e=0):2===c&&(i=cc.REPEAT_FOREVER,n=0),cc.assert(t,cc._LogInfos.Node_schedule),cc.assert(0<=e,cc._LogInfos.Node_schedule_2),i=null==i?cc.REPEAT_FOREVER:i,this.scheduler.schedule(t,this,e=e||0,i,n=n||0,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions),this.resume()},resume:function(){this.scheduler.resumeTarget(this),this.actionManager&&this.actionManager.resumeTarget(this),cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions),this.pause()},pause:function(){this.scheduler.pauseTarget(this),this.actionManager&&this.actionManager.pauseTarget(this),cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(t){if(void 0===t)return this._additionalTransformDirty=!1;this._additionalTransform=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.p(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.p(0,0);t=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(t)},_convertToWindowSpace:function(t){t=this.convertToWorldSpace(t);return cc.director.convertToUI(t)},convertTouchToNodeSpace:function(t){t=t.getLocation();return this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(t){t=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(t)},update:function(t){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(t)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node._stateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(t){return this._componentContainer?this._componentContainer.getComponent(t):null},addComponent:function(t){this._componentContainer&&this._componentContainer.add(t)},removeComponent:function(t){return!!this._componentContainer&&this._componentContainer.remove(t)},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(t){this._renderCmd.visit(t)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())cc.affineTransformConcatIn(i,n.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform(),t=cc.rectApplyAffineTransform(t,e);if(this._children)for(var i=this._children,n=0;n<i.length;n++){var r=i[n];r&&r._visible&&(r=r._getBoundingBoxToCurrentNode(e))&&(t=cc.rectUnion(t,r))}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t),e=cc.rectApplyAffineTransform(e,i);if(this._children)for(var n=this._children,r=0;r<n.length;r++){var c=n[r];c&&c._visible&&(c=c._getBoundingBoxToCurrentNode(i))&&(e=cc.rectUnion(e,c))}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity!==t&&(this._realOpacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty))},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;cc.colorEqual(e,t)||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty))},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return new cc.Node.WebGLRenderCmd(this)}}),cc.Node.create=function(){return new cc.Node},cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js"),cc._tmp.PrototypeCCNode(),delete cc._tmp.PrototypeCCNode,cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e,this.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)},this.needDraw=function(){return this._needDraw}},cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1023},cc.Node.RenderCmd=function(t){this._dirtyFlag=1,this._savedDirtyFlag=!0,this._node=t,this._needDraw=!1,this._anchorPointInPoints=new cc.Point(0,0),this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._displayedOpacity=255,this._displayedColor=cc.color(255,255,255,255),this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._curLevel=-1},cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._inverse=cc.affineTransformInvert(this.getNodeToParentTransform())),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(t,e){var i=this._node,t=t?t._worldTransform:null,n=this._transform,r=this._worldTransform,c=(i._usingNormalizedPosition&&i._parent&&(c=i._parent._contentSize,i._position.x=i._normalizedPosition.x*c.width,i._position.y=i._normalizedPosition.y*c.height,i._normalizedPositionDirty=!1),i._rotationX||i._rotationY),o=i._skewX||i._skewY,s=i._scaleX,a=i._scaleY,h=this._anchorPointInPoints.x,l=this._anchorPointInPoints.y,_=1,u=0,d=0,p=1;if(c||o?(n.tx=i._position.x,n.ty=i._position.y,c&&(c=.017453292519943295*i._rotationX,d=Math.sin(c),p=Math.cos(c),u=i._rotationY===i._rotationX?(_=p,-d):(c=.017453292519943295*i._rotationY,_=Math.cos(c),-Math.sin(c))),n.a=_*=s,n.b=u*=s,n.c=d*=a,n.d=p*=a,o&&(c=Math.tan(i._skewX*Math.PI/180),o=Math.tan(i._skewY*Math.PI/180),c===1/0&&(c=99999999),n.a=_+d*(o=o===1/0?99999999:o),n.b=u+p*o,n.c=d+_*c,n.d=p+u*c),(h||l)&&(n.tx-=n.a*h+n.c*l,n.ty-=n.b*h+n.d*l,i._ignoreAnchorPointForPosition)&&(n.tx+=h,n.ty+=l),t?(r.a=n.a*t.a+n.b*t.c,r.b=n.a*t.b+n.b*t.d,r.c=n.c*t.a+n.d*t.c,r.d=n.c*t.b+n.d*t.d,r.tx=t.a*n.tx+t.c*n.ty+t.tx,r.ty=t.d*n.ty+t.ty+t.b*n.tx):(r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty)):(n.a=s,n.b=0,n.c=0,n.d=a,n.tx=i._position.x,n.ty=i._position.y,(h||l)&&(n.tx-=n.a*h,n.ty-=n.d*l,i._ignoreAnchorPointForPosition)&&(n.tx+=h,n.ty+=l),t?(r.a=n.a*t.a+n.b*t.c,r.b=n.a*t.b+n.b*t.d,r.c=n.c*t.a+n.d*t.c,r.d=n.c*t.b+n.d*t.d,r.tx=n.tx*t.a+n.ty*t.c+t.tx,r.ty=n.tx*t.b+n.ty*t.d+t.ty):(r.a=n.a,r.b=n.b,r.c=n.c,r.d=n.d,r.tx=n.tx,r.ty=n.ty)),i._additionalTransformDirty&&(this._transform=cc.affineTransformConcat(n,i._additionalTransform)),this._updateCurrentRegions&&this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble),e){var f,g,m=this._node._children;if(!m||0===m.length)return;for(f=0,g=m.length;f<g;f++)m[f]._renderCmd.transform(this,e)}this._cacheDirty=!0},getNodeToParentTransform:function(){return this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&this.transform(),this._transform},visit:function(t){var e=this._node,i=cc.renderer;e._visible&&((t=t||this.getParentRenderCmd())&&(this._curLevel=t._curLevel+1),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t),this.visitChildren())},_updateDisplayColor:function(t){var e,i,n=this._node,r=this._displayedColor,c=n._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!n._cascadeColorEnabled){r.r=c.r,r.g=c.g,r.b=c.b;for(var o,s=new cc.Color(255,255,255,255),a=0,h=(o=n._children).length;a<h;a++)(e=o[a])&&e._renderCmd&&e._renderCmd._updateDisplayColor(s);this._cascadeColorEnabledDirty=!1}else if(void 0===t&&(t=(i=n._parent)&&i._cascadeColorEnabled?i.getDisplayedColor():cc.color.WHITE),r.r=0|c.r*t.r/255,r.g=0|c.g*t.g/255,r.b=0|c.b*t.b/255,n._cascadeColorEnabled)for(a=0,h=(o=n._children).length;a<h;a++)(e=o[a])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(r),e._renderCmd._updateColor());this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,c,o=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!o._cascadeOpacityEnabled){for(this._displayedOpacity=o._realOpacity,e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else if(void 0===t&&(t=255,c=o._parent)&&c._cascadeOpacityEnabled&&(t=c.getDisplayedOpacity()),this._displayedOpacity=o._realOpacity*t/255,o._cascadeOpacityEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor());this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;void 0===t&&(t=(e=e._parent)&&e._cascadeColorEnabled?e.getDisplayedColor():cc.color.WHITE),i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e,i=this._node;void 0===t&&(t=255,e=i._parent)&&e._cascadeOpacityEnabled&&(t=e.getDisplayedOpacity()),this._displayedOpacity=i._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;this._savedDirtyFlag=this._savedDirtyFlag||e,i&&this._updateDisplayColor(),n&&this._updateDisplayOpacity(),(i||n)&&this._updateColor(),e&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&t.transformDirty^this._dirtyFlag),e&t.orderDirty&&(this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag)},_syncStatus:function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag,n=null,n=(t?(n=t._node,this._savedDirtyFlag=this._savedDirtyFlag||t._savedDirtyFlag||i):this._savedDirtyFlag=this._savedDirtyFlag||i,n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty),i&e.colorDirty),r=i&e.opacityDirty;this._dirtyFlag=i,n&&this._syncDisplayColor(),r&&this._syncDisplayOpacity(),(n||r)&&this._updateColor(),i&e.transformDirty&&this.transform(t),i&e.orderDirty&&(this._dirtyFlag=this._dirtyFlag&e.orderDirty^this._dirtyFlag)},visitChildren:function(){var t,e,i=cc.renderer,n=this._node,r=n._children,c=r.length;if(0<c){for(n.sortAllChildren(),t=0;t<c&&(e=r[t])._localZOrder<0;t++)e._renderCmd.visit(this);for(i.pushRenderCommand(this);t<c;t++)r[t]._renderCmd.visit(this)}else i.pushRenderCommand(this);this._dirtyFlag=0}},cc.Node.RenderCmd.prototype.originVisit=cc.Node.RenderCmd.prototype.visit,cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform,cc._tmp.PrototypeTexture2D=function(){var t=cc.Texture2D,e=(t.PVRImagesHavePremultipliedAlpha=function(t){cc.PVRHaveAlphaPremultiplied_=t},t.PIXEL_FORMAT_RGBA8888=2,t.PIXEL_FORMAT_RGB888=3,t.PIXEL_FORMAT_RGB565=4,t.PIXEL_FORMAT_A8=5,t.PIXEL_FORMAT_I8=6,t.PIXEL_FORMAT_AI88=7,t.PIXEL_FORMAT_RGBA4444=8,t.PIXEL_FORMAT_RGB5A1=7,t.PIXEL_FORMAT_PVRTC4=9,t.PIXEL_FORMAT_PVRTC2=10,t.PIXEL_FORMAT_DEFAULT=t.PIXEL_FORMAT_RGBA8888,t.defaultPixelFormat=t.PIXEL_FORMAT_DEFAULT,cc.Texture2D._M={}),e=(e[t.PIXEL_FORMAT_RGBA8888]="RGBA8888",e[t.PIXEL_FORMAT_RGB888]="RGB888",e[t.PIXEL_FORMAT_RGB565]="RGB565",e[t.PIXEL_FORMAT_A8]="A8",e[t.PIXEL_FORMAT_I8]="I8",e[t.PIXEL_FORMAT_AI88]="AI88",e[t.PIXEL_FORMAT_RGBA4444]="RGBA4444",e[t.PIXEL_FORMAT_RGB5A1]="RGB5A1",e[t.PIXEL_FORMAT_PVRTC4]="PVRTC4",e[t.PIXEL_FORMAT_PVRTC2]="PVRTC2",cc.Texture2D._B={}),e=(e[t.PIXEL_FORMAT_RGBA8888]=32,e[t.PIXEL_FORMAT_RGB888]=24,e[t.PIXEL_FORMAT_RGB565]=16,e[t.PIXEL_FORMAT_A8]=8,e[t.PIXEL_FORMAT_I8]=8,e[t.PIXEL_FORMAT_AI88]=16,e[t.PIXEL_FORMAT_RGBA4444]=16,e[t.PIXEL_FORMAT_RGB5A1]=16,e[t.PIXEL_FORMAT_PVRTC4]=4,e[t.PIXEL_FORMAT_PVRTC2]=3,cc.Texture2D.prototype);e.name,cc.defineGetterSetter(e,"name",e.getName),e.pixelFormat,cc.defineGetterSetter(e,"pixelFormat",e.getPixelFormat),e.pixelsWidth,cc.defineGetterSetter(e,"pixelsWidth",e.getPixelsWide),e.pixelsHeight,cc.defineGetterSetter(e,"pixelsHeight",e.getPixelsHigh),e.width,cc.defineGetterSetter(e,"width",e._getWidth),e.height,cc.defineGetterSetter(e,"height",e._getHeight)},cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,refnum:0,ctor:function(){this._contentSize=cc.size(0,0),this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj),this._htmlElementObj=null,cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(t){this.maxS=t},getMaxT:function(){return this.maxT},setMaxT:function(t){this.maxT=t},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(t){this.shaderProgram=t},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){var t=this;return"<cc.Texture2D | Name = "+t._name+" | Dimensions = "+t._pixelsWide+" x "+t._pixelsHigh+" | Coordinates = ("+t.maxS+", "+t.maxT+")>"},releaseData:function(t){},keepData:function(t,e){return t},initWithData:function(t,e,i,n,r){var c=this,o=cc.Texture2D,s=cc._renderContext,a=s.RGBA,h=s.UNSIGNED_BYTE,l=i*cc.Texture2D._B[e]/8;switch(l%8==0?s.pixelStorei(s.UNPACK_ALIGNMENT,8):l%4==0?s.pixelStorei(s.UNPACK_ALIGNMENT,4):l%2==0?s.pixelStorei(s.UNPACK_ALIGNMENT,2):s.pixelStorei(s.UNPACK_ALIGNMENT,1),c._webTextureObj=s.createTexture(),cc.glBindTexture2D(c),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),e){case o.PIXEL_FORMAT_RGBA8888:a=s.RGBA;break;case o.PIXEL_FORMAT_RGB888:a=s.RGB;break;case o.PIXEL_FORMAT_RGBA4444:h=s.UNSIGNED_SHORT_4_4_4_4;break;case o.PIXEL_FORMAT_RGB5A1:h=s.UNSIGNED_SHORT_5_5_5_1;break;case o.PIXEL_FORMAT_RGB565:h=s.UNSIGNED_SHORT_5_6_5;break;case o.PIXEL_FORMAT_AI88:a=s.LUMINANCE_ALPHA;break;case o.PIXEL_FORMAT_A8:a=s.ALPHA;break;case o.PIXEL_FORMAT_I8:a=s.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}return s.texImage2D(s.TEXTURE_2D,0,a,i,n,0,a,h,t),c._contentSize.width=r.width,c._contentSize.height=r.height,c._pixelsWide=i,c._pixelsHigh=n,c._pixelFormat=e,c.maxS=r.width/i,c.maxT=r.height/n,c._hasPremultipliedAlpha=!1,c._hasMipmaps=!1,c.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),c._textureLoaded=!0},drawAtPoint:function(t){},drawInRect:function(t){},initWithImage:function(t){var e,i,n;return null==t?(cc.log(cc._LogInfos.Texture2D_initWithImage),!1):(e=t.getWidth(),i=t.getHeight(),(n=cc.configuration.getMaxTextureSize())<e||n<i?(cc.log(cc._LogInfos.Texture2D_initWithImage_2,e,i,n,n),!1):(this._textureLoaded=!0,this._initPremultipliedATextureWithImage(t,e,i)))},initWithElement:function(t){t&&(this._webTextureObj=cc._renderContext.createTexture(),this._htmlElementObj=t,this._textureLoaded=!0,this._hasPremultipliedAlpha=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(t){var e,i,n=this;this.refnum++,t=void 0!==t?t:n._hasPremultipliedAlpha,cc.game._rendererInitialized&&n._htmlElementObj&&n._htmlElementObj.width&&n._htmlElementObj.height&&(e=cc._renderContext,cc.glBindTexture2D(n),e.pixelStorei(e.UNPACK_ALIGNMENT,4),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE),cc.glBindTexture2D(null),t&&e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e=n._htmlElementObj.width,i=n._htmlElementObj.height,n._pixelsWide=n._contentSize.width=e,n._pixelsHigh=n._contentSize.height=i,n._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,n.maxS=1,n.maxT=1,n._hasPremultipliedAlpha=t,n._hasMipmaps=!1,n._htmlElementObj instanceof HTMLImageElement&&(n._htmlElementObj=null),n.dispatchEvent("load"))},updateTexture:function(){cc.glBindTexture2D(this),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this._htmlElementObj),cc.glBindTexture2D(null)},initWithString:function(t,e,i,n,r,c){return cc.log(cc._LogInfos.Texture2D_initWithString),null},initWithETCFile:function(t){return!1},initWithPVRFile:function(t){return!1},initWithPVRTCData:function(t,e,i,n,r,c){return!1},setTexParameters:function(t,e,i,n){var r=this,c=cc._renderContext;void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),cc.assert(r._pixelsWide===cc.NextPOT(r._pixelsWide)&&r._pixelsHigh===cc.NextPOT(r._pixelsHigh)||t.wrapS===c.CLAMP_TO_EDGE&&t.wrapT===c.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,t.minFilter),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,t.magFilter),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,t.wrapS),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,t.wrapT)},setAntiAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)},setAliasTexParameters:function(){var t=cc._renderContext;cc.glBindTexture2D(this),this._hasMipmaps?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},generateMipmap:function(){var t=this;cc.assert(t._pixelsWide===cc.NextPOT(t._pixelsWide)&&t._pixelsHigh===cc.NextPOT(t._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(t),cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D),t._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(t){t=t||this._pixelFormat;var e=cc.Texture2D._B[t];return null!=e?e:(cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,t),-1)},_initPremultipliedATextureWithImage:function(t,e,i){var n,r,c=cc.Texture2D,o=t.getData(),s=null,a=t.hasAlpha(),h=cc.size(t.getWidth(),t.getHeight()),l=c.defaultPixelFormat,_=t.getBitsPerComponent(),u=e*i;if((l=a?l:8<=_?c.PIXEL_FORMAT_RGB888:c.PIXEL_FORMAT_RGB565)===c.PIXEL_FORMAT_RGB565)if(a)for(o=new Uint16Array(e*i),s=t.getData(),r=0;r<u;++r)o[r]=(s[r]>>0&255)>>3<<11|(s[r]>>8&255)>>2<<5|(s[r]>>16&255)>>3<<0;else for(o=new Uint16Array(e*i),n=t.getData(),r=0;r<u;++r)o[r]=(255&n[r])>>3<<11|(255&n[r])>>2<<5|(255&n[r])>>3<<0;else if(l===c.PIXEL_FORMAT_RGBA4444)for(o=new Uint16Array(e*i),s=t.getData(),r=0;r<u;++r)o[r]=(s[r]>>0&255)>>4<<12|(s[r]>>8&255)>>4<<8|(s[r]>>16&255)>>4<<4|(s[r]>>24&255)>>4<<0;else if(l===c.PIXEL_FORMAT_RGB5A1)for(o=new Uint16Array(e*i),s=t.getData(),r=0;r<u;++r)o[r]=(s[r]>>0&255)>>3<<11|(s[r]>>8&255)>>3<<6|(s[r]>>16&255)>>3<<1|(s[r]>>24&255)>>7<<0;else if(l===c.PIXEL_FORMAT_A8)for(o=new Uint8Array(e*i),s=t.getData(),r=0;r<u;++r)o[r]=s>>24&255;if(a&&l===c.PIXEL_FORMAT_RGB888)for(s=t.getData(),o=new Uint8Array(e*i*3),r=0;r<u;++r)o[3*r]=s>>0&255,o[3*r+1]=s>>8&255,o[3*r+2]=s>>16&255;return this.initWithData(o,l,e,i,h),o!=t.getData()&&(o=null),this._hasPremultipliedAlpha=t.isPremultipliedAlpha(),!0},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},removeLoadedEventListener:function(t){this.removeEventTarget("load",t)}})},cc._tmp.WebGLTextureAtlas=function(){},cc._tmp.WebGLTextureCache=function(){var t=cc.textureCache;t.handleLoadedTexture=function(t,e){var i,n=this._textures;return(i=(n=cc.game._rendererInitialized?n:this._loadedTexturesBefore)[t])||((i=n[t]=new cc.Texture2D).url=t),i.initWithElement(e),".png"===cc.path.extname(t)?i.handleLoadedTexture(!0):i.handleLoadedTexture(),i},t.addImage=function(i,n,r){cc.assert(i,cc._LogInfos.Texture2D_addImage_2);var t=this._textures,e=(t=cc.game._rendererInitialized?t:this._loadedTexturesBefore)[i]||t[cc.loader._getAliase(i)];return e?e.isLoaded()?n&&n.call(r,e):e.addEventListener("load",function(){n&&n.call(r,e)},r):((e=t[i]=new cc.Texture2D).url=i,t=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath,cc.loader.loadImg(cc.loader.getUrl(t,i),function(t,e){if(t)return n&&n.call(r,t);t=cc.textureCache.handleLoadedTexture(i,e);n&&n.call(r,t)})),e},t.addImageAsync=t.addImage},cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.PVRHaveAlphaPremultiplied_=!1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D),cc.EventHelper.prototype.apply(cc.Texture2D.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js"),cc._tmp.PrototypeTexture2D(),delete cc._tmp.PrototypeTexture2D}),cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var t,e=this._loadedTexturesBefore,i=this._textures;for(t in e){var n=e[t];n.handleLoadedTexture(),i[t]=n}this._loadedTexturesBefore={}},addPVRTCImage:function(t){},addETCImage:function(t){},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.log(cc._LogInfos.textureCache_textureForKey),this.getTextureForKey(t)},getTextureForKey:function(t){var e=this._textures[t];return e||((e=cc.loader._getAliase(t))?this._textures[e]:null)},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._htmlElementObj,i=(i=this.getKeyByTexture(e))||(e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId));return this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},addPVRImage:function(t){},removeAllTextures:function(){var t,e=this._textures;for(t in e)e[t]&&e[t].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e,i=this._textures;for(e in i)i[e]===t&&this.removeTextureForKey(e)}},removeTextureForKey:function(t){null!=t&&this._textures[t]&&(this._textures[t].refnum--,this._textures[t].refnum<=0)&&(this._textures[t].releaseTexture(),delete this._textures[t])},cacheImage:function(t,e){var i;e instanceof cc.Texture2D?this._textures[t]=e:((i=new cc.Texture2D).initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i)},addUIImage:function(t,e){},dumpCachedTextureInfo:function(){},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random(),this._loadedTexturesBefore={}}},cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)}),cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize)},init:function(){var t=this;return t._ignoreAnchorPointForPosition=!0,t.setAnchorPoint(.5,.5),t.setContentSize(cc.winSize),t._cascadeColorEnabled=!1,!(t._cascadeOpacityEnabled=!1)},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},addChild:function(t,e,i){cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._bakeForAddChild(t)},_createRenderCmd:function(){return new cc.Layer.WebGLRenderCmd(this)}}),cc.Layer.create=function(){return new cc.Layer},cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(t,e){this.width=t,this.height=e},changeWidth:function(t){this.width=t},changeHeight:function(t){this.height=t},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},ctor:function(t,e,i){cc.Layer.prototype.ctor.call(this),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),cc.LayerColor.prototype.init.call(this,t,e,i)},init:function(t,e,i){var n=cc.director.getWinSize(),n=(t=t||cc.color(0,0,0,255),e=void 0===e?n.width:e,i=void 0===i?n.height:i,this._realColor);return n.r=t.r,n.g=t.g,n.b=t.b,this._realOpacity=t.a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty),cc.LayerColor.prototype.setContentSize.call(this,e,i),!0},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},_createRenderCmd:function(){return new cc.LayerColor.WebGLRenderCmd(this)}}),cc.LayerColor.create=function(t,e,i){return new cc.LayerColor(t,e,i)},!function(){var t=cc.LayerColor.prototype;cc.defineGetterSetter(t,"width",t._getWidth,t._setWidth),cc.defineGetterSetter(t,"height",t._getHeight,t._setHeight)}(),cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(t,e,i,n){cc.LayerColor.prototype.ctor.call(this),this._endColor=cc.color(0,0,0,255),this._alongVector=cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,n&&n instanceof Array?((this._colorStops=n).splice(0,0,{p:0,color:t||cc.color.BLACK}),n.push({p:1,color:e||cc.color.BLACK})):this._colorStops=[{p:0,color:t||cc.color.BLACK},{p:1,color:e||cc.color.BLACK}],cc.LayerGradient.prototype.init.call(this,t,e,i,n)},init:function(t,e,i,n){t=t||cc.color(0,0,0,255),e=e||cc.color(0,0,0,255),i=i||cc.p(0,-1);var r=this,c=r._endColor;return r._startOpacity=t.a,c.r=e.r,c.g=e.g,c.b=e.b,r._endOpacity=e.a,r._alongVector=i,r._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(r,cc.color(t.r,t.g,t.b,255)),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty),!0},setContentSize:function(t,e){cc.LayerColor.prototype.setContentSize.call(this,t,e),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return new cc.LayerGradient.WebGLRenderCmd(this)}}),cc.LayerGradient.create=function(t,e,i,n){return new cc.LayerGradient(t,e,i,n)},!function(){var t=cc.LayerGradient.prototype;t.startColor,cc.defineGetterSetter(t,"startColor",t.getStartColor,t.setStartColor),t.endColor,cc.defineGetterSetter(t,"endColor",t.getEndColor,t.setEndColor),t.startOpacity,cc.defineGetterSetter(t,"startOpacity",t.getStartOpacity,t.setStartOpacity),t.endOpacity,cc.defineGetterSetter(t,"endOpacity",t.getEndOpacity,t.setEndOpacity),t.vector,cc.defineGetterSetter(t,"vector",t.getVector,t.setVector),t.colorStops,cc.defineGetterSetter(t,"colorStops",t.getColorStops,t.setColorStops)}(),cc._tmp.PrototypeSprite=function(){var t=cc.Sprite.prototype;cc.defineGetterSetter(t,"opacityModifyRGB",t.isOpacityModifyRGB,t.setOpacityModifyRGB),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),cc.defineGetterSetter(t,"color",t.getColor,t.setColor),t.dirty,t.flippedX,cc.defineGetterSetter(t,"flippedX",t.isFlippedX,t.setFlippedX),t.flippedY,cc.defineGetterSetter(t,"flippedY",t.isFlippedY,t.setFlippedY),t.offsetX,cc.defineGetterSetter(t,"offsetX",t._getOffsetX),t.offsetY,cc.defineGetterSetter(t,"offsetY",t._getOffsetY),t.atlasIndex,t.texture,cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture),t.textureRectRotated,cc.defineGetterSetter(t,"textureRectRotated",t.isTextureRectRotated),t.textureAtlas,t.batchNode,cc.defineGetterSetter(t,"batchNode",t.getBatchNode,t.setBatchNode),t.quad,cc.defineGetterSetter(t,"quad",t.getQuad)},cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){var n=this;cc.Node.prototype.ctor.call(n),this.setAnchorPoint(.5,.5),n._loader=new cc.Sprite.LoadManager,n._shouldBeHidden=!1,n._offsetPosition=cc.p(0,0),n._unflippedOffsetPositionFromCenter=cc.p(0,0),n._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},n._rect=cc.rect(0,0,0,0),n._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(t){this.atlasIndex=t},getTextureRect:function(){return cc.rect(this._rect)},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){return cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrame),this.setSpriteFrame(t)},initWithSpriteFrameName:function(t){cc.assert(t,cc._LogInfos.Sprite_initWithSpriteFrameName);var e,i=cc.spriteFrameCache.getSpriteFrame(t);return cc.assert(i,t+cc._LogInfos.Sprite_initWithSpriteFrameName1),!i&&window.logCenter&&(e=new Error,window.logCenter.error(t+cc._LogInfos.Sprite_initWithSpriteFrameName1,"",0,0,e)),this.initWithSpriteFrame(i)},useBatchNode:function(t){this.textureAtlas=t.getTextureAtlas(),this._batchNode=t},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},sortAllChildren:function(){var t;this._reorderChildDirty&&(t=this._children,cc.Node.prototype.sortAllChildren.call(this),this._batchNode&&this._arrayMakeObjectsPerformSelector(t,cc.Node._stateCallbackType.sortAllChildren),this._reorderChildDirty=!1)},reorderChild:function(t,e){cc.assert(t,cc._LogInfos.Sprite_reorderChild_2),-1===this._children.indexOf(t)?cc.log(cc._LogInfos.Sprite_reorderChild):e!==t.zIndex&&(this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,t,e))},removeChild:function(t,e){this._batchNode&&this._batchNode.removeSpriteFromAtlas(t),cc.Node.prototype.removeChild.call(this,t,e)},setVisible:function(t){cc.Node.prototype.setVisible.call(this,t),this._renderCmd.setDirtyRecursively(!0)},removeAllChildren:function(t){var e=this._children,i=this._batchNode;if(i&&null!=e)for(var n=0,r=e.length;n<r;n++)i.removeSpriteFromAtlas(e[n]);cc.Node.prototype.removeAllChildren.call(this,t),this._hasChildren=!1},ignoreAnchorPointForPosition:function(t){this._batchNode||cc.Node.prototype.ignoreAnchorPointForPosition.call(this,t)},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assert(t,cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var t=cc.animationCache.getAnimation(t);t?(t=t.getFrames()[e])?this.setSpriteFrame(t.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;for(var t=this._parent;t&&t!==this._batchNode;)t._setReorderChildDirtyRecursively(),t=t.parent}},getTexture:function(){return this._texture},_softInit:function(t,e,i){var n;void 0===t?cc.Sprite.prototype.init.call(this):cc.isString(t)?"#"===t[0]?(n=t.substr(1,t.length-1),(n=cc.spriteFrameCache.getSpriteFrame(n))?this.initWithSpriteFrame(n):cc.log("%s does not exist",t)):cc.Sprite.prototype.init.call(this,t,e):"object"==typeof t&&(t instanceof cc.Texture2D?this.initWithTexture(t,e,i):t instanceof cc.SpriteFrame?this.initWithSpriteFrame(t):(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&((n=new cc.Texture2D).initWithElement(t),n.handleLoadedTexture(),this.initWithTexture(n)))},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return 0<arguments.length?t.initWithFile(arguments[0],arguments[1]):(cc.Node.prototype.init.call(t),t.dirty=t._recursiveDirty=!1,t._blendFunc.src=cc.BLEND_SRC,t._blendFunc.dst=cc.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t._hasChildren=!1,t.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assert(t,cc._LogInfos.Sprite_initWithFile);var i,n=cc.textureCache.getTextureForKey(t);return(n=n||cc.textureCache.addImage(t)).isLoaded()?(e||(i=n.getContentSize(),e=cc.rect(0,0,i.width,i.height)),this.initWithTexture(n,e)):(this._loader.clear(),this._loader.once(n,function(){this.initWithFile(t,e),this.dispatchEvent("load")},this),!1)},initWithTexture:function(t,e,i,n){var r=this;return cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture),this._loader.clear(),r._textureLoaded=t.isLoaded(),r._textureLoaded?(i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),!!cc.Node.prototype.init.call(r)&&(r._batchNode=null,r._recursiveDirty=!1,r.dirty=!1,r._opacityModifyRGB=!0,r._blendFunc.src=cc.BLEND_SRC,r._blendFunc.dst=cc.BLEND_DST,r._flippedX=r._flippedY=!1,r._offsetPosition.x=0,r._offsetPosition.y=0,r._hasChildren=!1,r._rectRotated=i,e&&(r._rect.x=e.x,r._rect.y=e.y,r._rect.width=e.width,r._rect.height=e.height),e=e||cc.rect(0,0,t.width,t.height),this._renderCmd._checkTextureBoundary(t,e,i),r.setTexture(t),r.setTextureRect(e,i),r.setBatchNode(null),!0)):(this._loader.once(t,function(){this.initWithTexture(t,e,i,n),this.dispatchEvent("load")},this),!1)},setTextureRect:function(t,e,i,n){var r=this,e=(r._rectRotated=e||!1,r.setContentSize(i||t),r.setVertexRect(t),r._renderCmd._setTextureCoords(t,n),r._unflippedOffsetPositionFromCenter.x),i=r._unflippedOffsetPositionFromCenter.y,t=(r._flippedX&&(e=-e),r._flippedY&&(i=-i),r._rect);r._offsetPosition.x=e+(r._contentSize.width-t.width)/2,r._offsetPosition.y=i+(r._contentSize.height-t.height)/2},addChild:function(t,e,i){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_addChild_2),null==e&&(e=t._localZOrder),null==i&&(i=t.tag),this._renderCmd._setBatchNodeForAddChild(t)&&(cc.Node.prototype.addChild.call(this,t,e,i),this._hasChildren=!0)},setSpriteFrame:function(t){var e=this;if(cc.isString(t)&&(t=cc.spriteFrameCache.getSpriteFrame(t),cc.assert(t,cc._LogInfos.Sprite_setSpriteFrame)),this._loader.clear(),this.setNodeDirty(!0),null==t)cc.error("newFrame == null");else{var i=t.getTexture();if(e._textureLoaded=t.textureLoaded(),this._loader.clear(),!e._textureLoaded)return this._loader.once(i,function(){this.setSpriteFrame(t),this.dispatchEvent("load")},this),!1;var n=t.getOffset();e._unflippedOffsetPositionFromCenter.x=n.x,e._unflippedOffsetPositionFromCenter.y=n.y,i!==e._texture&&(this._renderCmd._setTexture(i),e.setColor(e._realColor)),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())}},setDisplayFrame:function(t){cc.log(cc._LogInfos.Sprite_setDisplayFrame),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(t){var e=this;e._batchNode=t,e._batchNode?(e._transformToBatch=cc.affineTransformIdentity(),e.textureAtlas=e._batchNode.getTextureAtlas()):(e.atlasIndex=cc.Sprite.INDEX_NOT_INITIALIZED,e.textureAtlas=null,e._recursiveDirty=!1,e.dirty=!1)},setTexture:function(t){var e;return t?((e=cc.isString(t))&&(t=cc.textureCache.addImage(t)),this._loader.clear(),t._textureLoaded?(this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t),this.setColor(this._realColor),void(this._textureLoaded=!0)):(this._loader.once(t,function(){this.setTexture(t),this.dispatchEvent("load")},this),!1)):this._renderCmd._setTexture(null)},_changeRectWithTexture:function(t){t=t._contentSize,t=cc.rect(0,0,t.width,t.height);this.setTextureRect(t)},_createRenderCmd:function(){return new cc.Sprite.WebGLRenderCmd(this)}}),cc.Sprite.create=function(t,e,i){return new cc.Sprite(t,e,i)},cc.Sprite.createWithTexture=cc.Sprite.create,cc.Sprite.createWithSpriteFrameName=cc.Sprite.create,cc.Sprite.createWithSpriteFrame=cc.Sprite.create,cc.Sprite.INDEX_NOT_INITIALIZED=-1,cc.EventHelper.prototype.apply(cc.Sprite.prototype),cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js"),cc._tmp.PrototypeSprite(),delete cc._tmp.PrototypeSprite,!function(){var t=cc.Sprite.LoadManager=function(){this.list=[]};t.prototype.add=function(t,e,i){t&&t.addEventListener&&(t.addEventListener("load",e,i),this.list.push({source:t,listener:e,target:i}))},t.prototype.once=function(e,i,n){var r,c;e&&e.addEventListener&&(r=function(t){e.removeEventListener("load",r,n),e.removeEventListener("error",c,n),i.call(n,t)},c=function(t){e.removeEventListener("load",r,n),e.removeEventListener("error",c,n),i.call(n,t)},e.addEventListener("load",r,n),e.addEventListener("error",c,n),this.list.push({source:e,listener:r,target:n}))},t.prototype.clear=function(){for(;0<this.list.length;){var t=this.list.pop();t.source.removeEventListener("load",t.listener,t.target)}}}(),cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(t,e,i){this._spriteFrame=t||null,this._delayPerUnit=e||0,this._userInfo=i||null},clone:function(){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},copyWithZone:function(t){return cc.clone(this)},copy:function(t){var e=new cc.AnimationFrame;return e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),e},initWithSpriteFrame:function(t,e,i){return this._spriteFrame=t,this._delayPerUnit=e,this._userInfo=i,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(t){this._spriteFrame=t},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(t){this._delayPerUnit=t},getUserInfo:function(){return this._userInfo},setUserInfo:function(t){this._userInfo=t}}),cc.AnimationFrame.create=function(t,e,i){return new cc.AnimationFrame(t,e,i)},cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(t,e,i){var n;this._frames=[],void 0===t?this.initWithSpriteFrames(null,0):(n=t[0])&&(n instanceof cc.SpriteFrame?this.initWithSpriteFrames(t,e,i):n instanceof cc.AnimationFrame&&this.initWithAnimationFrames(t,e,i))},getFrames:function(){return this._frames},setFrames:function(t){this._frames=t},addSpriteFrame:function(t){var e=new cc.AnimationFrame;e.initWithSpriteFrame(t,1,null),this._frames.push(e),this._totalDelayUnits++},addSpriteFrameWithFile:function(t){var t=cc.textureCache.addImage(t),e=cc.rect(0,0,0,0),t=(e.width=t.width,e.height=t.height,new cc.SpriteFrame(t,e));this.addSpriteFrame(t)},addSpriteFrameWithTexture:function(t,e){t=new cc.SpriteFrame(t,e);this.addSpriteFrame(t)},initWithAnimationFrames:function(t,e,i){cc.arrayVerifyType(t,cc.AnimationFrame),this._delayPerUnit=e,this._loops=void 0===i?1:i,this._totalDelayUnits=0;for(var n=this._frames,r=n.length=0;r<t.length;r++){var c=t[r];n.push(c),this._totalDelayUnits+=c.getDelayUnits()}return!0},clone:function(){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},copyWithZone:function(t){var e=new cc.Animation;return e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),e.setRestoreOriginalFrame(this._restoreOriginalFrame),e},_copyFrames:function(){for(var t=[],e=0;e<this._frames.length;e++)t.push(this._frames[e].clone());return t},copy:function(t){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(t){this._loops=t},setRestoreOriginalFrame:function(t){this._restoreOriginalFrame=t},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(t){this._delayPerUnit=t},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(t,e,i){cc.arrayVerifyType(t,cc.SpriteFrame),this._loops=void 0===i?1:i,this._delayPerUnit=e||0,this._totalDelayUnits=0;var n=this._frames;if(n.length=0,t){for(var r=0;r<t.length;r++){var c=t[r],o=new cc.AnimationFrame;o.initWithSpriteFrame(c,1,null),n.push(o)}this._totalDelayUnits+=t.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(t,e,i){return new cc.Animation(t,e,i)},cc.Animation.createWithAnimationFrames=cc.Animation.create,cc.animationCache={_animations:{}},cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(t,e,i,n,r){this._offset=cc.p(0,0),this._offsetInPixels=cc.p(0,0),this._originalSize=cc.size(0,0),this._rotated=!1,this._originalSizeInPixels=cc.size(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1,void 0!==t&&void 0!==e&&(void 0===i||void 0===n||void 0===r?this.initWithTexture(t,e):this.initWithTexture(t,e,i,n,r))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},getRectInPixels:function(){var t=this._rectInPixels;return cc.rect(t.x,t.y,t.width,t.height)},setRectInPixels:function(t){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=t.x,this._rectInPixels.y=t.y,this._rectInPixels.width=t.width,this._rectInPixels.height=t.height,this._rect=cc.rectPixelsToPoints(t)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){var t=this._rect;return cc.rect(t.x,t.y,t.width,t.height)},setRect:function(t){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height,this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(t){this._offsetInPixels.x=t.x,this._offsetInPixels.y=t.y,cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(t){this._originalSizeInPixels.width=t.width,this._originalSizeInPixels.height=t.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize.width=t.width,this._originalSize.height=t.height},getTexture:function(){var t;return this._texture||(""!==this._textureFilename?((t=cc.textureCache.addImage(this._textureFilename))&&(this._textureLoaded=t.isLoaded()),t):null)},setTexture:function(t){var e;this._texture!==t&&(e=t.isLoaded(),this._textureLoaded=e,this._texture=t,e||t.addEventListener("load",function(t){this._textureLoaded=!0;var e=this._rect;0===e.width&&0===e.height&&(e=t.width,t=t.height,this._rect.width=e,this._rect.height=t,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=e,this._originalSize.height=t),this.dispatchEvent("load")},this))},getOffset:function(){return cc.p(this._offset)},setOffset:function(t){this._offset.x=t.x,this._offset.y=t.y},clone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copyWithZone:function(){var t=new cc.SpriteFrame;return t.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),t.setTexture(this._texture),t},copy:function(){return this.copyWithZone()},initWithTexture:function(t,e,i,n,r){var c,o;return 2===arguments.length&&(e=cc.rectPointsToPixels(e)),n=n||cc.p(0,0),r=r||e,i=i||!1,cc.isString(t)?(this._texture=null,this._textureFilename=t):t instanceof cc.Texture2D&&this.setTexture(t),t=this.getTexture(),this._rectInPixels=e,this._rect=cc.rectPixelsToPoints(e),t&&t.url&&t.isLoaded()&&(o=i?(c=e.x+e.height,e.y+e.width):(c=e.x+e.width,e.y+e.height),c>t.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,t.url),o>t.getPixelsHigh())&&cc.error(cc._LogInfos.RectHeight,t.url),this._offsetInPixels.x=n.x,this._offsetInPixels.y=n.y,cc._pointPixelsToPointsOut(n,this._offset),this._originalSizeInPixels.width=r.width,this._originalSizeInPixels.height=r.height,cc._sizePixelsToPointsOut(r,this._originalSize),this._rotated=i,!0}}),cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype),cc.SpriteFrame.create=function(t,e,i,n,r){return new cc.SpriteFrame(t,e,i,n,r)},cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create,cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(t){},_pointFromString:function(t){},_sizeFromString:function(t){},_getFrameConfig:function(t){var e=cc.loader.getRes(t);return cc.assert(e,cc._LogInfos.spriteFrameCache__getFrameConfig_2,t),cc.loader.release(t),e._inited?this._frameConfigCache[t]=e:(this._frameConfigCache[t]=this._parseFrameConfig(e),this._frameConfigCache[t])},_getFrameConfigByJsonObject:function(t,e){},_parseFrameConfig:function(t){var e,i,n=t.frames,t=t.metadata||t.meta,r={},c={},o=0;for(i in t&&(o=(e=t.format).length<=1?parseInt(e):e,c.image=t.textureFileName||t.textureFileName||t.image),n){var s,a,h,l=n[i];l&&(s={},1!=o&&2!=o||(l instanceof Array?(h=0,a=l[h++],s.rect=cc.rect(a[0],a[1],a[2],a[3]),s.rotated=l[h++],a=l[h++],s.offset=cc.p(a[0],a[1]),h=l[3],s.size=cc.size(h[0],h[1])):(s.rect=this._rectFromString(l.frame),s.rotated=l.rotated||!1,s.offset=this._pointFromString(l.offset),s.size=this._sizeFromString(l.sourceSize))),r[i]=s)}return{_inited:!0,frames:r,meta:c}},_addSpriteFramesByObject:function(t,e,i){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2),e&&e.frames&&(e=this._frameConfigCache[t]||this._getFrameConfigByJsonObject(t,e),this._createSpriteFrames(t,e,i))},_createSpriteFrames:function(t,e,i){var n,r=e.frames,e=e.meta,c=(i?i instanceof cc.Texture2D||(cc.isString(i)?i=cc.textureCache.addImage(i):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(t=cc.path.changeBasename(t,e.image||".png"),i=cc.textureCache.addImage(t)),this._spriteFramesAliases),o=this._spriteFrames;for(n in r){var s=r[n];if(!o[n]){var a=new cc.SpriteFrame(i,s.rect,s.rotated,s.offset,s.size),h=s.aliases;if(h)for(var l=0,_=h.length;l<_;l++){var u=h[l];c[u]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,u),c[u]=n}o[n]=a}}},addSpriteFrames:function(t,e){cc.assert(t,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var i=this._frameConfigCache[t]||cc.loader.getRes(t);i&&i.frames&&(i=this._frameConfigCache[t]||this._getFrameConfig(t),this._createSpriteFrames(t,i,e))},_checkConflict:function(t){},addSpriteFrame:function(t,e){this._spriteFrames[e]=t},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={}},removeSpriteFrameByName:function(t){t&&(this._spriteFramesAliases[t]&&delete this._spriteFramesAliases[t],this._spriteFrames[t])&&delete this._spriteFrames[t]},removeSpriteFramesFromFile:function(t){var e,i=this._spriteFrames,n=this._spriteFramesAliases,t=this._frameConfigCache[t];if(t)for(e in t.frames)if(i[e])for(var r in delete i[e],n)n[r]===e&&delete n[r]},removeSpriteFramesFromTexture:function(t){var e,i=this._spriteFrames,n=this._spriteFramesAliases;for(e in i){var r=i[e];if(r&&r.getTexture()===t)for(var c in delete i[e],n)n[c]===e&&delete n[c]}},getSpriteFrame:function(t){var e,i=this._spriteFrames[t];return i||!(e=this._spriteFramesAliases[t])||(i=this._spriteFrames[e.toString()])||delete this._spriteFramesAliases[t],i},_clear:function(){this._spriteFrames={},this._spriteFramesAliases={},this._frameConfigCache={}}},cc.g_NumberOfDraws=0,cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var t=this;t._lastUpdate=Date.now(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE),this._eventAfterUpdate.setUserData(this),this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT),this._eventAfterVisit.setUserData(this),this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW),this._eventAfterDraw.setUserData(this),this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED),this._eventProjectionChanged.setUserData(this),!0},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(t-this._lastUpdate)/1e3,0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&.2<this._deltaTime&&(this._deltaTime=1/60),this._lastUpdate=t},convertToGL:function(t){var e=document.documentElement,i=cc.view,n=e.getBoundingClientRect(),e=(n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop,i._devicePixelRatio*(t.x-n.left)),n=i._devicePixelRatio*(n.top+n.height-t.y);return i._isRotated?{x:i._viewPortRect.width-n,y:e}:{x:e,y:n}},convertToUI:function(t){var e=document.documentElement,i=cc.view,n=e.getBoundingClientRect(),e=(n.left+=window.pageXOffset-e.clientLeft,n.top+=window.pageYOffset-e.clientTop,{x:0,y:0});return i._isRotated?(e.x=n.left+t.y/i._devicePixelRatio,e.y=n.top+n.height-(i._viewPortRect.width-t.x)/i._devicePixelRatio):(e.x=n.left+t.x/i._devicePixelRatio,e.y=n.top+n.height-t.y/i._devicePixelRatio),e},drawScene:function(){var t=cc.renderer;this.calculateDeltaTime(),this._paused||(this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate)),this._nextScene&&this.setNextScene(),this._beforeVisitScene&&this._beforeVisitScene(),this._runningScene&&(t.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()),t.clear(),this._notificationNode&&this._notificationNode.visit(),cc.eventManager.dispatchEvent(this._eventAfterVisit),cc.g_NumberOfDraws=0,this._afterVisitScene&&this._afterVisitScene(),t.rendering(cc._renderContext),this._totalFrames++,cc.eventManager.dispatchEvent(this._eventAfterDraw),this._calculateMPF()},_beforeVisitScene:null,_afterVisitScene:null,end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.animationCache._clear(),cc.spriteFrameCache._clear(),cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll(),cc.eventManager&&cc.eventManager.setEnabled(!1),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData(),cc.checkGLErrorDebug()},pushScene:function(t){cc.assert(t,cc._LogInfos.Director_pushScene),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runScene:function(t){var e;cc.assert(t,cc._LogInfos.Director_pushScene),this._runningScene?(0===(e=this._scenesStack.length)?(this._sendCleanupToScene=!0,this._scenesStack[e]=t):(this._sendCleanupToScene=!0,this._scenesStack[e-1]=t),this._nextScene=t):(this.pushScene(t),this.startAnimation())},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),e||((e=this._runningScene)&&(e.onExitTransitionDidStart(),e.onExit()),this._sendCleanupToScene&&e&&e.cleanup()),this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(t){cc.renderer.childrenOrderDirty=!0,this._notificationNode&&(this._notificationNode.onExitTransitionDidStart(),this._notificationNode.onExit(),this._notificationNode.cleanup()),(this._notificationNode=t)&&(this._notificationNode.onEnter(),this._notificationNode.onEnterTransitionDidFinish())},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!0},setDisplayStats:function(t){cc.profiler&&cc.profiler.hideStats()},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var e=this._scenesStack,i=e.length;if(0===t)this.end();else if(!(i<=t)){for(;t<i;){var n=e.pop();n.running&&(n.onExitTransitionDidStart(),n.onExit()),n.cleanup(),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager=t)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){var t=Date.now();this._secondsPerFrame=(t-this._lastUpdate)/1e3}}),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)}),cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1,cc.ListEntry=function(t,e,i,n,r,c,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=c,this.markedForDeletion=o},cc.HashUpdateEntry=function(t,e,i,n,r){this.list=t,this.entry=e,this.target=i,this.callback=n,this.hh=r},cc.HashTimerEntry=cc.hashSelectorEntry=function(t,e,i,n,r,c,o){var s=this;s.timers=t,s.target=e,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=c,s.hh=o},cc.Timer=cc.Class.extend({_scheduler:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,_interval:0,getInterval:function(){return this._interval},setInterval:function(t){this._interval=t},setupTimerWithInterval:function(t,e,i){this._elapsed=-1,this._interval=t,this._delay=i,this._useDelay=0<this._delay,this._repeat=e,this._runForever=this._repeat===cc.REPEAT_FOREVER},trigger:function(){return 0},cancel:function(){return 0},ctor:function(){this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0},update:function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}}),cc.TimerTargetSelector=cc.Timer.extend({_target:null,_selector:null,ctor:function(){this._target=null,this._selector=null},initWithSelector:function(t,e,i,n,r,c){return this._scheduler=t,this._target=i,this._selector=e,this.setupTimerWithInterval(n,r,c),!0},getSelector:function(){return this._selector},trigger:function(){this._target&&this._selector&&this._target.call(this._selector,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._selector,this._target)}}),cc.TimerTargetCallback=cc.Timer.extend({_target:null,_callback:null,_key:null,ctor:function(){this._target=null,this._callback=null},initWithCallback:function(t,e,i,n,r,c,o){return this._scheduler=t,this._target=i,this._callback=e,this._key=n,this.setupTimerWithInterval(r,c,o),!0},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}}),cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_schedulePerFrame:function(t,e,i,n){var r=this._hashForUpdates[e.__instanceId];if(r&&r.entry){if(r.entry.priority===i)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return cc.log("warning: you CANNOT change update priority in scheduled function"),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(e)}0===i?this._appendIn(this._updates0List,t,e,n):i<0?this._priorityIn(this._updatesNegList,t,e,i,n):this._priorityIn(this._updatesPosList,t,e,i,n)},_removeHashElement:function(t){delete this._hashForTimers[t.target.__instanceId],cc.arrayRemoveObject(this._arrayForTimers,t),t.Timer=null,t.target=null},_removeUpdateFromHash:function(t){t=this._hashForUpdates[t.target.__instanceId];t&&(cc.arrayRemoveObject(t.list,t.entry),delete this._hashForUpdates[t.target.__instanceId],t.entry=null,t.target=null)},_priorityIn:function(t,e,i,n,r){e=new cc.ListEntry(null,null,e,i,n,r,!1);if(t){for(var c=t.length-1,o=0;o<=c;o++)if(n<t[o].priority){c=o;break}t.splice(o,0,e)}else(t=[]).push(e);return this._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,e,i,null),t},_appendIn:function(t,e,i,n){e=new cc.ListEntry(null,null,e,i,0,n,!1);t.push(e),this._hashForUpdates[i.__instanceId]=new cc.HashUpdateEntry(t,e,i,null,null)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),o=0,i=(e=this._updatesNegList).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.callback(t);for(o=0,i=(e=this._updates0List).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.callback(t);for(o=0,i=(e=this._updatesPosList).length;o<i;o++)(n=e[o]).paused||n.markedForDeletion||n.callback(t);for(var r,c=this._arrayForTimers,o=0;o<c.length;o++){if(r=c[o],this._currentTarget=r,this._currentTargetSalvaged=!1,!r.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;++r.timerIndex)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(t),r.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}for(o=0,e=this._updatesNegList;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;for(o=0,e=this._updates0List;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;for(o=0,e=this._updatesPosList;o<e.length;)(n=e[o]).markedForDeletion?this._removeUpdateFromHash(n):o++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,c){this.schedule(e,t,i,n,r,c,t.__instanceId+"")},schedule:function(t,e,i,n,r,c,o){var s,a,h,l=!1,_=("function"!=typeof t&&(s=t,l=!0),!1===l?4!==arguments.length&&5!==arguments.length||(o=r,c=n,r=0,n=cc.REPEAT_FOREVER):4===arguments.length&&(c=n,n=cc.REPEAT_FOREVER,r=0),void 0===o&&(o=e.__instanceId+""),cc.assert(e,"Scheduler_scheduleCallbackForTarget_3"),this._hashForTimers[e.__instanceId]);if(_?cc.assert(_.paused===c,""):(_=new cc.HashTimerEntry(null,e,0,null,null,c,null),this._arrayForTimers.push(_),this._hashForTimers[e.__instanceId]=_),null==_.timers)_.timers=[];else if(!1===l){for(h=0;h<_.timers.length;h++)if(t===(a=_.timers[h])._callback)return cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,a.getInterval().toFixed(4),i.toFixed(4)),void(a._interval=i)}else for(h=0;h<_.timers.length;++h)if((a=_.timers[h])&&s===a.getSelector())return cc.log("CCScheduler#scheduleSelector. Selector already scheduled. Updating interval from: %.4f to %.4f",a.getInterval(),i),void a.setInterval(i);!1===l?(a=new cc.TimerTargetCallback).initWithCallback(this,t,e,o,i,n,r):(a=new cc.TimerTargetSelector).initWithSelector(this,s,e,i,n,r),_.timers.push(a)},scheduleUpdate:function(e,t,i){this._schedulePerFrame(function(t){e.update(t)},e,t,i)},_getUnscheduleMark:function(t,e){switch(typeof t){case"number":case"string":return t===e.getKey();case"function":return t===e._callback;default:return t===e.getSelector()}},unschedule:function(t,e){if(e&&t){var i=this._hashForTimers[e.__instanceId];if(i)for(var n=i.timers,r=0,c=n.length;r<c;r++){var o=n[r];if(this._getUnscheduleMark(t,o))return o!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),n.splice(r,1),i.timerIndex>=r&&i.timerIndex--,void(0===n.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}},unscheduleUpdate:function(t){null!=t&&(t=this._hashForUpdates[t.__instanceId])&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllForTarget:function(t){var e;null!=t&&((e=this._hashForTimers[t.__instanceId])&&(-1<e.timers.indexOf(e.currentTimer)&&!e.currentTimerSalvaged&&(e.currentTimerSalvaged=!0),e.timers.length=0,this._currentTarget===e?this._currentTargetSalvaged=!0:this._removeHashElement(e)),this.unscheduleUpdate(t))},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){for(var e,i,n=this._arrayForTimers,r=n.length-1;0<=r;r--)e=n[r],this.unscheduleAllForTarget(e.target);var c=0;if(t<0)for(r=0;r<this._updatesNegList.length;)c=this._updatesNegList.length,(i=this._updatesNegList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),c==this._updatesNegList.length&&r++;if(t<=0)for(r=0;r<this._updates0List.length;)c=this._updates0List.length,(i=this._updates0List[r])&&this.unscheduleUpdate(i.target),c==this._updates0List.length&&r++;for(r=0;r<this._updatesPosList.length;)c=this._updatesPosList.length,(i=this._updatesPosList[r])&&i.priority>=t&&this.unscheduleUpdate(i.target),c==this._updatesPosList.length&&r++},isScheduled:function(t,e){cc.assert(t,"Argument key must not be empty"),cc.assert(e,"Argument target must be non-nullptr");e=this._hashForUpdates[e.__instanceId];if(e&&null!=e.timers)for(var i=e.timers,n=0;n<i.length;++n)if(t===i[n].getKey())return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){for(var e,i,n=[],r=this._arrayForTimers,c=0,o=r.length;c<o;c++)(e=r[c])&&(e.paused=!0,n.push(e.target));if(t<0)for(c=0;c<this._updatesNegList.length;c++)(i=this._updatesNegList[c])&&i.priority>=t&&(i.paused=!0,n.push(i.target));if(t<=0)for(c=0;c<this._updates0List.length;c++)(i=this._updates0List[c])&&(i.paused=!0,n.push(i.target));for(c=0;c<this._updatesPosList.length;c++)(i=this._updatesPosList[c])&&i.priority>=t&&(i.paused=!0,n.push(i.target));return n},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_pauseTarget);var e=this._hashForTimers[t.__instanceId],e=(e&&(e.paused=!0),this._hashForUpdates[t.__instanceId]);e&&(e.entry.paused=!0)},resumeTarget:function(t){cc.assert(t,cc._LogInfos.Scheduler_resumeTarget);var e=this._hashForTimers[t.__instanceId],e=(e&&(e.paused=!1),this._hashForUpdates[t.__instanceId]);e&&(e.entry.paused=!1)},isTargetPaused:function(t){cc.assert(t,cc._LogInfos.Scheduler_isTargetPaused);var e=this._hashForTimers[t.__instanceId];return e?e.paused:!!(e=this._hashForUpdates[t.__instanceId])&&e.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unschedule(t.__instanceId+"",t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=-2147483648,cc._tmp.PrototypeLabelTTF=function(){var t=cc.LabelTTF.prototype;cc.defineGetterSetter(t,"color",t.getColor,t.setColor),cc.defineGetterSetter(t,"opacity",t.getOpacity,t.setOpacity),t.string,cc.defineGetterSetter(t,"string",t.getString,t.setString),t.textAlign,cc.defineGetterSetter(t,"textAlign",t.getHorizontalAlignment,t.setHorizontalAlignment),t.verticalAlign,cc.defineGetterSetter(t,"verticalAlign",t.getVerticalAlignment,t.setVerticalAlignment),t.fontSize,cc.defineGetterSetter(t,"fontSize",t.getFontSize,t.setFontSize),t.fontName,cc.defineGetterSetter(t,"fontName",t.getFontName,t.setFontName),t.font,cc.defineGetterSetter(t,"font",t._getFont,t._setFont),t.boundingSize,t.boundingWidth,cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t._setBoundingWidth),t.boundingHeight,cc.defineGetterSetter(t,"boundingHeight",t._getBoundingHeight,t._setBoundingHeight),t.fillStyle,cc.defineGetterSetter(t,"fillStyle",t._getFillStyle,t.setFontFillColor),t.strokeStyle,cc.defineGetterSetter(t,"strokeStyle",t._getStrokeStyle,t._setStrokeStyle),t.lineWidth,cc.defineGetterSetter(t,"lineWidth",t._getLineWidth,t._setLineWidth),t.shadowOffset,t.shadowOffsetX,cc.defineGetterSetter(t,"shadowOffsetX",t._getShadowOffsetX,t._setShadowOffsetX),t.shadowOffsetY,cc.defineGetterSetter(t,"shadowOffsetY",t._getShadowOffsetY,t._setShadowOffsetY),t.shadowOpacity,cc.defineGetterSetter(t,"shadowOpacity",t._getShadowOpacity,t._setShadowOpacity),t.shadowBlur,cc.defineGetterSetter(t,"shadowBlur",t._getShadowBlur,t._setShadowBlur)},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",_lineHeight:"normal",initWithString:function(t,e,i,n,r,c){t=t?t+"":"";return i=i||16,n=n||cc.size(0,0),r=r||cc.TEXT_ALIGNMENT_LEFT,c=c||cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._dimensions=cc.size(n.width,n.height),this._fontName=e||"Arial",this._hAlignment=r,this._vAlignment=c,this._fontSize=i,this._renderCmd._setFontStyle(this._fontName,i,this._fontStyle,this._fontWeight),this.string=t,this._renderCmd._setColorsString(),this._renderCmd._updateTexture(),this._setUpdateTextureDirty(),this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio(),!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(t,e,i,n,r,c){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.size(0,0),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontName="Arial",this._shadowEnabled=!1,this._shadowOffset=cc.p(0,0),this._shadowOpacity=0,this._shadowBlur=0,this._strokeEnabled=!1,this._strokeColor=cc.color(255,255,255,255),this._strokeSize=0,this._textFillColor=cc.color(255,255,255,255),this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._renderCmd._setColorsString(),this._textureLoaded=!0,e&&e instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(t,e):cc.LabelTTF.prototype.initWithString.call(this,t,e,i,n,r,c)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},getLineHeight:function(){return this._lineHeight&&!this._lineHeight.charAt&&this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(t){this._lineHeight=t},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(t,e){return this._updateWithTextDefinition(e,!1),this.string=t,this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio(),!0},setTextDefinition:function(t){t&&this._updateWithTextDefinition(t,!0)},getTextDefinition:function(){},enableShadow:function(t,e,i,n){null!=t.r&&null!=t.g&&null!=t.b&&null!=t.a?this._enableShadow(t,e,i):this._enableShadowNoneColor(t,e,i,n)},_enableShadowNoneColor:function(t,e,i,n){i=i||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var r=this._shadowOffset;(r&&r.x!==t||r._y!==e)&&(r.x=t,r.y=e),this._shadowOpacity!==i&&(this._shadowOpacity=i),this._renderCmd._setColorsString(),this._shadowBlur!==n&&(this._shadowBlur=n),this._setUpdateTextureDirty()},_enableShadow:function(t,e,i){var n;this._shadowColor||(this._shadowColor=cc.color(255,255,255,128)),this._shadowColor.r=t.r,this._shadowColor.g=t.g,this._shadowColor.b=t.b,n=e.width||e.x||0,e=e.height||e.y||0,t=null!=t.a?t.a/255:.5,this._enableShadowNoneColor(n,e,t,i)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x!==t&&(this._shadowOffset.x=t,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset._y!==t&&(this._shadowOffset._y=t,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,this._shadowOffset.y)},_setShadowOffset:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOffset.x===t.x&&this._shadowOffset.y===t.y||(this._shadowOffset.x=t.x,this._shadowOffset.y=t.y,this._setUpdateTextureDirty())},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowOpacity!==t&&(this._shadowOpacity=t,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},_setShadowBlur:function(t){!1===this._shadowEnabled&&(this._shadowEnabled=!0),this._shadowBlur!==t&&(this._shadowBlur=t,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(t,e){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var i=this._strokeColor;i.r===t.r&&i.g===t.g&&i.b===t.b||(i.r=t.r,i.g=t.g,i.b=t.b,this._renderCmd._setColorsString()),this._strokeSize!==e&&(this._strokeSize=e||0),this._setUpdateTextureDirty()},_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var e=this._strokeColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(t){!1===this._strokeEnabled&&(this._strokeEnabled=!0),this._strokeSize!==t&&(this._strokeSize=t||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(t){var e=this._textFillColor;e.r===t.r&&e.g===t.g&&e.b===t.b||(e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0)},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(t,e){t.fontDimensions?(this._dimensions.width=t.boundingWidth,this._dimensions.height=t.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=t.textAlign,this._vAlignment=t.verticalAlign,this._fontName=t.fontName,this._fontSize=t.fontSize||12,t.lineHeight?this._lineHeight=t.lineHeight:this._lineHeight=this._fontSize,this._renderCmd._setFontStyle(t),t.shadowEnabled&&this.enableShadow(t.shadowOffsetX,t.shadowOffsetY,t.shadowOpacity,t.shadowBlur),t.strokeEnabled&&this.enableStroke(t.strokeStyle,t.lineWidth),this.setFontFillColor(t.fillStyle),e&&this._renderCmd._updateTexture();t=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(t.colorDirty|t.opacityDirty|t.textDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale),this._scaleX*cc.view.getDevicePixelRatio()},setScale:function(t,e){this._scaleX=t/cc.view.getDevicePixelRatio(),this._scaleY=(e||0===e?e:t)/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(t){this._scaleX=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(t){this._scaleY=t/cc.view.getDevicePixelRatio(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(t){t=String(t),this._originalText!==t&&(this._originalText=t+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0),this._string=this._originalText},setHorizontalAlignment:function(t){t!==this._hAlignment&&(this._hAlignment=t,this._setUpdateTextureDirty())},setVerticalAlignment:function(t){t!==this._vAlignment&&(this._vAlignment=t,this._setUpdateTextureDirty())},setDimensions:function(t,e){var i;void 0===e?(i=t.width,e=t.height):i=t,i===this._dimensions.width&&e===this._dimensions.height||(this._dimensions.width=i,this._dimensions.height=e,this._updateString(),this._setUpdateTextureDirty())},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(t){t!==this._dimensions.width&&(this._dimensions.width=t,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(t){t!==this._dimensions.height&&(this._dimensions.height=t,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(t){this._fontName&&this._fontName!==t&&(this._fontName=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(t){t=cc.LabelTTF._fontStyleRE.exec(t);t&&(this._fontSize=parseInt(t[1]),this._fontName=t[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},getContentSize:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),cc.size(this._contentSize)},_getWidth:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.width},_getHeight:function(){return this._needUpdateTexture&&this._renderCmd._updateTTF(),this._contentSize.height},setTextureRect:function(t,e,i){cc.Sprite.prototype.setTextureRect.call(this,t,e,i,!1)},setDrawMode:function(t){this._onCacheCanvasMode=t},_createRenderCmd:function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL)return new cc.LabelTTF.WebGLRenderCmd(this)},_setFontStyle:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}}),cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js"),cc._tmp.PrototypeLabelTTF(),delete cc._tmp.PrototypeLabelTTF,cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/,cc.LabelTTF.create=function(t,e,i,n,r,c){return new cc.LabelTTF(t,e,i,n,r,c)},cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create,cc.sys.platform===cc.sys.WECHAT_GAME||window.kwaigame||(cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1),document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},!1)),cc.LabelCoefficientConfig={"Microsoft YaHei":1.334,Arial:1.134},cc.LabelTTF.__getFontHeightByDiv=function(t,e){if(cc.sys.platform===cc.sys.WECHAT_GAME||window.kwaigame)return i=18,n=cc.LabelCoefficientConfig[t]||1.34,i=t instanceof cc.FontDefinition?(r=t).fontSize*n:e*n,Math.ceil(i);var i,n=cc.LabelTTF.__labelHeightDiv;if(t instanceof cc.FontDefinition){var r=t;if(0<(i=cc.LabelTTF.__fontHeightCache[r._getCanvasFontStr()]))return i;n.innerHTML="ajghl~!",n.style.fontFamily=r.fontName,n.style.fontSize=r.fontSize+"px",n.style.fontStyle=r.fontStyle,n.style.fontWeight=r.fontWeight,i=n.clientHeight,cc.LabelTTF.__fontHeightCache[r._getCanvasFontStr()]=i}else{if(0<(i=cc.LabelTTF.__fontHeightCache[t+"."+e]))return i;n.innerHTML="ajghl~!",n.style.fontFamily=t,n.style.fontSize=e+"px",i=n.clientHeight,cc.LabelTTF.__fontHeightCache[t+"."+e]=i}return n.innerHTML="",i},cc.LabelTTF.__fontHeightCache={},cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF.wrapInspection=!0,cc.LabelTTF._wordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)/,cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>、‘“》？。，！]/,cc.LabelTTF._lastWordRex=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+|\S)$/,cc.LabelTTF._lastEnglish=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]+$/,cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôû]/,!function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18,this._fontStyleStr="",this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeColorStr="",this._fillColorStr="rgba(255,255,255,1)",this._labelCanvas=null,this._labelContext=null,this._lineWidths=[],this._strings=[],this._isMultiLine=!1,this._status=[],this._renderingIndex=0,this._texRect=cc.rect(),this._canUseDirtyRegion=!0};var t=cc.LabelTTF.RenderCmd.prototype,i=(t.constructor=cc.LabelTTF.RenderCmd,t._setFontStyle=function(t,e,i,n){var r;t instanceof cc.FontDefinition?(this._fontStyleStr=t._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t)):(r=e*cc.view.getDevicePixelRatio(),this._fontStyleStr=i+" "+n+" "+r+"px '"+t+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,e))},t._getFontStyle=function(){return this._fontStyleStr},t._getFontClientHeight=function(){return this._fontClientHeight},t._updateColor=function(){this._setColorsString(),this._updateTexture()},t._setColorsString=function(){var t=this._displayedColor,e=this._node,i=e._shadowColor||this._displayedColor,n=e._strokeColor,r=e._textFillColor,c=t.r/255,o=t.g/255,t=t.b/255;this._shadowColorStr="rgba("+(0|c*i.r)+","+(0|o*i.g)+","+(0|t*i.b)+","+e._shadowOpacity+")",this._fillColorStr="rgba("+(0|c*r.r)+","+(0|o*r.g)+","+(0|t*r.b)+", 1)",this._strokeColorStr="rgba("+(0|c*n.r)+","+(0|o*n.g)+","+(0|t*n.b)+", 1)"},new cc.Rect);t.getLocalBB=function(){var t=this._node,e=(i.x=i.y=0,cc.view.getDevicePixelRatio());return i.width=t._getWidth()*e,i.height=t._getHeight()*e,i},t._updateTTF=function(){var t,e,i=this._node,n=cc.view.getDevicePixelRatio(),r=i._dimensions.width*n,c=this._lineWidths,o=(c.length=0,this._isMultiLine=!1,this._measureConfig(),{});if(0!=r)for(this._strings=i._string.split("\n"),t=0;t<this._strings.length;t++)this._checkWarp(this._strings,t,r);else for(this._strings=i._string.split("\n"),t=0,e=this._strings.length;t<e;t++)this._strings[t]?(s=this._measure(this._strings[t]),c.push(s),o[this._strings[t]]=s):c.push(0);1<this._strings.length&&(this._isMultiLine=!0);var s,a,h=0,l=0,_=(i._strokeEnabled&&(h=l=2*i._strokeSize),i._shadowEnabled&&(a=i._shadowOffset,h+=2*Math.abs(a.x),l+=2*Math.abs(a.y)),a=0==r?this._isMultiLine?cc.size(Math.ceil(Math.max.apply(Math,c)+h),Math.ceil(this._fontClientHeight*n*this._strings.length+l)):(!(s=o[i._string])&&i._string&&(s=this._measure(i._string)),cc.size(Math.ceil((s||0)+h),Math.ceil(this._fontClientHeight*n+l))):0===i._dimensions.height?this._isMultiLine?cc.size(Math.ceil(r+h),Math.ceil(i.getLineHeight()*n*this._strings.length+l)):cc.size(Math.ceil(r+h),Math.ceil(i.getLineHeight()*n+l)):cc.size(Math.ceil(r+h),Math.ceil(i._dimensions.height*n+l)),"normal"!==i._getFontStyle()&&(a.width=Math.ceil(a.width+.3*i._fontSize)),0===this._strings.length?(this._texRect.width=1,this._texRect.height=a.height||1):(this._texRect.width=a.width,this._texRect.height=a.height),a.width/n),n=a.height/n,_=(i.setContentSize(_,n),i._strokeShadowOffsetX=h,i._strokeShadowOffsetY=l,i._anchorPoint);this._anchorPointInPoints.x=.5*h+(a.width-h)*_.x,this._anchorPointInPoints.y=.5*l+(a.height-l)*_.y},t._saveStatus=function(){var t=this._node,e=cc.view.getDevicePixelRatio(),i=t._strokeShadowOffsetX,n=t._strokeShadowOffsetY,r=t._contentSize.height*e-n,c=t._vAlignment,o=t._hAlignment,s=.5*i,n=r+.5*n,a=0,h=0,l=[],i=t._contentSize.width*e-i,_=t.getLineHeight()*e,u=(_-this._fontClientHeight*e)/2;if(o===cc.TEXT_ALIGNMENT_RIGHT?a+=i:o===cc.TEXT_ALIGNMENT_CENTER?a+=i/2:a+=0,this._isMultiLine){var d=this._strings.length;c===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?h=_-2*u+r-_*d:c===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(h=(_-2*u)/2+(r-_*d)/2);for(var p=0;p<d;p++)l.push(_*p+u-r+h)}else c!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&(c===cc.VERTICAL_TEXT_ALIGNMENT_TOP?h-=r:h-=.5*r),l.push(h);t={contextTransform:cc.p(s,n),xOffset:a,OffsetYArray:l};this._status.push(t)},t._drawTTFInCanvas=function(t){var e,i;t&&(i=this._status.pop(),t.setTransform(1,0,0,1,i.contextTransform.x,i.contextTransform.y),e=i.xOffset,i=i.OffsetYArray,this.drawLabels(t,e,i))},t._checkWarp=function(t,e,i){var n=t[e],r=this._measure(n);if(i<r&&1<n.length){for(var c,o,s=n.length*(i/r)|0,a=n.substr(s),h=r-this._measure(a),l=0,_=0;i<h&&_++<100;)a=n.substr(s=s*(i/h)|0),h=r-this._measure(a);for(_=0;h<i&&_++<100;)a&&(l=(c=cc.LabelTTF._wordRex.exec(a))?c[0].length:1,o=a),s+=l,a=n.substr(s),h=r-this._measure(a);0===(s-=l)&&(o=o.substr(s=1));var u,d=n.substr(0,s);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(o||a)&&(s-=(u=cc.LabelTTF._lastWordRex.exec(d))?u[0].length:0,o=n.substr(s=0===s?1:s),d=n.substr(0,s)),cc.LabelTTF._firsrEnglish.test(o)&&(u=cc.LabelTTF._lastEnglish.exec(d))&&d!==u[0]&&(s-=u[0].length,o=n.substr(s),d=n.substr(0,s)),t[e]=o||a,t.splice(e,0,d)}},t.updateStatus=function(){var t=cc.Node._dirtyFlags;this._dirtyFlag&t.textDirty&&this._updateTexture(),cc.Node.RenderCmd.prototype.updateStatus.call(this),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty^this._dirtyFlag)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.textDirty&&this._updateTexture(),cc.Node.RenderCmd.prototype._syncStatus.call(this,t),(cc._renderType===cc.game.RENDER_TYPE_WEBGL||i&e.transformDirty)&&this.transform(t)},t.drawLabels=function(t,e,i){for(var n=this._node,r=(n._shadowEnabled&&(r=n._shadowOffset,t.shadowColor=this._shadowColorStr,t.shadowOffsetX=r.x,t.shadowOffsetY=-r.y,t.shadowBlur=n._shadowBlur),n._hAlignment),c=n._vAlignment,o=n._strokeSize,s=(t.font!==this._fontStyleStr&&(t.font=this._fontStyleStr),t.fillStyle=this._fillColorStr,n._strokeEnabled),a=(s&&(t.lineWidth=2*o,t.strokeStyle=this._strokeColorStr),t.textBaseline=cc.LabelTTF._textBaseline[c],t.textAlign=cc.LabelTTF._textAlign[r],this._strings.length),h=0;h<a;h++){var l=this._strings[h];s&&(t.lineJoin="round",t.strokeText(l,e,i[h])),t.fillText(l,e,i[h])}cc.g_NumberOfDraws++}}(),!function(){cc.LabelTTF.CacheRenderCmd=function(t){cc.LabelTTF.RenderCmd.call(this,t);t=this._labelCanvas=document.createElement("canvas");t.width=1,t.height=1,this._labelContext=t.getContext("2d"),this._texRect=cc.rect()},cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype),cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var t=cc.LabelTTF.CacheRenderCmd.prototype;t.constructor=cc.LabelTTF.CacheRenderCmd,t._updateTexture=function(){this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.textDirty^this._dirtyFlag;var t,e=this._node,i=(this._updateTTF(),this._texRect.width),n=this._texRect.height,r=this._labelContext,c=this._labelCanvas;return e._texture||((t=new cc.Texture2D).initWithElement(this._labelCanvas),e.setTexture(t)),0===e._string.length?(c.width=i,c.height=n,e._texture&&(e._texture._htmlElementObj=this._labelCanvas,e._texture.handleLoadedTexture()),e.setTextureRect(this._texRect)):(r.font=this._fontStyleStr,t=c.width===i&&c.height===n,c.width=this._texRect.width,c.height=this._texRect.height,t&&r.clearRect(0,0,i,n),this._saveStatus(),this._drawTTFInCanvas(r),e._texture&&(e._texture._htmlElementObj=this._labelCanvas,e._texture.handleLoadedTexture()),e.setTextureRect(this._texRect)),!0},t._measureConfig=function(){this._labelContext.font=this._fontStyleStr},t._measure=function(e){try{return this._labelContext.measureText(e).width}catch(t){return 24*e.length}}}();var cc,GlobalVertexBuffer=((cc=cc||{})._tmp=cc._tmp||{},cc.associateWithNative=function(t,e){},cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new i,t.prototype.constructor=t},cc.base=function(t,e,i){var n=arguments.callee.caller;if(n.superClass_)return ret=n.superClass_.constructor.apply(t,Array.prototype.slice.call(arguments,1));for(var r=Array.prototype.slice.call(arguments,2),c=!1,o=t.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[e]===n)c=!0;else if(c)return o.prototype[e].apply(t,r);if(t[e]===n)return t.constructor.prototype[e].apply(t,r);throw Error("cc.base called from a method of one name to a method of a different name")},function(){function t(t,e){this.gl=t,this.vertexBuffer=t.createBuffer(),this.size=888,this.byteLength=e||3552*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,this.data=new ArrayBuffer(this.byteLength),this.dataArray=new Float32Array(this.data),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.dataArray,t.DYNAMIC_DRAW),this._dirty=!1,this._spaces={0:this.byteLength}}return t.prototype={constructor:t,allocBuffer:function(t,e){var i=this._spaces[t];return!!(i&&e<=i)&&(delete this._spaces[t],e<i&&(this._spaces[t+e]=i-e),!0)},requestBuffer:function(t){var e,i;for(e in this._spaces)if(i=parseInt(e),t<=this._spaces[e]&&this.allocBuffer(i,t))return i;return-1},freeBuffer:function(t,e){var i,n,r,c=this._spaces;for(n in c){if(t<(i=parseInt(n)))break;if(i+c[n]>=t){e=e+t-i,t=i;break}}this._spaces[r=t+e]&&(e+=this._spaces[r],delete this._spaces[r]),this._spaces[t]=e},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},updateSubData:function(t,e){this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,t,e)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer),this.data=null,this.positions=null,this.colors=null,this.texCoords=null,this.vertexBuffer=null}},t}()),_p;cc.profiler=function(){for(var t=!1,e=!1,i=0,n=0,r=0,c=0,o=0,s=0,a=0,h=null,l=document.createElement("div"),_=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div"),p=document.createElement("div"),f=.6,g=10,m=[0,10,20,30],T=[0,0,0,0],E=3,y=0,S=0,C=(p.id="fps",p.style.position="absolute",p.style.padding="3px",p.style.textAlign="left",p.style.backgroundColor="rgba(0, 0, 34, .6)",p.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px",p.style.left=cc.DIRECTOR_STATS_POSITION.x+"px",p.style.width="45px",p.style.height="60px","rgb(0, 255, 255)"),x="rgb(255, 0, 0)",v=[d,u,l,_],R=0;R<v.length;++R){var A=v[R].style;A.color=C,A.font="bold 12px Helvetica, Arial",A.lineHeight="16px",A.width="100%",v[R].innerText="计算中..",p.appendChild(v[R])}function b(t){var e,i=m.length-1,n=i,r=0;for(y++,S+=t;0<=n;n--)if(t>=m[n]){T[n]++;break}if(g<=y){for(r=S/g,n=i;0<n;n--)if(e=T[n]/g,f<=e&&r>=m[n]){n!=E&&(E=n,w.onFrameRateChange)&&w.onFrameRateChange(r.toFixed(2));break}for(_changeCount=0,S=y=0,n=i;0<n;n--)T[n]=0}}function I(t,e){t.style.color=e?x:C}function L(){r=cc.director.getSecondsPerFrame(),i++,c+=cc.director.getDeltaTime(),o++,a+=cc.director.getDeltaTime(),c>cc.DIRECTOR_FPS_INTERVAL&&(n=i/c,c=i=0,w.onFrameRateChange&&b(n),t)&&(u.innerText=r.toFixed(3),l.innerText=n.toFixed(1),I(l,n<24),d.innerText=(0|cc.g_NumberOfDraws).toString()),a>cc.DIRECTOR_FPS_INTERVAL_LONG&&(s=o/a,a=o=0,w.onFrameRateChange&&b(s),t)&&(_.innerText=s.toFixed(1),I(_,s<24))}var w={onFrameRateChange:null,getSecondsPerFrame:function(){return r},getFrameRate:function(){return n},setProfileDuration:function(t){!isNaN(t)&&0<t&&(g=t/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(h,1)},stopProfiling:function(){cc.eventManager.removeListener(h)},isShowingStats:function(){return t},showStats:function(){e||this.init(),null===p.parentElement&&cc.container.appendChild(p),t=!0},hideStats:function(){e||this.init(),t=!1,p.parentElement===cc.container&&cc.container.removeChild(p)},init:function(){e||(h=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,L),e=!0)}};return w}(),cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){var t,n;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}}),t=cc.Director.prototype,n=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);for(var e=t._children,i=0;i<e.length;i++)n(e[i])}},cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){cc.director;for(var t=cc.director._scenesStack,e=0;e<t.length;e++)n(t[e])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints,n=(e.setViewport(),e._openGLView);n._viewPortRect.x,n._scaleX,n._viewPortRect.y,n._scaleY;t===cc.Director.PROJECTION_2D?(cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),n=cc.math.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024),cc.kmGLMultMatrix(n),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity()):cc.log(cc._LogInfos.Director_setProjection),e._projection=t,cc.eventManager.dispatchEvent(e._eventProjectionChanged),cc.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){cc.renderer._clearColor=t},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view;t=cc.configuration;t.gatherGPUInfo(),t.dumpInfo(),this.setGLDefaultValues(),cc.eventManager&&cc.eventManager.setEnabled(!0)},t._clear=function(){var t=cc._renderContext;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t,e=this._openGLView;e&&(t=this._winSizeInPoints,e.setViewPortInPoints(-e._viewPortRect.x/e._scaleX,-e._viewPortRect.y/e._scaleY,t.width,t.height))},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)})}),cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return-1<this._GlExtensions.indexOf(t)},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]||e},setValue:function(t,e){this._valueDict[t]=e},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();for(var t=cc._renderContext,e=this._valueDict,i=(e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="",t.getSupportedExtensions()),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);cc.assert(e,cc._LogInfos.configuration_loadConfigFile_2,t);var i=e.data;if(i)for(var n in i)this._valueDict[n]=i[n];else cc.log(cc._LogInfos.configuration_loadConfigFile,t)}},cc.rendererWebGL=function(){var s={texture:null,blendSrc:null,blendDst:null,shader:null},o=null,a=null,h=0,l=0,_=6,u=null,d=null,p=null;function i(t){var e=cc._renderContext;if(o){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o);for(var i=new Uint16Array(6*t),n=0,r=0,c=6*t;r<c;r+=6)i[r]=n+0,i[r+1]=n+1,i[r+2]=n+2,i[r+3]=n+1,i[r+4]=n+2,i[r+5]=n+3,n+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW)}a&&(u=new ArrayBuffer(4*(4*t*_)),d=new Float32Array(u),p=new Uint32Array(u),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,d,e.DYNAMIC_DRAW)),h=4*t}return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),init:function(){var t,e=cc._renderContext;e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),e=2e3,t=cc._renderContext,null===o&&(a=t.createBuffer(),o=t.createBuffer()),i(e),cc.sys.os,cc.sys.OS_IOS},getVertexSize:function(){return h},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,this._cacheToBufferCmds[t=t||0]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],e=(e&&(e.length=0,delete this._cacheToBufferCmds[t]),this._cacheInstanceIds);cc.arrayRemoveObject(e,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext,i=(this.rendering(i,e),this._removeCache(t),this._cacheInstanceIds);0===i.length?this._isCacheToBufferOn=!1:this._currentID=i[i.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t,e,i=this._transformNodePool;for(i.sort(this._sortNodeByLevelAsc),t=0,e=i.length;t<e;t++)i[t].updateStatus();i.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){var e;t.needDraw()&&(this._isCacheToBufferOn?(e=this._currentID,-1===(e=this._cacheToBufferCmds[e]).indexOf(t)&&e.push(t)):-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t))},_increaseBatchingSize:function(t){l+=t},_uploadBufferData:function(t){h<=l&&this._batchRendering();var e=t._node,i=e._texture||(e._spriteFrame?e._spriteFrame._texture:null),n=e._blendFunc.src,e=e._blendFunc.dst,r=t._shaderProgram,i=(s.texture===i&&s.blendSrc===n&&s.blendDst===e&&s.shader===r||(this._batchRendering(),s.texture=i,s.blendSrc=n,s.blendDst=e,s.shader=r),t.uploadData(d,p,l*_));0<i&&(l+=i)},_batchRendering:function(){var t,e,i,n;0!==l&&s.texture&&(t=cc._renderContext,n=s.texture,e=l/4,(i=s.shader)&&(i.use(),i._updateProjectionUniform()),cc.glBlendFunc(s.blendSrc,s.blendDst),cc.glBindTexture2DN(0,n),i=!t.bindBuffer(t.ARRAY_BUFFER,a),.5*h<l?t.bufferData(t.ARRAY_BUFFER,d,t.DYNAMIC_DRAW):(n=d.subarray(0,l*_),t.bufferData(t.ARRAY_BUFFER,n,t.DYNAMIC_DRAW)),i&&(t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.drawElements(t.TRIANGLES,6*e,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,l=0)},rendering:function(t,e){var i,n,r,c=e||this._renderCmds,o=t||cc._renderContext;for(o.bindBuffer(gl.ARRAY_BUFFER,null),i=0,n=c.length;i<n;++i)(r=c[i]).uploadData?this._uploadBufferData(r):(0<l&&this._batchRendering(),r.rendering(o));this._batchRendering(),s.texture=null}}}(),!function(){cc.Node.WebGLRenderCmd=function(t){cc.Node.RenderCmd.call(this,t),this._shaderProgram=null};var t=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);t.constructor=cc.Node.WebGLRenderCmd,t._updateColor=function(){},t.setShaderProgram=function(t){this._shaderProgram=t},t.getShaderProgram=function(){return this._shaderProgram}}(),!function(){cc.Layer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Layer.WebGLRenderCmd,t.bake=function(){},t.unbake=function(){},t._bakeForAddChild=function(){}}(),!function(){cc.LayerColor.WebGLRenderCmd=function(t){cc.Layer.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity();var t=this,e=(t._squareVerticesAB=new ArrayBuffer(48),t._squareColorsAB=new ArrayBuffer(16),t._squareVerticesAB),i=t._squareColorsAB,n=cc.Vertex3F.BYTES_PER_ELEMENT,r=cc._WebGLColor.BYTES_PER_ELEMENT;t._squareVertices=[new cc.Vertex3F(0,0,0,e,0),new cc.Vertex3F(0,0,0,e,n),new cc.Vertex3F(0,0,0,e,2*n),new cc.Vertex3F(0,0,0,e,3*n)],t._squareColors=[new cc._WebGLColor(0,0,0,255,i,0),new cc._WebGLColor(0,0,0,255,i,r),new cc._WebGLColor(0,0,0,255,i,2*r),new cc._WebGLColor(0,0,0,255,i,3*r)],t._verticesFloat32Buffer=cc._renderContext.createBuffer(),t._colorsUint8Buffer=cc._renderContext.createBuffer(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var t=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);t.constructor=cc.LayerColor.WebGLRenderCmd,t.rendering=function(t){var t=t||cc._renderContext,e=this._node,i=this._worldTransform;this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,this._squareVertices.length)},t.transform=function(t,e){this.originTransform(t,e);var t=this._node,e=t._contentSize.width,i=t._contentSize.height,n=this._squareVertices;n[1].x=e,n[2].y=i,n[3].x=e,n[3].y=i,n[0].z=n[1].z=n[2].z=n[3].z=t._vertexZ,this._bindLayerVerticesBufferData()},t._updateColor=function(){for(var t=this._displayedColor,e=this._displayedOpacity,i=this._squareColors,n=0;n<4;n++)i[n].r=t.r,i[n].g=t.g,i[n].b=t.b,i[n].a=e;this._bindLayerColorsBufferData()},t._bindLayerVerticesBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareVerticesAB,t.DYNAMIC_DRAW)},t._bindLayerColorsBufferData=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.bufferData(t.ARRAY_BUFFER,this._squareColorsAB,t.STATIC_DRAW)},t.updateBlendFunc=function(t){}}(),!function(){cc.LayerGradient.WebGLRenderCmd=function(t){cc.LayerColor.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._clipRect=new cc.Rect,this._clippingRectDirty=!1};var t=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);t.constructor=cc.LayerGradient.WebGLRenderCmd,t.updateStatus=function(){var t=cc.Node._dirtyFlags,e=this._dirtyFlag;e&t.gradientDirty&&(this._dirtyFlag|=t.colorDirty,this._updateVertex(),this._dirtyFlag=e&t.gradientDirty^e),cc.Node.RenderCmd.prototype.updateStatus.call(this)},t._syncStatus=function(t){var e=cc.Node._dirtyFlags,i=this._dirtyFlag;i&e.gradientDirty&&(this._dirtyFlag|=e.colorDirty,this._updateVertex(),this._dirtyFlag=i&e.gradientDirty^i),cc.Node.RenderCmd.prototype._syncStatus.call(this,t)},t.transform=function(t,e){this.originTransform(t,e),this._updateVertex()},t._updateVertex=function(){var t=this._node,e=t._colorStops;if(e&&!(e.length<2)){this._clippingRectDirty=!0;var i=e.length,n=2*i,r=t._contentSize,c=this._squareVertices;if(c.length<n){this._squareVerticesAB=new ArrayBuffer(12*n),c.length=0;for(var o=this._squareVerticesAB,s=cc.Vertex3F.BYTES_PER_ELEMENT,a=0;a<n;a++)c.push(new cc.Vertex3F(0,0,0,o,s*a))}var h=Math.PI+cc.pAngleSigned(cc.p(0,-1),t._alongVector),l=cc.p(r.width/2,r.height/2),_=Math.round(cc.radiansToDegrees(h)),u=cc.affineTransformMake(1,0,0,1,l.x,l.y),u=cc.affineTransformRotate(u,h),_=_<90?(p=cc.p(-l.x,l.y),cc.p(l.x,l.y)):_<180?(p=cc.p(l.x,l.y),cc.p(l.x,-l.y)):_<270?(p=cc.p(l.x,-l.y),cc.p(-l.x,-l.y)):(p=cc.p(-l.x,-l.y),cc.p(-l.x,l.y)),d=Math.sin(h),h=Math.cos(h),p=Math.abs((p.x*h-p.y*d)/l.x),d=Math.abs((_.x*d+_.y*h)/l.y);for(u=cc.affineTransformScale(u,p,d),a=0;a<i;a++){var f=e[a].p*r.height,g=cc.pointApplyAffineTransform(-l.x,f-l.y,u),g=(c[2*a].x=g.x,c[2*a].y=g.y,c[2*a].z=t._vertexZ,cc.pointApplyAffineTransform(r.width-l.x,f-l.y,u));c[2*a+1].x=g.x,c[2*a+1].y=g.y,c[2*a+1].z=t._vertexZ}this._bindLayerVerticesBufferData()}},t._updateColor=function(){var t=this._node._colorStops;if(t&&!(t.length<2)){var e=t.length,n=this._squareColors,r=2*e;if(n.length<r){this._squareColorsAB=new ArrayBuffer(4*r),n.length=0;var c=this._squareColorsAB,o=cc._WebGLColor.BYTES_PER_ELEMENT;for(i=0;i<r;i++)n.push(new cc._WebGLColor(0,0,0,255,c,o*i))}var s=this._displayedOpacity/255;for(i=0;i<e;i++){var a=t[i].color,h=n[2*i],l=n[2*i+1];h.r=a.r,h.g=a.g,h.b=a.b,h.a=a.a*s,l.r=a.r,l.g=a.g,l.b=a.b,l.a=a.a*s}this._bindLayerColorsBufferData()}},t.rendering=function(t){var t=t||cc._renderContext,e=this._node,i=this._getClippingRect(),i=(t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(i.x,i.y,i.width,i.height),this._worldTransform);this._matrix.mat[0]=i.a,this._matrix.mat[4]=i.c,this._matrix.mat[12]=i.tx,this._matrix.mat[1]=i.b,this._matrix.mat[5]=i.d,this._matrix.mat[13]=i.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc.glBlendFunc(e._blendFunc.src,e._blendFunc.dst),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,this._squareVertices.length),t.disable(t.SCISSOR_TEST)},t._getClippingRect=function(){var t,e;return this._clippingRectDirty&&(e=this._node,t=cc.rect(0,0,e._contentSize.width,e._contentSize.height),e=e.getNodeToWorldTransform(),this._clipRect=cc._rectApplyAffineTransformIn(t,e)),this._clipRect}}(),!function(){cc.Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._color=new Uint32Array(1),this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)};var t=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.Sprite.WebGLRenderCmd,t.updateBlendFunc=function(t){},t.setDirtyFlag=function(t){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},t.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)(e=i[r])instanceof cc.Sprite&&e._renderCmd.setDirtyRecursively(t)},t._setBatchNodeForAddChild=function(t){var e=this._node;if(e._batchNode){if(!(t instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;t.texture._webTextureObj!==e.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2),e._batchNode.appendChild(t),e._reorderChildDirty||e._setReorderChildDirtyRecursively()}return!0},t._handleTextureForRotatedTexture=function(t){return t},t.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().getName()===e._texture.getName()&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},t._textureLoadedCallback=function(t){var e;this._textureLoaded||(this._textureLoaded=!0,(e=this._rect)?cc._rectEqualToZero(e)&&(e.width=t.width,e.height=t.height):e=cc.rect(0,0,t.width,t.height),this.texture=t,this.setTextureRect(e,this._rectRotated),this.setBatchNode(this._batchNode),this.dispatchEvent("load"),cc.renderer.childrenOrderDirty=!0)},t._setTextureCoords=function(t,e){(e=void 0===e?!0:e)&&(t=cc.rectPointsToPixels(t));var i,n,r,c,o,s,e=this._node,a=e._batchNode?e.textureAtlas.texture:e._texture,h=this._vertices;a&&(i=a.pixelsWidth,a=a.pixelsHeight,e._rectRotated?(o=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(r=(n=(2*t.x+1)/(2*i))+(2*t.height-2)/(2*i),(c=(2*t.y+1)/(2*a))+(2*t.width-2)/(2*a)):(n=t.x/i,r=(t.x+t.height)/i,c=t.y/a,(t.y+t.width)/a),e._flippedX&&(s=c,c=o,o=s),e._flippedY&&(s=n,n=r,r=s),h[0].u=r,h[0].v=c,h[1].u=n,h[1].v=c,h[2].u=r,h[2].v=o,h[3].u=n):(o=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(r=(n=(2*t.x+1)/(2*i))+(2*t.width-2)/(2*i),(c=(2*t.y+1)/(2*a))+(2*t.height-2)/(2*a)):(n=t.x/i,r=(t.x+t.width)/i,c=t.y/a,(t.y+t.height)/a),e._flippedX&&(s=n,n=r,r=s),e._flippedY&&(s=c,c=o,o=s),h[0].u=n,h[0].v=c,h[1].u=n,h[1].v=o,h[2].u=r,h[2].v=c,h[3].u=r),h[3].v=o)},t._setColorDirty=function(){},t._updateBlendFunc=function(){var t,e;this._batchNode||(e=(t=this._node)._blendFunc,t._texture&&t._texture.hasPremultipliedAlpha()?(e.src===cc.SRC_ALPHA&&e.dst===cc.BLEND_DST&&(e.src=cc.ONE),t.opacityModifyRGB=!0):(e.src===cc.ONE&&e.dst===cc.BLEND_DST&&(e.src=cc.SRC_ALPHA),t.opacityModifyRGB=!1))},t._setTexture=function(t){var e=this._node;e._batchNode?e._batchNode.texture!==t&&cc.log(cc._LogInfos.Sprite_setTexture):e._texture!==t&&(e._textureLoaded=!!t&&t._textureLoaded,e._texture=t,this._updateBlendFunc(),e._textureLoaded)&&(cc.renderer.childrenOrderDirty=!0)},t._checkTextureBoundary=function(t,e,i){var n;t&&t.url&&(i=i?(n=e.x+e.height,e.y+e.width):(n=e.x+e.width,e.y+e.height),n>t.width&&cc.error(cc._LogInfos.RectWidth,t.url),i>t.height)&&cc.error(cc._LogInfos.RectHeight,t.url)},t.transform=function(t,e){this.originTransform(t,e);var t=this._node,e=t._offsetPosition.x,i=e+t._rect.width,n=t._offsetPosition.y,t=n+t._rect.height,r=this._worldTransform,c=r.tx,o=r.ty,s=e*r.a,e=e*r.b,a=i*r.a,i=i*r.b,h=t*r.c,t=t*r.d,l=n*r.c,n=n*r.d,r=this._vertices;r[0].x=s+h+c,r[0].y=e+t+o,r[1].x=s+l+c,r[1].y=e+n+o,r[2].x=a+h+c,r[2].y=i+t+o,r[3].x=a+l+c,r[3].y=i+n+o},t.needDraw=function(){var t=this._node._texture;return this._needDraw&&t},t.uploadData=function(t,e,i){var n=this._node,r=n._texture;if(!(r&&r._textureLoaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return!1;for(var c,o,r=this._displayedOpacity,s=this._displayedColor.r,a=this._displayedColor.g,h=this._displayedColor.b,l=(n._opacityModifyRGB&&(s*=c=r/255,a*=c,h*=c),this._color[0]=r<<24|h<<16|a<<8|s,n._vertexZ),_=this._vertices,u=_.length,d=i,p=0;p<u;++p)o=_[p],t[d]=o.x,t[d+1]=o.y,t[d+2]=l,e[d+3]=this._color[0],t[d+4]=o.u,t[d+5]=o.v,d+=6;return u}}(),!function(){cc.LabelTTF.WebGLRenderCmd=function(t){cc.Sprite.WebGLRenderCmd.call(this,t),cc.LabelTTF.CacheRenderCmd.call(this)};var t=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,t),t.constructor=cc.LabelTTF.WebGLRenderCmd,t._updateColor=function(){}}(),(_p=cc.inputManager)._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc._canvas.addEventListener("keyup",function(t){cc.eventManager.dispatchEvent(new cc.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},delete _p,cc.vertexLineToPolygon=function(t,e,i,n,r){if(!((r+=n)<=1)){e*=.5;for(var c=r-1,o=n;o<r;o++){var s,a,h,l,_,u=2*o,d=cc.p(t[2*o],t[2*o+1]);_=0===o?cc.pPerp(cc.pNormalize(cc.pSub(d,cc.p(t[2*(o+1)],t[2*(o+1)+1])))):o===c?cc.pPerp(cc.pNormalize(cc.pSub(cc.p(t[2*(o-1)],t[2*(o-1)+1]),d))):(s=cc.p(t[2*(o-1)],t[2*(o-1)+1]),a=cc.p(t[2*(o+1)],t[2*(o+1)+1]),h=cc.pNormalize(cc.pSub(a,d)),l=cc.pNormalize(cc.pSub(s,d)),(_=Math.acos(cc.pDot(h,l)))<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(h,l))):_<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(h,l)):cc.pPerp(cc.pNormalize(cc.pSub(a,s)))),_=cc.pMult(_,e),i[2*u]=d.x+_.x,i[2*u+1]=d.y+_.y,i[2*(u+1)]=d.x-_.x,i[2*(u+1)+1]=d.y-_.y}for(o=n=0===n?0:n-1;o<c;o++){var p=(u=2*o)+2,f=cc.vertex2(i[2*u],i[2*u+1]),g=cc.vertex2(i[2*(u+1)],i[2*(u+1)+1]),m=cc.vertex2(i[2*p],i[2*p]),T=cc.vertex2(i[2*(p+1)],i[2*(p+1)+1]),f=!cc.vertexLineIntersect(f.x,f.y,T.x,T.y,g.x,g.y,m.x,m.y);f.isSuccess||(f.value<0||1<f.value)&&(f.isSuccess=!0),f.isSuccess&&(i[2*p]=T.x,i[2*p+1]=T.y,i[2*(p+1)]=m.x,i[2*(p+1)+1]=m.y)}}},cc.vertexLineIntersect=function(t,e,i,n,r,c,o,s){return t===i&&e===n||r===o&&c===s||(n-=e,c-=e,o-=t,s-=e,n=(r-=t)*(t=(i-=t)/(e=Math.sqrt(i*i+n*n)))+c*(i=n/e),c=c*t-r*i,r=n,n=o*t+s*i,s=s*t-o*i,o=n,c===s)?{isSuccess:!1,value:0}:{isSuccess:!0,value:(o+(r-o)*s/(s-c))/e}},cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(t,e){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD),this._keyCode=t,this._isPressed=e}}),cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var e=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(t){t._isPressed?e.onKeyPressed&&e.onKeyPressed(t._keyCode,t):e.onKeyReleased&&e.onKeyReleased(t._keyCode,t)})},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard",cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard},cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getRotation:"RotationX != RotationY. Don't know which one to return",Node_getScale:"ScaleX != ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag = %s): child not found!",Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"child must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex = %s",swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_reorderChild:"cc.Sprite.reorderChild(): this child is not in children list",Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_reorderChild_2:"cc.Sprite.reorderChild(): child should be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_setSpriteFrame:"Invalid spriteFrameName",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."},cc._logToWebPage=function(t){var e,i,n,r;cc._canvas&&(e=cc._logList,i=document,e||(r=(n=i.createElement("Div")).style,n.setAttribute("id","logInfoDiv"),cc._canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc._canvas.height),r.zIndex="99999",r.position="absolute",r.top="0",r.left="0",r=(e=cc._logList=i.createElement("textarea")).style,e.setAttribute("rows","20"),e.setAttribute("cols","30"),e.setAttribute("disabled",!0),n.appendChild(e),r.backgroundColor="transparent",r.borderBottom="1px solid #cccccc",r.borderRightWidth="0px",r.borderLeftWidth="0px",r.borderTopWidth="0px",r.borderTopStyle="none",r.borderRightStyle="none",r.borderLeftStyle="none",r.padding="0px",r.margin=0),e.value=e.value+t+"\r\n",e.scrollTop=e.scrollHeight)},cc._formatString=function(t){if(!cc.isObject(t))return t;try{return JSON.stringify(t)}catch(t){return""}},cc._initDebugSetting=function(t){var n,e=cc.game;t!==e.DEBUG_MODE_NONE&&(t>e.DEBUG_MODE_ERROR?(n=cc._logToWebPage.bind(cc),cc.error=function(){n("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));n("Assert: "+e)}},t!==e.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(cc.warn=function(){n("WARN :  "+cc.formatStr.apply(cc,arguments))}),t===e.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(cc.log=function(){n(cc.formatStr.apply(cc,arguments))})):console&&console.log.apply&&(cc.error=Function.prototype.bind.call(console.error,console),console.assert?cc.assert=Function.prototype.bind.call(console.assert,console):cc.assert=function(t,e){if(!t&&e){for(var i=2;i<arguments.length;i++)e=e.replace(/(%s)|(%d)/,cc._formatString(arguments[i]));throw new Error(e)}},t!==e.DEBUG_MODE_ERROR&&(cc.warn=Function.prototype.bind.call(console.warn,console)),t===e.DEBUG_MODE_INFO)&&(cc.log=Function.prototype.bind.call(console.log,console)))},cc.HashElement=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},cc.ActionManager=cc.Class.extend({_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null},_getElement:function(t,e){var i=this._elementPool.pop();return(i=i||new cc.HashElement).target=t,i.paused=!!e,i},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): target must be non-null");var n=this._hashTargets[e.__instanceId];n?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){null!=t&&(t=this._hashTargets[t.__instanceId])&&(t.actions.length=0,this._deleteHashElement(t))},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1),i.actionIndex>=n&&i.actionIndex--;break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction),cc.assert(e,cc._LogInfos.ActionManager_addAction);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;r<n;++r){var c=i.actions[r];if(c&&c.getTag()===t&&c.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){t===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,t)}return null},numberOfRunningActionsInTarget:function(t){t=this._hashTargets[t.__instanceId];return t&&t.actions?t.actions.length:0},pauseTarget:function(t){t=this._hashTargets[t.__instanceId];t&&(t.paused=!0)},resumeTarget:function(t){t=this._hashTargets[t.__instanceId];t&&(t.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t];e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target.__instanceId]){delete this._hashTargets[t.target.__instanceId];for(var i=this._arrayTargets,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i,n=this._arrayTargets,r=0;r<n.length;r++){if(this._currentTarget=n[r],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)e.currentAction=e.actions[e.actionIndex],e.currentAction&&(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()&&(e.currentAction.stop(),i=e.currentAction,e.currentAction=null,this.removeAction(i)),e.currentAction=null);e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}}),cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.ACTION_TAG_INVALID},copy:function(){return cc.log("copy is deprecated. Please use clone instead."),this.clone()},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.log("[Action step]. override me")},update:function(t){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.action=function(){return new cc.Action},cc.Action.create=cc.action,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,e=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,e),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){var i;if(t)return i=this,e=e||cc.rect(0,0,0,0),i._followedNode=t,i._worldRect=e,i._boundarySet=!cc._rectEqualToZero(e),i._boundaryFullyCovered=!1,t=cc.director.getWinSize(),i._fullScreenSize=cc.p(t.width,t.height),i._halfScreenSize=cc.pMult(i._fullScreenSize,.5),i._boundarySet&&(i.leftBoundary=-(e.x+e.width-i._fullScreenSize.x),i.rightBoundary=-e.x,i.topBoundary=-e.y,i.bottomBoundary=-(e.y+e.height-i._fullScreenSize.y),i.rightBoundary<i.leftBoundary&&(i.rightBoundary=i.leftBoundary=(i.leftBoundary+i.rightBoundary)/2),i.topBoundary<i.bottomBoundary&&(i.topBoundary=i.bottomBoundary=(i.topBoundary+i.bottomBoundary)/2),i.topBoundary===i.bottomBoundary)&&i.leftBoundary===i.rightBoundary&&(i._boundaryFullyCovered=!0),!0;throw new Error("cc.Follow.initWithAction(): followedNode must be non nil")},step:function(t){var e=this._followedNode.x,i=this._followedNode.y,e=this._halfScreenSize.x-e,i=this._halfScreenSize.y-i;this.target._renderCmd._dirtyFlag=0,this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(e,this.leftBoundary,this.rightBoundary),cc.clampf(i,this.bottomBoundary,this.topBoundary)):this.target.setPosition(e,i)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)},cc.Follow.create=cc.follow,cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(e&&0!==e.length)for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;t=this._elapsed/(1.192092896e-7<this._duration?this._duration:1.192092896e-7);this.update(0<(t=t<1?t:1)?t:0),this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(t){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){return cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass."),0},speed:function(t){return t<=0?cc.log("The speed parameter error"):(this._speedMethod=!0,this._speed*=t),this},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?cc.log("The repeat parameter error"):(this._repeatMethod=!0,this._timesForRepeat*=t),this},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.ActionInterval.create=cc.actionInterval,cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments,i=e.length-1;if(0<=i&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),0<=i){for(var n,r=e[0],c=1;c<i;c++)e[c]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[c]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){var i;if(t&&e)return i=t._duration+e._duration,this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0;throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil")},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i=0,n=this._split,r=this._actions,c=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===i&&1===c&&(r[1].update(0),r[1].stop())):(e=(i=1)===n?1:(t-n)/(1-n),-1===c&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),c||(r[0].update(1),r[0].stop())),t=r[i],c===i&&t.isDone()||(c!==i&&t.startWithTarget(this.target),e*=t._timesForRepeat,t.update(1<e?e%1:e),this._last=i)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.sequence=function(t){var e,i,n,r,c=t instanceof Array?t:arguments;for(0<c.length&&null==c[c.length-1]&&cc.log("parameters should not be ending with null in Javascript");c&&0<c.length;)for(r=(i=Array.prototype.shift.call(c))._timesForRepeat||1,i._repeatMethod=!1,i._timesForRepeat=1,n=0,e||(e=i,n=1);n<r;n++)e=cc.Sequence._actionOneTwo(e,i);return e},cc.Sequence.create=cc.sequence,cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!(!this.initWithDuration(i)||(this._times=e,(this._innerAction=t)instanceof cc.ActionInstant&&(this._actionInstant=!0,--this._times),this._total=0))},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(r<=t){for(;r<t&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;1<=t&&this._total<n&&this._total++,this._actionInstant||(this._total===n?(e.update(1),e.stop()):e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.Repeat.create=cc.repeat,cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(t)return this._innerAction=t,!0;throw new Error("cc.RepeatForever.initWithAction(): action must be non null")},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.RepeatForever.create=cc.repeatForever,cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments,i=e.length-1;if(0<=i&&null==e[i]&&cc.log("parameters should not be ending with null in Javascript"),0<=i){for(var n,r=e[0],c=1;c<i;c++)e[c]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[c]));this.initWithTwoActions(r,e[i])}},initWithTwoActions:function(t,e){var i,n,r;if(t&&e)return i=!1,n=t._duration,r=e._duration,this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,r<n?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i;throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null")},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){for(var e=t instanceof Array?t:arguments,i=(0<e.length&&null==e[e.length-1]&&cc.log("parameters should not be ending with null in Javascript"),e[0]),n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn.create=cc.spawn,cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=e||0,this._dstAngleY=void 0!==i?i:this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e,e=(180<i&&(i-=360),i<-180&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360,this._dstAngleY-this._startAngleY);180<e&&(e-=360),e<-180&&(e+=360),this._diffAngleY=e},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateTo.create=cc.rotateTo,cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=e||0,this._angleY=i||this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.RotateBy.create=cc.rotateBy,cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),t=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,c;t=this._computeEaseTime(t),this.target&&(e=this._positionDelta.x*t,t=this._positionDelta.y*t,i=this._startPosition,cc.ENABLE_STACKABLE_ACTIONS?(n=this.target.getPositionX(),r=this.target.getPositionY(),c=this._previousPosition,i.x=i.x+n-c.x,i.y=i.y+r-c.y,e+=i.x,t+=i.y,c.x=e,c.y=t,this.target.setPosition(e,t)):this.target.setPosition(i.x+e,i.y+t))},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveBy.create=cc.moveBy,cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.MoveTo.create=cc.moveTo,cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,180<this._deltaX&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,180<this._deltaY&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewTo.create=cc.skewTo,cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.SkewBy.create=cc.skewBy,cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),t=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,c;t=this._computeEaseTime(t),this.target&&(e=t*this._jumps%1,e=4*this._height*e*(1-e),e+=this._delta.y*t,t=this._delta.x*t,i=this._startPosition,cc.ENABLE_STACKABLE_ACTIONS?(n=this.target.getPositionX(),r=this.target.getPositionY(),c=this._previousPosition,i.x=i.x+n-c.x,i.y=i.y+r-c.y,t+=i.x,e+=i.y,c.x=t,c.y=e,this.target.setPosition(t,e)):this.target.setPosition(i.x+t,i.y+e))},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpBy.create=cc.jumpBy,cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.JumpTo.create=cc.jumpTo,cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){for(var t=new cc.BezierBy,e=(this._cloneDecoration(t),[]),i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),t=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=t,this._startPosition.x=e,this._startPosition.y=t},update:function(t){var e,i,n,r,c,o;t=this._computeEaseTime(t),this.target&&(e=(o=this._config)[0].x,i=o[1].x,n=o[2].x,r=o[0].y,c=o[1].y,o=o[2].y,e=cc.bezierAt(0,e,i,n,t),i=cc.bezierAt(0,r,c,o,t),n=this._startPosition,cc.ENABLE_STACKABLE_ACTIONS?(r=this.target.getPositionX(),c=this.target.getPositionY(),o=this._previousPosition,n.x=n.x+r-o.x,n.y=n.y+c-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)):this.target.setPosition(n.x+e,n.y+i))},reverse:function(){var t=this._config,t=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],t=new cc.BezierBy(this._duration,t);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierBy.create=cc.bezierBy,cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var t=this._startPosition,e=this._toConfig,i=this._config;i[0]=cc.pSub(e[0],t),i[1]=cc.pSub(e[1],t),i[2]=cc.pSub(e[2],t)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.BezierTo.create=cc.bezierTo,cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&this.target.setScale(this._startScaleX+this._deltaX*t,this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleTo.create=cc.scaleTo,cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.ScaleBy.create=cc.scaleBy,cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeTo.create=cc.fadeTo,cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),this.initWithDuration(t=null==t?0:t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeIn.create=cc.fadeIn,cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),this.initWithDuration(t=null==t?0:t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.FadeOut.create=cc.fadeOut,cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo,e=(this._cloneDecoration(t),this._to);return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintTo.create=cc.tintTo,cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);t=t.color;this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.TintBy.create=cc.tintBy,cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.DelayTime.create=cc.delayTime,cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.ReverseTime.create=cc.reverseTime,cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes,n=i.length=0,r=e/t.getTotalDelayUnits(),c=t.getFrames();cc.arrayVerifyType(c,cc.AnimationFrame);for(var o=0;o<c.length;o++){var s=n*r/e;n+=c[o].getDelayUnits(),i.push(s)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){(t=this._computeEaseTime(t))<1&&((0|(t*=this._animation.getLoops()))>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1);for(var e=this._animation.getFrames(),i=e.length,n=this._splitTimes,r=this._nextFrame;r<i&&n[r]<=t;r++)null==e[_currFrameIndex=r].getSpriteFrame()?this.target.setSpriteFrame(e[1].getSpriteFrame()):this.target.setSpriteFrame(e[_currFrameIndex].getSpriteFrame()),this._nextFrame=r+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.arrayVerifyType(e,cc.AnimationFrame),0<e.length)for(var n=e.length-1;0<=n;n--){var r=e[n];if(!r)break;i.push(r.clone())}var c=new cc.Animation(i,t.getDelayPerUnit(),t.getLoops()),t=(c.setRestoreOriginalFrame(t.getRestoreOriginalFrame()),new cc.Animate(c));return this._cloneDecoration(t),this._reverseEaseList(t),t},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.Animate.create=cc.animate,cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)},cc.TargetedAction.create=cc.targetedAction,cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Show.create=cc.show,cc.Hide=cc.ActionInstant.extend({update:function(t){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.Hide.create=cc.hide,cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.ToggleVisibility.create=cc.toggleVisibility,cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.RemoveSelf.create=cc.removeSelf,cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipX.create=cc.flipX,cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.FlipY.create=cc.flipY,cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,void(this._y=0)!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.Place.create=cc.place,cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)},cc.CallFunc.create=cc.callFunc,cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(t)return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0);throw new Error("cc.ActionEase.initWithAction(): action must be non nil")},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.ActionEase.create=cc.actionEase,cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=e,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseRateAction.create=cc.easeRateAction,cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseIn.create=function(t,e){return new cc.EaseIn(t,e)},cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.EaseOut.create=function(t,e){return new cc.EaseOut(t,e)},cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){(t*=2)<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.EaseInOut.create=function(t,e){return new cc.EaseInOut(t,e)},cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialIn.create=function(t){return new cc.EaseExponentialIn(t)},cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:1-Math.pow(2,-10*t))},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialOut.create=function(t){return new cc.EaseExponentialOut(t)},cc._easeExponentialOutObj={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t=(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseExponentialInOut.create=function(t){return new cc.EaseExponentialInOut(t)},cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineIn.create=function(t){return new cc.EaseSineIn(t)},cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseSineOut.create=function(t){return new cc.EaseSineOut(t)},cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc.EaseSineInOut.create=function(t){return new cc.EaseSineInOut(t)},cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass."),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElastic.create=function(t,e){return new cc.EaseElastic(t,e)},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e,i=0,i=0===t||1===t?t:(e=this._period/4,t-=1,-Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/this._period));this._inner.update(i)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn.create=function(t,e){return new cc.EaseElasticIn(t,e)},cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e,i=0;i=0===t||1===t?t:(e=this._period/4,Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/this._period)+1),this._inner.update(i)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticOut.create=function(t,e){return new cc.EaseElasticOut(t,e)},cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e,i=0,n=this._period;i=0===t||1===t?t:(t*=2,e=(n=n||(this._period=.3*1.5))/4,(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/n):Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/n)*.5+1),this._inner.update(i)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticInOut.create=function(t,e){return new cc.EaseElasticInOut(t,e)},cc.easeElasticInOut=function(t){return{_period:t=t||.3,easing:function(t){var e,i=this._period;return 0===t||1===t?t:(t*=2,e=(i=i||(this._period=.3*1.5))/4,(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-e)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI*2/i)*.5+1)},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounce.create=function(t){return new cc.EaseBounce(t)},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){t=1-this.bounceTime(1-t);this._inner.update(t)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceIn.create=function(t){return new cc.EaseBounceIn(t)},cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){t=this.bounceTime(t);this._inner.update(t)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBounceOut.create=function(t){return new cc.EaseBounceOut(t)},cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0,e=t<.5?.5*(1-this.bounceTime(1-(t*=2))):.5*this.bounceTime(2*t-1)+.5;this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc.EaseBounceInOut.create=function(t){return new cc.EaseBounceInOut(t)},cc._easeBounceInOutObj={easing:function(t){t=t<.5?.5*(1-cc._bounceTime(1-(t*=2))):.5*cc._bounceTime(2*t-1)+.5;return t},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){this._inner.update(t=0===t||1===t?t:t*t*(2.70158*t-1.70158))},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackIn.create=function(t){return new cc.EaseBackIn(t)},cc._easeBackInObj={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){this._inner.update((t-=1)*t*(2.70158*t+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc.EaseBackOut.create=function(t){return new cc.EaseBackOut(t)},cc._easeBackOutObj={easing:function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){var e=2.5949095;(t*=2)<1?this._inner.update(t*t*((1+e)*t-e)/2):this._inner.update((t-=2)*t*((1+e)*t+e)/2+1)},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc.EaseBackInOut.create=function(t){return new cc.EaseBackInOut(t)},cc._easeBackInOutObj={easing:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)/2:(t-=2)*t*((1+e)*t+e)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){t=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(t)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.EaseBezierAction.create=function(t){return new cc.EaseBezierAction(t)},cc.easeBezierAction=function(e,i,n,r){return{easing:function(t){return cc.EaseBezierAction.prototype._updateTime(e,i,n,r,t)},reverse:function(){return cc.easeBezierAction(r,n,i,e)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc.EaseQuadraticActionIn.create=function(t){return new cc.EaseQuadraticActionIn(t)},cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc.EaseQuadraticActionOut.create=function(t){return new cc.EaseQuadraticActionOut(t)},cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?t*t*.5:-.5*(--t*(t-2)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc.EaseQuadraticActionInOut.create=function(t){return new cc.EaseQuadraticActionInOut(t)},cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc.EaseQuarticActionIn.create=function(t){return new cc.EaseQuarticActionIn(t)},cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-(--t*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc.EaseQuarticActionOut.create=function(t){return new cc.EaseQuarticActionOut(t)},cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc.EaseQuarticActionInOut.create=function(t){return new cc.EaseQuarticActionInOut(t)},cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc.EaseQuinticActionIn.create=function(t){return new cc.EaseQuinticActionIn(t)},cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return--t*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc.EaseQuinticActionOut.create=function(t){return new cc.EaseQuinticActionOut(t)},cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc.EaseQuinticActionInOut.create=function(t){return new cc.EaseQuinticActionInOut(t)},cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc.EaseCircleActionIn.create=function(t){return new cc.EaseCircleActionIn(t)},cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc.EaseCircleActionOut.create=function(t){return new cc.EaseCircleActionOut(t)},cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc.EaseCircleActionInOut.create=function(t){return new cc.EaseCircleActionInOut(t)},cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc.EaseCubicActionIn.create=function(t){return new cc.EaseCubicActionIn(t)},cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return--t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc.EaseCubicActionOut.create=function(t){return new cc.EaseCubicActionOut(t)},cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc.EaseCubicActionInOut.create=function(t){return new cc.EaseCubicActionInOut(t)},cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut},cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(t,e){}}),cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this.key="",void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.key=e,this.to=n,this.from=i,!0)},startWithTarget:function(t){if(!t||!t.updateTweenAction)throw new Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");cc.ActionInterval.prototype.startWithTarget.call(this,t),this.delta=this.to-this.from},update:function(t){this.target.updateTweenAction(this.to-this.delta*(1-t),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var t=new cc.ActionTween;return t.initWithDuration(this._duration,this.key,this.from,this.to),t}}),cc.actionTween=function(t,e,i,n){return new cc.ActionTween(t,e,i,n)},cc.ActionTween.create=cc.actionTween,!function(){var t=cc.sys,e=(t.browserVersion,{ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1,ONE_SOURCE:!1});t.os===t.OS_IOS&&(e.USE_LOADER_EVENT="loadedmetadata"),t.os===t.OS_ANDROID&&t.browserType===t.BROWSER_TYPE_UC&&(e.ONE_SOURCE=!0),window.__audioSupport=e}(),cc.Audio=cc.Class.extend({src:null,_element:null,_AUDIO_TYPE:"AUDIO",ctor:function(t){this.src=t},setBuffer:function(t){this._AUDIO_TYPE="WEBAUDIO",this._element=new cc.Audio.WebAudio(t)},setElement:function(t){this._AUDIO_TYPE="AUDIO",(this._element=t).addEventListener("ended",function(){t.loop||(t.paused=!0)})},play:function(t,e){this._element&&(this._element.loop=e,this._element.play(),"AUDIO"===this._AUDIO_TYPE&&this._element.paused&&cc.sys.platform!==cc.sys.WECHAT_GAME&&!window.kwaigame&&(this.stop(),cc.Audio.touchPlayList.push({loop:e,offset:t,audio:this._element})),cc.sys.platform===cc.sys.WECHAT_GAME||window.kwaigame||!1!==cc.Audio.bindTouch||(cc.Audio.bindTouch=!0,cc.game.canvas.addEventListener("touchstart",cc.Audio.touchStart)))},getPlaying:function(){return!this._element||!this._element.paused},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(t){}}},pause:function(){this._element&&this._element.pause()},resume:function(){this._element&&this._element.paused&&this._element.play()},setVolume:function(t){this._element&&(this._element.volume=t)},getVolume:function(){if(this._element)return this._element.volume},cloneNode:function(){var t=new cc.Audio(this.src);if("AUDIO"===this._AUDIO_TYPE){if(window.kwaigame)var e=new Audio;else{e=document.createElement("audio");if(cc.sys.platform!==cc.sys.WECHAT_GAME)for(var i=e.getElementsByTagName("source"),n=0;n<i.length;n++)e.appendChild(i[n])}e.src=this.src,t.setElement(e)}else t.setBuffer(this._element.buffer);return t}}),cc.Audio.touchPlayList=[],cc.Audio.bindTouch=!1,cc.Audio.touchStart=function(){for(var t=cc.Audio.touchPlayList,e=null;e=t.pop();)e.audio.loop=!!e.loop,e.audio.play(e.offset)},cc.Audio.WebAudio=function(t){this.buffer=t,this.context=cc.Audio._context;t=this.context.createGain();t.gain.value=1,t.connect(this.context.destination),this._volume=t,this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null},cc.Audio.WebAudio.prototype={constructor:cc.Audio.WebAudio,get paused(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this.context.currentTime-this._startTime>this.buffer.duration)},set paused(t){},get loop(){return this._loop},set loop(t){return this._loop=t},get volume(){return this._volume.gain.value},set volume(t){return this._volume.gain.value=t},get currentTime(){return this.playedLength},set currentTime(t){return this.playedLength=t},play:function(t){this._currentSource&&!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var e,i=this.context.createBufferSource(),n=(i.buffer=this.buffer,i.connect(this._volume),i.loop=this._loop,this._startTime=this.context.currentTime,t=t||this.playedLength,this.buffer.duration);this._loop?i.start?i.start(0):i.notoGrainOn?i.noteGrainOn(0):i.noteOn(0):i.start?i.start(0,t,n-t):i.notoGrainOn?i.noteGrainOn(0,t,n-t):i.noteOn(0,t,n-t),this._currentSource=i,0===this.context.currentTime&&(e=this,clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){0===e.context.currentTime&&cc.Audio.touchPlayList.push({offset:t,audio:e})},10))},pause:function(){this.playedLength=this.context.currentTime-this._startTime,this.playedLength%=this.buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},!function(u){var t,e,n,d=u.WEB_AUDIO,a=u.ONLY_ONE,p=[];(e=window.kwaigame?new Audio:document.createElement("audio")).canPlayType&&((t=e.canPlayType('audio/ogg; codecs="vorbis"'))&&""!==t&&p.push(".ogg"),(t=e.canPlayType("audio/mpeg"))&&""!==t&&p.push(".mp3"),(t=e.canPlayType('audio/wav; codecs="1"'))&&""!==t&&p.push(".wav"),(t=e.canPlayType("audio/mp4"))&&""!==t&&p.push(".mp4"),t=e.canPlayType("audio/x-m4a"))&&""!==t&&p.push(".m4a");try{d&&(n=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),cc.Audio._context=n,u.DELAY_CREATE_CTX)&&setTimeout(function(){n=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),cc.Audio._context=n},0)}catch(t){d=!1,cc.log("browser don't support web audio")}var h={cache:{},useWebAudio:!1,loadBuffer:function(t,e){var i;d&&((i=new XMLHttpRequest).open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){n.decodeAudioData(i.response,function(t){e(null,t)},function(){e("decode error - "+t)})},i.onerror=function(){e("request error - "+t)},i.send())},load:function(t,e,i,n){if(0===p.length)return n("can not support audio!");var r=cc.loader.getRes(e);if(r)return n(null,r);cc.loader.audioPath&&(t=cc.path.join(cc.loader.audioPath,t));for(var c=cc.path.extname(t),o=[c],s=0;s<p.length;s++)c!==p[s]&&o.push(p[s]);return r=new cc.Audio(t),cc.loader.cache[e]=r,this.loadAudioFromExtList(t,o,r,n),r},loadAudioFromExtList:function(t,e,i,n){var r;if(0===e.length)return r="can not found the resource of audio! Last match url is : ",r+=t.replace(/\.(.*)?$/,"("),p.forEach(function(t){r+=t+"|"}),r=r.replace(/\|$/,")"),n({status:520,errorMessage:r},null);if(d)this.loadBuffer(t,function(t,e){t&&cc.log(t),e&&i.setBuffer(e),n(null,i)});else{var c=u.ONE_SOURCE?1:e.length,o=window.kwaigame?new Audio:document.createElement("audio");if(cc.sys.platform===cc.sys.WECHAT_GAME||window.kwaigame)o.src=cc.path.changeExtname(t,e[0]),window.kwaigame&&o.load();else for(var s=0;s<c;s++){var a=document.createElement("source");a.src=cc.path.changeExtname(t,e[s]),o.appendChild(a)}i.setElement(o);var h=setTimeout(function(){(0===o.readyState?_:l)()},8e3),l=function(){o.removeEventListener("canplaythrough",l,!1),o.removeEventListener("error",_,!1),o.removeEventListener("emptied",l,!1),u.USE_LOADER_EVENT&&o.removeEventListener(u.USE_LOADER_EVENT,l,!1),clearTimeout(h),n(null,i)},_=function(){cc.log("load audio failure - "+t),l()};o.addEventListener("canplaythrough",l,!1),o.addEventListener("error",_,!1),u.USE_LOADER_EVENT&&o.addEventListener(u.USE_LOADER_EVENT,l,!1)}}};cc.loader.register(["mp3","ogg","wav","mp4","m4a"],h),cc.audioEngine={_currMusic:null,_musicVolume:1,features:u,willPlayMusic:function(){return!1},playMusic:function(t,e){var i=this._currMusic,i=(i&&i.getPlaying()&&i.stop(),cc.loader.getRes(t));i||(cc.loader.load(t),i=cc.loader.getRes(t)),i.setVolume(this._musicVolume),i.play(0,e||!1),this._currMusic=i},stopMusic:function(t){var e=this._currMusic;e&&(e.stop(),this._currMusic=null,t)&&cc.loader.release(e.src)},pauseMusic:function(){var t=this._currMusic;t&&t.pause()},resumeMusic:function(){var t=this._currMusic;t&&t.resume()},rewindMusic:function(){var t=this._currMusic;t&&(t.stop(),t.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(t){t=+t,isNaN(t)&&(t=1),this._musicVolume=t=(t=1<t?1:t)<0?0:t;var e=this._currMusic;e&&e.setVolume(t)},isMusicPlaying:function(){var t=this._currMusic;return!!t&&t.getPlaying()},_audioPool:{},_maxAudioInstance:8,_effectVolume:1,playEffect:function(e,i,n,r){if(a&&this._currMusic&&this._currMusic.getPlaying())return cc.log("Browser is only allowed to play one audio"),null;for(var t,c,o=(o=this._audioPool[e])||(this._audioPool[e]=[]),s=0;s<o.length&&o[s].getPlaying();s++);if(!d&&s>this._maxAudioInstance&&((t=o.shift()).stop(),o.push(t),s=o.length-1),o[s])(c=o[s]).setVolume(this._effectVolume),c.play(0,i||!1);else{if((c=cc.loader.getRes(e))&&d&&"AUDIO"===c._AUDIO_TYPE&&(cc.loader.release(e),c=null),c){if(!d||"AUDIO"!==c._AUDIO_TYPE)return(c=c.cloneNode()).setVolume(this._effectVolume),c.play(0,i||!1),o.push(c),c;h.loadBuffer(e,function(t,e){c.setBuffer(e),c.setVolume(cc.audioEngine._effectVolume),c.getPlaying()||c.play(0,i||!1)})}h.useWebAudio=!0;cc.loader.load(e,function(t){(t=cc.loader.getRes(e))&&((t=t.cloneNode()).setVolume(cc.audioEngine._effectVolume),t.play(0,i),o.push(t),n)&&n(r,t)}),h.useWebAudio=!1}return c},setEffectsVolume:function(t){t=+t,isNaN(t)&&(t=1),this._effectVolume=t=(t=1<t?1:t)<0?0:t;var e,i=this._audioPool;for(e in i){var n=i[e];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r].setVolume(t)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(t){t&&t.pause()},pauseAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].getPlaying()&&i[n].pause()},resumeEffect:function(t){t&&t.resume()},resumeAllEffects:function(){var t,e=this._audioPool;for(t in e)for(var i=e[t],n=0;n<e[t].length;n++)i[n].resume()},stopEffect:function(t){t&&t.stop()},stopAllEffects:function(){var t,e=this._audioPool;for(t in e){for(var i=e[t],n=0;n<i.length;n++)i[n].stop();i.length=0}},unloadEffect:function(t){var e;t&&(cc.loader.release(t),(e=this._audioPool[t])&&(e.length=0),delete this._audioPool[t])},end:function(){this.stopMusic(),this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var t,e=this._currMusic,i=(e&&e.getPlaying()&&(e.pause(),this._pauseCache.push(e)),this._audioPool);for(t in i)for(var n=i[t],r=0;r<i[t].length;r++)n[r].getPlaying()&&(n[r].pause(),this._pauseCache.push(n[r]))},_resumePlaying:function(){for(var t=this._pauseCache,e=0;e<t.length;e++)t[e].resume();t.length=0}}}(window.__audioSupport),cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e},!function(n){n.math.Vec3=n.kmVec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},n.math.vec3=function(t,e,i){return new n.math.Vec3(t,e,i)};var t=n.math.Vec3.prototype;t.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},t.length=function(){return Math.sqrt(n.math.square(this.x)+n.math.square(this.y)+n.math.square(this.z))},t.lengthSq=function(){return n.math.square(this.x)+n.math.square(this.y)+n.math.square(this.z)},t.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},t.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},t.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.transform=function(t){var e=this.x,i=this.y,n=this.z,t=t.mat;return this.x=e*t[0]+i*t[4]+n*t[8]+t[12],this.y=e*t[1]+i*t[5]+n*t[9]+t[13],this.z=e*t[2]+i*t[6]+n*t[10]+t[14],this},t.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,t=t.mat;return this.x=e*t[0]+i*t[4]+n*t[8],this.y=e*t[1]+i*t[5]+n*t[9],this.z=e*t[2]+i*t[6]+n*t[10],this},t.transformCoord=function(t){var e=new n.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},t.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.equals=function(t){var e=n.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},t.inverseTransform=function(t){var t=t.mat,e=new n.math.Vec3(this.x-t[12],this.y-t[13],this.z-t[14]);return this.x=e.x*t[0]+e.y*t[1]+e.z*t[2],this.y=e.x*t[4]+e.y*t[5]+e.z*t[6],this.z=e.x*t[8]+e.y*t[9]+e.z*t[10],this},t.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,t=t.mat;return this.x=e*t[0]+i*t[1]+n*t[2],this.y=e*t[4]+i*t[5]+n*t[6],this.z=e*t[8]+i*t[9]+n*t[10],this},t.assignFrom=function(t){return t&&(this.x=t.x,this.y=t.y,this.z=t.z),this},n.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},t.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}(cc),!function(c){c.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)},c.kmVec4=c.math.Vec4;var t=c.math.Vec4.prototype;t.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},t.add=function(t){return t&&(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w),this},t.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.length=function(){return Math.sqrt(c.math.square(this.x)+c.math.square(this.y)+c.math.square(this.z)+c.math.square(this.w))},t.lengthSq=function(){return c.math.square(this.x)+c.math.square(this.y)+c.math.square(this.z)+c.math.square(this.w)},t.lerp=function(t,e){return this},t.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},t.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,t=t.mat;return this.x=e*t[0]+i*t[4]+n*t[8]+r*t[12],this.y=e*t[1]+i*t[5]+n*t[9]+r*t[13],this.z=e*t[2]+i*t[6]+n*t[10]+r*t[14],this.w=e*t[3]+i*t[7]+n*t[11]+r*t[15],this},c.math.Vec4.transformArray=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=new c.math.Vec4(t[n]);r.transform(e),i.push(r)}return i},t.equals=function(t){var e=c.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},t.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}(cc),window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,!function(l){l.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)},l.kmMat4=l.math.Matrix4;var t=l.math.Matrix4.prototype,n=(t.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},l.kmMat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},t.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},t.get=function(t,e){return this.mat[t+4*e]},t.set=function(t,e,i){this.mat[t+4*e]=i},t.swap=function(t,e,i,n){var r=this.mat,c=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=c},l.math.Matrix4._gaussj=function(t,e){},(new l.math.Matrix4).identity());l.kmMat4Inverse=function(t,e){var e=new l.math.Matrix4(e),i=new l.math.Matrix4(n);return!1===l.math.Matrix4._gaussj(e,i)?null:(t.assignFrom(e),t)},t.inverse=function(){var t=new l.math.Matrix4(this),e=new l.math.Matrix4(n);return!1===l.math.Matrix4._gaussj(t,e)?null:t},t.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},t.transpose=function(){},l.kmMat4Multiply=function(t,e,i){},t.multiply=function(t){var e=this.mat,t=t.mat,i=e[0],n=e[1],r=e[2],c=e[3],o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],_=e[9],u=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15],T=t[0],E=t[1],y=t[2],S=t[3],C=t[4],x=t[5],v=t[6],R=t[7],A=t[8],b=t[9],I=t[10],L=t[11],w=t[12],P=t[13],O=t[14],t=t[15];return e[0]=T*i+E*o+y*l+S*p,e[1]=T*n+E*s+y*_+S*f,e[2]=T*r+E*a+y*u+S*g,e[3]=T*c+E*h+y*d+S*m,e[4]=C*i+x*o+v*l+R*p,e[5]=C*n+x*s+v*_+R*f,e[6]=C*r+x*a+v*u+R*g,e[7]=C*c+x*h+v*d+R*m,e[8]=A*i+b*o+I*l+L*p,e[9]=A*n+b*s+I*_+L*f,e[10]=A*r+b*a+I*u+L*g,e[11]=A*c+b*h+I*d+L*m,e[12]=w*i+P*o+O*l+t*p,e[13]=w*n+P*s+O*_+t*f,e[14]=w*r+P*a+O*u+t*g,e[15]=w*c+P*h+O*d+t*m,this},l.getMat4MultiplyValue=function(t,e){},l.kmMat4Assign=function(t,e){},t.assignFrom=function(t){},t.equals=function(t){if(this===t)l.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object.");else for(var e=this.mat,i=t.mat,n=l.math.EPSILON,r=0;r<16;r++)if(!(e[r]+n>i[r]&&e[r]-n<i[r]))return!1;return!0},l.math.Matrix4.createByRotationX=function(t,e){var i=(e=e||new l.math.Matrix4).mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},l.math.Matrix4.createByRotationY=function(t,e){var i=(e=e||new l.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},l.math.Matrix4.createByRotationZ=function(t,e){var i=(e=e||new l.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},l.math.Matrix4.createByPitchYawRoll=function(t,e,i,n){n=n||new l.math.Matrix4;var r=Math.cos(t),t=Math.sin(t),c=Math.cos(e),e=Math.sin(e),o=Math.cos(i),i=Math.sin(i),s=t*e,a=r*e,h=n.mat;return h[0]=c*o,h[4]=c*i,h[8]=-e,h[1]=s*o-r*i,h[5]=s*i+r*o,h[9]=t*c,h[2]=a*o+t*i,h[6]=a*i-t*o,h[10]=r*c,h[3]=h[7]=h[11]=0,h[15]=1,n},l.math.Matrix4.createByQuaternion=function(t,e){var i=(e=e||new l.math.Matrix4).mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},l.math.Matrix4.createByRotationTranslation=function(t,e,i){var n=(i=i||new l.math.Matrix4).mat,t=t.mat;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,i},l.math.Matrix4.createByScale=function(t,e,i,n){var r=(n=n||new l.math.Matrix4).mat;return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,n},l.kmMat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},l.math.Matrix4.createByTranslation=function(t,e,i,n){return(n=n||new l.math.Matrix4).identity(),n.mat[12]=t,n.mat[13]=e,n.mat[14]=i,n},t.getUpVec3=function(){var t=this.mat;return new l.math.Vec3(t[4],t[5],t[6]).normalize()},t.getRightVec3=function(){var t=this.mat;return new l.math.Vec3(t[0],t[1],t[2]).normalize()},t.getForwardVec3=function(){var t=this.mat;return new l.math.Vec3(t[8],t[9],t[10]).normalize()},l.kmMat4PerspectiveProjection=function(t,e,i,n,r){var e=l.degreesToRadians(e/2),c=r-n,o=Math.sin(e);return 0==c||0===o||0===i?null:(e=Math.cos(e)/o,t.identity(),t.mat[0]=e/i,t.mat[5]=e,t.mat[10]=-(r+n)/c,t.mat[11]=-1,t.mat[14]=-2*n*r/c,t.mat[15]=0,t)},l.math.Matrix4.createPerspectiveProjection=function(t,e,i,n){var r,t=l.degreesToRadians(t/2),c=n-i,o=Math.sin(t);return 0==c||0===o||0===e?null:(t=Math.cos(t)/o,r=(o=new l.math.Matrix4).mat,o.identity(),r[0]=t/e,r[5]=t,r[10]=-(n+i)/c,r[11]=-1,r[14]=-2*i*n/c,r[15]=0,o)},l.kmMat4OrthographicProjection=function(t,e,i,n,r,c,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-c),t.mat[12]=-(i+e)/(i-e),t.mat[13]=-(r+n)/(r-n),t.mat[14]=-(o+c)/(o-c),t},l.math.Matrix4.createOrthographicProjection=function(t,e,i,n,r,c){var o=new l.math.Matrix4,s=o.mat;return o.identity(),s[0]=2/(e-t),s[5]=2/(n-i),s[10]=-2/(c-r),s[12]=-(e+t)/(e-t),s[13]=-(n+i)/(n-i),s[14]=-(c+r)/(c-r),o},l.kmMat4LookAt=function(t,e,i,n){},new l.math.Matrix4;t.lookAt=function(t,e,i){},l.kmMat4RotationAxisAngle=function(t,e,i){},l.math.Matrix4.createByAxisAndAngle=function(t,e,i){},t.extractRotation=function(){},t.extractPlane=function(t){},t.toAxisAndAngle=function(){}}(cc),!function(i){i.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[]},i.km_mat4_stack=i.math.Matrix4Stack;var t=i.math.Matrix4Stack.prototype;t.initialize=function(){this.stack.length=0,this.top=null},i.km_mat4_stack_push=function(t,e){t.stack.push(t.top),t.top=new i.math.Matrix4(e)},i.km_mat4_stack_pop=function(t,e){t.top=t.stack.pop()},i.km_mat4_stack_release=function(t){t.stack=null,t.top=null},t.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new i.math.Matrix4(t)},t.pop=function(){this.top=this.stack.pop()},t.release=function(){this.stack=null,this.top=null,this._matrixPool=null},t._getFromPool=function(t){var e=this._matrixPool;return 0===e.length?new i.math.Matrix4(t):((e=e.pop()).assignFrom(t),e)},t._putInPool=function(t){this._matrixPool.push(t)}}(cc),!function(r){r.KM_GL_MODELVIEW=5888,r.KM_GL_PROJECTION=5889,r.KM_GL_TEXTURE=5890,r.modelview_matrix_stack=new r.math.Matrix4Stack,r.projection_matrix_stack=new r.math.Matrix4Stack,r.texture_matrix_stack=new r.math.Matrix4Stack,r.current_stack=null;r.lazyInitialize=function(){var t=new r.math.Matrix4;r.modelview_matrix_stack.initialize(),r.projection_matrix_stack.initialize(),r.texture_matrix_stack.initialize(),r.current_stack=r.modelview_matrix_stack,r.initialized=!0,t.identity(),r.modelview_matrix_stack.push(t),r.projection_matrix_stack.push(t),r.texture_matrix_stack.push(t)},r.lazyInitialize(),r.kmGLFreeAll=function(){r.modelview_matrix_stack.release(),r.modelview_matrix_stack=null,r.projection_matrix_stack.release(),r.projection_matrix_stack=null,r.texture_matrix_stack.release(),r.texture_matrix_stack=null,r.initialized=!1,r.current_stack=null},r.kmGLPushMatrix=function(){r.current_stack.push(r.current_stack.top)},r.kmGLPushMatrixWitMat4=function(t){r.current_stack.stack.push(r.current_stack.top),t.assignFrom(r.current_stack.top),r.current_stack.top=t},r.kmGLPopMatrix=function(){r.current_stack.top=r.current_stack.stack.pop()},r.kmGLMatrixMode=function(t){switch(t){case r.KM_GL_MODELVIEW:r.current_stack=r.modelview_matrix_stack;break;case r.KM_GL_PROJECTION:r.current_stack=r.projection_matrix_stack;break;case r.KM_GL_TEXTURE:r.current_stack=r.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},r.kmGLLoadIdentity=function(){r.current_stack.top.identity()},r.kmGLLoadMatrix=function(t){r.current_stack.top.assignFrom(t)},r.kmGLMultMatrix=function(t){r.current_stack.top.multiply(t)};var c=new r.math.Matrix4,o=(r.kmGLTranslatef=function(t,e,i){t=r.math.Matrix4.createByTranslation(t,e,i,c);r.current_stack.top.multiply(t)},new r.math.Vec3);r.kmGLRotatef=function(t,e,i,n){o.fill(e,i,n);e=r.math.Matrix4.createByAxisAndAngle(o,r.degreesToRadians(t),c);r.current_stack.top.multiply(e)},r.kmGLScalef=function(t,e,i){t=r.math.Matrix4.createByScale(t,e,i,c);r.current_stack.top.multiply(t)},r.kmGLGetMatrix=function(t,e){switch(t){case r.KM_GL_MODELVIEW:e.assignFrom(r.modelview_matrix_stack.top);break;case r.KM_GL_PROJECTION:e.assignFrom(r.projection_matrix_stack.top);break;case r.KM_GL_TEXTURE:e.assignFrom(r.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}}(cc),cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor = v_fragmentColor;      \n}\n",cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor = v_fragmentColor; \n} ",cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_SPRITE_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main() \n{ \n// #if defined GL_OES_standard_derivatives  \n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else \ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color; \nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;  \nvoid main() \n{ \n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord = a_texcoord; \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a <= CC_alpha_value )          \n        discard; \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   = texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  = texture2D(u_mask, v_texCoord); \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor; \n}",cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,defaultShaders:[cc.SHADER_POSITION_TEXTURECOLOR,cc.SHADER_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_POSITION_COLOR,cc.SHADER_POSITION_TEXTURE,cc.SHADER_POSITION_TEXTURE_UCOLOR,cc.SHADER_POSITION_TEXTUREA8COLOR,cc.SHADER_POSITION_UCOLOR,cc.SHADER_POSITION_LENGTHTEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_SPRITE_POSITION_COLOR],_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case cc.SHADER_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_POSITION_TEXTURE:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTUREA8COLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_UCOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case cc.SHADER_POSITION_LENGTHTEXTURECOLOR:t.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:return void cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type")}t.link(),t.updateUniforms()},loadDefaultShaders:function(){for(var t=0;t<this.defaultShaders.length;++t){var e=this.defaultShaders[t];this.programForKey(e)}},reloadDefaultShaders:function(){var t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);t.reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR),(t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)).reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURECOLOR_ALPHATEST),(t=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST)).reset(),this._loadDefaultShader(t,this.TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST),(t=this.programForKey(cc.SHADER_POSITION_COLOR)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_COLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTURE)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE),(t=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_UCOLOR),(t=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_TEXTURE_A8COLOR),(t=this.programForKey(cc.SHADER_POSITION_UCOLOR)).reset(),this._loadDefaultShader(t,this.TYPE_POSITION_UCOLOR)},programForKey:function(t){var e;return!this._programs[t]&&-1<this.defaultShaders.indexOf(t)&&(e=new cc.GLProgram,this._loadDefaultShader(e,t),this._programs[t]=e),this._programs[t]},getProgram:function(t){return this.programForKey(t)},addProgram:function(t,e){this._programs[e]=t}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(t){if(!t)return!1;var e=this._hashForUniforms[t];if(e)for(var i=!1,n=arguments.length-1,r=0;r<n;++r)arguments[r+1]!==e[r]&&(e[r]=arguments[r+1],i=!0);else this._hashForUniforms[t]=e=[arguments[1],arguments[2],arguments[3],arguments[4]],i=!0;return i},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){var n;return!(!i||!t)&&(n=cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n",this._glContext.shaderSource(t,i=n+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+i),this._glContext.compileShader(t),(n=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS))||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),!0===n)},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i,n=this._glContext;for(i in this._programObj=n.createProgram(),this._vertShader=null,this._fragShader=null,t&&(this._vertShader=n.createShader(n.VERTEX_SHADER),this._compileShader(this._vertShader,n.VERTEX_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),e&&(this._fragShader=n.createShader(n.FRAGMENT_SHADER),this._compileShader(this._fragShader,n.FRAGMENT_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&n.attachShader(this._programObj,this._vertShader),cc.checkGLErrorDebug(),this._fragShader&&n.attachShader(this._programObj,this._fragShader),this._hashForUniforms)delete this._hashForUniforms[i];return cc.checkGLErrorDebug(),!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);t=cc.loader.getRes(e);if(t)return this.initWithVertexShaderByteArray(i,t);throw new Error("Please load the resource firset : "+e)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;if((this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode])&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS))return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1;return!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S),this._uniforms[cc.UNIFORM_MVMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S),this._uniforms[cc.UNIFORM_MVPMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S),this._uniforms[cc.UNIFORM_TIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S),this._uniforms[cc.UNIFORM_SINTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S),this._uniforms[cc.UNIFORM_COSTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME_S]||null!=this._uniforms[cc.UNIFORM_SINTIME_S]||null!=this._uniforms[cc.UNIFORM_COSTIME_S],this._uniforms[cc.UNIFORM_RANDOM01_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S),this._uniforms[cc.UNIFORM_SAMPLER_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER_S],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(this._programObj)return this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t);throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized")},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX_S]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(t,e){var i,n=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e)&&(i=this.getUniformLocationForName(t),n.uniform1i(i,e)):n.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n,r=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i)&&(n=this.getUniformLocationForName(t),r.uniform2i(n,e,i)):r.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r,c=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i,n)&&(r=this.getUniformLocationForName(t),c.uniform3i(r,e,i,n)):c.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var c,o=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i,n,r)&&(c=this.getUniformLocationForName(t),o.uniform4i(c,e,i,n,r)):o.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(t,e)},setUniformLocationWith3iv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(t,e)},setUniformLocationWith4iv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(t,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i,n=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e)&&(i=this.getUniformLocationForName(t),n.uniform1f(i,e)):n.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n,r=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i)&&(n=this.getUniformLocationForName(t),r.uniform2f(n,e,i)):r.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r,c=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i,n)&&(r=this.getUniformLocationForName(t),c.uniform3f(r,e,i,n)):c.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var c,o=this._glContext;"string"==typeof t?this._updateUniformLocation(t,e,i,n,r)&&(c=this.getUniformLocationForName(t),o.uniform4f(c,e,i,n,r)):o.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(t,e)},setUniformLocationWith3fv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(t,e)},setUniformLocationWith4fv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(t,e)},setUniformLocationWithMatrix4fv:function(t,e){t="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(t,!1,e)},setUniformsForBuiltins:function(){var t=new cc.math.Matrix4,e=new cc.math.Matrix4,i=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,e),cc.kmMat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],i.mat,1),this._usesTime&&(e=(t=cc.director).getTotalFrames()*t.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],e/10,e,2*e,4*e),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],e/8,e/4,e/2,Math.sin(e)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],e/8,e/4,e/2,Math.cos(e))),-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){cc.kmMat4Multiply(t,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,cc.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){for(var t in this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null,this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(t,e){return new cc.GLProgram(t,e)},cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var t;return null==cc.GLProgram._highpSupported&&(t=(t=cc._renderContext).getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT),cc.GLProgram._highpSupported=0!==t.precision),cc.GLProgram._highpSupported},cc.setProgram=function(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)cc.setProgram(i[n],e)},cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0),cc.sys.platform!==cc.sys.WECHAT_GAME)&&(_currBuffers={},WebGLRenderingContext.prototype.glBindBuffer=WebGLRenderingContext.prototype.bindBuffer,WebGLRenderingContext.prototype.bindBuffer=function(t,e){return _currBuffers[t]===e||(this.glBindBuffer(t,e),_currBuffers[t]=e,!1)},WebGLRenderingContext.prototype.glEnableVertexAttribArray=WebGLRenderingContext.prototype.enableVertexAttribArray,WebGLRenderingContext.prototype.enableVertexAttribArray=function(t){t===cc.VERTEX_ATTRIB_FLAG_POSITION?this._vertexAttribPosition||(this.glEnableVertexAttribArray(t),this._vertexAttribPosition=!0):t===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor||(this.glEnableVertexAttribArray(t),this._vertexAttribColor=!0):t===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords||(this.glEnableVertexAttribArray(t),this._vertexAttribTexCoords=!0):this.glEnableVertexAttribArray(t)},WebGLRenderingContext.prototype.glDisableVertexAttribArray=WebGLRenderingContext.prototype.disableVertexAttribArray,WebGLRenderingContext.prototype.disableVertexAttribArray=function(t){t===cc.VERTEX_ATTRIB_FLAG_COLOR?this._vertexAttribColor&&(this.glDisableVertexAttribArray(t),this._vertexAttribColor=!1):t===cc.VERTEX_ATTRIB_FLAG_TEX_COORDS?this._vertexAttribTexCoords&&(this.glDisableVertexAttribArray(t),this._vertexAttribTexCoords=!1):0!==t&&this.glDisableVertexAttribArray(t)}),cc.glInvalidateStateCache=function(){if(cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var t=0;t<cc.MAX_ACTIVETEXTURE;t++)cc._currentBoundTexture[t]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=cc.ENABLE_GL_STATE_CACHE?function(t){t!==cc._currentShaderProgram&&(cc._currentShaderProgram=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.glDeleteProgram=function(t){cc.ENABLE_GL_STATE_CACHE&&t===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),gl.deleteProgram(t)},cc.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),cc._renderContext.blendFunc(t,e))},cc.glBlendFunc=cc.ENABLE_GL_STATE_CACHE?function(t,e){t===cc._blendingSource&&e===cc._blendingDest||(cc._blendingSource=t,cc._blendingDest=e,cc.setBlending(t,e))}:cc.setBlending,cc.glBlendFuncForParticle=function(t,e){var i;t===cc._blendingSource&&e===cc._blendingDest||(cc._blendingSource=t,cc._blendingDest=e,t===(i=cc._renderContext).ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e)))},cc.glBlendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glBindTexture2D=function(t){cc.glBindTexture2DN(0,t)},cc.glBindTexture2DN=cc.ENABLE_GL_STATE_CACHE?function(t,e){var i;cc._currentBoundTexture[t]!==e&&(cc._currentBoundTexture[t]=e,(i=cc._renderContext).activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null))}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._webTextureObj):i.bindTexture(i.TEXTURE_2D,null)},cc.glDeleteTexture=function(t){cc.glDeleteTextureN(0,t)},cc.glDeleteTextureN=function(t,e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentBoundTexture[t]&&(cc._currentBoundTexture[t]=-1),cc._renderContext.deleteTexture(e._webTextureObj)},cc.glBindVAO=function(t){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==t&&(cc._uVAO=t)},cc.glEnable=function(t){cc.ENABLE_GL_STATE_CACHE},cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=9,cc.NextPOT=function(t){return(t=(t=(t=(t=(t=(t-=1)|t>>1)|t>>2)|t>>4)|t>>8)|t>>16)+1},cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){cc.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(t,e,i,n=n||0)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return new cc.RenderTexture.WebGLRenderCmd(this)},cleanup:function(){cc.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,c){var o=cc._renderContext;r=r||o.COLOR_BUFFER_BIT,c=c||o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,n,r,c,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,c,o){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,c,o)},end:function(){this._renderCmd.end(),cc.renderer._turnToNormalMode(this.__instanceId)},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var _p,_p=((_p=cc.RenderTexture.prototype).clearColorVal,cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor),cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)},!function(){cc.RenderTexture.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var t=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.RenderTexture.WebGLRenderCmd,t.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},t.needDraw=function(){return this._needDraw&&this._node.autoDraw},t.rendering=function(t){var t=t||cc._renderContext,e=this._node;if(e.autoDraw){e.begin();for(var i,n,r,c=e.clearFlags,o=(c&&(i=[0,0,0,0],r=n=0,c&t.COLOR_BUFFER_BIT&&(i=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(e._clearColor.r/255,e._clearColor.g/255,e._clearColor.b/255,e._clearColor.a/255)),c&t.DEPTH_BUFFER_BIT&&(n=t.getParameter(t.DEPTH_CLEAR_VALUE),t.clearDepth(e.clearDepthVal)),c&t.STENCIL_BUFFER_BIT&&(r=t.getParameter(t.STENCIL_CLEAR_VALUE),t.clearStencil(e.clearStencilVal)),t.clear(c),c&t.COLOR_BUFFER_BIT&&t.clearColor(i[0],i[1],i[2],i[3]),c&t.DEPTH_BUFFER_BIT&&t.clearDepth(n),c&t.STENCIL_BUFFER_BIT)&&t.clearStencil(r),e.sortAllChildren(),e._children),s=0;s<o.length;s++){var a=o[s];a!==e.sprite&&a._renderCmd.visit(e.sprite._renderCmd)}e.end()}},t.clearStencil=function(t){var e=cc._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},t.cleanup=function(){this._node;this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},t.updateClearColor=function(t){},t.initWithWidthAndHeight=function(t,e,i,n){var r,c=this._node,o=(i===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;"),cc._renderContext),s=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,t,e),this._fullViewport=new cc.Rect(0,0,t=0|t*s,e=0|e*s),this._oldFBO=o.getParameter(o.FRAMEBUFFER_BINDING);for(var a=cc.configuration.supportsNPOT()?(r=t,e):(r=cc.NextPOT(t),cc.NextPOT(e)),h=new Uint8Array(r*a*4),l=0;l<r*a*4;l++)h[l]=0;this._pixelFormat=i;s=c._texture=new cc.Texture2D;if(!c._texture)return!1;s.initWithData(h,c._pixelFormat,r,a,cc.size(t,e));i=o.getParameter(o.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(h,c._pixelFormat,r,a,cc.size(t,e))}this._fBO=o.createFramebuffer(),o.bindFramebuffer(o.FRAMEBUFFER,this._fBO),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,s._webTextureObj,0),0!==n&&(this._depthRenderBuffer=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,this._depthRenderBuffer),o.renderbufferStorage(o.RENDERBUFFER,n,r,a),n===o.DEPTH_STENCIL?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):n===o.STENCIL_INDEX||n===o.STENCIL_INDEX8?o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer):n===o.DEPTH_COMPONENT16&&o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,this._depthRenderBuffer)),o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),s.setAliasTexParameters();t=c.sprite=new cc.Sprite(s);return t.flippedY=!0,t.setBlendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.bindRenderbuffer(o.RENDERBUFFER,i),o.bindFramebuffer(o.FRAMEBUFFER,this._oldFBO),c.autoDraw=!1,c.addChild(t),!0},t.begin=function(){var t=this._node,e=(cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix(),cc._renderContext),i=cc.director,i=(i.setProjection(i.getProjection()),t._texture.getContentSizeInPixels()),n=cc.director.getWinSizeInPixels(),r=n.width/i.width,n=n.height/i.height,i=cc.math.Matrix4.createOrthographicProjection(-1/r,1/r,-1/n,1/n,-1,1),r=(cc.kmGLMultMatrix(i),new cc.Rect(0,0,0,0)),n=1,i=(cc.sys.platform===cc.sys.WECHAT_GAME&&cc.sys.os===cc.sys.OS_ANDROID&&(n=cc.view.getDevicePixelRatio()/devicePixelRatio),r.width=this._fullViewport.width*n,r.height=this._fullViewport.height*n,r.width/this._fullRect.width),n=r.height/this._fullRect.height;r.x=(this._fullRect.x-this._rtTextureRect.x)*i,r.y=(this._fullRect.y-this._rtTextureRect.y)*n,e.viewport(r.x,r.y,r.width,r.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._webTextureObj,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._webTextureObj,0))},t._beginWithClear=function(t,e,i,n,r,c,o){t/=255,e/=255,i/=255,n/=255;var s=cc._renderContext,a=[0,0,0,0],h=0,l=0;o&s.COLOR_BUFFER_BIT&&(a=s.getParameter(s.COLOR_CLEAR_VALUE),s.clearColor(t,e,i,n)),o&s.DEPTH_BUFFER_BIT&&(h=s.getParameter(s.DEPTH_CLEAR_VALUE),s.clearDepth(r)),o&s.STENCIL_BUFFER_BIT&&(l=s.getParameter(s.STENCIL_CLEAR_VALUE),s.clearStencil(c)),s.clear(o),o&s.COLOR_BUFFER_BIT&&s.clearColor(a[0],a[1],a[2],a[3]),o&s.DEPTH_BUFFER_BIT&&s.clearDepth(h),o&s.STENCIL_BUFFER_BIT&&s.clearStencil(l)},t.end=function(){var t=this._node,t=(cc.renderer._renderingToBuffer(t.__instanceId),cc._renderContext),e=cc.director;t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),e.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},t.clearRect=function(t,e,i,n){},t.clearDepth=function(t){var e=this._node,i=(e.begin(),cc._renderContext),n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(n),e.end()},t.visit=function(t){var e=this._node;e._visible&&(cc.kmGLPushMatrix(),this._syncStatus(t),cc.renderer.pushRenderCommand(this),e.sprite.visit(this),this._dirtyFlag=0,cc.kmGLPopMatrix())}}(),cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){var e;cc.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.isString(t)?e=(e=cc.textureCache.getTextureForKey(t))||cc.textureCache.addImage(t):t instanceof cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},addSpriteWithoutQuad:function(t,e,i){return this.addChild(t,e,i),this},getTextureAtlas:function(){return null},setTextureAtlas:function(t){},getDescendants:function(){return this._children},initWithFile:function(t,e){var i=(i=cc.textureCache.getTextureForKey(t))||cc.textureCache.addImage(t);return this.initWithTexture(i,e)},init:function(t,e){var i=(i=cc.textureCache.getTextureForKey(t))||cc.textureCache.addImage(t);return this.initWithTexture(i,e)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},rebuildIndexInOrder:function(t,e){return e},highestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.highestAtlasIndexInChild(e[e.length-1]):t.zIndex},lowestAtlasIndexInChild:function(t){var e=t.children;return e&&0!==e.length?this.lowestAtlasIndexInChild(e[e.length-1]):t.zIndex},atlasIndexForChild:function(t){return t.zIndex},reorderBatch:function(t){this._reorderChildDirty=t},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){cc.assert(t,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2),t instanceof cc.Sprite?(t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(t,e){this.addChild(t,e)},insertChild:function(t,e){this.addChild(t,e)},appendChild:function(t){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(t.lastLocalZOrder+1)},removeSpriteFromAtlas:function(t,e){this.removeChild(t,e)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(n){if((this._texture=n)._textureLoaded)for(var t=this._children,e=t.length,i=0;i<e;++i)t[i].setTexture(n);else n.addEventListener("load",function(){for(var t=this._children,e=t.length,i=0;i<e;++i)t[i].setTexture(n)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);for(var e=this._children,i=e.length,n=0;n<i;++n)e[n].setShaderProgram(t)},addChild:function(t,e,i){cc.assert(void 0!==t,cc._LogInfos.CCSpriteBatchNode_addChild_3),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,cc.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram)&&(t.shaderProgram=this._renderCmd._shaderProgram)},_isValidChild:function(t){return t instanceof cc.Sprite?t.texture===this._texture||(cc.log(cc._LogInfos.Sprite_addChild_5),!1):(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}}),cc.SpriteBatchNode.prototype),_fntLoader=(cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture),cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram),cc.SpriteBatchNode.create=function(t){return new cc.SpriteBatchNode(t)},cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create,cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return new cc.LabelBMFont.WebGLRenderCmd(this)},_setString:function(t,e){e?this._initialString=t:this._string=t;var i=this._children;if(i)for(var n=0;n<i.length;n++){var r=i[n];r&&r.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),e)&&this.updateLabel()},ctor:function(t,e,i,n,r){cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=cc.p(0,0),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this.initWithString(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.addEventListener("load",t,e)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(t){this._opacityModifyRGB=t;var e=this._children;if(e)for(var i=0;i<e.length;i++){var n=e[i];n&&(n.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(t,e,i,n,r){var c=this,t=t||"";if(c._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported, "+e),e){var o=cc.loader.getRes(e);if(!o)return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file, "+e),!1;c._config=o,c._fntFile=e;var s,e=(s=cc.textureCache.addImage(o.atlasName)).isLoaded();(c._textureLoaded=e)||s.addEventListener("load",function(t){this._textureLoaded=!0,this.initWithTexture(t,this._initialString.length),this.setString(this._initialString,!0),this.dispatchEvent("load")},c)}else{s=new cc.Texture2D;o=new Image;s.initWithElement(o),c._textureLoaded=!1}if(c.initWithTexture(s,t.length)){for(var a=0;a<c.children.length;a++)c.children[a].setTexture(s);return c._alignment=n||cc.TEXT_ALIGNMENT_LEFT,c._imageOffset=r||cc.p(0,0),c._width=void 0===i?-1:i,c._realOpacity=255,c._realColor=cc.color(255,255,255,255),c._contentSize.width=0,c._contentSize.height=0,c.setAnchorPoint(.5,.5),c.setString(t,!0),!0}return!1},createFontChars:function(){var t=this._string,e=t?t.length:0;if(0!==e){for(var i=this._renderCmd,n=i._texture||this._texture,r=0,c=cc.size(0,0),o=0,s=1,a=this._config,h=a.kerningDict,l=a.commonHeight,_=a.fontDefDictionary,u=0;u<e-1;u++)10===t.charCodeAt(u)&&s++;var d=l*s,p=-(l-l*s),f=-1;for(u=0;u<e;u++){var g,m,T,E,y,S=t.charCodeAt(u);0!==S&&(10===S?(r=0,p-=a.commonHeight):(g=h[f<<16|65535&S]||0,(m=_[S])||(cc.log("cocos2d: LabelBMFont: character not found "+t[u]),m={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0}),T=cc.rect(m.rect.x,m.rect.y,m.rect.width,m.rect.height),(T=cc.rectPixelsToPoints(T)).x+=this._imageOffset.x,T.y+=this._imageOffset.y,(E=this.getChildByTag(u))?i._updateCharTexture(E,T,S):((E=new cc.Sprite).initWithTexture(n,T,!1),E._newTextureWhenChangeColor=!0,this.addChild(E,0,u)),E.opacityModifyRGB=this._opacityModifyRGB,i._updateCharColorAndOpacity(E),y=a.commonHeight-m.yOffset,y=cc.p(r+m.xOffset+.5*m.rect.width+g,p+y-.5*T.height*cc.contentScaleFactor()),E.setPosition(cc.pointPixelsToPoints(y)),f=S,o<(r+=m.xAdvance+g)&&(o=r)))}m&&m.xAdvance<m.rect.width?c.width=o-m.xAdvance+m.rect.width:c.width=o,c.height=d,this.setContentSize(cc.sizePixelsToPoints(c))}},updateString:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];r&&(r.visible=!1)}this._config&&this.createFontChars(),t||this.updateLabel()},getString:function(){return this._initialString},setString:function(t,e){null==e&&(e=!0),this._initialString===t&&e||(null!=(t=String(t))&&cc.isString(t)||(t+=""),this._initialString=t,this._setString(t,e))},_setStringForSetter:function(t){this.setString(t,!1)},setCString:function(t){this.setString(t,!0)},_getCharsWidth:function(t,e){var i;return e<=0?0:(i=this.getChildByTag(t),t=this.getChildByTag(t+e),this._getLetterPosXLeft(t)-this._getLetterPosXLeft(i))},_checkWarp:function(t,e,i,n){for(var r=t[e],c=0,o=0;o<e;o++)c+=t[o].length;var c=c+e-n,s=this._getCharsWidth(c,t[e].length-1);if(i<s&&1<r.length){for(var a,h,l=r.length*(i/s)|0,_=r.substr(l),u=s-this._getCharsWidth(c+l,_.length-1),d=0,p=0;i<u&&p++<100;)_=r.substr(l=l*(i/u)|0),u=s-this._getCharsWidth(c+l,_.length-1);for(p=0;u<i&&p++<100;)_&&(d=(a=cc.LabelTTF._wordRex.exec(_))?a[0].length:1,h=_),l+=d=this._lineBreakWithoutSpaces?0:d,_=r.substr(l),u=s-this._getCharsWidth(c+l,_.length-1);0===(l-=d)&&(h=h.substr(l=1));var f,n=r.substr(0,l);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(h||_)&&(d=(f=cc.LabelTTF._lastWordRex.exec(n))?f[0].length:0,this._lineBreakWithoutSpaces&&(d=0),h=r.substr(l-=d),n=r.substr(0,l)),cc.LabelTTF._firsrEnglish.test(h)&&(f=cc.LabelTTF._lastEnglish.exec(n))&&n!==f[0]&&(d=f[0].length,this._lineBreakWithoutSpaces&&(d=0),h=r.substr(l-=d),n=r.substr(0,l)),t[e]=h||_,t.splice(e,0,n)}},updateLabel:function(){var t,e,i=this;if(i.string=i._initialString,0<i._width){for(var n,r=i.string.split("\n"),c="",o=0,s=0;s<r.length;s++)n=r.length,this._checkWarp(r,s,i._width*this._scaleX,o),n<r.length&&o++,0<s&&(c+="\n"),c+=r[s];c+=String.fromCharCode(0),i._setString(c,!1)}if(i._alignment!==cc.TEXT_ALIGNMENT_LEFT)for(var a=s=0,h=i._string.length,l=[],_=0;_<h;_++)if(10===i._string[_].charCodeAt(0)||0===i._string[_].charCodeAt(0)){var u=l.length;if(0===u)a++;else{var d=s+u-1+a;if(!(d<0)){var p=i.getChildByTag(d);if(null!=p){var f=p.getPositionX()+p._getWidth()/2,g=0;switch(i._alignment){case cc.TEXT_ALIGNMENT_CENTER:g=i.width/2-f/2;break;case cc.TEXT_ALIGNMENT_RIGHT:g=i.width-f}if(0!==g)for(t=0;t<u;t++)(d=s+t+a)<0||(e=i.getChildByTag(d))&&(e.x+=g);s+=u,a++,l.length=0}}}}else l.push(i._string[s])},setAlignment:function(t){this._alignment=t,this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(t){this._width=t,this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces=t,this.updateLabel()},setScale:function(t,e){cc.Node.prototype.setScale.call(this,t,e),this.updateLabel()},setScaleX:function(t){cc.Node.prototype.setScaleX.call(this,t),this.updateLabel()},setScaleY:function(t){cc.Node.prototype.setScaleY.call(this,t),this.updateLabel()},setFntFile:function(t){var e;null!=t&&t!==this._fntFile&&((e=cc.loader.getRes(t))?(this._fntFile=t,this._config=e,e=(t=cc.textureCache.addImage(e.atlasName)).isLoaded(),(this._textureLoaded=e)?(this.setTexture(t),this.createFontChars()):t.addEventListener("load",function(t){this._textureLoaded=!0,this.setTexture(t),this.createFontChars(),this._changeTextureColor(),this.updateLabel(),this.dispatchEvent("load")},this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file"))},getFntFile:function(){return this._fntFile},setTexture:function(t){this._texture=t,this._renderCmd.setTexture(t)},setAnchorPoint:function(t,e){cc.Node.prototype.setAnchorPoint.call(this,t,e),this.updateLabel()},_setAnchorX:function(t){cc.Node.prototype._setAnchorX.call(this,t),this.updateLabel()},_setAnchorY:function(t){cc.Node.prototype._setAnchorY.call(this,t),this.updateLabel()},_atlasNameFromFntFile:function(t){},_kerningAmountForFirst:function(t,e){var i=0,t=t<<16|65535&e;return i=this._configuration.kerningDictionary&&(e=this._configuration.kerningDictionary[t.toString()])?e.amount:i},_getLetterPosXLeft:function(t){return t.getPositionX()*this._scaleX-t._getWidth()*this._scaleX*t._getAnchorX()},_getLetterPosXRight:function(t){return t.getPositionX()*this._scaleX+t._getWidth()*this._scaleX*t._getAnchorX()},_isspace_unicode:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},_utf8_trim_ws:function(t){var e=t.length;if(!(e<=0)){var i=e-1;if(this._isspace_unicode(t[i])){for(var n=i-1;0<=n&&this._isspace_unicode(t[n]);--n)i=n;this._utf8_trim_from(t,i)}}},_utf8_trim_from:function(t,e){var i=t.length;i<=e||e<0||t.splice(e,i)}}),!function(){var t=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(t),t.string,cc.defineGetterSetter(t,"string",t.getString,t._setStringForSetter),t.boundingWidth,cc.defineGetterSetter(t,"boundingWidth",t._getBoundingWidth,t.setBoundingWidth),t.textAlign,cc.defineGetterSetter(t,"textAlign",t._getAlignment,t.setAlignment),cc.defineGetterSetter(t,"texture",t.getTexture,t.setTexture)}(),cc.LabelBMFont.create=function(t,e,i,n,r){return new cc.LabelBMFont(t,e,i,n,r)},{INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(t){var e=t.match(this.ITEM_EXP),i={};if(e)for(var n=0,r=e.length;n<r;n++){var c=e[n],o=c.indexOf("="),s=c.substring(0,o),c=c.substring(o+1);c.match(this.INT_EXP)?c=parseInt(c):'"'===c[0]&&(c=c.substring(1,c.length-1)),i[s]=c}return i},parseFnt:function(t,e){for(var i=this,n={},r=i._parseStrToObj(t.match(i.INFO_EXP)[0]).padding.split(","),r=(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3]),i._parseStrToObj(t.match(i.COMMON_EXP)[0])),c=(n.commonHeight=r.lineHeight,cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(c=cc.configuration.getMaxTextureSize(),r.scaleW>c.width||r.scaleH>c.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported"),1!==r.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page"),i._parseStrToObj(t.match(i.PAGE_EXP)[0])),o=(0!==c.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),n.atlasName=cc.path.changeBasename(e,c.file),t.match(i.CHAR_EXP)),s=n.fontDefDictionary={},a=0,h=o.length;a<h;a++){var l=i._parseStrToObj(o[a]);s[l.id]={rect:{x:l.x,y:l.y,width:l.width,height:l.height},xOffset:l.xoffset,yOffset:l.yoffset,xAdvance:l.xadvance}}var _=n.kerningDict={},u=t.match(i.KERNING_EXP);if(u)for(a=0,h=u.length;a<h;a++){var d=i._parseStrToObj(u[a]);_[d.first<<16|65535&d.second]=d.amount}return n},load:function(t,i,e,n){var r=this;cc.loader.loadTxt(t,function(t,e){if(t)return n(t);n(null,r.parseFnt(e,i))})}});cc.loader.register(["fnt"],_fntLoader),!function(){cc.LabelBMFont.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)};var t=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.LabelBMFont.WebGLRenderCmd,t.setTexture=function(t){this._node.setOpacityModifyRGB(this._node._texture.hasPremultipliedAlpha())},t._updateCharTexture=function(t,e,i){t.setTextureRect(e,!1),t.visible=!0},t._changeTextureColor=function(){},t._updateCharColorAndOpacity=function(){}}(),cc.MotionStreak=cc.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(t,e,i,n,r){cc.Node.prototype.ctor.call(this),this._positionR=cc.p(0,0),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this.fastMode=!1,this.startingPositionInitialized=!1,this.texture=null,this._stroke=0,this._fadeDelta=0,this._minSeg=0,this._maxPoints=0,this._nuPoints=0,this._previousNuPoints=0,this._pointVertexes=null,this._pointState=null,this._vertices=null,this._colorPointer=null,this._texCoords=null,this._verticesBuffer=null,this._colorPointerBuffer=null,this._texCoordsBuffer=null,void 0!==r&&this.initWithFade(t,e,i,n,r)},getTexture:function(){return this.texture},setTexture:function(t){this.texture!==t&&(this.texture=t)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?this._blendFunc=t:(this._blendFunc.src=t,this._blendFunc.dst=e)},getOpacity:function(){return cc.log("cc.MotionStreak.getOpacity has not been supported."),0},setOpacity:function(t){cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isFastMode:function(){return this.fastMode},setFastMode:function(t){this.fastMode=t},isStartingPositionInitialized:function(){return this.startingPositionInitialized},setStartingPositionInitialized:function(t){this.startingPositionInitialized=t},getStroke:function(){return this._stroke},setStroke:function(t){this._stroke=t},initWithFade:function(t,e,i,n,r){if(!r)throw new Error("cc.MotionStreak.initWithFade(): Invalid filename or texture");cc.isString(r)&&(r=cc.textureCache.addImage(r)),cc.Node.prototype.setPosition.call(this,cc.p(0,0)),this.anchorX=0,this.anchorY=0,this.ignoreAnchor=!0,this.startingPositionInitialized=!1,this.fastMode=!0,this._minSeg=-1===e?i/5:e,this._minSeg*=this._minSeg,this._stroke=i,this._fadeDelta=1/t;e=2+(0|60*t);return this._maxPoints=e,this._nuPoints=0,this._pointState=new Float32Array(e),this._pointVertexes=new Float32Array(2*e),this._vertices=new Float32Array(4*e),this._texCoords=new Float32Array(4*e),this._colorPointer=new Uint8Array(8*e),this._verticesBuffer=gl.createBuffer(),this._texCoordsBuffer=gl.createBuffer(),this._colorPointerBuffer=gl.createBuffer(),this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.texture=r,this.color=n,this.scheduleUpdate(),gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW),!0},tintWithColor:function(t){this.color=t;for(var e=this._colorPointer,i=0,n=2*this._nuPoints;i<n;i++)e[4*i]=t.r,e[4*i+1]=t.g,e[4*i+2]=t.b},reset:function(){this._nuPoints=0},setPosition:function(t,e){this.startingPositionInitialized=!0,void 0===e?(this._positionR.x=t.x,this._positionR.y=t.y):(this._positionR.x=t,this._positionR.y=e)},getPositionX:function(){return this._positionR.x},setPositionX:function(t){this._positionR.x=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(t){this._positionR.y=t,this.startingPositionInitialized||(this.startingPositionInitialized=!0)},update:function(t){if(this.startingPositionInitialized){this._renderCmd._updateDisplayColor(),t*=this._fadeDelta;var e,i,n,r=0,c=this._nuPoints,o=this._pointState,s=this._pointVertexes,a=this._vertices,h=this._colorPointer;for(f=0;f<c;f++)o[f]-=t,o[f]<=0?r++:(e=f-r,0<r?(o[e]=o[f],s[2*e]=s[2*f],s[2*e+1]=s[2*f+1],a[2*(i=2*e)]=a[2*(n=2*f)],a[2*i+1]=a[2*n+1],a[2*(i+1)]=a[2*(1+n)],a[2*(i+1)+1]=a[2*(1+n)+1],n*=4,h[(i*=4)+0]=h[0+n],h[i+1]=h[1+n],h[i+2]=h[2+n],h[i+4]=h[4+n],h[i+5]=h[5+n],h[i+6]=h[6+n]):i=8*e,n=255*o[e],h[i+3]=n,h[i+7]=n);var l,_,u=!0;if((u=(c-=r)>=this._maxPoints||0<c&&(l=cc.pDistanceSQ(cc.p(s[2*(c-1)],s[2*(c-1)+1]),this._positionR)<this._minSeg,_=1!==c&&cc.pDistanceSQ(cc.p(s[2*(c-2)],s[2*(c-2)+1]),this._positionR)<2*this._minSeg,l||_)?!1:u)&&(s[2*c]=this._positionR.x,s[2*c+1]=this._positionR.y,o[c]=1,l=8*c,_=this.getDisplayedColor(),h[l]=_.r,h[1+l]=_.g,h[2+l]=_.b,h[4+l]=_.r,h[5+l]=_.g,h[6+l]=_.b,h[3+l]=255,h[7+l]=255,0<c&&this.fastMode&&(1<c?cc.vertexLineToPolygon(s,this._stroke,this._vertices,c,1):cc.vertexLineToPolygon(s,this._stroke,this._vertices,0,2)),c++),this.fastMode||cc.vertexLineToPolygon(s,this._stroke,this._vertices,0,c),c&&this._previousNuPoints!==c){for(var d=1/c,p=this._texCoords,f=0;f<c;f++)p[4*f]=0,p[4*f+1]=d*f,p[2*(2*f+1)]=1,p[2*(2*f+1)+1]=d*f;this._previousNuPoints=c}this._nuPoints=c}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.MotionStreak.WebGLRenderCmd(this):null}}),cc.MotionStreak.create=function(t,e,i,n,r){return new cc.MotionStreak(t,e,i,n,r)},cc.MotionStreak.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)},cc.MotionStreak.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.MotionStreak.WebGLRenderCmd.prototype.constructor=cc.Sprite.WebGLRenderCmd,cc.MotionStreak.WebGLRenderCmd.prototype.rendering=function(t){var e,i=this._node;i._nuPoints<=1||i.texture&&i.texture.isLoaded()&&(t=t||cc._renderContext,e=this._worldTransform,this._matrix.mat[0]=e.a,this._matrix.mat[4]=e.c,this._matrix.mat[12]=e.tx,this._matrix.mat[1]=e.b,this._matrix.mat[5]=e.d,this._matrix.mat[13]=e.ty,this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),cc.glBindTexture2D(i.texture),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,i._verticesBuffer),t.bufferData(t.ARRAY_BUFFER,i._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i._texCoordsBuffer),t.bufferData(t.ARRAY_BUFFER,i._texCoords,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,i._colorPointerBuffer),t.bufferData(t.ARRAY_BUFFER,i._colorPointer,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,2*i._nuPoints),cc.g_NumberOfDraws++)},cc.NodeGrid=cc.Node.extend({grid:null,_target:null,_gridRect:null,ctor:function(t){cc.Node.prototype.ctor.call(this),void 0===t&&(t=cc.rect()),this._gridRect=t},getGrid:function(){return this.grid},setGrid:function(t){this.grid=t},setGridRect:function(t){this._gridRect=t},getGridRect:function(){return this._gridRect},setTarget:function(t){this._target=t},_createRenderCmd:function(){return new cc.NodeGrid.WebGLRenderCmd(this)}});var _p,_p=((_p=cc.NodeGrid.prototype).grid,_p.target,cc.defineGetterSetter(_p,"target",null,_p.setTarget),cc.NodeGrid.create=function(){return new cc.NodeGrid},cc.v2fzero=function(){return{x:0,y:0}},cc.v2f=function(t,e){return{x:t,y:e}},cc.v2fadd=function(t,e){return cc.v2f(t.x+e.x,t.y+e.y)},cc.v2fsub=function(t,e){return cc.v2f(t.x-e.x,t.y-e.y)},cc.v2fmult=function(t,e){return cc.v2f(t.x*e,t.y*e)},cc.v2fperp=function(t){return cc.v2f(-t.y,t.x)},cc.v2fneg=function(t){return cc.v2f(-t.x,-t.y)},cc.v2fdot=function(t,e){return t.x*e.x+t.y*e.y},cc.v2fforangle=function(t){return cc.v2f(Math.cos(t),Math.sin(t))},cc.v2fnormalize=function(t){t=cc.pNormalize(cc.p(t.x,t.y));return cc.v2f(t.x,t.y)},cc.__v2f=function(t){return cc.v2f(t.x,t.y)},cc.__t=function(t){return{u:t.x,v:t.y}},cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.create=function(){return new cc.DrawNode},cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){function F(t,e,i){i.x=t.x*e,i.y=t.y*e}var a,A,u,d,s,D,N,B,M,b;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a=null,A=[],u=cc.p(),d=cc.p(),s=new Uint32Array(1),D=cc.p(),N=cc.p(),B=cc.p(),M=cc.p(),b=[],cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_vertexCount:0,_offset:0,_occupiedSize:0,_f32Buffer:null,_ui32Buffer:null,_dirty:!1,_className:"DrawNodeWebGL",manualRelease:!1,ctor:function(t,e){cc.Node.prototype.ctor.call(this),a=a||new GlobalVertexBuffer(cc._renderContext,20*cc.DRAWNODE_TOTAL_VERTICES),this._renderCmd._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR),this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this._bufferCapacity=t||64,this.manualRelease=e,this._dirty=!0},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._occupiedSize<this._bufferCapacity&&this._ensureCapacity(this._bufferCapacity)},onExit:function(){this.manualRelease||this.release(),cc.Node.prototype.onExit.call(this)},release:function(){0<this._occupiedSize&&(this._vertexCount=0,a.freeBuffer(this._offset,20*this._occupiedSize),this._occupiedSize=0)},_ensureCapacity:function(t){var e=this,i=e._occupiedSize,n=e._offset;if(i<t||e._bufferCapacity>i){var t=Math.max(Math.min(i+i,200),t,e._bufferCapacity),r=(0!==i&&(a.freeBuffer(n,20*i),e._occupiedSize=0),e._offset=a.requestBuffer(20*t));if(0<=r){if(e._occupiedSize=e._bufferCapacity=t,e._f32Buffer=new Float32Array(a.data,r,5*e._occupiedSize),e._ui32Buffer=new Uint32Array(a.data,r,5*e._occupiedSize),0!==i&&n!==r)for(var c=n/4+5*i,o=r/4,s=n/4;s<c;o++,s++)a.dataArray[o]=a.dataArray[s];return!0}return cc.warn("Failed to allocate buffer for DrawNode: buffer for "+t+" vertices requested"),!1}return!0},drawRect:function(t,e,i,n,r){n=null==n?this._lineWidth:n,r=r||this._drawColor,A.length=0,A.push(t.x,t.y,e.x,t.y,e.x,e.y,t.x,e.y),null==i?this._drawSegments(A,n,r,!0):this.drawPoly(A,i,n,r),A.length=0},drawRoundRect:function(t,e,i,n,r,s,a){n=null==n?this._lineWidth:n,r=r||this._drawColor,A.length=0,(addCircleVertices=function(t,e,i){for(var n=Math.PI/2/a,r=0;r<=a;r++){var c=r*n,o=s*Math.cos(c+t)+e,c=s*Math.sin(c+t)+i;A.push(o,c)}})(Math.PI/2,t.x+s,t.y-s),addCircleVertices(Math.PI,t.x+s,e.y+s),addCircleVertices(3*Math.PI/2,e.x-s,e.y+s),addCircleVertices(0,e.x-s,t.y-s),null==i?this._drawSegments(A,n,r,!0):this.drawPoly(A,i,n,r),A.length=0},drawCircle:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this._drawColor;for(var s,a=2*Math.PI/n,h=A.length=0;h<=n;h++){var l=h*a,_=e*Math.cos(l+i)+t.x,l=e*Math.sin(l+i)+t.y;A.push(_,l)}for(r&&A.push(t.x,t.y),c*=.5,h=0,s=A.length-2;h<s;h+=2)u.x=A[h],u.y=A[h+1],d.x=A[h+2],d.y=A[h+3],this.drawSegment(u,d,c,o);A.length=0},drawQuadBezier:function(t,e,i,n,r,c){r=r||this._lineWidth,c=c||this._drawColor;for(var o=0,s=A.length=0;s<n;s++){var a=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,h=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;A.push(a,h),o+=1/n}A.push(i.x,i.y),this._drawSegments(A,r,c,!1),A.length=0},drawCubicBezier:function(t,e,i,n,r,c,o){c=c||this._lineWidth,o=o||this._drawColor;for(var s=0,a=A.length=0;a<r;a++){var h=Math.pow(1-s,3)*t.x+3*Math.pow(1-s,2)*s*e.x+3*(1-s)*s*s*i.x+s*s*s*n.x,l=Math.pow(1-s,3)*t.y+3*Math.pow(1-s,2)*s*e.y+3*(1-s)*s*s*i.y+s*s*s*n.y;A.push(h,l),s+=1/r}A.push(n.x,n.y),this._drawSegments(A,c,o,!1),A.length=0},drawCatmullRom:function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},drawCardinalSpline:function(t,e,i,n,r){n=n||this._lineWidth,r=r||this._drawColor;for(var c,o=1/t.length,s=A.length=0;s<i+1;s++){var a=s/i,a=1==a?(c=t.length-1,1):(a-o*(c=0|a/o))/o;cc.cardinalSplineAt(cc.getControlPointAt(t,c-1),cc.getControlPointAt(t,+c),cc.getControlPointAt(t,c+1),cc.getControlPointAt(t,c+2),e,a,u),A.push(u.x,u.y)}n*=.5;for(var h=0,l=A.length-2;h<l;h+=2)u.x=A[h],u.y=A[h+1],d.x=A[h+2],d.y=A[h+3],this.drawSegment(u,d,n,r);A.length=0},drawDots:function(t,e,i){if(t&&0!==t.length){i=i||this._drawColor;for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},_render:function(){var t=cc._renderContext;this._offset<0||this._vertexCount<=0||(this._dirty?(a.updateSubData(this._offset,this._f32Buffer),this._dirty=!1):t.bindBuffer(t.ARRAY_BUFFER,a.vertexBuffer),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,20,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,20,8),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,20,12),t.drawArrays(t.TRIANGLES,this._offset/20,this._vertexCount),cc.incrementGLDraws(1))},appendVertexData:function(t,e,i,n,r){var c=this._f32Buffer,o=5*this._vertexCount;c[o]=t,c[1+o]=e,s[0]=i.a<<24|i.b<<16|i.g<<8|i.r,this._ui32Buffer[2+o]=s[0],c[3+o]=n,c[4+o]=r,this._vertexCount++},drawDot:function(t,e,i){null==(i=i||this._drawColor).a&&(i.a=255);var n=t.x-e,r=t.y-e,c=t.x+e,t=t.y+e;this._ensureCapacity(this._vertexCount+6)&&(this.appendVertexData(n,r,i,-1,-1),this.appendVertexData(n,t,i,-1,1),this.appendVertexData(c,t,i,1,1),this.appendVertexData(n,r,i,-1,-1),this.appendVertexData(c,t,i,1,1),this.appendVertexData(c,r,i,1,-1),this._dirty=!0)},drawSegment:function(t,e,i,n){null==(n=n||this.getDrawColor()).a&&(n.a=255),i=i||.5*this._lineWidth;var r,c,o,s,a,h,l,_,u,d,p,f,g,m,T,E,y,S,C,x,v,R,A,b,I,L,w,P,O;this._ensureCapacity(this._vertexCount+18)&&(D.x=(t=t).y-(e=e).y,D.y=e.x-t.x,cc.pNormalizeIn(D),N.x=-D.y,N.y=D.x,F(D,i,B),F(N,i,M),i=e.x-B.x-M.x,r=e.y-B.y-M.y,c=-(D.x+N.x),o=-(D.y+N.y),s=e.x+B.x-M.x,a=e.y+B.y-M.y,h=D.x-N.x,l=D.y-N.y,_=e.x-B.x,u=e.y-B.y,d=-D.x,p=-D.y,f=e.x+B.x,e=e.y+B.y,g=D.x,m=D.y,T=t.x-B.x,E=t.y-B.y,y=d,S=p,C=t.x+B.x,x=t.y+B.y,v=D.x,R=D.y,A=t.x-B.x+M.x,b=t.y-B.y+M.y,I=N.x-D.x,L=N.y-D.y,w=t.x+B.x+M.x,t=t.y+B.y+M.y,P=D.x+N.x,O=D.y+N.y,this.appendVertexData(i,r,n,c,o),this.appendVertexData(s,a,n,h,l),this.appendVertexData(_,u,n,d,p),this.appendVertexData(f,e,n,g,m),this.appendVertexData(s,a,n,h,l),this.appendVertexData(_,u,n,d,p),this.appendVertexData(f,e,n,g,m),this.appendVertexData(T,E,n,y,S),this.appendVertexData(_,u,n,d,p),this.appendVertexData(f,e,n,g,m),this.appendVertexData(T,E,n,y,S),this.appendVertexData(C,x,n,v,R),this.appendVertexData(A,b,n,I,L),this.appendVertexData(T,E,n,y,S),this.appendVertexData(C,x,n,v,R),this.appendVertexData(A,b,n,I,L),this.appendVertexData(w,t,n,P,O),this.appendVertexData(C,x,n,v,R),this._dirty=!0)},drawPoly:function(t,e,i,n){if("object"==typeof t[0]){for(var r=A.length=0;r<t.length;r++)A.push(t[r].x,t[r].y);t=A}if(null==e)this._drawSegments(t,i,n,!0);else{null==e.a&&(e.a=255),null==n.a&&(n.a=255),i=null==i?this._lineWidth:i,i*=.5;var c,o,s,a,h=t.length;for(r=b.length=0;r<h;r+=2)C=t[(r-2+h)%h],x=t[(r-1+h)%h],v=t[r],R=t[r+1],c=t[(r+2)%h],o=t[(r+3)%h],D.x=x-R,D.y=v-C,B.x=R-o,B.y=c-v,cc.pNormalizeIn(D),cc.pNormalizeIn(B),a=D.x*B.x+D.y*B.y+1,s=(D.x+B.x)/a,a=(D.y+B.y)/a,b.push(s,a,B.x,B.y);var l=0<i;if(this._ensureCapacity(this._vertexCount+3*(3*(h/=2)-2))){var _=0==l?.5:0;for(r=0;r<h-2;r++)C=t[0]-b[0]*_,x=t[1]-b[1]*_,v=t[2*r+2]-b[4*(r+1)]*_,R=t[2*r+3]-b[4*(r+1)+1]*_,c=t[2*r+4]-b[4*(r+2)]*_,o=t[2*r+5]-b[4*(r+2)+1]*_,this.appendVertexData(C,x,e,0,0),this.appendVertexData(v,R,e,0,0),this.appendVertexData(c,o,e,0,0);var u,d,p,f,g,m,T,E=l?i:.5,y=l?n:e;for(r=0;r<h;r++){var S=(r+1)%h,C=t[2*r],x=t[2*r+1],v=t[2*S],R=t[2*S+1];D.x=b[4*r+2],D.y=b[4*r+3],B.x=l?-D.x:0,B.y=l?-D.y:0,p=v-(T=b[4*S])*E,f=R-(S=b[4*S+1])*E,g=C+(u=b[4*r])*E,m=x+(d=b[4*r+1])*E,T=v+T*E,S=R+S*E,this.appendVertexData(u=C-u*E,d=x-d*E,y,B.x,B.y),this.appendVertexData(p,f,y,B.x,B.y),this.appendVertexData(T,S,y,D.x,D.y),this.appendVertexData(u,d,y,B.x,B.y),this.appendVertexData(g,m,y,D.x,D.y),this.appendVertexData(T,S,y,D.x,D.y)}A.length=b.length=0,this._dirty=!0}}},_drawSegments:function(t,e,i,n){if(!((e=null==e?this._lineWidth:e)<=0)){null==(i=i||this._drawColor).a&&(i.a=255),e*=.5;var r,c,o=t.length;for(f=b.length=0;f<o;f+=2)m=t[(f-2+o)%o],T=t[(f-1+o)%o],E=t[f],y=t[f+1],r=t[(f+2)%o],c=t[(f+3)%o],D.x=T-y,D.y=E-m,B.x=y-c,B.y=r-E,cc.pNormalizeIn(D),cc.pNormalizeIn(B),c=D.x*B.x+D.y*B.y+1,r=(D.x+B.x)/c,c=(D.y+B.y)/c,b.push(r,c,B.x,B.y);if(this._ensureCapacity(this._vertexCount+3*(3*(o/=2)-2))){for(var s,a,h,l,_,u,d,p=n?o:o-1,f=0;f<p;f++){var g=(f+1)%o,m=t[2*f],T=t[2*f+1],E=t[2*g],y=t[2*g+1];D.x=b[4*f+2],D.y=b[4*f+3],h=E-(d=b[4*g])*e,l=y-(g=b[4*g+1])*e,_=m+(s=b[4*f])*e,u=T+(a=b[4*f+1])*e,d=E+d*e,g=y+g*e,this.appendVertexData(s=m-s*e,a=T-a*e,i,-D.x,-D.y),this.appendVertexData(h,l,i,-D.x,-D.y),this.appendVertexData(d,g,i,D.x,D.y),this.appendVertexData(s,a,i,-D.x,-D.y),this.appendVertexData(_,u,i,D.x,D.y),this.appendVertexData(d,g,i,D.x,D.y)}b.length=0,this._dirty=!0}}},clear:function(){this.release(),this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}}))}),cc.DrawNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e,i=this._node;0<i._vertexCount&&(e=this._worldTransform,this._matrix.mat[0]=e.a,this._matrix.mat[4]=e.c,this._matrix.mat[12]=e.tx,this._matrix.mat[1]=e.b,this._matrix.mat[5]=e.d,this._matrix.mat[13]=e.ty,cc.glBlendFunc(i._blendFunc.src,i._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),i._render())},cc.stencilBits=-1,cc.ClippingNode=cc.Node.extend({alphaThreshold:0,inverted:!1,_stencil:null,_className:"ClippingNode",ctor:function(t){t=t||null,cc.Node.prototype.ctor.call(this),this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},init:function(t){return this._stencil=t,this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits(),!0},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),cc.Node.prototype.onExit.call(this)},getAlphaThreshold:function(){return this.alphaThreshold},setAlphaThreshold:function(t){this.alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&this._renderCmd.setStencil(t)},_createRenderCmd:function(){return new cc.ClippingNode.WebGLRenderCmd(this)}}),cc.ClippingNode.prototype),_p,_p;cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil),_p.stencil,cc.ClippingNode.create=function(t){return new cc.ClippingNode(t)},!function(){cc.ClippingNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._currentStencilEnabled=null,this._mask_layer_le=null};var t=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,t.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.stencilBits<=0&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},t.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&i._stencil._renderCmd.transform(this,e)},t.visit=function(t){var e=this._node;if(e._visible)if(e._parent&&e._parent._renderCmd&&(this._curLevel=e._parent._renderCmd._curLevel+1),cc.stencilBits<1)this.originVisit(t);else if(e._stencil&&e._stencil.visible)if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits)cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),this.originVisit(t);else{cc.renderer.pushRenderCommand(this._beforeVisitCmd);var i=cc.current_stack,n=(i.stack.push(i.top),this._syncStatus(t),i.top=this._stackMatrix,e._stencil._renderCmd.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd),e._children);if(n&&0<n.length){var r=n.length;e.sortAllChildren();for(var c=0;c<r;c++)n[c]._renderCmd.visit(this)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0,i.top=i.stack.pop()}else e.inverted&&this.originVisit(t)},t.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},t._onBeforeVisit=function(t){var t=t||cc._renderContext,e=this._node,i=(cc.ClippingNode.WebGLRenderCmd._layer++,1<<cc.ClippingNode.WebGLRenderCmd._layer);this._mask_layer_le=i|i-1,this._currentStencilEnabled=t.isEnabled(t.STENCIL_TEST),t.clear(t.DEPTH_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.depthMask(!1),t.stencilFunc(t.NEVER,i,i),t.stencilOp(t.REPLACE,t.KEEP,t.KEEP),t.stencilMask(i),t.clear(t.STENCIL_BUFFER_BIT),e.alphaThreshold<1&&(i=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),cc.glUseProgram(i.getProgram()),i.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,e.alphaThreshold),i.setUniformLocationWithMatrix4fv(cc.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),cc.setProgram(e._stencil,i))},t._onAfterDrawStencil=function(t){t=t||cc._renderContext;t.depthMask(!0),t.stencilFunc(this._node.inverted?t.NOTEQUAL:t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},t._onAfterVisit=function(t){var e,i,t=t||cc._renderContext;cc.ClippingNode.WebGLRenderCmd._layer--,this._currentStencilEnabled?(i=(e=1<<cc.ClippingNode.WebGLRenderCmd._layer)|e-1,t.stencilMask(e),t.stencilFunc(t.EQUAL,i,i)):t.disable(t.STENCIL_TEST)}}(),cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(t){cc.Node.prototype.ctor.call(this),this._type=cc.ProgressTimer.TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,t&&this.initWithSprite(t)},onEnter:function(){this._super(),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},cleanup:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData(),this._super()},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(t){this._midPoint=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(t){this._barChangeRate=cc.pClamp(t,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(t){this._percentage!==t&&(this._percentage=cc.clampf(t,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(t){this._sprite.color=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(t){this._sprite.opacity=t,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},setSprite:function(t){this._sprite!==t&&((this._sprite=t)?(this.setContentSize(t.width,t.height),t.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(t){t!==this._type&&(this._type=t,this._renderCmd.resetVertexData())},setReverseDirection:function(t){this._reverseDirection!==t&&(this._reverseDirection=t,this._renderCmd.resetVertexData())},initWithSprite:function(t){return this.percentage=0,this.setAnchorPoint(.5,.5),this._type=cc.ProgressTimer.TYPE_RADIAL,this._reverseDirection=!1,this.midPoint=cc.p(.5,.5),this.barChangeRate=cc.p(1,1),this.setSprite(t),this._renderCmd.resetVertexData(),!0},_createRenderCmd:function(){return new cc.ProgressTimer.WebGLRenderCmd(this)}}),(_p=cc.ProgressTimer.prototype).midPoint,cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint),_p.barChangeRate,cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate),_p.type,cc.defineGetterSetter(_p,"type",_p.getType,_p.setType),_p.percentage,cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage),_p.sprite,cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite),_p.reverseDir,cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection),cc.ProgressTimer.create=function(t){return new cc.ProgressTimer(t)},cc.ProgressTimer.TEXTURE_COORDS_COUNT=4,cc.ProgressTimer.TEXTURE_COORDS=75,cc.ProgressTimer.TYPE_RADIAL=0,cc.ProgressTimer.TYPE_BAR=1,cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._to=0,void(this._from=0)!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=e,!0)},clone:function(){var t=new cc.ProgressTo;return t.initWithDuration(this._duration,this._to),t},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=t.percentage},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressTo=function(t,e){return new cc.ProgressTo(t,e)},cc.ProgressTo.create=cc.progressTo,cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._to=0,void(this._from=0)!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=i,this._from=e,!0)},clone:function(){var t=new cc.ProgressFromTo;return t.initWithDuration(this._duration,this._from,this._to),t},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t)},update:function(t){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*t)}}),cc.progressFromTo=function(t,e,i){return new cc.ProgressFromTo(t,e,i)},cc.ProgressFromTo.create=cc.progressFromTo,!function(){cc.ProgressTimer.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._progressDirty=!0,this._bl=cc.p(),this._tr=cc.p(),this.initCmd()};var t=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);t.constructor=cc.ProgressTimer.WebGLRenderCmd,t.transform=function(t,e){this.originTransform(t,e);var t=this._node._sprite,e=(t._renderCmd.transform(this,e),t._offsetPosition.x),i=e+t._rect.width,n=t._offsetPosition.y,t=n+t._rect.height,r=this._worldTransform;this._bl.x=e*r.a+n*r.c+r.tx,this._bl.y=e*r.b+n*r.d+r.ty,this._tr.x=i*r.a+t*r.c+r.tx,this._tr.y=i*r.b+t*r.d+r.ty,this._updateProgressData()},t.rendering=function(t){var e,i=this._node,t=t||cc._renderContext;0!==this._vertexDataCount&&i._sprite&&(this._shaderProgram.use(),this._shaderProgram._updateProjectionUniform(),e=i._sprite._blendFunc,cc.glBlendFunc(e.src,e.dst),cc.glBindTexture2D(i._sprite.texture),t.bindBuffer(t.ARRAY_BUFFER,this._vertexWebGLBuffer),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),this._vertexDataDirty&&(t.bufferSubData(t.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1),e=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT,t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,e,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,16),i._type===cc.ProgressTimer.TYPE_RADIAL?t.drawArrays(t.TRIANGLE_FAN,0,this._vertexDataCount):i._type===cc.ProgressTimer.TYPE_BAR&&(i._reverseDirection?(t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount/2),t.drawArrays(t.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++)},t._syncStatus=function(t){var e,i,n,r,c=this._node;c._sprite&&(e=cc.Node._dirtyFlags,i=this._dirtyFlag,(n=t?t._node:null)&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty),r=((this._dirtyFlag=i)|(c=(n=c._sprite._renderCmd)._dirtyFlag))&e.colorDirty,c=(i|c)&e.opacityDirty,r&&(n._syncDisplayColor(),n._dirtyFlag=n._dirtyFlag&e.colorDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.colorDirty^this._dirtyFlag),c&&(n._syncDisplayOpacity(),n._dirtyFlag=n._dirtyFlag&e.opacityDirty^n._dirtyFlag,this._dirtyFlag=this._dirtyFlag&e.opacityDirty^this._dirtyFlag),(r||c)&&this._updateColor(),i&e.transformDirty&&this.transform(t),i&e.textureDirty&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&e.textureDirty^this._dirtyFlag),n._dirtyFlag=0)},t.updateStatus=function(){var t,e,i,n,r=this._node;r._sprite&&(t=cc.Node._dirtyFlags,i=((e=this._dirtyFlag)|(n=(r=r._sprite._renderCmd)._dirtyFlag))&t.colorDirty,n=(e|n)&t.opacityDirty,i&&(r._updateDisplayColor(),r._dirtyFlag=r._dirtyFlag&t.colorDirty^r._dirtyFlag,this._dirtyFlag=this._dirtyFlag&t.colorDirty^this._dirtyFlag),n&&(r._updateDisplayOpacity(),r._dirtyFlag=r._dirtyFlag&t.opacityDirty^r._dirtyFlag,this._dirtyFlag=this._dirtyFlag&t.opacityDirty^this._dirtyFlag),(i||n)&&this._updateColor(),e&t.transformDirty&&this.transform(this.getParentRenderCmd(),!0),e&t.orderDirty&&(this._dirtyFlag=this._dirtyFlag&t.orderDirty^this._dirtyFlag),e&t.textureDirty)&&(this._updateProgressData(),this._dirtyFlag=this._dirtyFlag&t.textureDirty^this._dirtyFlag)},t.releaseData=function(){var t;this._vertexData&&(t=this._vertexWebGLBuffer,setTimeout(function(){cc._renderContext.deleteBuffer(t)},.1),this._vertexWebGLBuffer=null,this._vertexData=null,this._float32View=null,this._vertexArrayBuffer=null,this._vertexDataCount=0)},t.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=cc._renderContext.createBuffer();var t=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*t),this._float32View=new Float32Array(this._vertexArrayBuffer),this._vertexData=[];for(var e=0;e<8;e++)this._vertexData[e]=new cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*t);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW),this._vertexDataCount=0,this._vertexDataDirty=!0,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}},t.resetVertexData=function(){this._vertexDataCount=0},t._updateProgressData=function(){var t=this._node._type;t===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():t===cc.ProgressTimer.TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0},t._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textureDirty)},t._updateBar=function(){var t,e,i,n=this._node;n._sprite&&(t=n._percentage/100,e=n._barChangeRate,t=cc.pMult(cc.p(1-e.x+t*e.x,1-e.y+t*e.y),.5),e=cc.pSub(n._midPoint,t),n=cc.pAdd(n._midPoint,t),e.x<0&&(n.x+=-e.x,e.x=0),1<n.x&&(e.x-=n.x-1,n.x=1),e.y<0&&(n.y+=-e.y,e.y=0),1<n.y&&(e.y-=n.y-1,n.y=1),this._reverseDirection?(i=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(i[0].texCoords,0,1),this._vertexFromAlphaPoint(i[0].vertices,0,1),this._textureCoordFromAlphaPoint(i[1].texCoords,0,0),this._vertexFromAlphaPoint(i[1].vertices,0,0),this._textureCoordFromAlphaPoint(i[6].texCoords,1,1),this._vertexFromAlphaPoint(i[6].vertices,1,1),this._textureCoordFromAlphaPoint(i[7].texCoords,1,0),this._vertexFromAlphaPoint(i[7].vertices,1,0)),this._textureCoordFromAlphaPoint(i[2].texCoords,e.x,n.y),this._vertexFromAlphaPoint(i[2].vertices,e.x,n.y),this._textureCoordFromAlphaPoint(i[3].texCoords,e.x,e.y),this._vertexFromAlphaPoint(i[3].vertices,e.x,e.y),this._textureCoordFromAlphaPoint(i[4].texCoords,n.x,n.y),this._vertexFromAlphaPoint(i[4].vertices,n.x,n.y),this._textureCoordFromAlphaPoint(i[5].texCoords,n.x,e.y),this._vertexFromAlphaPoint(i[5].vertices,n.x,e.y)):(this._vertexDataCount||(this._vertexDataCount=4),i=this._vertexData,this._textureCoordFromAlphaPoint(i[0].texCoords,e.x,n.y),this._vertexFromAlphaPoint(i[0].vertices,e.x,n.y),this._textureCoordFromAlphaPoint(i[1].texCoords,e.x,e.y),this._vertexFromAlphaPoint(i[1].vertices,e.x,e.y),this._textureCoordFromAlphaPoint(i[2].texCoords,n.x,n.y),this._vertexFromAlphaPoint(i[2].vertices,n.x,n.y),this._textureCoordFromAlphaPoint(i[3].texCoords,n.x,e.y),this._vertexFromAlphaPoint(i[3].vertices,n.x,e.y)),this._updateColor())},t._updateRadial=function(){var t=this._node;if(t._sprite){var e,i=t._midPoint,n=t._percentage/100,t=2*cc.PI*(t._reverseDirection?n:1-n),r=cc.p(i.x,1),c=cc.pRotateByAngle(r,i,t),o=0;if(0==n)e=r,o=0;else if(1==n)e=r,o=4;else{for(var s=cc.FLT_MAX,a=cc.ProgressTimer.TEXTURE_COORDS_COUNT,h=0;h<=a;++h){var l=(h+(a-1))%a,_=this._boundaryTexCoord(h%a),l=this._boundaryTexCoord(l),u=(0===h?l=cc.pLerp(_,l,1-i.x):4===h&&(_=cc.pLerp(_,l,1-i.x)),cc.p(0,0));cc.pLineIntersect(_,l,i,c,u)&&(0!==h&&4!==h||0<=u.x&&u.x<=1)&&0<=u.y&&u.y<s&&(s=u.y,o=h)}e=cc.pAdd(i,cc.pMult(cc.pSub(c,i),s))}var t=!0,d=(this._vertexDataCount!==o+3&&(t=!1,this._vertexDataCount=o+3),this._updateColor(),this._vertexData);if(!t)for(this._textureCoordFromAlphaPoint(d[0].texCoords,i.x,i.y),this._vertexFromAlphaPoint(d[0].vertices,i.x,i.y),this._textureCoordFromAlphaPoint(d[1].texCoords,r.x,r.y),this._vertexFromAlphaPoint(d[1].vertices,r.x,r.y),h=0;h<o;h++){var p=this._boundaryTexCoord(h);this._textureCoordFromAlphaPoint(d[h+2].texCoords,p.x,p.y),this._vertexFromAlphaPoint(d[h+2].vertices,p.x,p.y)}this._textureCoordFromAlphaPoint(d[this._vertexDataCount-1].texCoords,e.x,e.y),this._vertexFromAlphaPoint(d[this._vertexDataCount-1].vertices,e.x,e.y)}},t._boundaryTexCoord=function(t){var e;return t<cc.ProgressTimer.TEXTURE_COORDS_COUNT?(e=cc.ProgressTimer.TEXTURE_COORDS,this._node._reverseDirection?cc.p(e>>7-(t<<1)&1,e>>7-(1+(t<<1))&1):cc.p(e>>1+(t<<1)&1,e>>(t<<1)&1)):cc.p(0,0)},t._textureCoordFromAlphaPoint=function(t,e,i){var n,r,c=this._node._sprite;c?(n=(r=c._renderCmd._vertices)[1],r=r[2],n=cc.p(n.u,n.v),r=cc.p(r.u,r.v),c.textureRectRotated&&(c=e,e=i,i=c),t.u=n.x*(1-e)+r.x*e,t.v=n.y*(1-i)+r.y*i):(t.u=0,t.v=0)},t._vertexFromAlphaPoint=function(t,e,i){t.x=this._bl.x*(1-e)+this._tr.x*e,t.y=this._bl.y*(1-i)+this._tr.y*i,t.z=this._node._vertexZ},t._updateColor=function(){var t=this._node._sprite;if(this._vertexDataCount&&t){for(var e=this._displayedColor,i=t._renderCmd._displayedColor,n=i.r,r=i.g,i=i.b,c=t._renderCmd._displayedOpacity/255,o=(t._opacityModifyRGB&&(n*=c,r*=c,i*=c),e.r=n,e.g=r,e.b=i,e.a=t._renderCmd._displayedOpacity,this._vertexData),s=0,a=this._vertexDataCount;s<a;++s)o[s].colors=e;this._vertexDataDirty=!0}}}(),cc.PNGReader=cc.Class.extend({ctor:function(t){var e,i,n,r,c,o,s,a,h,l;for(this.data=t,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){switch(e=this.readUInt32(),c=function(){var t,e=[];for(t=0;t<4;++t)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(e);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},s=this.readUInt16(),r=this.readUInt16()||100,n.delay=1e3*s/r,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(this.pos+=4,e-=4),t=(null!=n?n.data:void 0)||this.imgData,a=0;0<=e?a<e:e<a;0<=e?++a:--a)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(e),0<(o=255-this.transparency.indexed.length))for(h=0;0<=o?h<o:o<h;0<=o?++h:--h)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case"tEXt":r=(s=this.read(e)).indexOf(0),l=String.fromCharCode.apply(String,s.slice(0,r)),this.text[l]=String.fromCharCode.apply(String,s.slice(r+1));break;case"IEND":return n&&this.animation.frames.push(n),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(l=this.colorType)||6===l,i=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*i,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=e}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(t){var e,i=[];for(e=0;0<=t?e<t:t<e;0<=t?++e:--e)i.push(this.data[this.pos++]);return i},readUInt32:function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},readUInt16:function(){return this.data[this.pos++]<<8|this.data[this.pos++]},decodePixels:function(t){var e,i,n,r,c,o,s,a,h,l,_,u,d,p,f,g,m,T,E,y,S;if(0===(t=null==t?this.imgData:t).length)return new Uint8Array(0);for(t=new Zlib.Inflate(t,{index:0,verify:!1}).decompress(),p=(l=this.pixelBitlength/8)*this.width,_=new Uint8Array(p*this.height),o=t.length,i=u=d=0;u<o;){switch(t[u++]){case 0:for(r=m=0;m<p;r=m+=1)_[i++]=t[u++];break;case 1:for(r=T=0;T<p;r=T+=1)e=t[u++],c=r<l?0:_[i-l],_[i++]=(e+c)%256;break;case 2:for(r=E=0;E<p;r=E+=1)e=t[u++],n=(r-r%l)/l,f=d&&_[(d-1)*p+n*l+r%l],_[i++]=(f+e)%256;break;case 3:for(r=y=0;y<p;r=y+=1)e=t[u++],n=(r-r%l)/l,c=r<l?0:_[i-l],f=d&&_[(d-1)*p+n*l+r%l],_[i++]=(e+Math.floor((c+f)/2))%256;break;case 4:for(r=S=0;S<p;r=S+=1)e=t[u++],n=(r-r%l)/l,c=r<l?0:_[i-l],0===d?f=g=0:(f=_[(d-1)*p+n*l+r%l],g=n&&_[(d-1)*p+(n-1)*l+r%l]),h=c+f-g,s=Math.abs(h-c),a=Math.abs(h-f),h=Math.abs(h-g),_[i++]=(e+(s<=a&&s<=h?c:a<=h?f:g))%256;break;default:throw new Error("Invalid filter algorithm: "+t[u-1])}d++}return _},copyToImageData:function(t,e){var i,n,r,c,o,s,a,h,l=this.colors,_=null,u=this.hasAlphaChannel;if(this.palette.length&&(_=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),l=4,u=!0),s=(i=t.data||t).length,r=_||e,n=c=0,1===l)for(;n<s;)o=_?4*e[n/4]:c,a=r[o++],i[n++]=a,i[n++]=a,i[n++]=a,i[n++]=u?r[o++]:255,c=o;else for(;n<s;)o=_?4*e[n/4]:c,i[n++]=r[o++],i[n++]=r[o++],i[n++]=r[o++],i[n++]=u?r[o++]:255,c=o},decodePalette:function(){for(var t,e,i=this.palette,n=this.transparency.indexed||[],r=new Uint8Array((n.length||0)+i.length),c=0,o=0,s=t=0,a=i.length;t<a;s=t+=3)r[c++]=i[s],r[c++]=i[s+1],r[c++]=i[s+2],r[c++]=null!=(e=n[o++])?e:255;return r},render:function(t){var e;return t.width=this.width,t.height=this.height,e=(t=t.getContext("2d")).createImageData(this.width,this.height),this.copyToImageData(e,this.decodePixels()),t.putImageData(e,0,0)}}),cc.IMEKeyboardNotificationInfo=function(t,e,i){this.begin=t||cc.rect(0,0,0,0),this.end=e||cc.rect(0,0,0,0),this.duration=i||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(t,e){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}}),cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl,this._lastClickPosition=cc.p(0,0)},init:function(){var i;cc.sys.isMobile||(this._domInputControl=cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl)),(i=this)._domInputControl.addEventListener("input",function(){i._processDomInputString(i._domInputControl.value)},!1),this._domInputControl.addEventListener("keydown",function(t){t.keyCode===cc.KEY.tab?(t.stopPropagation(),t.preventDefault()):t.keyCode===cc.KEY.enter&&(i.dispatchInsertText("\n",1),t.stopPropagation(),t.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(t){t.keyCode===cc.KEY.backspace&&i._processDomInputString(i._domInputControl.value)},!1),window.addEventListener("mousedown",function(t){var e=t.pageX||0,t=t.pageY||0;i._lastClickPosition.x=e,i._lastClickPosition.y=t},!1))},_processDomInputString:function(t){for(var e=(this._currentInputString.length<t.length?this._currentInputString:t).length,i=0;i<e&&t[i]===this._currentInputString[i];i++);for(var n=this._currentInputString.length-i,r=t.length-i,c=0;c<n;c++)this.dispatchDeleteBackward();for(c=0;c<r;c++)this.dispatchInsertText(t[i+c],1);this._currentInputString=t},dispatchInsertText:function(t,e){!this.impl||!t||e<=0||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(t,e)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},getContentText:function(){return this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.getContentText()||""},dispatchKeyboardWillShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillShow(t)}},dispatchKeyboardDidShow:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidShow(t)}},dispatchKeyboardWillHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardWillHide(t)}},dispatchKeyboardDidHide:function(t){if(this.impl)for(var e=0;e<this.impl._delegateList.length;e++){var i=this.impl._delegateList[e];i&&i.keyboardDidHide(t)}},addDelegate:function(t){t&&this.impl&&(-1<this.impl._delegateList.indexOf(t)||this.impl._delegateList.splice(0,0,t))},attachDelegateWithIME:function(t){var e;return!(!this.impl||!t||-1===this.impl._delegateList.indexOf(t)||(this.impl._delegateWithIme?!this.impl._delegateWithIme.canDetachWithIME()||!t.canAttachWithIME()||(e=this.impl._delegateWithIme,this.impl._delegateWithIme=null,e.didDetachWithIME(),this._focusDomInput(t),0):!t.canAttachWithIME()||(this._focusDomInput(t),0)))},_focusDomInput:function(t){var e,i;cc.sys.isMobile?((this.impl._delegateWithIme=t).didAttachWithIME(),this._currentInputString=t.string||"",e=t.getTipMessage?t.getTipMessage():"please enter your word:",null!=(i=(i=window.Window)&&i.prototype.prompt&&i.prototype.prompt!=prompt?i.prototype.prompt.call(window,e,this._currentInputString):prompt(e,this._currentInputString))&&this._processDomInputString(i),this.dispatchInsertText("\n",1)):(this.impl._delegateWithIme=t,this._currentInputString=t.string||"",t.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate())},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(t){return!(!this.impl||!t||this.impl._delegateWithIme!==t||!t.canDetachWithIME()||(this.impl._delegateWithIme=null,t.didDetachWithIME(),cc._canvas.focus(),0))},removeDelegate:function(t){this.impl&&t&&-1!==this.impl._delegateList.indexOf(t)&&(this.impl._delegateWithIme&&t===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.arrayRemoveObject(this.impl._delegateList,t))},processKeycode:function(t){t<32?t===cc.KEY.backspace?this.dispatchDeleteBackward():t===cc.KEY.enter?this.dispatchInsertText("\n",1):t!==cc.KEY.tab&&cc.KEY.escape:t<255&&this.dispatchInsertText(String.fromCharCode(t),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(t){for(var e=0;e<this._delegateList.length;e++)if(this._delegateList[e]===t)return e;return null}}),cc.imeDispatcher=new cc.IMEDispatcher,document.body?cc.imeDispatcher.init():window.addEventListener("load",function(){cc.imeDispatcher.init()},!1),cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(t){return!1},onTextFieldDetachWithIME:function(t){return!1},onTextFieldInsertText:function(t,e,i){return!1},onTextFieldDeleteBackward:function(t,e,i){return!1},onDraw:function(t){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(t,e,i,n,r){this.colorSpaceHolder=cc.color(127,127,127),this._colorText=cc.color(255,255,255,255),cc.LabelTTF.prototype.ctor.call(this),void 0!==r?(this.initWithPlaceHolder("",e,i,n,r),t&&this.setPlaceHolder(t)):void 0===n&&void 0!==i&&(this.initWithString("",e,i),t)&&this.setPlaceHolder(t)},onEnter:function(){cc.LabelTTF.prototype.onEnter.call(this),cc.imeDispatcher.addDelegate(this)},onExit:function(){cc.LabelTTF.prototype.onExit.call(this),cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(t){this.delegate=t},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(t){this.colorSpaceHolder.r=t.r,this.colorSpaceHolder.g=t.g,this.colorSpaceHolder.b=t.b,this.colorSpaceHolder.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(t){this._colorText.r=t.r,this._colorText.g=t.g,this._colorText.b=t.b,this._colorText.a=cc.isUndefined(t.a)?255:t.a,this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(t,e,i,n,r){switch(arguments.length){case 5:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,n,r,e,i);case 3:return t&&this.setPlaceHolder(t),this.initWithString(this._placeHolder,e,i);default:throw new Error("Argument must be non-nil ")}},setString:function(t){t=String(t),this._inputText=t||"",this._inputText.length?(cc.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(t){this._placeHolder=t||"",this._inputText.length||(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(t){t=t||cc._renderContext;this.delegate&&this.delegate.onDraw(this)||cc.LabelTTF.prototype.draw.call(this,t)},visit:function(t){this._super(t)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!this.delegate||!this.delegate.onTextFieldAttachWithIME(this)},didAttachWithIME:function(){},canDetachWithIME:function(){return!this.delegate||!this.delegate.onTextFieldDetachWithIME(this)},didDetachWithIME:function(){},deleteBackward:function(){var t=this._inputText.length;0===t||this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[t-1],1)||(t<=1?(this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)):this.string=this._inputText.substring(0,t-1))},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(t){null!=t&&(this._tipMessage=t)},getTipMessage:function(){return this._tipMessage},insertText:function(t,e){var i=t.indexOf("\n");if(0<(t=-1<i?t.substring(0,i):t).length){if(this.delegate&&this.delegate.onTextFieldInsertText(this,t,t.length))return;t=this._inputText+t;this._charCount=t.length,this.string=t}-1===i||this.delegate&&this.delegate.onTextFieldInsertText(this,"\n",1)||this.detachWithIME()},getContentText:function(){return this._inputText},keyboardWillShow:function(t){},keyboardDidShow:function(t){},keyboardWillHide:function(t){},keyboardDidHide:function(t){}}),(_p=cc.TextFieldTTF.prototype).charCount,cc.defineGetterSetter(_p,"charCount",_p.getCharCount),_p.placeHolder,cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),cc.TextFieldTTF.create=function(t,e,i,n,r){return new cc.TextFieldTTF(t,e,i,n,r)},cc.__getSubArray=function(t,e,i){return t instanceof Array?t.slice(e,i):t.subarray(e,i)},cc.__setDataToArray=function(t,e,i){for(var n=0;n<t.length;n++)e[i+n]=t[n]},cc.KEYBOARD_RETURNTYPE_DEFAULT=0,cc.KEYBOARD_RETURNTYPE_DONE=1,cc.KEYBOARD_RETURNTYPE_SEND=2,cc.KEYBOARD_RETURNTYPE_SEARCH=3,cc.KEYBOARD_RETURNTYPE_GO=4,cc.EDITBOX_INPUT_MODE_ANY=0,cc.EDITBOX_INPUT_MODE_EMAILADDR=1,cc.EDITBOX_INPUT_MODE_NUMERIC=2,cc.EDITBOX_INPUT_MODE_PHONENUMBER=3,cc.EDITBOX_INPUT_MODE_URL=4,cc.EDITBOX_INPUT_MODE_DECIMAL=5,cc.EDITBOX_INPUT_MODE_SINGLELINE=6,cc.EDITBOX_INPUT_FLAG_PASSWORD=0,cc.EDITBOX_INPUT_FLAG_SENSITIVE=1,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4,cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(t){},editBoxEditingDidEnd:function(t){},editBoxTextChanged:function(t,e){},editBoxReturn:function(t){}}),cc.EditBox=cc.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_maxLength:50,_text:"",_textColor:null,_placeholderText:"",_placeholderFontName:"",_placeholderFontSize:14,_placeholderColor:null,_className:"EditBox",_touchListener:null,_touchEnabled:!0,ctor:function(t,e){cc.Node.prototype.ctor.call(this),this._anchorPoint=cc.p(.5,.5),this._textColor=cc.color.WHITE,this._placeholderColor=cc.color.GRAY,this._renderCmd._createLabels(),this.createDomElementIfNeeded(),this.initWithSizeAndBackgroundSprite(t,e),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchEnded:this._onTouchEnded.bind(this)}),cc.eventManager.addListener(this._touchListener,this),this.setInputFlag(this._editBoxInputFlag)},setTouchEnabled:function(t){this._touchEnabled!==t&&(this._touchEnabled=t,this._touchEnabled?cc.eventManager.addListener(this._touchListener,this):cc.eventManager.removeListener(this._touchListener))},_createRenderCmd:function(){return new cc.EditBox.WebGLRenderCmd(this)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),cc.Node.prototype.setContentSize.call(this,t,e),this._updateEditBoxSize(t,e)},setVisible:function(t){cc.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||(window.wx?this._renderCmd._createWXInput(this._editBoxInputMode===cc.EDITBOX_INPUT_MODE_ANY):window.kwaigame?this._renderCmd._createKwaigameInput(this._editBoxInputMode===cc.EDITBOX_INPUT_MODE_ANY):this._renderCmd._createDomTextArea())},setTabIndex:function(t){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=t)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warn("The dom control is not created!"),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warn("The dom control is not created!"),!1)},stayOnTop:function(t){this._alwaysOnTop!==t&&(this._alwaysOnTop=t,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd._removeDomFromGameContainer()},_isAncestorsVisible:function(t){return null==t||!((t=t.getParent())&&!t.isVisible())&&this._isAncestorsVisible(t)},_onTouchBegan:function(t){var e;if(this.isVisible()&&this._isAncestorsVisible(this))return t=t.getLocation(),e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),!!cc.rectContainsPoint(e,this.convertToNodeSpace(t))||(this._renderCmd._endEditing(),!1)},_onTouchEnded:function(){this.isVisible()&&this._isAncestorsVisible(this)&&this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(t,e){this._backgroundSprite&&this._backgroundSprite.setContentSize(t,e)},_updateEditBoxSize:function(t,e){var i="number"==typeof t.width?t.width:t,t="number"==typeof t.height?t.height:e;this._updateBackgroundSpriteSize(i,t),this._renderCmd.updateSize(i,t)},setLineHeight:function(t){this._renderCmd.setLineHeight(t)},setFont:function(t,e){this._renderCmd.setFont(t,e)},_setFont:function(t){this._renderCmd._setFont(t)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(t){this._renderCmd.setFontName(t)},setFontSize:function(t){this._renderCmd.setFontSize(t)},setString:function(t){t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._text=t,this._renderCmd.setString(t)},setFontColor:function(t){this._textColor=t,this._renderCmd.setFontColor(t)},setMaxLength:function(t){isNaN(t)||(this._maxLength=t=t<0?65535:t,this._renderCmd.setMaxLength(t))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){null!==t&&(this._renderCmd.setPlaceHolder(t),this._placeholderText=t)},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(t){t=cc.LabelTTF._fontStyleRE.exec(t);t&&(this._placeholderFontName=t[2],this._placeholderFontSize=parseInt(t[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._renderCmd.setPlaceholderFontColor(t)},setInputFlag:function(t){this._editBoxInputFlag=t,this._renderCmd.setInputFlag(t)},getText:function(){return cc.log("Please use the getString"),this._text},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(t,e){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=e,this.setContentSize(t),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(t.width,t.height)),this.x=0,!(this.y=0)},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){var e;this._editBoxInputMode!==t&&(e=this.getString(),this._editBoxInputMode=t,this._renderCmd.setInputMode(t),this._renderCmd.transform(),this.setString(e),this._renderCmd._updateLabelPosition(this.getContentSize()))},setReturnType:function(t){this._keyboardReturnType=t,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(t,e){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(e)}});var _p,ccui=((_p=cc.EditBox.prototype).font,cc.defineGetterSetter(_p,"font",null,_p._setFont),_p.fontName,cc.defineGetterSetter(_p,"fontName",null,_p.setFontName),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize),_p.fontColor,cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor),_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.maxLength,cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),_p.placeHolder,cc.defineGetterSetter(_p,"placeholder",_p.getPlaceHolder,_p.setPlaceHolder),_p.placeHolderFont,cc.defineGetterSetter(_p,"placeholderFont",null,_p._setPlaceholderFont),_p.placeHolderFontName,cc.defineGetterSetter(_p,"placeholderFontName",null,_p.setPlaceholderFontName),_p.placeHolderFontSize,cc.defineGetterSetter(_p,"placeholderFontSize",null,_p.setPlaceholderFontSize),_p.placeHolderFontColor,cc.defineGetterSetter(_p,"placeholderFontColor",null,_p.setPlaceholderFontColor),_p.inputFlag,cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag),_p.delegate,cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate),_p.inputMode,cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode),_p.returnType,cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType),_p=null,cc.EditBox.create=function(t,e,i,n){return new cc.EditBox(t,e,i,n)},!function(t){t._polyfill={zoomInvalid:!1},cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0)}(cc.EditBox),!function(l){function i(t){var e=t.convertToWorldSpace(cc.p(0,0)),i=cc.visibleRect.height,t=cc.visibleRect.width,n=i<t?.7:.5;setTimeout(function(){var t;window.scrollY<40&&e.y<i*n&&(320<(t=(t=i*n-e.y-window.scrollY)<35?35:t)&&(t=320),window.scrollTo(t,t))},400)}var t=Object.create(Object.prototype);t.updateMatrix=function(){var t,e,i,n,r,c,o,s,a,h;this._edTxt&&(t=this._node,s=cc.view._scaleX,e=cc.view._scaleY,c=cc.view._devicePixelRatio,h=this._worldTransform,o=cc.game.container,i=h.a*(s/=c),n=h.b,r=h.c,c=h.d*(e/=c),a=o&&o.style.paddingLeft&&parseInt(o.style.paddingLeft),o=o&&o.style.paddingBottom&&parseInt(o.style.paddingBottom),s=h.tx*s+a,a=h.ty*e+o,l.zoomInvalid&&(this.updateSize(t._contentSize.width*i,t._contentSize.height*c),c=i=1),this._edTxt.style.transform=h="matrix("+i+","+-n+","+-r+","+c+","+s+","+-a+")",this._edTxt.style["-webkit-transform"]=h,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px")},t.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},t.stayOnTop=function(t){t?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._showLabels())},t._beginEditingOnMobile=function(t){this.__orientationChanged=function(){i(t)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},t._endEditingOnMobile=function(){var t,e,i;this.__rotateScreen&&((t=cc.game.container.style)["-webkit-transform"]="rotate(90deg)",t.transform="rotate(90deg)",e=(t=cc.view)._originalDesignResolutionSize.width,i=t._originalDesignResolutionSize.height,0<e&&t.setDesignResolutionSize(e,i,t._resolutionPolicy),this.__rotateScreen=!1),window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},t._onFocusOnMobile=function(t){var e;cc.view._isRotated?((e=cc.game.container.style)["-webkit-transform"]="rotate(0deg)",e.transform="rotate(0deg)",e.margin="0px",window.scrollTo(35,35),this.__rotateScreen=!0):this.__rotateScreen=!1,i(t)},t._createDomInput=function(){this._removeDomFromGameContainer();var i=this,t=this._edTxt=document.createElement("input");return t.type="text",t.style.fontFamily=this._edFontName,t.style.fontSize=this._edFontSize+"px",t.style.color="#000000",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.style.className="cocosEditBox",this.setMaxLength(i._editBox._maxLength),t.addEventListener("input",function(){var t=i._editBox;this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength)),t._delegate&&t._delegate.editBoxTextChanged&&t._text!==this.value&&(t._text=this.value,i._updateDomTextCases(),t._delegate.editBoxTextChanged(t,t._text))}),t.addEventListener("keypress",function(t){var e=i._editBox;t.keyCode===cc.KEY.enter&&(t.stopPropagation(),t.preventDefault(),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),e._text=this.value,i._updateDomTextCases(),i._endEditing(),e._delegate&&e._delegate.editBoxReturn&&e._delegate.editBoxReturn(e),cc._canvas.focus())}),t.addEventListener("focus",function(){var t=i._editBox;this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(t._textColor),i._hiddenLabels(),cc.sys.isMobile&&i._onFocusOnMobile(t),t._delegate&&t._delegate.editBoxEditingDidBegin&&t._delegate.editBoxEditingDidBegin(t)}),t.addEventListener("blur",function(){var t=i._editBox;t._text=this.value,i._updateDomTextCases(),t._delegate&&t._delegate.editBoxEditingDidEnd&&t._delegate.editBoxEditingDidEnd(t),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),t},t._createDomTextArea=function(){this._removeDomFromGameContainer();var i=this,t=this._edTxt=document.createElement("textarea");return t.type="text",t.style.fontFamily=this._edFontName,t.style.fontSize=this._edFontSize+"px",t.style.color="#000000",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.resize="none",t.style.textTransform="uppercase",t.style.overflow_y="scroll",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.style.className="cocosEditBox",this.setMaxLength(i._editBox._maxLength),t.addEventListener("input",function(){this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength));var t=i._editBox;t._delegate&&t._delegate.editBoxTextChanged&&t._text.toLowerCase()!==this.value.toLowerCase()&&(t._text=this.value,i._updateDomTextCases(),t._delegate.editBoxTextChanged(t,t._text))}),t.addEventListener("focus",function(){var t=i._editBox;i._hiddenLabels(),this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(t._textColor),cc.sys.isMobile&&i._onFocusOnMobile(t),t._delegate&&t._delegate.editBoxEditingDidBegin&&t._delegate.editBoxEditingDidBegin(t)}),t.addEventListener("keypress",function(t){var e=i._editBox;t.keyCode===cc.KEY.enter&&(t.stopPropagation(),e._delegate)&&e._delegate.editBoxReturn&&e._delegate.editBoxReturn(e)}),t.addEventListener("blur",function(){var t=i._editBox;t._text=this.value,i._updateDomTextCases(),t._delegate&&t._delegate.editBoxEditingDidEnd&&t._delegate.editBoxEditingDidEnd(t),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),t},t._createKwaigameInput=function(t){this._removeDomFromGameContainer();var i=this,e=this._edTxt=document.createElement("input");e.type="text",e.focus=function(){var e=i._editBox;loadRuntime().showKeyboard({defaultValue:e._text,maxLength:140,multiple:t,confirmHold:!0,confirmType:"done",success:function(t){e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)},fail:function(t){cc.warn(t.errMsg),i._endEditing()}}),loadRuntime().onKeyboardConfirm(function(t){e._text=t.value,i._updateDomTextCases(),e._delegate&&e._delegate.editBoxReturn&&e._delegate.editBoxReturn(e),i._endEditing(),loadRuntime().offKeyboardConfirm(),loadRuntime().offKeyboardInput(),loadRuntime().offKeyboardComplete(),loadRuntime().hideKeyboard({success:function(t){e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e)},fail:function(t){cc.warn(t.errMsg)}})}),loadRuntime().onKeyboardInput(function(t){e._delegate&&e._delegate.editBoxTextChanged&&e._text!==t.value&&(e._text=t.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),loadRuntime().onKeyboardComplete(function(){i._endEditing(),loadRuntime().offKeyboardConfirm(),loadRuntime().offKeyboardInput(),loadRuntime().offKeyboardComplete()})}},t._createWXInput=function(t){this._removeDomFromGameContainer();var i=this,e=this._edTxt=document.createElement("input");e.type="text",e.focus=function(){var e=i._editBox;wx.showKeyboard({defaultValue:e._text,maxLength:140,multiple:t,confirmHold:!0,confirmType:"done",success:function(t){e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)},fail:function(t){cc.warn(t.errMsg),i._endEditing()}}),wx.onKeyboardConfirm(function(t){e._text=t.value,i._updateDomTextCases(),e._delegate&&e._delegate.editBoxReturn&&e._delegate.editBoxReturn(e),wx.hideKeyboard({success:function(t){e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e)},fail:function(t){cc.warn(t.errMsg)}})}),wx.onKeyboardInput(function(t){e._delegate&&e._delegate.editBoxTextChanged&&e._text!==t.value&&(e._text=t.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),wx.onKeyboardComplete(function(){i._endEditing(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.offKeyboardComplete()})}},t._createLabels=function(){var t=this._editBox.getContentSize();this._textLabel||(this._textLabel=new cc.LabelTTF,this._textLabel.setAnchorPoint(cc.p(0,1)),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=new cc.LabelTTF,this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(t)},t._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},t._updateLabelPosition=function(t){var e;this._textLabel&&this._placeholderLabel&&(e=cc.size(t.width-2,t.height),this._textLabel.setContentSize(e),this._textLabel.setDimensions(e),this._placeholderLabel.setLineHeight(t.height),e=this._placeholderLabel.getContentSize(),this._editBox._editBoxInputMode===cc.EDITBOX_INPUT_MODE_ANY?(this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,t.height),this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP)):(this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,(t.height+e.height)/2),this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER)))},t.setLineHeight=function(t){this._textLabel&&this._textLabel.setLineHeight(t)},t._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},t._updateDomTextCases=function(){var t=this._editBox._editBoxInputFlag;t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD?this._editBox._text=this._editBox._text.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()}):t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE&&(this._editBox._text=(t=this._editBox._text).charAt(0).toUpperCase()+t.slice(1))},t._updateLabelStringStyle=function(){if(this._edTxt&&"password"===this._edTxt.type){for(var t="",e=this._editBox._text.length,i=0;i<e;++i)t+="●";this._textLabel&&this._textLabel.setString(t)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},t._showLabels=function(){this._hiddenLabels(),""===(cc.sys.platform===cc.sys.WECHAT_GAME||window.kwaigame?this._editBox._text:this._edTxt.value)?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},t._beginEditing=function(){var t=this;window.wx||window.kwaigame?t._edTxt.focus():t._editBox._alwaysOnTop||"none"===t._edTxt.style.display&&(t._edTxt.style.display="",t._edTxt.focus()),cc.sys.isMobile&&!t._editingMode&&t._beginEditingOnMobile(t._editBox),t._editingMode=!0},t._endEditing=function(){var t;!this._editBox._alwaysOnTop&&this._edTxt&&(this._edTxt.style.display="none"),this._showLabels(),!window.wx&&!window.kwaigame&&cc.sys.isMobile&&this._editingMode&&(t=this,setTimeout(function(){t._endEditingOnMobile()},400)),this._editingMode=!1},t._setFont=function(t){var t=cc.LabelTTF._fontStyleRE.exec(t),e=t[2],i=parseInt(t[1]);t&&this.setFont(e,i)},t.setFont=function(t,e){this._edFontName=t||this._edFontName,this._edFontSize=e||this._edFontSize,this._updateDOMFontStyle()},t.setFontName=function(t){this._edFontName=t||this._edFontName,this._updateDOMFontStyle()},t.setFontSize=function(t){this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},t.setFontColor=function(t){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(t)),this._textLabel)&&this._textLabel.setColor(t)},t.setPlaceHolder=function(t){this._placeholderLabel.setString(t)},t.setMaxLength=function(t){this._edTxt&&(this._edTxt.maxLength=t)},t._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontName(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},t.setPlaceholderFontColor=function(t){this._placeholderLabel.setColor(t)},t._updateDomInputType=function(){var t=this._editBox._editBoxInputMode;t===cc.EDITBOX_INPUT_MODE_EMAILADDR?this._edTxt.type="email":t===cc.EDITBOX_INPUT_MODE_DECIMAL||t===cc.EDITBOX_INPUT_MODE_NUMERIC?this._edTxt.type="number":t===cc.EDITBOX_INPUT_MODE_PHONENUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):t===cc.EDITBOX_INPUT_MODE_URL?this._edTxt.type="url":(this._edTxt.type="text",this._editBox._keyboardReturnType===cc.KEYBOARD_RETURNTYPE_SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD&&(this._edTxt.type="password")},t.setInputFlag=function(t){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},t.setInputMode=function(t){window.wx?this._createWXInput(t===cc.EDITBOX_INPUT_MODE_ANY):window.kwaigame?this._createKwaigameInput(t===cc.EDITBOX_INPUT_MODE_ANY):t===cc.EDITBOX_INPUT_MODE_ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();t=this._node.getContentSize();this.updateSize(t.width,t.height)},t.setString=function(t){this._edTxt&&null!==t&&(""===(this._edTxt.value=t)?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},t._updateDOMFontStyle=function(){this._edTxt&&(""!==this._edTxt.value&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel)&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontName(this._edFontName))},t.updateSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px",this._updateLabelPosition(cc.size(t,e)))},t._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},t._removeDomFromGameContainer=function(){var t=this._edTxt;t&&function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0}while(null!==(i=i.parentNode));return!1}(cc.game.container,t)&&cc.game.container.removeChild(t),this._edTxt=null},t.initializeRenderCmd=function(t){this._editBox=t,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},cc.EditBox.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this.initializeRenderCmd(t)};var e=cc.EditBox.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(t,e),e.constructor=cc.EditBox.WebGLRenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()}}(cc.EditBox._polyfill),cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(t,e){this._reorderProtectedChildDirty=!0,this._protectedChildren.push(t),t._setLocalZOrder(e)},ctor:function(){cc.Node.prototype.ctor.call(this),this._protectedChildren=[]},addProtectedChild:function(t,e,i){cc.assert(null!=t,"child must be non-nil"),cc.assert(!t.parent,"child already added. It can't be added again"),e=e||t.getLocalZOrder(),i&&t.setTag(i),this._insertProtectedChild(t,e),t.setParent(this),t.setOrderOfArrival(cc.s_globalOrderOfArrival),this._running&&(t.onEnter(),this._isTransitionFinished)&&t.onEnterTransitionDidFinish(),this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty(),this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(t){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag");for(var e=this._protectedChildren,i=0,n=e.length;i<n;i++)if(e.getTag()===t)return e[i];return null},removeProtectedChild:function(t,e){null==e&&(e=!0);var i,n=this._protectedChildren;0!==n.length&&-1<(i=n.indexOf(t))&&(this._running&&(t.onExitTransitionDidStart(),t.onExit()),e&&t.cleanup(),t.setParent(null),n.splice(i,1))},removeProtectedChildByTag:function(t,e){cc.assert(t!==cc.NODE_TAG_INVALID,"Invalid tag"),null==e&&(e=!0);var i=this.getProtectedChildByTag(t);null==i?cc.log("cocos2d: removeChildByTag(tag = %d): child not found!",t):this.removeProtectedChild(i,e)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(t){null==t&&(t=!0);for(var e=this._protectedChildren,i=0,n=e.length;i<n;i++){var r=e[i];this._running&&(r.onExitTransitionDidStart(),r.onExit()),t&&r.cleanup(),r.setParent(null)}e.length=0},reorderProtectedChild:function(t,e){cc.assert(null!=t,"Child must be non-nil"),this._reorderProtectedChildDirty=!0,t.setOrderOfArrival(cc.s_globalOrderOfArrival++),t._setLocalZOrder(e)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){for(var t,e,i=this._protectedChildren,n=i.length,r=1;r<n;r++){for(e=i[r],t=r-1;0<=t&&(e._localZOrder<i[t]._localZOrder||e._localZOrder===i[t]._localZOrder&&e.arrivalOrder<i[t].arrivalOrder);)i[t+1]=i[t],t--;i[t+1]=e}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},cleanup:function(){cc.Node.prototype.cleanup.call(this);for(var t=this._protectedChildren,e=0,i=t.length;e<i;e++)t[e].cleanup()},onEnter:function(){cc.Node.prototype.onEnter.call(this);for(var t=this._protectedChildren,e=0,i=t.length;e<i;e++)t[e].onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);for(var t=this._protectedChildren,e=0,i=t.length;e<i;e++)t[e].onEnterTransitionDidFinish()},onExit:function(){cc.Node.prototype.onExit.call(this);for(var t=this._protectedChildren,e=0,i=t.length;e<i;e++)t[e].onExit()},onExitTransitionDidStart:function(){cc.Node.prototype.onExitTransitionDidStart.call(this);for(var t=this._protectedChildren,e=0,i=t.length;e<i;e++)t[e].onExitTransitionDidStart()},_createRenderCmd:function(){return new cc.ProtectedNode.WebGLRenderCmd(this)}}),cc.ProtectedNode.create=function(){return new cc.ProtectedNode},cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(t){var e,i,n=this._node,r=this._displayedColor,c=n._realColor;if(this._cascadeColorEnabledDirty&&!n._cascadeColorEnabled){r.r=c.r,r.g=c.g,r.b=c.b;for(var o,s=new cc.Color(255,255,255,255),a=0,h=(o=n._children).length;a<h;a++)(e=o[a])&&e._renderCmd&&e._renderCmd._updateDisplayColor(s);this._cascadeColorEnabledDirty=!1}else{if(void 0===t&&(t=(i=n._parent)&&i._cascadeColorEnabled?i.getDisplayedColor():cc.color.WHITE),r.r=0|c.r*t.r/255,r.g=0|c.g*t.g/255,r.b=0|c.b*t.b/255,n._cascadeColorEnabled)for(a=0,h=(o=n._children).length;a<h;a++)(e=o[a])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(r),e._renderCmd._updateColor());for(a=0,h=(o=n._protectedChildren).length;a<h;a++)(e=o[a])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(r),e._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty^this._dirtyFlag},_updateDisplayOpacity:function(t){var e,i,n,r,c,o=this._node;if(this._cascadeOpacityEnabledDirty&&!o._cascadeOpacityEnabled){for(this._displayedOpacity=o._realOpacity,e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t&&(t=255,c=o._parent)&&c._cascadeOpacityEnabled&&(t=c.getDisplayedOpacity()),this._displayedOpacity=o._realOpacity*t/255,o._cascadeOpacityEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor());for(e=0,i=(n=o._protectedChildren).length;e<i;e++)(r=n[e])&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty^this._dirtyFlag},_changeProtectedChild:function(t){var t=t._renderCmd,e=t._dirtyFlag,i=cc.Node._dirtyFlags,n=(this._dirtyFlag&i.colorDirty&&(e|=i.colorDirty),this._dirtyFlag&i.opacityDirty&&(e|=i.opacityDirty),e&i.colorDirty),e=e&i.opacityDirty;n&&t._updateDisplayColor(this._displayedColor),e&&t._updateDisplayOpacity(this._displayedOpacity),(n||e)&&t._updateColor()}},!function(){var t;cc.Node.WebGLRenderCmd&&(cc.ProtectedNode.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t)},t=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),cc.inject(cc.ProtectedNode.RenderCmd,t),t.constructor=cc.ProtectedNode.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible){this._syncStatus(t);var i,n,r,t=e.grid,c=(t&&t._active&&t.beforeDraw(),e._children),o=e._protectedChildren,s=c.length,a=o.length;for(e.sortAllChildren(),e.sortAllProtectedChildren(),i=0;i<s&&(c[i]&&c[i]._localZOrder<0);i++)c[i].visit(this);for(n=0;n<a&&((r=o[n])&&r._localZOrder<0);n++)this._changeProtectedChild(r),r.visit(this);for(cc.renderer.pushRenderCommand(this);i<s;i++)c[i]&&c[i].visit(this);for(;n<a;n++)(r=o[n])&&(this._changeProtectedChild(r),r.visit(this));t&&t._active&&t.afterDraw(e),this._dirtyFlag=0}},t.transform=function(t,e){this.originTransform(t,e);var i,n,r=this._node._protectedChildren;if(e&&r&&0!==r.length)for(i=0,n=r.length;i<n;i++)r[i]._renderCmd.transform(this,e)},t.pNodeVisit=t.visit,t.pNodeTransform=t.transform)}(),ccui||{}),_p;ccui.Class=ccui.Class||cc.Class,ccui.Class.extend=ccui.Class.extend||cc.Class.extend,ccui.Node=ccui.Node||cc.Node,ccui.Node.extend=ccui.Node.extend||cc.Node.extend,ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode,ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend,ccui.cocosGUIVersion="CocosGUI v1.0.0.0",ccui._FocusNavigationController=cc.Class.extend({}),ccui.__LAYOUT_COMPONENT_NAME="__ui_layout",ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,ctor:function(){cc.ProtectedNode.prototype.ctor.call(this),this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._touchBeganPosition=cc.p(0,0),this._touchMovePosition=cc.p(0,0),this._touchEndPosition=cc.p(0,0),this._widgetType=ccui.Widget.TYPE_WIDGET,this._customSize=cc.size(0,0),this._layoutParameterDictionary={},this._sizeType=ccui.Widget.SIZE_ABSOLUTE,this._sizePercent=cc.p(0,0),this._positionType=ccui.Widget.POSITION_ABSOLUTE,this._positionPercent=cc.p(0,0),this._nodes=[],this._layoutParameterType=ccui.LayoutParameter.NONE,ccui.Widget.prototype.init.call(this)},init:function(){return!!cc.ProtectedNode.prototype.init.call(this)&&(this._layoutParameterDictionary={},this._initRenderer(),this.setBright(!0),this.onFocusChanged=this.onFocusChange,this.onNextFocusedWidget=null,this.setAnchorPoint(cc.p(.5,.5)),this.ignoreContentAdaptWithSize(!0),!0)},onEnter:function(){var t=this._touchListener;t&&!t._isRegistered()&&this._touchEnabled&&cc.eventManager.addListener(t,this),this._usingLayoutComponent||this.updateSizeAndPosition(),cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate(),cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var t=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);return null==t&&(t=new ccui.LayoutComponent,this.addComponent(t)),t},getWidgetParent:function(){var t=this.getParent();return t instanceof ccui.Widget?t:null},_updateContentSizeWithTextureSize:function(t){this._unifySize?this.setContentSize(t):this.setContentSize(this._ignoreSize?t:this._customSize)},_isAncestorsEnabled:function(){var t=this._getAncensterWidget(this);return null==t||!(t&&!t.isEnabled())&&t._isAncestorsEnabled()},setPropagateTouchEvents:function(t){this._propagateTouchEvents=t},isPropagateTouchEvents:function(){return this._propagateTouchEvents},setSwallowTouches:function(t){this._touchListener&&this._touchListener.setSwallowTouches(t)},isSwallowTouches:function(){return!!this._touchListener&&this._touchListener.isSwallowTouches()},_getAncensterWidget:function(t){return null==t||null==(t=t.getParent())?null:t instanceof ccui.Widget?t:this._getAncensterWidget(t.getParent())},_isAncestorsVisible:function(t){return null==t||!((t=t.getParent())&&!t.isVisible())&&this._isAncestorsVisible(t)},_cleanupWidget:function(){this._eventDispatcher.removeEventListener(this._touchListener),this._touchEnabled=!1,this._touchListener=null,ccui.Widget._focusedWidget===this&&(ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null)},setEnabled:function(t){this._enabled=t},_initRenderer:function(){},setContentSize:function(t,e){var i=void 0===e?t.width:t,t=void 0===e?t.height:e;cc.Node.prototype.setContentSize.call(this,i,t),this._customSize.width=i,this._customSize.height=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(e=(this.getWidgetParent()||this._parent).getContentSize(),this._sizePercent.x=0<e.width?i/e.width:0,this._sizePercent.y=0<e.height?t/e.height:0),this._onSizeChanged()},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._customSize.width=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(this.getWidgetParent()||this._parent).width,this._sizePercent.x=0<t?this._customSize.width/t:0),this._onSizeChanged()},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._customSize.height=t,this._unifySize||this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(t=(this.getWidgetParent()||this._parent).height,this._sizePercent.y=0<t?this._customSize.height/t:0),this._onSizeChanged()},setSizePercent:function(t){var e,i,n;this._usingLayoutComponent?((e=this._getOrCreateLayoutComponent()).setUsingPercentContentSize(!0),e.setPercentContentSize(t),e.refreshLayout()):(this._sizePercent.x=t.x,this._sizePercent.y=t.y,e=this._customSize.width,n=this._customSize.height,this._running&&(n=(i=this.getWidgetParent())?(e=i.width*t.x,i.height*t.y):(e=this._parent.width*t.x,this._parent.height*t.y)),this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(e,n),this._customSize.width=e,this._customSize.height=n)},_setWidthPercent:function(t){this._sizePercent.x=t;var e=this._customSize.width;this._running&&(e=(this.getWidgetParent()||this._parent).width*t),this._ignoreSize?this._setWidth(this.getVirtualRendererSize().width):this._setWidth(e),this._customSize.width=e},_setHeightPercent:function(t){this._sizePercent.y=t;var e=this._customSize.height;this._running&&(e=(this.getWidgetParent()||this._parent).height*t),this._ignoreSize?this._setHeight(this.getVirtualRendererSize().height):this._setHeight(e),this._customSize.height=e},updateSizeAndPosition:function(t){switch(t||(t=(n=this.getWidgetParent())?n.getLayoutSize():this._parent.getContentSize()),this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(this._customSize),this._sizePercent.x=0<t.width?this._customSize.width/t.width:0,this._sizePercent.y=0<t.height?this._customSize.height/t.height:0;break;case ccui.Widget.SIZE_PERCENT:var e=cc.size(t.width*this._sizePercent.x,t.height*this._sizePercent.y);this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(e),this._customSize.width=e.width,this._customSize.height=e.height}this._onSizeChanged();var i=this.getPosition();switch(this._positionType){case ccui.Widget.POSITION_ABSOLUTE:t.width<=0||t.height<=0?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=i.x/t.width,this._positionPercent.y=i.y/t.height);break;case ccui.Widget.POSITION_PERCENT:i=cc.p(t.width*this._positionPercent.x,t.height*this._positionPercent.y)}if(this._parent instanceof ccui.ImageView){var n=this._parent._imageRenderer;if(n&&!n._textureLoaded)return}this.setPosition(i)},setSizeType:function(t){this._sizeType=t,this._usingLayoutComponent&&this._getOrCreateLayoutComponent().setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(t){this._unifySize?this.setContentSize(this._customSize):this._ignoreSize!==t&&(this._ignoreSize=t,this.setContentSize(t?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){var t;return this._usingLayoutComponent&&(t=this._getOrCreateLayoutComponent(),this._sizePercent=t.getPercentContentSize()),this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent)for(var t=this.getChildren(),e=0,i=t.length;e<i;e++){var n=t[e];n instanceof ccui.Widget&&n.updateSizeAndPosition()}},setTouchEnabled:function(t){this._touchEnabled!==t&&(this._touchEnabled=t,this._touchEnabled?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(t){t!==this._highlight&&(this._highlight=t,this._bright?this._highlight?this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(t){(this._focused=t)&&(ccui.Widget._focusedWidget=this,ccui.Widget._focusNavigationController)&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this)},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(t){this._focusEnabled=t},findNextFocusedWidget:function(t,e){var i,n;return null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(t)?(i=e instanceof ccui.Layout,this.isFocused()||i?null!==(n=this.getParent())&&n instanceof ccui.Layout?n.findNextFocusedWidget(t,e):i?e.findNextFocusedWidget(t,e):e:e):(n=this.onNextFocusedWidget(t),this.dispatchFocusEvent(this,n),n)},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onFocusChange:function(t,e){t&&t.setFocused(!1),e&&e.setFocused(!0)},dispatchFocusEvent:function(t,e){e!==(t=t&&!t.isFocused()?ccui.Widget._focusedWidget:t)&&(e&&e.onFocusChanged&&e.onFocusChanged(t,e),t&&e.onFocusChanged&&t.onFocusChanged(t,e),cc.eventManager.dispatchEvent(new cc.EventFocus(t,e)))},setBright:function(t){this._bright=t,this._bright?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):this._onPressStateChangedToDisabled()},setBrightStyle:function(t){if(this._brightStyle!==t)switch(t=t||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle=t,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor()),this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(t,e){var i;return this._hit=!1,this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)&&(i=t.getLocation(),this._touchBeganPosition.x=i.x,this._touchBeganPosition.y=i.y,this.hitTest(this._touchBeganPosition))&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0),!!this._hit&&(this.setHighlighted(!0),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,this,t),this._pushDownEvent(),!0)},propagateTouchEvent:function(t,e,i){var n=this.getWidgetParent();n&&n.interceptTouchEvent(t,e,i)},onTouchMoved:function(t,e){var i=t.getLocation();this._touchMovePosition.x=i.x,this._touchMovePosition.y=i.y,this.setHighlighted(this.hitTest(i)),this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,t),this._moveEvent()},onTouchEnded:function(t,e){var i=t.getLocation(),i=(this._touchEndPosition.x=i.x,this._touchEndPosition.y=i.y,this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,t),this._highlight);this.setHighlighted(!1),i?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(t){this.setHighlighted(!1),this._cancelUpEvent()},onTouchLongClicked:function(t){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED),this._clickEventListener&&this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED),this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(t,e){void 0===e?this._touchEventCallback=t:(this._touchEventSelector=t,this._touchEventListener=e)},addClickEventListener:function(t){this._clickEventListener=t},hitTest:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(e,this.convertToNodeSpace(t))},isClippingParentContainsPoint:function(t){this._affectByClipping=!1;for(var e=this.getParent(),i=null;e;){if(e instanceof ccui.Layout&&e.isClippingEnabled()){this._affectByClipping=!0,i=e;break}e=e.getParent()}return!this._affectByClipping||!i||!!i.hitTest(t)&&i.isClippingParentContainsPoint(t)},checkChildInfo:function(t,e,i){var n=this.getWidgetParent();n&&n.checkChildInfo(t,e,i)},setPosition:function(t,e){var i;!this._usingLayoutComponent&&this._running&&(i=this.getWidgetParent())&&((i=i.getContentSize()).width<=0||i.height<=0?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===e?(this._positionPercent.x=t.x/i.width,this._positionPercent.y=t.y/i.height):(this._positionPercent.x=t/i.width,this._positionPercent.y=e/i.height)),cc.Node.prototype.setPosition.call(this,t,e)},setPositionX:function(t){var e;this._running&&(e=this.getWidgetParent())&&(e=e.width,this._positionPercent.x=e<=0?0:t/e),cc.Node.prototype.setPositionX.call(this,t)},setPositionY:function(t){var e;this._running&&(e=this.getWidgetParent())&&(e=e.height,this._positionPercent.y=e<=0?0:t/e),cc.Node.prototype.setPositionY.call(this,t)},setPositionPercent:function(t){var e;this._usingLayoutComponent?((e=this._getOrCreateLayoutComponent()).setPositionPercentX(t.x),e.setPositionPercentY(t.y),e.refreshLayout()):(this._setXPercent(t.x),this._setYPercent(t.y),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_setXPercent:function(t){var e;this._usingLayoutComponent?((e=this._getOrCreateLayoutComponent()).setPositionPercentX(t.x),e.refreshLayout()):this._positionPercent.x=t},_setYPercent:function(t){var e;this._usingLayoutComponent?((e=this._getOrCreateLayoutComponent()).setPositionPercentY(t.x),e.refreshLayout()):this._positionPercent.y=t},getPositionPercent:function(){var t;return this._usingLayoutComponent&&(t=this._getOrCreateLayoutComponent(),this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()),cc.p(this._positionPercent)},_getXPercent:function(){var t;return this._usingLayoutComponent&&(t=this._getOrCreateLayoutComponent(),this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()),this._positionPercent.x},_getYPercent:function(){var t;return this._usingLayoutComponent&&(t=this._getOrCreateLayoutComponent(),this._positionPercent.x=t.getPositionPercentX(),this._positionPercent.y=t.getPositionPercentY()),this._positionPercent.y},setPositionType:function(t){var e;this._positionType=t,this._usingLayoutComponent&&(e=this._getOrCreateLayoutComponent(),t===ccui.POSITION_ABSOLUTE?(e.setPositionPercentXEnabled(!1),e.setPositionPercentYEnabled(!1)):(e.setPositionPercentXEnabled(!0),e.setPositionPercentYEnabled(!0))),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},setFlippedX:function(t){var e=this.getScaleX();this._flippedX=t,this.setScaleX(e)},isFlippedX:function(){return this._flippedX},setFlippedY:function(t){var e=this.getScaleY();this._flippedY=t,this.setScaleY(e)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(t){t&&(this._layoutParameterDictionary[t.getLayoutType()]=t,this._layoutParameterType=t.getLayoutType())},getLayoutParameter:function(t){return t=t||this._layoutParameterType,this._layoutParameterDictionary[t]},getDescription:function(){return"Widget"},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t._copyClonedWidgetChildren(this),t},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(t){for(var e=t.getChildren(),i=0;i<e.length;i++){var n=e[i];n instanceof ccui.Widget&&this.addChild(n.clone())}},_copySpecialProperties:function(t){},_copyProperties:function(t){},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setSize:function(t){this.setContentSize(t)},getSize:function(){return this.getContentSize()},addNode:function(t,e,i){t instanceof ccui.Widget?cc.log("Please use addChild to add a Widget."):(cc.Node.prototype.addChild.call(this,t,e,i),this._nodes.push(t))},getNodeByTag:function(t){for(var e=this._nodes,i=0;i<e.length;i++){var n=e[i];if(n&&n.getTag()===t)return n}return null},getNodes:function(){return this._nodes},removeNode:function(t,e){cc.Node.prototype.removeChild.call(this,t,e),cc.arrayRemoveObject(this._nodes,t)},removeNodeByTag:function(t,e){var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.log("cocos2d: removeNodeByTag(tag = %d): child not found!",t)},removeAllNodes:function(){for(var t=0;t<this._nodes.length;t++){var e=this._nodes[t];cc.Node.prototype.removeChild.call(this,e)}this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=!0;for(var t=this._parent;t;){if(t._doLayout){t._doLayoutDirty=!0;break}t=t._parent}},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(t){this._unifySize=t},_ccEventCallback:null,addCCSEventListener:function(t){this._ccEventCallback=t},setScaleX:function(t){this._flippedX&&(t*=-1),cc.Node.prototype.setScaleX.call(this,t)},setScaleY:function(t){this._flippedY&&(t*=-1),cc.Node.prototype.setScaleY.call(this,t)},setScale:function(t,e){void 0===e&&(e=t),this.setScaleX(t),this.setScaleY(e)},getScaleX:function(){var t=cc.Node.prototype.getScaleX.call(this);return this._flippedX&&(t*=-1),t},getScaleY:function(){var t=cc.Node.prototype.getScaleY.call(this);return this._flippedY&&(t*=-1),t},getScale:function(){return this.getScaleX()!==this.getScaleY()&&cc.log("Widget#scale. ScaleX != ScaleY. Don't know which one to return"),this.getScaleX()},setCallbackName:function(t){this._callbackName=t},getCallbackName:function(){return this._callbackName},setCallbackType:function(t){this._callbackType=t},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(t){this._usingLayoutComponent=t},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return new ccui.Widget.WebGLRenderCmd(this)}}),(_p=ccui.Widget.prototype).xPercent,cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent),_p.yPercent,cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent),_p.widthPercent,cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent),_p.heightPercent,cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent),_p.widgetParent,cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent),_p.enabled,cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled),_p.focused,cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused),_p.sizeType,cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType),_p.widgetType,cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType),_p.touchEnabled,cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled),_p.updateEnabled,cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled),_p.bright,cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright),_p.name,cc.defineGetterSetter(_p,"name",_p.getName,_p.setName),_p.actionTag,cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag),_p.opacity,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p=null,ccui.Widget.create=function(){return new ccui.Widget},ccui.Widget._focusedWidget=null,ccui.Widget._focusNavigationController=null,ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget},ccui.Widget.BRIGHT_STYLE_NONE=-1,ccui.Widget.BRIGHT_STYLE_NORMAL=0,ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1,ccui.Widget.TYPE_WIDGET=0,ccui.Widget.TYPE_CONTAINER=1,ccui.Widget.LEFT=0,ccui.Widget.RIGHT=1,ccui.Widget.UP=2,ccui.Widget.DOWN=3,ccui.Widget.LOCAL_TEXTURE=0,ccui.Widget.PLIST_TEXTURE=1,ccui.Widget.TOUCH_BEGAN=0,ccui.Widget.TOUCH_MOVED=1,ccui.Widget.TOUCH_ENDED=2,ccui.Widget.TOUCH_CANCELED=3,ccui.Widget.SIZE_ABSOLUTE=0,ccui.Widget.SIZE_PERCENT=1,ccui.Widget.POSITION_ABSOLUTE=0,ccui.Widget.POSITION_PERCENT=1,cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){var t;cc._renderType===cc.game.RENDER_TYPE_CANVAS?cc.log("no canvas!"):(ccui.Widget.WebGLRenderCmd=function(t){cc.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1},(t=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype)).constructor=ccui.Widget.WebGLRenderCmd,t.visit=function(t){var e=this._node;e._visible&&(e._adaptRenderers(),this.pNodeVisit(t))},t.transform=function(t,e){var i,n=this._node;n._visible&&n._running&&(n._adaptRenderers(),this._usingLayoutComponent||(i=n.getWidgetParent())&&0!==(i=i.getContentSize()).width&&0!==i.height&&(n._position.x=i.width*n._positionPercent.x,n._position.y=i.height*n._positionPercent.y),this.pNodeTransform(t,e))},t.widgetVisit=t.visit,t.widgetTransform=t.transform)}),function(){var y,S={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort())},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}if(e)return this._pool[e].pop()}},m=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL,t={_rebuildQuads_base:function(t,e,i,n){var r,c,o,s,a,h,l,_,u,d,p=t._vertices,f=t._renderCmd._worldTransform;n=n?(u=_=0,d=i.width,i.height):(n=e._originalSize,r=e._rect,l=e._offset,c=i.width/n.width,o=i.height/n.height,s=l.x+(n.width-r.width)/2,a=l.x-(n.width-r.width)/2,h=l.y+(n.height-r.height)/2,l=l.y-(n.height-r.height)/2,_=s*c,u=h*o,d=i.width+a*c,i.height+l*o),p.length<8&&(S.put(p),p=S.get(8)||new Float32Array(8),t._vertices=p),y?(p[0]=_*f.a+u*f.c+f.tx,p[1]=_*f.b+u*f.d+f.ty,p[2]=d*f.a+u*f.c+f.tx,p[3]=d*f.b+u*f.d+f.ty,p[4]=_*f.a+n*f.c+f.tx,p[5]=_*f.b+n*f.d+f.ty,p[6]=d*f.a+n*f.c+f.tx,p[7]=d*f.b+n*f.d+f.ty):(p[0]=_,p[1]=u,p[2]=d,p[3]=u,p[4]=_,p[5]=n,p[6]=d,p[7]=n),0,1,2,3,t._uvsDirty&&this._calculateUVs(t,e),t._vertCount=4},_calculateUVs:function(t,e){var i,n,r,c,o=t._uvs,s=e._texture._pixelsWide,a=e._texture._pixelsHigh,h=e._rect,h=cc.rectPointsToPixels(h),t=(o.length<8&&(S.put(o),o=S.get(8)||new Float32Array(8),t._uvs=o),m?.5:0);e._rotated?(i=(h.x+t)/s,n=(h.y+h.width-t)/a,r=(h.x+h.height-t)/s,c=(h.y+t)/a,o[0]=i,o[1]=c,o[2]=i,o[3]=n,o[4]=r,o[5]=c,o[6]=r,o[7]=n):(i=(h.x+t)/s,n=(h.y+h.height-t)/a,r=(h.x+h.width-t)/s,c=(h.y+t)/a,o[0]=i,o[1]=n,o[2]=r,o[3]=n,o[4]=i,o[5]=c,o[6]=r,o[7]=c)}},e={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t,e,i,n,r,c,o){var s,a,h=t._vertices,l=t._renderCmd._worldTransform,_=e._rect,u=n,d=(_.width,o),_=(_.height,i),i=_.width-u-r,p=_.height-c-d,f=1<(f=_.width/(u+r))?1:f,g=1<(g=_.height/(c+d))?1:g,i=i<0?0:i,p=p<0?0:p,m=this.x,T=this.y,E=(m[0]=0,m[1]=u*f,m[2]=m[1]+i,m[3]=_.width,T[0]=0,T[1]=d*g,T[2]=T[1]+p,T[3]=_.height,h.length<32&&(S.put(h),h=S.get(32)||new Float32Array(32),t._vertices=h),0);if(y)for(s=0;s<4;s++)for(a=0;a<4;a++)h[E]=m[a]*l.a+T[s]*l.c+l.tx,h[E+1]=m[a]*l.b+T[s]*l.d+l.ty,E+=2;else for(s=0;s<4;s++)for(a=0;a<4;a++)h[E]=m[a],h[E+1]=T[s],E+=2;0,1,2,3,t._uvsDirty&&this._calculateUVs(t,e,n,r,c,o)},_calculateUVs:function(t,e,i,n,r,c){var o,s,a=t._uvs,h=e._rect,l=e._texture._pixelsWide,_=e._texture._pixelsHigh,u=e._rect,u=cc.rectPointsToPixels(u),h=cc.rectPointsToPixels(h),d=cc.contentScaleFactor(),i=i*d,n=h.width-i-n*d,r=r*d,c=c*d,d=h.height-r-c,p=(a.length<32&&(S.put(a),a=S.get(32)||new Float32Array(32),t._uvs=a),this.x),f=this.y,h=m?.5:0,g=0;if(e._rotated)for(p[0]=(u.x+h)/l,p[1]=(c+u.x)/l,p[2]=(c+d+u.x)/l,p[3]=(u.x+u.height-h)/l,f[3]=(u.y+h)/_,f[2]=(i+u.y)/_,f[1]=(i+n+u.y)/_,f[0]=(u.y+u.width-h)/_,o=0;o<4;o++)for(s=0;s<4;s++)a[g]=p[o],a[g+1]=f[3-s],g+=2;else for(p[0]=(u.x+h)/l,p[1]=(i+u.x)/l,p[2]=(i+n+u.x)/l,p[3]=(u.x+u.width-h)/l,f[3]=(u.y+h)/_,f[2]=(r+u.y)/_,f[1]=(r+d+u.y)/_,f[0]=(u.y+u.height-h)/_,o=0;o<4;o++)for(s=0;s<4;s++)a[g]=p[s],a[g+1]=f[o],g+=2}},i=(ccui.Scale9Sprite=cc.Scale9Sprite=cc.Node.extend({_spriteFrame:null,_scale9Image:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_opacityModifyRGB:!1,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!1,_textureLoaded:!1,_flippedX:!1,_flippedY:!1,_className:"Scale9Sprite",ctor:function(t,e,i){var n;cc.Node.prototype.ctor.call(this),this._loader=new cc.Sprite.LoadManager,this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=S.get(8)||new Float32Array(8),this._uvs=S.get(8)||new Float32Array(8),void 0!==t&&(t instanceof cc.SpriteFrame?this.initWithSpriteFrame(t,e):(n=cc.spriteFrameCache.getSpriteFrame(t))?this.initWithSpriteFrame(n,e):this.initWithFile(t,e,i)),void 0===y&&(y=cc._renderType===cc.game.RENDER_TYPE_WEBGL)},textureLoaded:function(){return this._textureLoaded},getCapInsets:function(){return cc.rect(this._capInsetsInternal)},_asyncSetCapInsets:function(){this.removeEventListener("load",this._asyncSetCapInsets,this),this.setCapInsets(this._cacheCapInsets),this._cacheCapInsets=null},setCapInsets:function(t){if(!this.loaded())return this._cacheCapInsets=t,this.removeEventListener("load",this._asyncSetCapInsets,this),this.addEventListener("load",this._asyncSetCapInsets,this),!1;this._capInsetsInternal=t,this._updateCapInsets(this._spriteFrame._rect,this._capInsetsInternal)},_updateCapInsets:function(t,e){e&&t&&!cc._rectEqualToZero(e)?this._capInsetsInternal=e:(t=t||{x:0,y:0,width:this._contentSize.width,height:this._contentSize.height},this._capInsetsInternal=cc.rect(t.width/3,t.height/3,t.width/3,t.height/3)),cc._rectEqualToZero(t)||(this._insetLeft=this._capInsetsInternal.x,this._insetTop=this._capInsetsInternal.y,this._insetRight=t.width-this._insetLeft-this._capInsetsInternal.width,this._insetBottom=t.height-this._insetTop-this._capInsetsInternal.height,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty))},initWithFile:function(t,e,i){var n,r;if(t instanceof cc.Rect?(t=arguments[1],i=arguments[0],e=cc.rect(0,0,0,0)):(e=e||cc.rect(0,0,0,0),i=i||cc.rect(0,0,0,0)),t)return r=(n=(n=cc.textureCache.getTextureForKey(t))||cc.textureCache.addImage(t)).isLoaded(),this._textureLoaded=r,this._loader.clear(),r?(cc._rectEqualToZero(e)&&(r=n.getContentSize(),e=cc.rect(0,0,r.width,r.height)),this.setTexture(n,e),this._updateCapInsets(e,i),!0):(this._loader.once(n,function(){this.initWithFile(t,e,i),this.dispatchEvent("load")},this),!1);throw new Error("ccui.Scale9Sprite.initWithFile(): file should be non-null")},updateWithBatchNode:function(t,e,i,n){var r;return!!t&&(r=t.getTexture(),this._loader.clear(),r.isLoaded()?(this.setTexture(r,e),this._updateCapInsets(e,n),!0):(this._loader.once(r,function(){this.updateWithBatchNode(t,e,i,n),this.dispatchEvent("load")},this),!1))},initWithSpriteFrame:function(t,e){this.setSpriteFrame(t),e=e||cc.rect(0,0,0,0),this._updateCapInsets(t._rect,e)},initWithSpriteFrameName:function(t,e){if(!t)throw new Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");e=e||cc.rect(0,0,0,0);t=cc.spriteFrameCache.getSpriteFrame(t);if(null==t)return cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),!1;this.setSpriteFrame(t),e=e||cc.rect(0,0,0,0),this._updateCapInsets(t._rect,e)},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},setTexture:function(t,e){t=new cc.SpriteFrame(t,e);this.setSpriteFrame(t)},_updateBlendFunc:function(){var t=this._blendFunc;this._spriteFrame&&this._spriteFrame._texture.hasPremultipliedAlpha()?(t.src===cc.SRC_ALPHA&&t.dst===cc.BLEND_DST&&(t.src=cc.ONE),this._opacityModifyRGB=!0):(t.src===cc.ONE&&t.dst===cc.BLEND_DST&&(t.src=cc.SRC_ALPHA),this._opacityModifyRGB=!1)},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setSpriteFrame:function(t){var e,i;t&&(this._spriteFrame=t,this._quadsDirty=!0,this._uvsDirty=!0,i=function(){cc.sizeEqualToSize(e._contentSize,cc.size(0,0))&&e.setContentSize(e._spriteFrame._rect),e._textureLoaded=!0,e._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty),cc.renderer.childrenOrderDirty=!0},(e=this)._textureLoaded=t.textureLoaded(),e._textureLoaded?i():(this._loader.clear(),this._loader.once(t,function(){i(),this.dispatchEvent("load")},this)))},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src||cc.BLEND_SRC,this._blendFunc.dst=t.dst||cc.BLEND_DST):(this._blendFunc.src=t||cc.BLEND_SRC,this._blendFunc.dst=e||cc.BLEND_DST),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setPreferredSize:function(t){t&&!cc.sizeEqualToSize(this._contentSize,t)&&this.setContentSize(t)},getPreferredSize:function(){return this.getContentSize()},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(cc.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},getContentSize:function(){return this._renderingType===ccui.Scale9Sprite.RenderingType.SIMPLE&&this._spriteFrame?this._spriteFrame._originalSize:cc.size(this._contentSize)},_setWidth:function(t){cc.Node.prototype._setWidth.call(this,t),this._quadsDirty=!0},_setHeight:function(t){cc.Node.prototype._setHeight.call(this,t),this._quadsDirty=!0},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setScale9Enabled:function(t){},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){switch(this._updateBlendFunc(),this._isTriangle=!1,this._renderingType){case n.SIMPLE:t._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case n.SLICED:e._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;default:return this._quadsDirty=!1,this._uvsDirty=!1,void cc.error("Can not generate quad")}this._quadsDirty=!1,this._uvsDirty=!1}},_createRenderCmd:function(){return new(cc._renderType===cc.game.RENDER_TYPE_CANVAS?ccui.Scale9Sprite.CanvasRenderCmd:ccui.Scale9Sprite.WebGLRenderCmd)(this)}}),ccui.Scale9Sprite.prototype),n=(cc.EventHelper.prototype.apply(i),i.preferredSize,cc.defineGetterSetter(i,"preferredSize",i.getPreferredSize,i.setPreferredSize),i.capInsets,cc.defineGetterSetter(i,"capInsets",i.getCapInsets,i.setCapInsets),i.insetLeft,cc.defineGetterSetter(i,"insetLeft",i.getInsetLeft,i.setInsetLeft),i.insetTop,cc.defineGetterSetter(i,"insetTop",i.getInsetTop,i.setInsetTop),i.insetRight,cc.defineGetterSetter(i,"insetRight",i.getInsetRight,i.setInsetRight),i.insetBottom,cc.defineGetterSetter(i,"insetBottom",i.getInsetBottom,i.setInsetBottom),ccui.Scale9Sprite.create=function(t,e,i){return new ccui.Scale9Sprite(t,e,i)},ccui.Scale9Sprite.createWithSpriteFrame=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.createWithSpriteFrameName=function(t,e){return new ccui.Scale9Sprite(t,e)},ccui.Scale9Sprite.POSITIONS_CENTRE=0,ccui.Scale9Sprite.POSITIONS_TOP=1,ccui.Scale9Sprite.POSITIONS_LEFT=2,ccui.Scale9Sprite.POSITIONS_RIGHT=3,ccui.Scale9Sprite.POSITIONS_BOTTOM=4,ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5,ccui.Scale9Sprite.POSITIONS_TOPLEFT=6,ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=7,ccui.Scale9Sprite.state={NORMAL:0,GRAY:1},ccui.Scale9Sprite.RenderingType={SIMPLE:0,SLICED:1})}(),function(){var g,t;cc.Node.WebGLRenderCmd&&(ccui.Scale9Sprite.WebGLRenderCmd=function(t){cc.Node.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},g=ccui.Scale9Sprite,(t=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype)).constructor=ccui.Scale9Sprite.WebGLRenderCmd,t.needDraw=function(){return this._needDraw&&this._node.loaded()},t._uploadSliced=function(t,e,i,n,r,c,o){for(var s,a=0;a<3;++a)for(var h=0;h<3;++h)r[o]=t[s=8*a+2*h],r[o+1]=t[1+s],r[o+2]=n,c[o+3]=i[0],r[o+4]=e[s],r[o+5]=e[1+s],r[o+=6]=t[2+s],r[o+1]=t[3+s],r[o+2]=n,c[o+3]=i[0],r[o+4]=e[2+s],r[o+5]=e[3+s],r[o+=6]=t[8+s],r[o+1]=t[9+s],r[o+2]=n,c[o+3]=i[0],r[o+4]=e[8+s],r[o+5]=e[9+s],r[o+=6]=t[10+s],r[o+1]=t[11+s],r[o+2]=n,c[o+3]=i[0],r[o+4]=e[10+s],r[o+5]=e[11+s],o+=6;return 36},t.transform=function(t,e){this.originTransform(t,e),this._node._rebuildQuads()},t._setColorDirty=function(){},t.uploadData=function(t,e,i){var n=this._node;if(0===this._displayedOpacity)return 0;n._quadsDirty&&n._rebuildQuads();var r=this._displayedOpacity,c=this._displayedColor.r,o=this._displayedColor.g,s=this._displayedColor.b,a=(n._opacityModifyRGB&&(c*=_=r/255,o*=_,s*=_),this._color[0]=r<<24|s<<16|o<<8|c,n._vertexZ),h=n._vertices,l=n._uvs,_=g.RenderingType,u=i,d=0;switch(n._renderingType){case _.SIMPLE:for(var d=this._node._vertCount,p=0,f=0;p<d;p++,f+=2)t[u]=h[f],t[u+1]=h[f+1],t[u+2]=a,e[u+3]=this._color[0],t[u+4]=l[f],t[u+5]=l[f+1],u+=6;break;case _.SLICED:d=this._uploadSliced(h,l,this._color,a,t,e,u)}return d},t.setState=function(t){t===g.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===g.state.GRAY&&(this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY))})}(),ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE,this._widgetType=ccui.Widget.TYPE_CONTAINER,this._clippingType=ccui.Layout.CLIPPING_SCISSOR,this._colorType=ccui.Layout.BG_COLOR_NONE,ccui.Widget.prototype.ctor.call(this),this.ignoreContentAdaptWithSize(!1),this.setContentSize(cc.size(0,0)),this.setAnchorPoint(0,0),this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this),this._backGroundImageCapInsets=cc.rect(0,0,0,0),this._color=cc.color(255,255,255,255),this._startColor=cc.color(255,255,255,255),this._endColor=cc.color(255,255,255,255),this._alongVector=cc.p(0,-1),this._backGroundImageTextureSize=cc.size(0,0),this._clippingRect=cc.rect(0,0,0,0),this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this),this._clippingStencil&&this._clippingStencil.onEnter(),this._doLayoutDirty=!0,this._clippingRectDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this),this._clippingStencil&&this._clippingStencil.onExit()},setLoopFocus:function(t){this._loopFocus=t},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(t){this.__passFocusToChild=t},isPassFocusToChild:function(){return this.__passFocusToChild},onPassFocusToChild:null,addChild:function(t,e,i){t instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(t),ccui.Widget.prototype.addChild.call(this,t,e,i),this._doLayoutDirty=!0},removeChild:function(t,e){ccui.Widget.prototype.removeChild.call(this,t,e),this._doLayoutDirty=!0},removeAllChildren:function(t){ccui.Widget.prototype.removeAllChildren.call(this,t),this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(t){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,t),this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},visit:function(t){if(this._visible)if(this._adaptRenderers(),this._doLayout(),this._clippingEnabled)switch(this._clippingType){case ccui.Layout.CLIPPING_STENCIL:this._renderCmd.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this._renderCmd.scissorClippingVisit(t)}else ccui.Widget.prototype.visit.call(this,t)},setClippingEnabled:function(t){if(t!==this._clippingEnabled)switch(this._clippingEnabled=t,this._clippingType){case ccui.Layout.CLIPPING_SCISSOR:case ccui.Layout.CLIPPING_STENCIL:t?(this._clippingStencil=new cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil.onEnter(),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil.onExit(),this._clippingStencil=null)}},setClippingType:function(t){var e;t!==this._clippingType&&(e=this.isClippingEnabled(),this.setClippingEnabled(!1),this._clippingType=t,this.setClippingEnabled(e))},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(t){var e,i;this._clippingEnabled&&((e=[])[0]=cc.p(0,0),e[1]=cc.p(t.width,0),e[2]=cc.p(t.width,t.height),e[3]=cc.p(0,t.height),i=cc.color.GREEN,this._clippingStencil.clear(),this._clippingStencil.setLocalBB&&this._clippingStencil.setLocalBB(0,0,t.width,t.height),this._clippingStencil.drawPoly(e,4,i,0,i))},_getClippingRect:function(){if(this._clippingRectDirty){for(var t,e,i=this.convertToWorldSpace(cc.p(0,0)),n=this.getNodeToWorldTransform(),r=this._contentSize.width*n.a,n=this._contentSize.height*n.d,c=this;c;)if((c=c.getParent())&&c instanceof ccui.Layout&&c.isClippingEnabled()){this._clippingParent=c;break}this._clippingParent?(e=this._clippingParent._getClippingRect(),this._clippingRect.x=Math.max(i.x,e.x),this._clippingRect.y=Math.max(i.y,e.y),t=Math.min(i.x+r,e.x+e.width),e=Math.min(i.y+n,e.y+e.height),this._clippingRect.width=Math.max(0,t-this._clippingRect.x),this._clippingRect.height=Math.max(0,e-this._clippingRect.y)):(this._clippingRect.x=i.x,this._clippingRect.y=i.y,this._clippingRect.width=r,this._clippingRect.height=n),this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var t=this._contentSize;this._setStencilClippingSize(t),this._doLayoutDirty=!0,this._clippingRectDirty=!0,this._backGroundImage&&(this._backGroundImage.setPosition(.5*t.width,.5*t.height),this._backGroundScale9Enabled)&&this._backGroundImage instanceof ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(t),this._colorRender&&this._colorRender.setContentSize(t),this._gradientRender&&this._gradientRender.setContentSize(t)},setBackGroundImageScale9Enabled:function(t){this._backGroundScale9Enabled!==t&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=t,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled)),this._backGroundImageFileName=t,this._bgImageTexType=e;var i=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._backGroundScale9Enabled&&i.setPreferredSize(this._contentSize),this._backGroundImageTextureSize=i.getContentSize(),i.setPosition(.5*this._contentSize.width,.5*this._contentSize.height),this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(t){},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(t){if(t)switch(this._layoutType){case ccui.Layout.ABSOLUTE:break;case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:t.getLayoutParameter(ccui.LayoutParameter.LINEAR)||t.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:t.getLayoutParameter(ccui.LayoutParameter.RELATIVE)||t.setLayoutParameter(new ccui.RelativeLayoutParameter)}},_addBackGroundImage:function(){var t=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(t)):this._backGroundImage=new cc.Sprite,this.addProtectedChild(this._backGroundImage,ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1),this._backGroundImage.setPosition(.5*t.width,.5*t.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(t){},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(t,e){e?(this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._gradientRender&&this._gradientRender.setStartColor(t),this._endColor.r=e.r,this._endColor.g=e.g,this._endColor.b=e.b,this._gradientRender&&this._gradientRender.setEndColor(e)):(this._color.r=t.r,this._color.g=t.g,this._color.b=t.b,this._colorRender&&this._colorRender.setColor(t))},getBackGroundColor:function(){var t=this._color;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundStartColor:function(){var t=this._startColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundEndColor:function(){var t=this._endColor;return cc.color(t.r,t.g,t.b,t.a)},setBackGroundColorOpacity:function(t){switch(this._opacity=t,this._colorType){case ccui.Layout.BG_COLOR_NONE:break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(t);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(t)}},getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(t){this._alongVector.x=t.x,this._alongVector.y=t.y,this._gradientRender&&this._gradientRender.setVector(t)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(t){this._backGroundImageColor.r=t.r,this._backGroundImageColor.g=t.g,this._backGroundImageColor.b=t.b,this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(t){this._backGroundImageColor.a=t,this.getBackGroundImageColor()},getBackGroundImageColor:function(){var t=this._backGroundImageColor;return cc.color(t.r,t.g,t.b,t.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(t){this._layoutType=t;for(var e,i=this._children,n=0;n<i.length;n++)(e=i[n])instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(e);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){var t;this._doLayoutDirty&&(this.sortAllChildren(),(t=ccui.getLayoutManager(this._layoutType))&&t._doLayout(this),this._doLayoutDirty=!1)},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){},_findNearestChildWidgetIndex:function(t,e){},_findFarthestChildWidgetIndex:function(t,e){},_calculateNearestDistance:function(t){},_calculateFarthestDistance:function(t){},_findProperSearchingFunctor:function(t,e){},_findFirstNonLayoutWidget:function(){},_findFirstFocusEnabledWidgetIndex:function(){},_findFocusEnabledChildWidgetByIndex:function(t){},_getWorldCenterPoint:function(t){var e=t instanceof ccui.Layout?t._getLayoutAccumulatedSize():t.getContentSize();return t.convertToWorldSpace(cc.p(e.width/2,e.height/2))},_getNextFocusedWidget:function(t,e){var i=null,n=this._children,r=n.indexOf(e);return(r+=1)<n.length?(i=this._getChildWidgetByIndex(r))?i.isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e:this._loopFocus?this._checkFocusEnabledChild()?(i=this._getChildWidgetByIndex(r=0)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getNextFocusedWidget(t,i):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:!this._isLastWidgetInContainer(e,t)||this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget},_getPreviousFocusedWidget:function(t,e){var i=null,n=this._children,r=n.indexOf(e);return 0<=(r-=1)?(i=this._getChildWidgetByIndex(r)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i):this._loopFocus?this._checkFocusEnabledChild()?(r=n.length-1,(i=this._getChildWidgetByIndex(r)).isFocusEnabled()?i instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i):this._getPreviousFocusedWidget(t,i)):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget:!this._isLastWidgetInContainer(e,t)||this._isWidgetAncestorSupportLoopFocus(this,t)?ccui.Widget.prototype.findNextFocusedWidget.call(this,t,this):e instanceof ccui.Layout?e:ccui.Widget._focusedWidget},_getChildWidgetByIndex:function(t){for(var e=this._children,i=e.length,n=t;t<i;){var r=e[t];if(r&&r instanceof ccui.Widget)return r;t++}for(var c=0;c<n;){var o=e[c];if(o&&o instanceof ccui.Widget)return o;c++}return null},_isLastWidgetInContainer:function(t,e){var i,n=t.getParent();return!(null!=n&&n instanceof ccui.Layout)||(t=(i=n.getChildren()).indexOf(t),n.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?e===ccui.Widget.LEFT?0===t&&this._isLastWidgetInContainer(n,e):e===ccui.Widget.RIGHT?t===i.length-1&&this._isLastWidgetInContainer(n,e):e===ccui.Widget.DOWN||e===ccui.Widget.UP?this._isLastWidgetInContainer(n,e):void 0:n.getLayoutType()===ccui.Layout.LINEAR_VERTICAL?e===ccui.Widget.UP?0===t&&this._isLastWidgetInContainer(n,e):e===ccui.Widget.DOWN?t===i.length-1&&this._isLastWidgetInContainer(n,e):e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT?this._isLastWidgetInContainer(n,e):void 0:(cc.log("invalid layout Type"),!1))},_isWidgetAncestorSupportLoopFocus:function(t,e){var i,t=t.getParent();return null!=t&&t instanceof ccui.Layout&&(t.isLoopFocus()?(i=t.getLayoutType())===ccui.Layout.LINEAR_HORIZONTAL?e===ccui.Widget.LEFT||e===ccui.Widget.RIGHT||this._isWidgetAncestorSupportLoopFocus(t,e):i===ccui.Layout.LINEAR_VERTICAL?e===ccui.Widget.DOWN||e===ccui.Widget.UP||this._isWidgetAncestorSupportLoopFocus(t,e):(cc.assert(0,"invalid layout type"),!1):this._isWidgetAncestorSupportLoopFocus(t,e))},_passFocusToChild:function(t,e){var i;return this._checkFocusEnabledChild()?(i=ccui.Widget.getCurrentFocusedWidget(),this._findProperSearchingFunctor(t,i),i=this.onPassFocusToChild(t,i),(i=this._getChildWidgetByIndex(i))instanceof ccui.Layout?(i._isFocusPassing=!0,i.findNextFocusedWidget(t,i)):(this.dispatchFocusEvent(e,i),i)):this},_checkFocusEnabledChild:function(){for(var t=this._children,e=0,i=t.length;e<i;e++){var n=t[e];if(n&&n instanceof ccui.Widget&&n.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(t){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(t._backGroundScale9Enabled),this.setBackGroundImage(t._backGroundImageFileName,t._bgImageTexType),this.setBackGroundImageCapInsets(t._backGroundImageCapInsets),this.setBackGroundColorType(t._colorType),this.setBackGroundColor(t._color),this.setBackGroundColor(t._startColor,t._endColor),this.setBackGroundColorOpacity(t._opacity),this.setBackGroundColorVector(t._alongVector),this.setLayoutType(t._layoutType),this.setClippingEnabled(t._clippingEnabled),this.setClippingType(t._clippingType),this._loopFocus=t._loopFocus,this.__passFocusToChild=t.__passFocusToChild,this._isInterceptTouch=t._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout(),this._doLayout()},_createRenderCmd:function(){return new ccui.Layout.WebGLRenderCmd(this)}})}(_p=ccui.Layout.prototype).clippingEnabled,cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled),_p.clippingType,cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType),_p.layoutType,cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType),_p=null,ccui.Layout.create=function(){return new ccui.Layout},ccui.Layout.BG_COLOR_NONE=0,ccui.Layout.BG_COLOR_SOLID=1,ccui.Layout.BG_COLOR_GRADIENT=2,ccui.Layout.ABSOLUTE=0,ccui.Layout.LINEAR_VERTICAL=1,ccui.Layout.LINEAR_HORIZONTAL=2,ccui.Layout.RELATIVE=3,ccui.Layout.CLIPPING_STENCIL=0,ccui.Layout.CLIPPING_SCISSOR=1,ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1,ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2,function(){var t;ccui.ProtectedNode.WebGLRenderCmd&&(ccui.Layout.WebGLRenderCmd=function(t){ccui.ProtectedNode.WebGLRenderCmd.call(this,t),this._needDraw=!1,this._currentStencilEnabled=0,this._scissorOldState=!1,this._clippingOldRect=null,this._mask_layer_le=0,this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=new cc.CustomRenderCmd(this,this._onAfterVisitStencil),this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,this._onBeforeVisitScissor),this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor)},(t=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype)).constructor=ccui.Layout.WebGLRenderCmd,t.visit=function(t){var e=this._node;if(e._visible)if(t&&t._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(e._clippingRectDirty=!0),e._adaptRenderers(),e._doLayout(),e._clippingEnabled)switch(e._clippingType){case ccui.Layout.CLIPPING_STENCIL:this.stencilClippingVisit(t);break;case ccui.Layout.CLIPPING_SCISSOR:this.scissorClippingVisit(t)}else this.pNodeVisit(t)},t.layoutVisit=t.visit,t._onBeforeVisitStencil=function(t){var t=t||cc._renderContext,e=(ccui.Layout.WebGLRenderCmd._layer++,1<<ccui.Layout.WebGLRenderCmd._layer);this._mask_layer_le=e|e-1,this._currentStencilEnabled=t.isEnabled(t.STENCIL_TEST),t.clear(t.DEPTH_BUFFER_BIT),t.enable(t.STENCIL_TEST),t.depthMask(!1),t.stencilFunc(t.NEVER,e,e),t.stencilOp(t.REPLACE,t.KEEP,t.KEEP),t.stencilMask(e),t.clear(t.STENCIL_BUFFER_BIT)},t._onAfterDrawStencil=function(t){t=t||cc._renderContext;t.depthMask(!0),t.stencilFunc(t.EQUAL,this._mask_layer_le,this._mask_layer_le),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},t._onAfterVisitStencil=function(t){var e,i,t=t||cc._renderContext;ccui.Layout.WebGLRenderCmd._layer--,this._currentStencilEnabled?(i=(e=1<<ccui.Layout.WebGLRenderCmd._layer)|e-1,t.stencilMask(e),t.stencilFunc(t.EQUAL,i,i)):t.disable(t.STENCIL_TEST)},t._onBeforeVisitScissor=function(t){this._node._clippingRectDirty=!0;var e=this._node._getClippingRect(),t=t||cc._renderContext;this._scissorOldState=t.isEnabled(t.SCISSOR_TEST),this._scissorOldState?(this._clippingOldRect=cc.view.getScissorRect(),cc.rectEqualToRect(this._clippingOldRect,e)||cc.view.setScissorInPoints(e.x,e.y,e.width,e.height)):(t.enable(t.SCISSOR_TEST),cc.view.setScissorInPoints(e.x,e.y,e.width,e.height))},t._onAfterVisitScissor=function(t){t=t||cc._renderContext;this._scissorOldState?cc.rectEqualToRect(this._clippingOldRect,this._node._clippingRect)||cc.view.setScissorInPoints(this._clippingOldRect.x,this._clippingOldRect.y,this._clippingOldRect.width,this._clippingOldRect.height):t.disable(t.SCISSOR_TEST)},t.rebindStencilRendering=function(t){},t.transform=function(t,e){var i=this._node;this.pNodeTransform(t,e),i._clippingStencil&&i._clippingStencil._renderCmd.transform(this,e)},t.stencilClippingVisit=function(t){var e=this._node;if(e._clippingStencil&&e._clippingStencil.isVisible())if(ccui.Layout.WebGLRenderCmd._layer+1===cc.stencilBits)ccui.Layout.WebGLRenderCmd._visit_once=!0,ccui.Layout.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1),cc.Node.prototype.visit.call(e,t);else{cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);for(var i,n=cc.current_stack,r=(n.stack.push(n.top),this._syncStatus(t),this._dirtyFlag=0,n.top=this._stackMatrix,e._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd),0),c=0,o=(e.sortAllChildren(),e.sortAllProtectedChildren(),e._children),s=e._protectedChildren,a=o.length,h=s.length;r<a&&((i=o[r])&&i.getLocalZOrder()<0);r++)i.visit(this);for(;c<h&&((i=s[c])&&i.getLocalZOrder()<0);c++)i.visit(this);for(;r<a;r++)o[r].visit(this);for(;c<h;c++)s[c].visit(this);cc.renderer.pushRenderCommand(this._afterVisitCmdStencil),n.top=n.stack.pop()}},t.scissorClippingVisit=function(t){cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor),this.pNodeVisit(t),cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)},ccui.Layout.WebGLRenderCmd._layer=-1,ccui.Layout.WebGLRenderCmd._visit_once=null)}(),ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(t,e,i,n){void 0!==t&&void 0===e&&(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom),void 0!==n&&(this.left=t,this.top=e,this.right=i,this.bottom=n)},setMargin:function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},equals:function(t){return this.left===t.left&&this.top===t.top&&this.right===t.right&&this.bottom===t.bottom}}),ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)},ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin,this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(t){cc.isObject(t)?(this._margin.left=t.left,this._margin.top=t.top,this._margin.right=t.right,this._margin.bottom=t.bottom):(this._margin.left=t,this._margin.top=arguments[1],this._margin.right=arguments[2],this._margin.bottom=arguments[3])},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},clone:function(){var t=this._createCloneInstance();return t._copyProperties(this),t},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(t){this._margin.bottom=t._margin.bottom,this._margin.left=t._margin.left,this._margin.right=t._margin.right,this._margin.top=t._margin.top}}),ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter},ccui.LayoutParameter.NONE=0,ccui.LayoutParameter.LINEAR=1,ccui.LayoutParameter.RELATIVE=2,ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._linearGravity=ccui.LinearLayoutParameter.NONE,this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(t){this._linearGravity=t},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.LinearLayoutParameter&&this.setGravity(t._linearGravity)}}),ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter},ccui.LinearLayoutParameter.NONE=0,ccui.LinearLayoutParameter.LEFT=1,ccui.LinearLayoutParameter.TOP=2,ccui.LinearLayoutParameter.RIGHT=3,ccui.LinearLayoutParameter.BOTTOM=4,ccui.LinearLayoutParameter.CENTER_VERTICAL=5,ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6,ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this),this._relativeAlign=ccui.RelativeLayoutParameter.NONE,this._relativeWidgetName="",this._relativeLayoutName="",this._put=!1,this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(t){this._relativeAlign=t},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(t){this._relativeWidgetName=t},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(t){this._relativeLayoutName=t},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(t){ccui.LayoutParameter.prototype._copyProperties.call(this,t),t instanceof ccui.RelativeLayoutParameter&&(this.setAlign(t._relativeAlign),this.setRelativeToWidgetName(t._relativeWidgetName),this.setRelativeName(t._relativeLayoutName))}}),ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter},ccui.getLayoutManager=function(t){return null},ccui.helper={_activeLayout:!0,doLayout:function(t){if(this._activeLayout)for(var e=t.getChildren(),i=0,n=e.length;i<n;i++){var r=(c=e[i]).getComponent(ccui.LayoutComponent.NAME),c=c.getParent();null!=r&&null!==c&&r.refreshLayout&&r.refreshLayout()}},changeLayoutSystemActiveState:function(t){this._activeLayout=t},restrictCapInsetRect:function(t,e){var i=t.x,n=t.y,r=t.width,t=t.height;return e.width<r&&(r=i=0),e.height<t&&(t=n=0),cc.rect(i,n,r,t)},_createSpriteFromBase64:function(t,e){var i,n=cc.textureCache.getTextureForKey(e);return n||((i=new Image).src=t,cc.textureCache.cacheImage(e,i),n=cc.textureCache.getTextureForKey(e)),new cc.Sprite(n)}},ccui.Button=ccui.Widget.extend({_buttonNormalRenderer:null,_buttonClickedRenderer:null,_buttonDisableRenderer:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_capInsetsPressed:null,_capInsetsDisabled:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,_pressedTextureSize:null,_disabledTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_normalTextureScaleXInSize:1,_normalTextureScaleYInSize:1,_pressedTextureScaleXInSize:1,_pressedTextureScaleYInSize:1,_zoomScale:.1,_normalTextureLoaded:!1,_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_pressedTextureAdaptDirty:!0,_disabledTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(t,e,i,n){this._capInsetsNormal=cc.rect(0,0,0,0),this._capInsetsPressed=cc.rect(0,0,0,0),this._capInsetsDisabled=cc.rect(0,0,0,0),this._normalTextureSize=cc.size(0,0),this._pressedTextureSize=cc.size(0,0),this._disabledTextureSize=cc.size(0,0),this._titleColor=cc.color.WHITE,ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0),t&&this.loadTextures(t,e,i,n)},_initRenderer:function(){this._buttonNormalRenderer=new cc.Sprite,this._buttonClickedRenderer=new cc.Sprite,this._buttonDisableRenderer=new cc.Sprite,this._titleRenderer=new cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(.5,.5),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1)},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this._scale9Enabled=t,this.removeProtectedChild(this._buttonNormalRenderer),this.removeProtectedChild(this._buttonClickedRenderer),this.removeProtectedChild(this._buttonDisableRenderer),this._scale9Enabled?(this._buttonNormalRenderer=new ccui.Scale9Sprite,this._buttonClickedRenderer=new ccui.Scale9Sprite,this._buttonDisableRenderer=new ccui.Scale9Sprite):(this._buttonNormalRenderer=new cc.Sprite,this._buttonClickedRenderer=new cc.Sprite,this._buttonDisableRenderer=new cc.Sprite),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this.loadTextureNormal(this._normalFileName,this._normalTexType),this.loadTexturePressed(this._clickedFileName,this._pressedTexType),this.loadTextureDisabled(this._disabledFileName,this._disabledTexType),this.addProtectedChild(this._buttonNormalRenderer,ccui.Button.NORMAL_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonClickedRenderer,ccui.Button.PRESSED_RENDERER_ZORDER,-1),this.addProtectedChild(this._buttonDisableRenderer,ccui.Button.DISABLED_RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsetsNormalRenderer(this._capInsetsNormal),this.setCapInsetsPressedRenderer(this._capInsetsPressed),this.setCapInsetsDisabledRenderer(this._capInsetsDisabled),this.setBright(this._bright),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){this._unifySize?this._updateContentSize():this._scale9Enabled&&(!this._scale9Enabled||t)||(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&0<this._titleRenderer.getString().length?this._titleRenderer.getContentSize():cc.size(this._normalTextureSize)},loadTextures:function(t,e,i,n){this.loadTextureNormal(t,n),this.loadTexturePressed(e,n),this.loadTextureDisabled(i,n)},loadTextureNormal:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._normalFileName=t,this._normalTexType=e;var i=this,n=this._buttonNormalRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTextureNormal(i._normalFileName,i._normalTexType)}),this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._normalTextureLoaded=n._textureLoaded,this._normalTextureSize=this._buttonNormalRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(n.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),this._normalTextureAdaptDirty=!0,this._findLayout()}},loadTexturePressed:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._clickedFileName=t,this._pressedTexType=e;var i=this,n=this._buttonClickedRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTexturePressed(i._clickedFileName,i._pressedTexType)}),this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsPressed),this._pressedTextureSize=this._buttonClickedRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0,this._pressedTextureAdaptDirty=!0,this._findLayout()}},loadTextureDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._disabledFileName=t,this._disabledTexType=e;var i=this,n=this._buttonDisableRenderer;switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTextureDisabled(i._disabledFileName,i._disabledTexType)}),this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:n.initWithSpriteFrameName(t)}this._scale9Enabled&&n.setCapInsets(this._capInsetsDisabled),this._disabledTextureSize=this._buttonDisableRenderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._disabledTextureAdaptDirty=!0,this._findLayout()}},setCapInsets:function(t){this.setCapInsetsNormalRenderer(t),this.setCapInsetsPressedRenderer(t),this.setCapInsetsDisabledRenderer(t)},setCapInsetsNormalRenderer:function(t){var e,i,n,r;t&&(e=t.x,i=t.y,n=t.width,t=t.height,this._normalTextureSize.width<n&&(n=e=0),this._normalTextureSize.height<t&&(t=i=0),(r=this._capInsetsNormal).x=e,r.y=i,r.width=n,r.height=t,this._scale9Enabled)&&this._buttonNormalRenderer.setCapInsets(r)},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(t){var e,i,n,r;t&&this._scale9Enabled&&(e=t.x,i=t.y,n=t.width,t=t.height,this._pressedTextureSize.width<n&&(n=e=0),this._pressedTextureSize.height<t&&(t=i=0),(r=this._capInsetsPressed).x=e,r.y=i,r.width=n,r.height=t,this._buttonClickedRenderer.setCapInsets(r))},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsPressed)},setCapInsetsDisabledRenderer:function(t){var e,i,n,r;t&&this._scale9Enabled&&(e=t.x,i=t.y,n=t.width,t=t.height,this._disabledTextureSize.width<n&&(n=e=0),this._disabledTextureSize.height<t&&(t=i=0),(r=this._capInsetsDisabled).x=e,r.y=i,r.width=n,r.height=t,this._buttonDisableRenderer.setCapInsets(r))},getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsDisabled)},_onPressStateChangedToNormal:function(){var t;this._buttonNormalRenderer.setVisible(!0),this._buttonClickedRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!1),this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded?this.pressedActionEnabled&&(this._buttonNormalRenderer.stopAllActions(),this._buttonClickedRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._unifySize?(t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1,1),this._titleRenderer.runAction(t)):(this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1))):(this._buttonNormalRenderer.stopAllActions(),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._titleRenderer.stopAllActions(),this._scale9Enabled&&this._buttonNormalRenderer.setColor(cc.color.WHITE),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1))},_onPressStateChangedToPressed:function(){var t,e=this._buttonNormalRenderer;this._scale9Enabled&&e.setState(ccui.Scale9Sprite.state.NORMAL),this._pressedTextureLoaded?(e.setVisible(!1),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),this.pressedActionEnabled&&(e.stopAllActions(),this._buttonClickedRenderer.stopAllActions(),t=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale),this._buttonClickedRenderer.runAction(t),e.setScale(this._pressedTextureScaleXInSize+this._zoomScale,this._pressedTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale)))):(e.setVisible(!0),this._buttonClickedRenderer.setVisible(!0),this._buttonDisableRenderer.setVisible(!1),e.stopAllActions(),e.setScale(this._normalTextureScaleXInSize+this._zoomScale,this._normalTextureScaleYInSize+this._zoomScale),this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?(this._buttonNormalRenderer.setVisible(!1),this._buttonDisableRenderer.setVisible(!0)):this._normalTextureLoaded&&this._scale9Enabled&&this._buttonNormalRenderer.setState(ccui.Scale9Sprite.state.GRAY),this._buttonClickedRenderer.setVisible(!1),this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize),this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize)},_updateContentSize:function(){var t;this._unifySize?(this._scale9Enabled?ccui.ProtectedNode.setContentSize(this._customSize):(t=this._getNormalSize(),ccui.ProtectedNode.setContentSize(t)),this._onSizeChanged()):this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._updateTitleLocation(),this._normalTextureAdaptDirty=!0,this._pressedTextureAdaptDirty=!0,this._disabledTextureAdaptDirty=!0},getVirtualRenderer:function(){if(!this._bright)return this._buttonDisableRenderer;switch(this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:return this._buttonNormalRenderer;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:return this._buttonClickedRenderer;default:return null}},_normalTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonNormalRenderer.setScale(1),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonNormalRenderer.setPreferredSize(this._contentSize),this._normalTextureScaleXInSize=this._normalTextureScaleYInSize=1,this._buttonNormalRenderer.setScale(this._normalTextureScaleXInSize,this._normalTextureScaleYInSize);else{var t=this._normalTextureSize;if(t.width<=0||t.height<=0)return void this._buttonNormalRenderer.setScale(1);var e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._buttonNormalRenderer.setScaleX(e),this._buttonNormalRenderer.setScaleY(t),this._normalTextureScaleXInSize=e,this._normalTextureScaleYInSize=t}this._buttonNormalRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_pressedTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled||(this._buttonClickedRenderer.setScale(1),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1);else if(this._scale9Enabled)this._buttonClickedRenderer.setPreferredSize(this._contentSize),this._pressedTextureScaleXInSize=this._pressedTextureScaleYInSize=1,this._buttonClickedRenderer.setScale(this._pressedTextureScaleXInSize,this._pressedTextureScaleYInSize);else{var t=this._pressedTextureSize;if(t.width<=0||t.height<=0)return void this._buttonClickedRenderer.setScale(1);var e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._buttonClickedRenderer.setScaleX(e),this._buttonClickedRenderer.setScaleY(t),this._pressedTextureScaleXInSize=e,this._pressedTextureScaleYInSize=t}this._buttonClickedRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_disabledTextureScaleChangedWithSize:function(){if(this._ignoreSize&&!this._unifySize)this._scale9Enabled&&this._buttonDisableRenderer.setScale(1);else if(this._scale9Enabled)this._buttonDisableRenderer.setScale(1),this._buttonDisableRenderer.setPreferredSize(this._contentSize);else{var t=this._disabledTextureSize;if(t.width<=0||t.height<=0)return void this._buttonDisableRenderer.setScale(1);var e=this._contentSize.width/t.width,t=this._contentSize.height/t.height;this._buttonDisableRenderer.setScaleX(e),this._buttonDisableRenderer.setScaleY(t)}this._buttonDisableRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1),this._pressedTextureAdaptDirty&&(this._pressedTextureScaleChangedWithSize(),this._pressedTextureAdaptDirty=!1),this._disabledTextureAdaptDirty&&(this._disabledTextureScaleChangedWithSize(),this._disabledTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(.5*this._contentSize.width,.5*this._contentSize.height)},setPressedActionEnabled:function(t){this.pressedActionEnabled=t},setTitleText:function(t){t!==this.getTitleText()&&(this._titleRenderer.setString(t),this._ignoreSize?(t=this.getVirtualRendererSize(),this.setContentSize(t)):this._titleRenderer._renderCmd._updateTTF())},getTitleText:function(){return this._titleRenderer.getString()},setTitleColor:function(t){this._titleRenderer.setFontFillColor(t)},getTitleColor:function(){return this._titleRenderer._getFillStyle()},setTitleFontSize:function(t){this._titleRenderer.setFontSize(t),this._fontSize=t},getTitleFontSize:function(){return this._titleRenderer.getFontSize()},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(t){this._titleRenderer.setFontName(t),this._fontName=t},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer.getFontName()},_setTitleFont:function(t){this._titleRenderer.font=t},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(t){this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTextureNormal(t._normalFileName,t._normalTexType),this.loadTexturePressed(t._clickedFileName,t._pressedTexType),this.loadTextureDisabled(t._disabledFileName,t._disabledTexType),this.setCapInsetsNormalRenderer(t._capInsetsNormal),this.setCapInsetsPressedRenderer(t._capInsetsPressed),this.setCapInsetsDisabledRenderer(t._capInsetsDisabled),this.setTitleText(t.getTitleText()),this.setTitleFontName(t.getTitleFontName()),this.setTitleFontSize(t.getTitleFontSize()),this.setTitleColor(t.getTitleColor()),this.setPressedActionEnabled(t.pressedActionEnabled),this.setZoomScale(t._zoomScale)},_getNormalSize:function(){null!==this._titleRenderer&&(i=this._titleRenderer.getContentSize()),null!==this._buttonNormalRenderer&&(t=this._buttonNormalRenderer.getContentSize());var t,e=(i.width>t.width?i:t).width,i=(i.height>t.height?i:t).height;return cc.size(e,i)}}),(_p=ccui.Button.prototype).titleText,cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText),_p.titleFont,cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont),_p.titleFontSize,cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize),_p.titleFontName,cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName),_p.titleColor,cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor),_p=null,ccui.Button.create=function(t,e,i,n){return new ccui.Button(t,e,i,n)},ccui.Button.NORMAL_RENDERER_ZORDER=-2,ccui.Button.PRESSED_RENDERER_ZORDER=-2,ccui.Button.DISABLED_RENDERER_ZORDER=-2,ccui.Button.TITLE_RENDERER_ZORDER=-1,ccui.Button.ZOOM_ACTION_TIME_STEP=.05,ccui.Button.SYSTEM=0,ccui.Button.TTF=1,ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:.1,_backgroundTextureScaleX:.1,_backgroundTextureScaleY:.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(t,e,i,n,r,c){ccui.Widget.prototype.ctor.call(this),this.setTouchEnabled(!0);for(var o=0,s=0;s<arguments.length;s++){var a=typeof arguments[s];"string"==a?isNaN(+arguments[s])?o++:(c=arguments[s],arguments[s]=void 0):"number"==a&&o++}2===o&&(c=i,i=e,e=void 0),c=void 0===c?0:c,this._isSelected=!0,this.setSelected(!1),this.loadTextures(t,e,i,n,r,c)},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite,this._backGroundSelectedBoxRenderer=new cc.Sprite,this._frontCrossRenderer=new cc.Sprite,this._backGroundBoxDisabledRenderer=new cc.Sprite,this._frontCrossDisabledRenderer=new cc.Sprite,this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1),this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1),this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,-1)},loadTextures:function(t,e,i,n,r,c){t&&this.loadTextureBackGround(t,c),e&&this.loadTextureBackGroundSelected(e,c),i&&this.loadTextureFrontCross(i,c),n&&this.loadTextureBackGroundDisabled(n,c),r&&this.loadTextureFrontCrossDisabled(r,c)},loadTextureBackGround:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundFileName=t,this._backGroundTexType=e;var i=this._backGroundBoxRenderer;switch(i._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):i.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this),this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize()),this._backGroundBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundSelected:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundSelectedFileName=t,this._backGroundSelectedTexType=e;var i=this._backGroundSelectedBoxRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this),this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundSelectedBoxRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCross:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossFileName=t,this._frontCrossTexType=e;var i=this._frontCrossRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this),this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossRendererAdaptDirty=!0,this._findLayout()}},loadTextureBackGroundDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._backGroundDisabledFileName=t,this._backGroundDisabledTexType=e;var i=this._backGroundBoxDisabledRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this),this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._backGroundBoxDisabledRendererAdaptDirty=!0,this._findLayout()}},loadTextureFrontCrossDisabled:function(t,e){if(t){e=e||ccui.Widget.LOCAL_TEXTURE,this._frontCrossDisabledFileName=t,this._frontCrossDisabledTexType=e;var i=this._frontCrossDisabledRenderer;switch(i._textureLoaded||i.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},this),this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:i.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i.initWithSpriteFrameName(t)}this._updateChildrenDisplayedRGBA(),this._frontCrossDisabledRendererAdaptDirty=!0,this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0),this._backGroundSelectedBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0)),this._backGroundSelectedBoxRenderer.setVisible(!1),this._frontCrossRenderer.setVisible(!1),this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY),this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(t){this._zoomScale=t},getZoomScale:function(){return this._zoomScale},setSelectedState:function(t){this.setSelected(t)},setSelected:function(t){t!==this._isSelected&&(this._isSelected=t,this._frontCrossRenderer.setVisible(this._isSelected))},getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this),this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(t,e){this.addEventListener(t,e)},addEventListener:function(t,e){this._checkBoxEventSelector=t,this._checkBoxEventListener=e},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._backGroundBoxRendererAdaptDirty=!0,this._backGroundSelectedBoxRendererAdaptDirty=!0,this._frontCrossRendererAdaptDirty=!0,this._backGroundBoxDisabledRendererAdaptDirty=!0,this._frontCrossDisabledRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var t=this._backGroundBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return t.setScale(1),void(this._backgroundTextureScaleX=this._backgroundTextureScaleY=1);var n=e.width/i.width,i=e.height/i.height;this._backgroundTextureScaleX=n,this._backgroundTextureScaleY=i,t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var t=this._backGroundSelectedBoxRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,i=e.height/i.height;t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossTextureScaleChangedWithSize:function(){var t=this._frontCrossRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,i=e.height/i.height;t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var t=this._backGroundBoxDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,i=e.height/i.height;t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var t=this._frontCrossDisabledRenderer,e=this._contentSize;if(this._ignoreSize)t.setScale(1);else{var i=t.getContentSize();if(i.width<=0||i.height<=0)return void t.setScale(1);var n=e.width/i.width,i=e.height/i.height;t.setScaleX(n),t.setScaleY(i)}t.setPosition(.5*e.width,.5*e.height)},_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1),this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1),this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1),this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),this._backGroundBoxDisabledRendererAdaptDirty=!1),this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}}),ccui.CheckBox.create=function(t,e,i,n,r,c){return new ccui.CheckBox(t,e,i,n,r,c)},ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(t,e){this._capInsets=cc.rect(0,0,0,0),this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height),ccui.Widget.prototype.ctor.call(this),e=void 0===e?0:e,t?this.loadTexture(t,e):this._imageTexType=ccui.Widget.LOCAL_TEXTURE},_initRenderer:function(){this._imageRenderer=new cc.Sprite,this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(t,e){if(t){var i=this,n=(e=e||ccui.Widget.LOCAL_TEXTURE,this._textureFile=t,this._imageTexType=e,i._imageRenderer);switch(n._textureLoaded||n.addEventListener("load",function(){i.loadTexture(i._textureFile,i._imageTexType)}),i._imageTexType){case ccui.Widget.LOCAL_TEXTURE:i._scale9Enabled?(n.initWithFile(t),n.setCapInsets(i._capInsets)):n.initWithFile(t);break;case ccui.Widget.PLIST_TEXTURE:i._scale9Enabled?(n.initWithSpriteFrameName(t),n.setCapInsets(i._capInsets)):n.initWithSpriteFrameName(t)}i._imageTextureSize=n.getContentSize(),this._updateChildrenDisplayedRGBA(),i._updateContentSizeWithTextureSize(i._imageTextureSize),i._imageRendererAdaptDirty=!0,i._findLayout()}},setTextureRect:function(t){this._scale9Enabled||this._imageRenderer.setTextureRect(t)},setScale9Enabled:function(t){this._scale9Enabled!==t&&(this._scale9Enabled=t,this.removeProtectedChild(this._imageRenderer),this._imageRenderer=null,this._scale9Enabled?this._imageRenderer=new ccui.Scale9Sprite:this._imageRenderer=new cc.Sprite,this.loadTexture(this._textureFile,this._imageTexType),this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1),this._scale9Enabled?(t=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=t):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(t){this._scale9Enabled&&(!this._scale9Enabled||t)||(ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,t),this._prevIgnoreSize=t)},setCapInsets:function(t){var e;t&&((e=this._capInsets).x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._scale9Enabled)&&this._imageRenderer.setCapInsets(t)},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){if(this._ignoreSize)this._scale9Enabled||this._imageRenderer.setScale(1);else if(this._scale9Enabled)this._imageRenderer.setPreferredSize(this._contentSize),this._imageRenderer.setScale(1);else{var t=this._imageTextureSize;if(t.width<=0||t.height<=0)return void this._imageRenderer.setScale(1);this._imageRenderer.setScaleX(this._contentSize.width/t.width),this._imageRenderer.setScaleY(this._contentSize.height/t.height)}this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(t){t instanceof ccui.ImageView&&(this._prevIgnoreSize=t._prevIgnoreSize,this.setScale9Enabled(t._scale9Enabled),this.loadTexture(t._textureFile,t._imageTexType),this.setCapInsets(t._capInsets))},setContentSize:function(t,e){null!=e&&(t=cc.size(t,e)),ccui.Widget.prototype.setContentSize.call(this,t),this._scale9Enabled?this._imageRenderer.setContentSize(t):(e=this._imageRenderer.getContentSize(),this._imageRenderer.setScaleX(t.width/e.width),this._imageRenderer.setScaleY(t.height/e.height))}}),ccui.ImageView.create=function(t,e){return new ccui.ImageView(t,e)},ccui.ImageView.RENDERER_ZORDER=-1,ccui.Slider=ccui.Widget.extend({}),(_p=ccui.Slider.prototype).percent,cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent),_p=null,ccui.Slider.create=function(t,e,i){return new ccui.Slider(t,e,i)},ccui.Slider.EVENT_PERCENT_CHANGED=0,ccui.Slider.BASEBAR_RENDERER_ZORDER=-3,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2,ccui.Slider.BALL_RENDERER_ZORDER=-1,ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:.5,_labelRenderer:null,_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(t,e,i){this._type=ccui.Text.Type.SYSTEM,this._textAreaSize=cc.size(0,0),ccui.Widget.prototype.ctor.call(this),void 0!==i?(this.setFontName(e),this.setFontSize(i),this.setString(t)):this.setFontName(this._fontName)},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF,this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelRenderer.getString()&&(this._labelRenderer.setString(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0)},getStringValue:function(){return cc.log("Please use the getString"),this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(t){this._labelRenderer.setFontSize(t),this._fontSize=t,this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(t){this._fontName=t,this._labelRenderer.setFontName(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getFontName:function(){return this._fontName},_setFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);e&&(this._fontSize=parseInt(e[1]),this._fontName=e[2],this._labelRenderer._setFont(t),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},getType:function(){return this._type},setTextAreaSize:function(t){this._labelRenderer.setDimensions(t),this._ignoreSize||(this._customSize=t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(t){this._labelRenderer.setHorizontalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(t){this._labelRenderer.setVerticalAlignment(t),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()),this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},setTouchScaleChangeEnabled:function(t){this._touchScaleChangeEnabled=t},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var t=this._labelRenderer.getContentSize();return this._ignoreSize||(this._labelRenderer.setDimensions(0,0),t=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height)),t},_labelScaleChangedWithSize:function(){var t=this._contentSize;if(this._ignoreSize)this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(cc.size(t.width,t.height));var e=this._labelRenderer.getContentSize();if(e.width<=0||e.height<=0)return void this._labelRenderer.setScale(1);var i=t.width/e.width,e=t.height/e.height;this._labelRenderer.setScaleX(i),this._labelRenderer.setScaleY(e),this._normalScaleValueX=i,this._normalScaleValueY=e}this._labelRenderer.setPosition(t.width/2,t.height/2)},getDescription:function(){return"Label"},enableShadow:function(t,e,i){this._labelRenderer.enableShadow(t,e,i)},enableOutline:function(t,e){this._labelRenderer.enableStroke(t,e)},enableGlow:function(t){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(t)},disableEffect:function(){this._labelRenderer.disableEffect&&this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(t){t instanceof ccui.Text&&(this.setFontName(t._fontName),this.setFontSize(t.getFontSize()),this.setString(t.getString()),this.setTouchScaleChangeEnabled(t.touchScaleEnabled),this.setTextAreaSize(t._textAreaSize),this.setTextHorizontalAlignment(t._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(t._labelRenderer.getVerticalAlignment()),this.setContentSize(t.getContentSize()),this.setTextColor(t.getTextColor()))},_setBoundingWidth:function(t){this._textAreaSize.width=t,this._labelRenderer._setBoundingWidth(t),this._labelScaleChangedWithSize()},_setBoundingHeight:function(t){this._textAreaSize.height=t,this._labelRenderer._setBoundingHeight(t),this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(t){cc.ProtectedNode.prototype.setColor.call(this,t),this._labelRenderer.setColor(t)},setTextColor:function(t){this._labelRenderer.setFontFillColor(t)},getTextColor:function(){return this._labelRenderer._getFillStyle()}}),(_p=ccui.Text.prototype).boundingWidth,cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth),_p.boundingHeight,cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight),_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.stringLength,cc.defineGetterSetter(_p,"stringLength",_p.getStringLength),_p.font,cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),_p.textAlign,cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment),_p.verticalAlign,cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment),_p=null,ccui.Label=ccui.Text.create=function(t,e,i){return new ccui.Text(t,e,i)},ccui.Text.RENDERER_ZORDER=-1,ccui.Text.Type={SYSTEM:0,TTF:1},ccui.TextAtlas=ccui.Widget.extend({}),(_p=ccui.TextAtlas.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextAtlas.create=function(t,e,i,n,r){return new ccui.TextAtlas(t,e,i,n,r)},ccui.TextAtlas.RENDERER_ZORDER=-1,ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(t,e){ccui.Widget.prototype.ctor.call(this),void 0!==e&&(this.setFntFile(e),this.setString(t))},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont,this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(t){var e;t&&this._fntFileName!==t&&(this._fntFileName=t,this._fntFileHasInit=!0,this._labelBMFontRenderer.initWithString(this._stringValue,t),this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0,(t=(e=this)._labelBMFontRenderer)._textureLoaded||t.addEventListener("load",function(){e.setFntFile(e._fntFileName);for(var t=e.parent;t;){if(t.requestDoLayout){t.requestDoLayout();break}t=t.parent}}))},setText:function(t){cc.log("Please use the setString"),this.setString(t)},setString:function(t){t!==this._labelBMFontRenderer.getString()&&(this._stringValue=t,this._labelBMFontRenderer.setString(t),this._fntFileHasInit)&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0)},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this),this._labelBMFontRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var t=this._labelBMFontRenderer;if(this._ignoreSize)t.setScale(1);else{var e=t.getContentSize();if(e.width<=0||e.height<=0)return void t.setScale(1);t.setScaleX(this._contentSize.width/e.width),t.setScaleY(this._contentSize.height/e.height)}t.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(t){this.setFntFile(t._fntFileName),this.setString(t._stringValue)}}),(_p=ccui.TextBMFont.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p=null,ccui.TextBMFont.create=function(t,e){return new ccui.TextBMFont(t,e)},ccui.TextBMFont.RENDERER_ZORDER=-1,ccui._TextFieldRenderer=cc.TextFieldTTF.extend({}),ccui._TextFieldRenderer.create=function(t,e,i){var n=new ccui._TextFieldRenderer;return n&&n.initWithString("",e,i)?(t&&n.setPlaceHolder(t),n):null},ccui.TextField=ccui.Widget.extend({}),ccui.TextField.create=function(t,e,i){return new ccui.TextField(t,e,i)},(_p=ccui.TextField.prototype).string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.placeHolder,cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder),_p.font,cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize),_p.fontName,cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName),_p.maxLengthEnabled,cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled),_p.maxLength,cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),_p.passwordEnabled,cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled),_p=null,ccui.TextField.EVENT_ATTACH_WITH_IME=0,ccui.TextField.EVENT_DETACH_WITH_IME=1,ccui.TextField.EVENT_INSERT_TEXT=2,ccui.TextField.EVENT_DELETE_BACKWARD=3,ccui.TextField.RENDERER_ZORDER=-1,ccui.RichElement=ccui.Class.extend({}),ccui.RichElementText=ccui.RichElement.extend({}),ccui.RichElementText.create=function(t,e,i,n,r,c){return new ccui.RichElementText(t,e,i,n,r,c)},ccui.RichElementImage=ccui.RichElement.extend({}),ccui.RichElementImage.create=function(t,e,i,n){return new ccui.RichElementImage(t,e,i,n)},ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(t,e,i,n){ccui.RichElement.prototype.ctor.call(this,t,e,i),this._type=ccui.RichElement.CUSTOM,this._customNode=n||null}}),ccui.RichElementCustomNode.create=function(t,e,i,n){return new ccui.RichElementCustomNode(t,e,i,n)},ccui.RichText=ccui.Widget.extend({}),ccui.RichText.create=function(){},ccui.RichElement.TEXT=0,ccui.RichElement.IMAGE=1,ccui.RichElement.CUSTOM=2,ccui.ScrollViewBar=ccui.ProtectedNode.extend({_parentScroll:null,_direction:null,_upperHalfCircle:null,_lowerHalfCircle:null,_body:null,_opacity:255,_marginFromBoundary:0,_marginForLength:0,_touching:!1,_autoHideEnabled:!0,autoHideTime:0,_autoHideRemainingTime:0,_className:"ScrollViewBar",ctor:function(t,e){cc.ProtectedNode.prototype.ctor.call(this),this._direction=e,this._parentScroll=t,this._marginFromBoundary=ccui.ScrollViewBar.DEFAULT_MARGIN,this._marginForLength=ccui.ScrollViewBar.DEFAULT_MARGIN,this.opacity=255*ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY,this.autoHideTime=ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME,this._autoHideEnabled=!0,ccui.ScrollViewBar.prototype.init.call(this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},init:function(){this._upperHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._upperHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),this._lowerHalfCircle.setAnchorPoint(cc.p(.5,0)),this._lowerHalfCircle.setScaleY(-1),this.addProtectedChild(this._upperHalfCircle),this.addProtectedChild(this._lowerHalfCircle),this._body=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY),this._body.setAnchorPoint(cc.p(.5,0)),this.addProtectedChild(this._body),this.setColor(ccui.ScrollViewBar.DEFAULT_COLOR),this.onScrolled(cc.p(0,0)),cc.ProtectedNode.prototype.setOpacity.call(this,0),this._autoHideRemainingTime=0,this._direction===ccui.ScrollView.DIR_HORIZONTAL&&this.setRotation(90)},setPositionFromCorner:function(t){this._direction===ccui.ScrollView.DIR_VERTICAL?(this._marginForLength=t.y,this._marginFromBoundary=t.x):(this._marginForLength=t.x,this._marginFromBoundary=t.y)},onEnter:function(){cc.ProtectedNode.prototype.onEnter.call(this),this.scheduleUpdate()},getPositionFromCorner:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._marginFromBoundary,this._marginForLength):cc.p(this._marginForLength,this._marginFromBoundary)},setWidth:function(t){t/=this._body.width;this._body.setScaleX(t),this._upperHalfCircle.setScale(t),this._lowerHalfCircle.setScale(-t)},getWidth:function(){return this._body.getBoundingBox().width},setAutoHideEnabled:function(t){this._autoHideEnabled=t,!this._autoHideEnabled&&!this._touching&&this._autoHideRemainingTime<=0?cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity):cc.ProtectedNode.prototype.setOpacity.call(this,0)},isAutoHideEnabled:function(){return this._autoHideEnabled},setOpacity:function(t){this._opacity=t},getOpacity:function(){return this._opacity},_updateLength:function(t){var e=t/this._body.getTextureRect().height;this._body.setScaleY(e),this._upperHalfCircle.setPositionY(this._body.getPositionY()+t)},_processAutoHide:function(t){!this._autoHideEnabled||this._autoHideRemainingTime<=0||this._touching||(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime),cc.ProtectedNode.prototype.setOpacity.call(this,this._opacity*(this._autoHideRemainingTime/this.autoHideTime))))},update:function(t){this._processAutoHide(t)},onTouchBegan:function(){this._autoHideEnabled&&(this._touching=!0)},onTouchEnded:function(){this._autoHideEnabled&&(this._touching=!1,this._autoHideRemainingTime<=0||(this._autoHideRemainingTime=this.autoHideTime))},onScrolled:function(t){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var e=this._parentScroll.getInnerContainer(),i=0,n=0,r=0,c=0,t=(this._direction===ccui.ScrollView.DIR_VERTICAL?(i=e.height,n=this._parentScroll.height,r=t.y,c=-e.getPositionY()):this._direction===ccui.ScrollView.DIR_HORIZONTAL&&(i=e.width,n=this._parentScroll.width,r=t.x,c=-e.getPositionX()),this._calculateLength(i,n,r)),e=this._calculatePosition(i,n,c,r,t);this._updateLength(t),this.setPosition(e)},_calculateLength:function(t,e,i){0!==i&&(t+=20*(0<i?i:-i)),i=e/t;return Math.abs(e-2*this._marginForLength)*i},_calculatePosition:function(t,e,i,n,r){t-=e,0!==n&&(t+=Math.abs(n)),n=0,0!==t&&(n=i/t,n=Math.max(n,0),n=Math.min(n,1)),i=(e-r-2*this._marginForLength)*n+this._marginForLength;return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._parentScroll.width-this._marginFromBoundary,i):cc.p(i,this._marginFromBoundary)}}),(_p=ccui.ScrollViewBar.prototype).opacity,cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity),_p.autoHideEnabled,cc.defineGetterSetter(_p,"autoHideEnabled",_p.isAutoHideEnabled,_p.setAutoHideEnabled),ccui.ScrollViewBar.DEFAULT_COLOR=cc.color(52,65,87),ccui.ScrollViewBar.DEFAULT_MARGIN=20,ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME=.2,ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY=.4,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY="/__half_circle_image",ccui.ScrollViewBar.HALF_CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMABgcbbW7Hz9Dz+PmlcJP5AAAAMElEQVR4AUXHwQ2AQAhFwYcLH1H6r1djzDK3ASxUpTBeK/uTCyz7dx54b44m4p5cD1MwAooEJyk3AAAAAElFTkSuQmCC",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY="/__body_image_height",ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAABCAMAAADdNb8LAAAAA1BMVEX///+nxBvIAAAACklEQVR4AWNABgAADQABYc2cpAAAAABJRU5ErkJggg==",ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,_direction:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_touchMoveDisplacements:null,_touchMoveTimeDeltas:null,_touchMovePreviousTimestamp:0,_touchTotalTimeThreshold:.5,_autoScrolling:!1,_autoScrollTargetDelta:null,_autoScrollAttenuate:!0,_autoScrollStartPosition:null,_autoScrollTotalTime:0,_autoScrollAccumulatedTime:0,_autoScrollCurrentlyOutOfBoundary:!1,_autoScrollBraking:!1,_autoScrollBrakingStartPosition:null,_bePressed:!1,_childFocusCancelOffset:0,bounceEnabled:!1,_outOfBoundaryAmount:null,_outOfBoundaryAmountDirty:!0,inertiaScrollEnabled:!1,_scrollBarEnabled:!0,_verticalScrollBar:null,_horizontalScrollBar:null,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this),this.setClippingEnabled(!0),this._innerContainer.setTouchEnabled(!1),this._direction=ccui.ScrollView.DIR_NONE,this._childFocusCancelOffset=5,this.inertiaScrollEnabled=!0,this._outOfBoundaryAmount=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollStartPosition=cc.p(0,0),this._autoScrollBrakingStartPosition=cc.p(0,0),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._scrollBarEnabled=!0,this._initScrollBar(),this.setTouchEnabled(!0)},init:function(){return!!ccui.Layout.prototype.init.call(this)},onEnter:function(){ccui.Layout.prototype.onEnter.call(this),this.scheduleUpdate()},onExit:function(){cc.renderer._removeCache(this.__instanceId),ccui.Layout.prototype.onExit.call(this)},findNextFocusedWidget:function(t,e){return this.getLayoutType()===ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(t,e):ccui.Widget.prototype.findNextFocusedWidget.call(this,t,e)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this),this._innerContainer=new ccui.Layout,this._innerContainer.setColor(cc.color(255,255,255)),this._innerContainer.setOpacity(255),this._innerContainer.setCascadeColorEnabled(!0),this._innerContainer.setCascadeOpacityEnabled(!0),this.addProtectedChild(this._innerContainer,1,1)},_createRenderCmd:function(){return new ccui.ScrollView.WebGLRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var t=this._contentSize,e=(this._topBoundary=t.height,this._rightBoundary=t.width,this._innerContainer.getContentSize());this._innerContainer.setContentSize(cc.size(Math.max(e.width,t.width),Math.max(e.height,t.height))),this._innerContainer.setPosition(0,t.height-this._innerContainer.getContentSize().height),this._verticalScrollBar&&this._verticalScrollBar.onScrolled(this._getHowMuchOutOfBoundary()),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(this._getHowMuchOutOfBoundary())},setInnerContainerSize:function(t){var e=this._innerContainer,i=this._contentSize,n=i.width,r=i.height,i=(t.width<i.width?cc.log("Inner width <= ScrollView width, it will be force sized!"):n=t.width,t.height<i.height?cc.log("Inner height <= ScrollView height, it will be force sized!"):r=t.height,e.setContentSize(cc.size(n,r)),this._innerContainer.getPosition()),t=this._innerContainer.getAnchorPoint();0!=this._innerContainer.getLeftBoundary()&&(i.x=t.x*n),this._innerContainer.getTopBoundary()!=this._contentSize.height&&(i.y=this._contentSize.height-(1-t.y)*r),this.setInnerContainerPosition(i),this._updateScrollBar(cc.p(0,0))},_setInnerWidth:function(t){var e,i=this._contentSize.width,n=i,r=this._innerContainer,c=r.width;switch(t<i?cc.log("Inner width <= scrollview width, it will be force sized!"):n=t,r.width=n,this._direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:r.getRightBoundary()<=i&&(e=r.width,this._scrollChildren(c-e,0))}t=r.anchorX;0<r.getLeftBoundary()&&(r.x=t*n),r.getRightBoundary()<i&&(r.x=i-(1-t)*n)},_setInnerHeight:function(t){var e=this._contentSize.height,i=e,n=this._innerContainer,r=n.height;switch(t<e?cc.log("Inner height <= scrollview height, it will be force sized!"):i=t,n.height=i,this._direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:var c=i;this._scrollChildren(0,r-c)}t=n.anchorY;0<n.getLeftBoundary()&&(n.y=t*i),n.getRightBoundary()<e&&(n.y=e-(1-t)*i)},setInnerContainerPosition:function(t){if(t.x!==this._innerContainer.getPositionX()||t.y!==this._innerContainer.getPositionY()){if(this._innerContainer.setPosition(t),this._outOfBoundaryAmountDirty=!0,this.bounceEnabled)for(var e=ccui.ScrollView.MOVEDIR_TOP;e<ccui.ScrollView.MOVEDIR_RIGHT;++e)this._isOutOfBoundary(e)&&this._processScrollEvent(e,!0);this._dispatchEvent(ccui.ScrollView.EVENT_CONTAINER_MOVED)}},getInnerContainerPosition:function(){return this._innerContainer.getPosition()},getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(t){var e,i,n,r,c,o;return!(this._clippingEnabled&&(e=t._position,i=t._contentSize,t=t._anchorPoint,n=this._customSize,r=this._innerContainer._position,o=c=0,(c=e.y-t.y*i.height)>=n.height-r.y||c+i.height<=-r.y||(o=e.x-t.x*i.width)>=n.width-r.x||o+i.width<=-r.x))},updateChildren:function(){for(var t,e=this._innerContainer._children,i=0,n=e.length;i<n;i++)!0===(t=e[i])._inViewRect&&!1===this._isInContainer(t)?t._inViewRect=!1:!1===t._inViewRect&&!0===this._isInContainer(t)&&(t._inViewRect=!0)},addChild:function(t,e,i){return!!t&&(!1===this._isInContainer(t)&&(t._inViewRect=!1),e=e||t.getLocalZOrder(),i=i||t.getTag(),this._innerContainer.addChild(t,e,i))},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(t){this._innerContainer.removeAllChildrenWithCleanup(t)},removeChild:function(t,e){return this._innerContainer.removeChild(t,e)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(t){return this._innerContainer.getChildByTag(t)},getChildByName:function(t){return this._innerContainer.getChildByName(t)},_flattenVectorByDirection:function(t){var e=cc.p(0,0);return e.x=this._direction===ccui.ScrollView.DIR_VERTICAL?0:t.x,e.y=this._direction===ccui.ScrollView.DIR_HORIZONTAL?0:t.y,e},_getHowMuchOutOfBoundary:function(t){var e;return 0!==(t=void 0===t?cc.p(0,0):t).x||0!==t.y||this._outOfBoundaryAmountDirty?(e=cc.p(0,0),this._innerContainer.getLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._innerContainer.getLeftBoundary()+t.x):this._innerContainer.getRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._innerContainer.getRightBoundary()+t.x)),this._innerContainer.getTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._innerContainer.getTopBoundary()+t.y):this._innerContainer.getBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._innerContainer.getBottomBoundary()+t.y)),0===t.x&&0===t.y&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),e):this._outOfBoundaryAmount},_isOutOfBoundary:function(t){var e=this._getHowMuchOutOfBoundary();if(void 0===t)return!this._fltEqualZero(e);switch(t){case ccui.ScrollView.MOVEDIR_TOP:return 0<e.y;case ccui.ScrollView.MOVEDIR_BOTTOM:return e.y<0;case ccui.ScrollView.MOVEDIR_LEFT:return e.x<0;case ccui.ScrollView.MOVEDIR_RIGHT:return 0<e.x}return!1},_moveInnerContainer:function(t,e){t=this._flattenVectorByDirection(t),this.setInnerContainerPosition(cc.pAdd(this.getInnerContainerPosition(),t)),t=this._getHowMuchOutOfBoundary();this._updateScrollBar(t),this.bounceEnabled&&e&&this._startBounceBackIfNeeded()},_updateScrollBar:function(t){this._verticalScrollBar&&this._verticalScrollBar.onScrolled(t),this._horizontalScrollBar&&this._horizontalScrollBar.onScrolled(t)},_calculateTouchMoveVelocity:function(){for(var t=0,e=0;e<this._touchMoveTimeDeltas.length;++e)t+=this._touchMoveTimeDeltas[e];if(0==t||t>=this._touchTotalTimeThreshold)return cc.p(0,0);for(var i=cc.p(0,0),e=0;e<this._touchMoveDisplacements.length;++e)i.x+=this._touchMoveDisplacements[e].x,i.y+=this._touchMoveDisplacements[e].y;return cc.pMult(i,1/t)},setTouchTotalTimeThreshold:function(t){this._touchTotalTimeThreshold=t},getTouchTotalTimeThreshold:function(){return this._touchTotalTimeThreshold},_startInertiaScroll:function(t){var e=cc.pMult(t,.7);this._startAttenuatingAutoScroll(e,t)},_startBounceBackIfNeeded:function(){var t;return!!this.bounceEnabled&&(t=this._getHowMuchOutOfBoundary(),!this._fltEqualZero(t))&&(this._startAutoScroll(t,1,!0),!0)},_startAutoScrollToDestination:function(t,e,i){this._startAutoScroll(cc.pSub(t,this._innerContainer.getPosition()),e,i)},_calculateAutoScrollTimeByInitialSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAttenuatingAutoScroll:function(t,e){e=this._calculateAutoScrollTimeByInitialSpeed(cc.pLength(e));this._startAutoScroll(t,e,!0)},_startAutoScroll:function(t,e,i){t=this._flattenVectorByDirection(t),this._autoScrolling=!0,this._autoScrollTargetDelta=t,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this._innerContainer.getPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),i=this._getHowMuchOutOfBoundary();!this._fltEqualZero(i)&&(this._autoScrollCurrentlyOutOfBoundary=!0,e=this._getHowMuchOutOfBoundary(t),0<i.x*e.x||0<i.y*e.y)&&(this._autoScrollBraking=!0)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAttenuate=!0,this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getInnerContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_getAutoScrollStopEpsilon:function(){return 1e-4},_fltEqualZero:function(t){return Math.abs(t.x)<=1e-4&&Math.abs(t.y)<=1e-4},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake()?.05:1,t=(this._autoScrollAccumulatedTime+=t*(1/e),Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime)),i=(this._autoScrollAttenuate&&(t=--t*t*t*t*t+1),cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,t))),t=Math.abs(t-1)<=this._getAutoScrollStopEpsilon();this.bounceEnabled?i=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(i,this._autoScrollBrakingStartPosition),e)):(e=cc.pSub(i,this.getInnerContainerPosition()),e=this._getHowMuchOutOfBoundary(e),this._fltEqualZero(e)||(i.x+=e.x,i.y+=e.y,t=!0)),t&&(this._autoScrolling=!1,this._dispatchEvent(ccui.ScrollView.EVENT_AUTOSCROLL_ENDED)),this._moveInnerContainer(cc.pSub(i,this.getInnerContainerPosition()),t)},_jumpToDestination:function(t,e){void 0===t.x&&(t=cc.p(t,e)),this._autoScrolling=!1,this._moveInnerContainer(cc.pSub(t,this.getInnerContainerPosition()),!0)},_scrollChildren:function(t){this.bounceEnabled&&(e=this._getHowMuchOutOfBoundary(),t.x*=0==e.x?1:.5,t.y*=0==e.y?1:.5),this.bounceEnabled||(e=this._getHowMuchOutOfBoundary(t),t.x+=e.x,t.y+=e.y);var e=!1,i=!1,n=!1,r=!1;0<t.y?this._innerContainer.getBottomBoundary()+t.y>=this._bottomBoundary&&(r=!0):t.y<0&&this._innerContainer.getTopBoundary()+t.y<=this._topBoundary&&(n=!0),t.x<0?this._innerContainer.getRightBoundary()+t.x<=this._rightBoundary&&(i=!0):0<t.x&&this._innerContainer.getLeftBoundary()+t.x>=this._leftBoundary&&(e=!0),this._moveInnerContainer(t,!1),0==t.x&&0==t.y||this._processScrollingEvent(),r&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_BOTTOM,!1),n&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_TOP,!1),e&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_LEFT,!1),i&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_RIGHT,!1)},scrollToBottom:function(t,e){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),0),t,e)},scrollToTop:function(t,e){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToLeft:function(t,e){this._startAutoScrollToDestination(cc.p(0,this._innerContainer.getPositionY()),t,e)},scrollToRight:function(t,e){this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),t,e)},scrollToTopLeft:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),t,e)},scrollToTopRight:function(t,e){var i;this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):(i=this._innerContainer.getContentSize(),this._startAutoScrollToDestination(cc.p(this._contentSize.width-i.width,this._contentSize.height-i.height),t,e))},scrollToBottomLeft:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,0),t,e)},scrollToBottomRight:function(t,e){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),t,e)},scrollToPercentVertical:function(t,e,i){var n=this._contentSize.height-this._innerContainer.getContentSize().height,r=-n;this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),n+t*r/100),e,i)},scrollToPercentHorizontal:function(t,e,i){var n=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-t*n/100,this._innerContainer.getPositionY()),e,i)},scrollToPercentBothDirection:function(t,e,i){var n,r,c;this._direction===ccui.ScrollView.DIR_BOTH&&(r=-(n=this._contentSize.height-this._innerContainer.getContentSize().height),c=this._innerContainer.getContentSize().width-this._contentSize.width,this._startAutoScrollToDestination(cc.p(-t.x*c/100,n+t.y*r/100),e,i))},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){var t;this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):(t=this._innerContainer.getContentSize(),this._jumpToDestination(this._contentSize.width-t.width,this._contentSize.height-t.height))},jumpToBottomLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,0)},jumpToBottomRight:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(t){var e=this._contentSize.height-this._innerContainer.getContentSize().height,i=-e;this._jumpToDestination(this._innerContainer.getPositionX(),e+t*i/100)},jumpToPercentHorizontal:function(t){var e=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-t*e/100,this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(t){var e,i;this._direction===ccui.ScrollView.DIR_BOTH&&(i=this._innerContainer.getContentSize(),e=this._contentSize.height-i.height,i=i.width-this._contentSize.width,this._jumpToDestination(-t.x*i/100,e+t.y*-e/100))},_gatherTouchMove:function(t){for(;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(t);t=(new Date).getTime();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},_handlePressLogic:function(t){this._bePressed=!0,this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._verticalScrollBar&&this._verticalScrollBar.onTouchBegan(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan()},_handleMoveLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),t=this.convertToNodeSpace(t.getPreviousLocation()),e=cc.pSub(e,t);this._scrollChildren(e),this._gatherTouchMove(e)},_handleReleaseLogic:function(t){var e=this.convertToNodeSpace(t.getLocation()),t=this.convertToNodeSpace(t.getPreviousLocation()),e=cc.pSub(e,t);this._gatherTouchMove(e),this._bePressed=!1,this._startBounceBackIfNeeded()||!this.inertiaScrollEnabled||0===(t=this._calculateTouchMoveVelocity()).x&&0===t.y||this._startInertiaScroll(t),this._verticalScrollBar&&this._verticalScrollBar.onTouchEnded(),this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded()},onTouchBegan:function(t,e){e=ccui.Layout.prototype.onTouchBegan.call(this,t,e);return this._isInterceptTouch||this._hit&&this._handlePressLogic(t),e},onTouchMoved:function(t,e){ccui.Layout.prototype.onTouchMoved.call(this,t,e),this._isInterceptTouch||this._handleMoveLogic(t)},onTouchEnded:function(t,e){ccui.Layout.prototype.onTouchEnded.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},onTouchCancelled:function(t,e){ccui.Layout.prototype.onTouchCancelled.call(this,t,e),this._isInterceptTouch||this._handleReleaseLogic(t),this._isInterceptTouch=!1},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)},interceptTouchEvent:function(t,e,i){},_processScrollEvent:function(t,e){var i=0;switch(t){case ccui.ScrollView.MOVEDIR_TOP:i=e?ccui.ScrollView.EVENT_BOUNCE_TOP:ccui.ScrollView.EVENT_SCROLL_TO_TOP;break;case ccui.ScrollView.MOVEDIR_BOTTOM:i=e?ccui.ScrollView.EVENT_BOUNCE_BOTTOM:ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM;break;case ccui.ScrollView.MOVEDIR_LEFT:i=e?ccui.ScrollView.EVENT_BOUNCE_LEFT:ccui.ScrollView.EVENT_SCROLL_TO_LEFT;break;case ccui.ScrollView.MOVEDIR_RIGHT:i=e?ccui.ScrollView.EVENT_BOUNCE_RIGHT:ccui.ScrollView.EVENT_SCROLL_TO_RIGHT}this._dispatchEvent(i)},_processScrollingEvent:function(){this._dispatchEvent(ccui.ScrollView.EVENT_SCROLLING)},_dispatchEvent:function(t){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,t):this._scrollViewEventSelector(this,t)),this._ccEventCallback&&this._ccEventCallback(this,t)},addEventListenerScrollView:function(t,e){this._scrollViewEventSelector=t,this._scrollViewEventListener=e},addEventListener:function(t){this._ccEventCallback=t},setDirection:function(t){this._direction=t,this._scrollBarEnabled&&(this._removeScrollBar(),this._initScrollBar())},getDirection:function(){return this._direction},setBounceEnabled:function(t){this.bounceEnabled=t},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(t){this.inertiaScrollEnabled=t},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},setScrollBarEnabled:function(t){this._scrollBarEnabled!==t&&(this._scrollBarEnabled&&this._removeScrollBar(),this._scrollBarEnabled=t,this._scrollBarEnabled)&&this._initScrollBar()},isScrollBarEnabled:function(){return this._scrollBarEnabled},setScrollBarPositionFromCorner:function(t){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t)},setScrollBarPositionFromCornerForVertical:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForVertical:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!"),this._verticalScrollBar.getPositionFromCorner()},setScrollBarPositionFromCornerForHorizontal:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.setPositionFromCorner(t)},getScrollBarPositionFromCornerForHorizontal:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!"),this._horizontalScrollBar.getPositionFromCorner()},setScrollBarWidth:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setWidth(t),this._horizontalScrollBar&&this._horizontalScrollBar.setWidth(t)},getScrollBarWidth:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.getWidth():this._horizontalScrollBar?this._horizontalScrollBar.getWidth():0},setScrollBarColor:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.setColor(t),this._horizontalScrollBar&&this._horizontalScrollBar.setColor(t)},getScrollBarColor:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&this._verticalScrollBar.getColor(),this._horizontalScrollBar&&this._horizontalScrollBar.getColor(),cc.color.WHITE},setScrollBarOpacity:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.opacity=t),this._horizontalScrollBar&&(this._horizontalScrollBar.opacity=t)},getScrollBarOpacity:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.opacity:this._horizontalScrollBar?this._horizontalScrollBar.opacity:-1},setScrollBarAutoHideEnabled:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideEnabled=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideEnabled=t)},isScrollBarAutoHideEnabled:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideEnabled:!!this._horizontalScrollBar&&this._horizontalScrollBar.autoHideEnabled},setScrollBarAutoHideTime:function(t){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar&&(this._verticalScrollBar.autoHideTime=t),this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideTime=t)},getScrollBarAutoHideTime:function(){return cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!"),this._verticalScrollBar?this._verticalScrollBar.autoHideTime:this._horizontalScrollBar?this._horizontalScrollBar.autoHideTime:0},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(t){this._innerContainer.setLayoutType(t)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},_copyClonedWidgetChildren:function(t){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,t)},_copySpecialProperties:function(t){t instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,t),this.setInnerContainerSize(t.getInnerContainerSize()),this.setInnerContainerPosition(t.getInnerContainerPosition()),this.setDirection(t._direction),this._topBoundary=t._topBoundary,this._bottomBoundary=t._bottomBoundary,this._leftBoundary=t._leftBoundary,this._rightBoundary=t._rightBoundary,this._bePressed=t._bePressed,this._childFocusCancelOffset=t._childFocusCancelOffset,this._touchMoveDisplacements=t._touchMoveDisplacements,this._touchMoveTimeDeltas=t._touchMoveTimeDeltas,this._touchMovePreviousTimestamp=t._touchMovePreviousTimestamp,this._autoScrolling=t._autoScrolling,this._autoScrollAttenuate=t._autoScrollAttenuate,this._autoScrollStartPosition=t._autoScrollStartPosition,this._autoScrollTargetDelta=t._autoScrollTargetDelta,this._autoScrollTotalTime=t._autoScrollTotalTime,this._autoScrollAccumulatedTime=t._autoScrollAccumulatedTime,this._autoScrollCurrentlyOutOfBoundary=t._autoScrollCurrentlyOutOfBoundary,this._autoScrollBraking=t._autoScrollBraking,this._autoScrollBrakingStartPosition=t._autoScrollBrakingStartPosition,this.setBounceEnabled(t.bounceEnabled),this.setInertiaScrollEnabled(t.inertiaScrollEnabled),this._scrollViewEventListener=t._scrollViewEventListener,this._scrollViewEventSelector=t._scrollViewEventSelector,this._ccEventCallback=t._ccEventCallback,this.setScrollBarEnabled(t.isScrollBarEnabled()),this.isScrollBarEnabled())&&(this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(t.getScrollBarPositionFromCornerForVertical()),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(t.getScrollBarPositionFromCornerForHorizontal()),this.setScrollBarWidth(t.getScrollBarWidth()),this.setScrollBarColor(t.getScrollBarColor()),this.setScrollBarAutoHideEnabled(t.isScrollBarAutoHideEnabled()),this.setScrollBarAutoHideTime(t.getScrollBarAutoHideTime()))},_initScrollBar:function(){this._direction===ccui.ScrollView.DIR_HORIZONTAL||this._verticalScrollBar||(this._verticalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_VERTICAL),this.addProtectedChild(this._verticalScrollBar,2)),this._direction===ccui.ScrollView.DIR_VERTICAL||this._horizontalScrollBar||(this._horizontalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_HORIZONTAL),this.addProtectedChild(this._horizontalScrollBar,2))},_removeScrollBar:function(){this._verticalScrollBar&&(this.removeProtectedChild(this._verticalScrollBar),this._verticalScrollBar=null),this._horizontalScrollBar&&(this.removeProtectedChild(this._horizontalScrollBar),this._horizontalScrollBar=null)},getNodeByTag:function(t){return this._innerContainer.getNodeByTag(t)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(t){this._innerContainer.removeNode(t)},removeNodeByTag:function(t){this._innerContainer.removeNodeByTag(t)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},addNode:function(t,e,i){this._innerContainer.addNode(t,e,i)}});(_p=ccui.ScrollView.prototype).innerWidth,cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth),_p.innerHeight,cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight),_p.direction,cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection),_p.touchTotalTimeThreshold,cc.defineGetterSetter(_p,"touchTotalTimeThreshold",_p.getTouchTotalTimeThreshold,_p.setTouchTotalTimeThreshold),_p=null,ccui.ScrollView.create=function(){return new ccui.ScrollView},ccui.ScrollView.DIR_NONE=0,ccui.ScrollView.DIR_VERTICAL=1,ccui.ScrollView.DIR_HORIZONTAL=2,ccui.ScrollView.DIR_BOTH=3,ccui.ScrollView.EVENT_SCROLL_TO_TOP=0,ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1,ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2,ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3,ccui.ScrollView.EVENT_SCROLLING=4,ccui.ScrollView.EVENT_BOUNCE_TOP=5,ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6,ccui.ScrollView.EVENT_BOUNCE_LEFT=7,ccui.ScrollView.EVENT_BOUNCE_RIGHT=8,ccui.ScrollView.EVENT_CONTAINER_MOVED=9,ccui.ScrollView.EVENT_AUTOSCROLL_ENDED=10,ccui.ScrollView.MOVEDIR_TOP=0,ccui.ScrollView.MOVEDIR_BOTTOM=1,ccui.ScrollView.MOVEDIR_LEFT=2,ccui.ScrollView.MOVEDIR_RIGHT=3,function(){var t;ccui.ProtectedNode.WebGLRenderCmd&&(ccui.ScrollView.WebGLRenderCmd=function(t){ccui.Layout.WebGLRenderCmd.call(this,t),this._needDraw=!0,this._dirty=!1},(t=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype)).constructor=ccui.ScrollView.WebGLRenderCmd,t.visit=function(t){var e,i=this._node;i._visible&&(e=this._node.__instanceId,cc.renderer.pushRenderCommand(this),cc.renderer._turnToCacheMode(e),this.layoutVisit(t),i.updateChildren(),this._dirtyFlag=0,cc.renderer._turnToNormalMode())},t.rendering=function(t){var e,i,n,r,c=this._node.__instanceId,o=cc.renderer._cacheToBufferCmds[c],s=t||cc._renderContext;if(o){for(this._node.updateChildren(),s.bindBuffer(gl.ARRAY_BUFFER,null),e=0,i=o.length;e<i;e++)(n=(r=o[e])._node)instanceof ccui.ScrollView||n&&n._parent&&!1===n._parent._inViewRect||(r.uploadData?cc.renderer._uploadBufferData(r):(cc.renderer._batchRendering(),r.rendering(s)));cc.renderer._batchRendering()}})}(),ccui.ListView=ccui.ScrollView.extend({}),ccui.ListView.create=function(){return new ccui.ListView},ccui.PageView=ccui.ListView.extend({}),ccui.PageViewIndicator=ccui.ProtectedNode.extend({}),ccui.WebView=ccui.Widget.extend({}),function(){var t=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(t.enableDiv=!0)}(),ccui.WebView._polyfill,cc.Component=cc.Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null,this._name="",this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(t){},serialize:function(t){},isEnabled:function(){return this._enabled},setEnabled:function(t){this._enabled=t},getName:function(){return this._name},setName:function(t){this._name=t},setOwner:function(t){this._owner=t},getOwner:function(){return this._owner}}),cc.Component.create=function(){return new cc.Component},ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3},ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3},ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2},ccui.LayoutComponent=cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){return!!cc.Component.prototype.init.call(this)},getPercentContentSize:function(){return cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(t){this.setPercentWidth(t.x),this.setPercentHeight(t.y)},setUsingPercentContentSize:function(t){this._usingPercentWidth=this._usingPercentHeight=t},SetActiveEnable:function(t){this._actived=t},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(t,e){var i=this._owner.getBoundingBox(),t=(this._owner.setAnchorPoint(t,e),this._owner.getBoundingBox()),e=i.x-t.x,i=i.y-t.y,t=this._owner.getPosition();t.x+=e,t.y+=i,this.setPosition(t)},getPosition:function(){return this._owner.getPosition()},setPosition:function(t,e){var i,n=this._getOwnerParent();null!=n?(void 0===e?(i=t.x,e=t.y):i=t,0!==(n=n.getContentSize()).width?this._positionPercentX=i/n.width:(this._positionPercentX=0,this._usingPositionPercentX&&(i=0)),0!==n.height?this._positionPercentY=e/n.height:(this._positionPercentY=0,this._usingPositionPercentY&&(e=0)),this._owner.setPosition(i,e),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setPosition(t,e)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(t){this._usingPositionPercentX=t,this._usingPositionPercentX&&(this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE)},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(t){this._positionPercentX=t;t=this._getOwnerParent();null!==t&&(this._owner.setPositionX(t.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(t){this._usingPositionPercentY=t,this._usingPositionPercentY&&(this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE)},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(t){this._positionPercentY=t;t=this._getOwnerParent();null!==t&&(this._owner.setPositionY(t.height*this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(t){this._horizontalEdge=t,this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var e,t=this._getOwnerParent();null!==t&&(e=this._owner.getPosition(),0!==(t=t.getContentSize()).width?this._positionPercentX=e.x/t.width:(this._positionPercentX=0,e.x=0,this._usingPositionPercentX&&this._owner.setPosition(e)),this._refreshHorizontalMargin())},getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(t){this._verticalEdge=t,this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var e,t=this._getOwnerParent();null!==t&&(e=this._owner.getPosition(),0!==(t=t.getContentSize()).height?this._positionPercentY=e.y/t.height:(this._positionPercentY=0,e.y=0,this._usingPositionPercentY&&this._owner.setPosition(e)),this._refreshVerticalMargin())},getLeftMargin:function(){return this._leftMargin},setLeftMargin:function(t){this._leftMargin=t},getRightMargin:function(){return this._rightMargin},setRightMargin:function(t){this._rightMargin=t},getTopMargin:function(){return this._topMargin},setTopMargin:function(t){this._topMargin=t},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(t){this._bottomMargin=t},getSize:function(){return this.getOwner().getContentSize()},setSize:function(t){var e,i=this._getOwnerParent();null!==i?(e=t,0!==(i=i.getContentSize()).width?this._percentWidth=e.width/i.width:(this._percentWidth=0,this._usingPercentWidth&&(e.width=0)),0!==i.height?this._percentHeight=e.height/i.height:(this._percentHeight=0,this._usingPercentHeight&&(e.height=0)),this._owner.setContentSize(e),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setContentSize(t)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(t){this._usingPercentWidth=t,this._usingPercentWidth&&(this._usingStretchWidth=!1)},getSizeWidth:function(){return this._owner.width},setSizeWidth:function(t){var e=this._owner.getContentSize(),t=(e.width=t,this._getOwnerParent());null!==t?(0!==(t=t.getContentSize()).width?this._percentWidth=e.width/t.width:(this._percentWidth=0,this._usingPercentWidth&&(e.width=0)),this._owner.setContentSize(e),this._refreshHorizontalMargin()):this._owner.setContentSize(e)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(t){this._percentWidth=t;var e,t=this._getOwnerParent();null!==t&&((e=this._owner.getContentSize()).width=t.width*this._percentWidth,this._owner.setContentSize(e),this._refreshHorizontalMargin())},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(t){this._usingPercentHeight=t,this._usingPercentHeight&&(this._usingStretchHeight=!1)},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(t){var e=this._owner.getContentSize(),t=(e.height=t,this._getOwnerParent());null!==t?(0!==(t=t.getContentSize()).height?this._percentHeight=e.height/t.height:(this._percentHeight=0,this._usingPercentHeight&&(e.height=0)),this._owner.setContentSize(e),this._refreshVerticalMargin()):this._owner.setContentSize(e)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(t){this._percentHeight=t;var e,t=this._getOwnerParent();null!==t&&((e=this._owner.getContentSize()).height=t.height*this._percentHeight,this._owner.setContentSize(e),this._refreshVerticalMargin())},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(t){this._usingStretchWidth=t,this._usingStretchWidth&&(this._usingPercentWidth=!1)},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(t){this._usingStretchHeight=t,this._usingStretchHeight&&(this._usingPercentHeight=!1)},setPercentOnlyEnabled:function(t){this._isPercentOnly=t},setActiveEnabled:function(t){this._actived=t},refreshLayout:function(){if(this._actived){var t=this._getOwnerParent();if(null!==t){var e=t.getContentSize(),t=this._owner,i=t.getAnchorPoint(),n=t.getContentSize(),r=t.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&!this._isPercentOnly?(n.width=e.width*this._percentWidth,r.x=this._leftMargin+i.x*n.width):(this._usingPositionPercentX&&(r.x=e.width*this._positionPercentX),this._usingPercentWidth&&(n.width=e.width*this._percentWidth));break;case ccui.LayoutComponent.horizontalEdge.LEFT:this._isPercentOnly||((this._usingPercentWidth||this._usingStretchWidth)&&(n.width=e.width*this._percentWidth),r.x=this._leftMargin+i.x*n.width);break;case ccui.LayoutComponent.horizontalEdge.RIGHT:this._isPercentOnly||((this._usingPercentWidth||this._usingStretchWidth)&&(n.width=e.width*this._percentWidth),r.x=e.width-(this._rightMargin+(1-i.x)*n.width));break;case ccui.LayoutComponent.horizontalEdge.CENTER:this._isPercentOnly||(this._usingStretchWidth?(n.width=e.width-this._leftMargin-this._rightMargin,n.width<0&&(n.width=0),r.x=this._leftMargin+i.x*n.width):(this._usingPercentWidth&&(n.width=e.width*this._percentWidth),r.x=e.width*this._positionPercentX))}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&!this._isPercentOnly?(n.height=e.height*this._percentHeight,r.y=this._bottomMargin+i.y*n.height):(this._usingPositionPercentY&&(r.y=e.height*this._positionPercentY),this._usingPercentHeight&&(n.height=e.height*this._percentHeight));break;case ccui.LayoutComponent.verticalEdge.BOTTOM:this._isPercentOnly||((this._usingPercentHeight||this._usingStretchHeight)&&(n.height=e.height*this._percentHeight),r.y=this._bottomMargin+i.y*n.height);break;case ccui.LayoutComponent.verticalEdge.TOP:this._isPercentOnly||((this._usingPercentHeight||this._usingStretchHeight)&&(n.height=e.height*this._percentHeight),r.y=e.height-(this._topMargin+(1-i.y)*n.height));break;case ccui.LayoutComponent.verticalEdge.CENTER:this._isPercentOnly||(this._usingStretchHeight?(n.height=e.height-this._topMargin-this._bottomMargin,n.height<0&&(n.height=0),r.y=this._bottomMargin+i.y*n.height):(this._usingPercentHeight&&(n.height=e.height*this._percentHeight),r.y=e.height*this._positionPercentY))}if(t.setPosition(r),t.setContentSize(n),t instanceof ccui.PageView){t.forceDoLayout();for(var c=t.getPages(),o=0;o<c.length;o++)ccui.helper.doLayout(c[o])}else ccui.helper.doLayout(t)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var t,e,i,n=this._getOwnerParent();null!==n&&(t=this._owner.getPosition(),e=this._owner.getAnchorPoint(),i=this._owner.getContentSize(),n=n.getContentSize(),this._leftMargin=t.x-e.x*i.width,this._rightMargin=n.width-(t.x+(1-e.x)*i.width))},_refreshVerticalMargin:function(){var t,e,i,n=this._getOwnerParent();null!==n&&(t=this._owner.getPosition(),e=this._owner.getAnchorPoint(),i=this._owner.getContentSize(),n=n.getContentSize(),this._bottomMargin=t.y-e.y*i.height,this._topMargin=n.height-(t.y+(1-e.y)*i.height))}}),ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3},ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3},ccui.LayoutComponent.NAME="__ui_layout",ccui.LayoutComponent.bindLayoutComponent=function(t){var e=t.getComponent(ccui.LayoutComponent.NAME);return void 0!==e||((e=new ccui.LayoutComponent).init(),t.addComponent(e),t instanceof ccui.Widget)||t.addEventListener&&t.addEventListener("load",function(){e.refreshLayout()},this),e},cc.ComponentContainer=cc.Class.extend({_components:null,_owner:null,ctor:function(t){this._components=null,this._owner=t},getComponent:function(t){if(t)return t=t.trim(),this._components||(this._components={}),this._components[t];throw new Error("cc.ComponentContainer.getComponent(): name should be non-null")},add:function(t){if(t)return t.getOwner()||(null==this._components&&(this._components={},this._owner.scheduleUpdate()),this._components[t.getName()])?(cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1):(t.setOwner(this._owner),(this._components[t.getName()]=t).onEnter(),!0);throw new Error("cc.ComponentContainer.add(): component should be non-null")},remove:function(t){if(t)return!!this._components&&(t instanceof cc.Component?this._removeByComponent(t):(t=t.trim(),this._removeByComponent(this._components[t])));throw new Error("cc.ComponentContainer.remove(): name should be non-null")},_removeByComponent:function(t){return!!t&&(t.onExit(),t.setOwner(null),delete this._components[t.getName()],!0)},removeAll:function(){if(this._components){var t,e=this._components;for(t in e){var i=e[t];i.onExit(),i.setOwner(null),delete e[t]}this._owner.unscheduleUpdate(),this._components=null}},_alloc:function(){this._components={}},visit:function(t){if(this._components){var e,i=this._components;for(e in i)i[e].update(t)}},isEmpty:function(){return!this._components||0===this._components.length}});var ccs=ccs||{};ccs.Class=ccs.Class||cc.Class,ccs.Class.extend=ccs.Class.extend||cc.Class.extend,ccs.Node=ccs.Node||cc.Node,ccs.Node.extend=ccs.Node.extend||cc.Node.extend,ccs.Sprite=ccs.Sprite||cc.Sprite,ccs.Sprite.extend=ccs.Sprite.extend||cc.Sprite.extend,ccs.Component=ccs.Component||cc.Component,ccs.Component.extend=ccs.Component.extend||cc.Component.extend,ccs.dataReaderHelper={},ccs.spriteFrameCacheHelper={},ccs.BaseData=ccs.Class.extend({}),ccs.ProcessBase=ccs.Class.extend({}),(_p=ccs.ProcessBase.prototype).currentFrameIndex,cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex),_p.paused,cc.defineGetterSetter(_p,"paused",_p.isPause),_p.completed,cc.defineGetterSetter(_p,"completed",_p.isComplete),_p.currentPercent,cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent),_p.rawDuration,cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration),_p.loop,cc.defineGetterSetter(_p,"loop",_p.getLoop),_p.tweenEasing,cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing),_p.playing,cc.defineGetterSetter(_p,"playing",_p.isPlaying),_p=null,ccs.MovementEventType={start:0,complete:1,loopComplete:2},ccs.AnimationEvent=ccs.Class.extend({}),ccs.MovementEvent=function(){this.armature=null,this.movementType=ccs.MovementEventType.start,this.movementID=""},ccs.FrameEvent=function(){this.bone=null,this.frameEventName="",this.originFrameIndex=0,this.currentFrameIndex=0},ccs.Tween=ccs.ProcessBase.extend({}),(_p=ccs.Tween.prototype).animation,cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation),_p=null,ccs.Tween.create=function(t){return new ccs.Tween(t)},ccs.FRAME_TYPE_MOVE=0,ccs.FRAME_TYPE_SCALE=1,ccs.FRAME_TYPE_ROTATE=2,ccs.FRAME_TYPE_TINT=3,ccs.FRAME_TYPE_FADE=4,ccs.FRAME_TYPE_MAX=5,ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1e3},ccs.actionManager={},ccs.ActionNode=ccs.Class.extend({}),ccs.ComAttribute=ccs.Component.extend({}),ccs.ComAttribute.create=function(){return new ccs.ComAttribute},ccs.ComAudio=ccs.Component.extend({}),ccs.ComController=ccs.Component.extend({}),ccs.ComController.create=function(){return new ccs.ComController},ccs.ComRender=ccs.Component.extend({}),ccs.ComRender.create=function(t,e){return new ccs.ComRender(t,e)},ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(t){this._init(t)},_init:function(t){return this._actionTag=t,!0},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag}}),ccs.AnimationInfo=function(t,e,i){this.name=t,this.startIndex=e,this.endIndex=i},ccs.ActionTimelineData.create=function(t){return new ccs.ActionTimelineData(t)},ccs.ActionTimeline=cc.Action.extend({_timelineMap:null,_timelineList:null,_guideLines:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:!1,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){cc.Action.prototype.ctor.call(this),this._timelineMap={},this._timelineList=[],this._guideLines={},this._animationInfos={},this.init()},_gotoFrame:function(t){for(var e=this._timelineList.length,i=0;i<e;i++)this._timelineList[i]._gotoFrame(t)},_stepToFrame:function(t){for(var e=this._timelineList.length,i=0;i<e;i++)this._timelineList[i]._stepToFrame(t)},_emitFrameEvent:function(t){this._frameEventListener&&this._frameEventListener(t)},init:function(){return!0},gotoFrameAndPlay:function(t,e,i,n){for(var r,c=0,o=arguments.length,s=[];c<o;c++)"boolean"==typeof arguments[c]?r=arguments[c]:s.push(arguments[c]);t=s[0],e=void 0!==s[1]?s[1]:this._duration,i=s[2]||t,n=null==r||r,this._startFrame=t,this._endFrame=e,this._currentFrame=i,this._loop=n,this._time=this._currentFrame*this._frameInternal,this.resume(),this._gotoFrame(this._currentFrame)},gotoFrameAndPause:function(t){this._startFrame=this._currentFrame=t,this._time=this._currentFrame*this._frameInternal,this.pause(),this._gotoFrame(this._currentFrame)},pause:function(){this._playing=!1},resume:function(){this._playing=!0},isPlaying:function(){return this._playing},setTimeSpeed:function(t){this._timeSpeed=t},getTimeSpeed:function(){return this._timeSpeed},setDuration:function(t){this._duration=t},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(t){t>=this._startFrame&&t<=this._endFrame?(this._currentFrame=t,this._time=this._currentFrame*this._frameInternal):cc.log("frame index is not between start frame and end frame")},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(t){var e=t.getActionTag();this._timelineMap[e]||(this._timelineMap[e]=[]),-1===this._timelineMap[e].indexOf(t)&&(this._timelineList.push(t),this._timelineMap[e].push(t),t.setActionTimeline(this))},removeTimeline:function(e){var t=e.getActionTag();this._timelineMap[t]&&this._timelineMap[t].some(function(t){if(t===e)return!0})&&(cc.arrayRemoveObject(this._timelineMap[t],e),cc.arrayRemoveObject(this._timelineList,e),e.setActionTimeline(null))},getTimelines:function(){return this._timelineList},setGuideLines:function(t){for(k in t){guideline=t[k];var e=new cc.GuideLine;e.setPath(guideline),this._guideLines[k]=e}},getGuideLineByTag:function(t){return this._guideLines[t]},setFrameEventCallFunc:function(t){this._frameEventListener=t},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var t,e=new ccs.ActionTimeline;for(t in e.setDuration(this._duration),e.setTimeSpeed(this._timeSpeed),this._timelineMap){var i,n=this._timelineMap[t];for(i in n){var r=n[i].clone();e.addTimeline(r)}}return e},reverse:function(){return null},step:function(t){this._playing&&0!==this._timelineMap.length&&0!==this._duration&&(this._time+=t*this._timeSpeed,(t=this._time-this._endFrame*this._frameInternal)<this._frameInternal?(this._currentFrame=Math.floor(this._time/this._frameInternal),this._stepToFrame(this._currentFrame),0<=t&&this._lastFrameListener&&this._lastFrameListener()):(this._playing=this._loop,this._playing?this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop):(this._time=this._endFrame*this._frameInternal,this._currentFrame!=this._endFrame&&(this._currentFrame=this._endFrame,this._stepToFrame(this._currentFrame),this._lastFrameListener)&&this._lastFrameListener())))},_foreachNodeDescendant:function(t,e){e(t);for(var i=t.getChildren(),n=0;n<i.length;n++){var r=i[n];this._foreachNodeDescendant(r,e)}},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t);var r=this;this._foreachNodeDescendant(t,function(t){var e=t._actionTag;if(r._timelineMap[e])for(var i=r._timelineMap[e],n=0;n<i.length;n++)i[n].setNode(t)})},isDone:function(){return!1},play:function(t,e){var i=this._animationInfos[t];if(!i)return cc.log("Can't find animation info for %s",t);this.gotoFrameAndPlay(i.startIndex,i.endIndex,e)},addAnimationInfo:function(t){this._animationInfos[t.name]=t},removeAnimationInfo:function(t){delete this._animationInfos[t]},isAnimationInfoExists:function(t){return this._animationInfos[t]},getAnimationInfo:function(t){return this._animationInfos[t]},setLastFrameCallFunc:function(t){this._lastFrameListener=t},clearLastFrameCallFunc:function(){this._lastFrameListener=null}}),ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline},ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0,this._tween=!0,this._timeline=null,this._node=null,this._enterWhenPassed=!1,this._easingParam=[]},_emitEvent:function(){this._timeline&&this._timeline.getActionTimeline()._emitFrameEvent(this)},_cloneProperty:function(t){this._frameIndex=t.getFrameIndex(),this._tween=t.isTween(),this._tweenType=t.getTweenType(),this.setEasingParams(t.getEasingParams())},setFrameIndex:function(t){this._frameIndex=t},getFrameIndex:function(){return this._frameIndex},setTimeline:function(t){this._timeline=t},getTimeline:function(t){return this._timeline},setNode:function(t){this._node=t},getNode:function(){return this._node},setTween:function(t){this._tween=t},isTween:function(){return this._tween},onEnter:function(t){},apply:function(t){this._tween&&this._onApply(t)},_onApply:function(t){},clone:function(){},setEasingParams:function(t){if(t)for(var e=this._easingParam.length=0;e<t.length;e++)this._easingParam[e]=t[e]},getEasingParams:function(){return this._easingParam},setTweenType:function(t){this._tweenType=t},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}}),ccs.VisibleFrame=ccs.Frame.extend({_visible:!0,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._visible=!0},onEnter:function(t){this._node&&this._node.setVisible(this._visible)},clone:function(){var t=new ccs.VisibleFrame;return t.setVisible(this._visible),t._cloneProperty(this),t},setVisible:function(t){this._visible=t},isVisible:function(){return this._visible}}),ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame},ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._textureName=""},setNode:function(t){ccs.Frame.prototype.setNode.call(this,t),this._sprite=t},onEnter:function(t){var e,i;this._sprite&&(e=this._sprite.getBlendFunc(),null!=(i=cc.spriteFrameCache._spriteFrames[this._textureName])?this._sprite.setSpriteFrame(i):this._sprite.setTexture(this._textureName),this._sprite.getBlendFunc()!==e)&&this._sprite.setBlendFunc(e)},clone:function(){var t=new ccs.TextureFrame;return t.setTextureName(this._textureName),t._cloneProperty(this),t},setTextureName:function(t){this._textureName=t},getTextureName:function(){return this._textureName}}),ccs.TextureFrame.create=function(){return new ccs.TextureFrame},ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._rotation=0},onEnter:function(t){this._node&&(this._node.setRotation(this._rotation),this._tween)&&(this._betwennRotation=t._rotation-this._rotation)},_onApply:function(t){0!==this._betwennRotation&&(t=this._rotation+t*this._betwennRotation,this._node.setRotation(t))},clone:function(){var t=new ccs.RotationFrame;return t.setRotation(this._rotation),t._cloneProperty(this),t},setRotation:function(t){this._rotation=t},getRotation:function(){return this._rotation}}),ccs.RotationFrame.create=function(){return new ccs.RotationFrame},ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_type:0,_cycle:0,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._skewX=0,this._skewY=0},onEnter:function(t){this._node&&(this._node.setSkewX(this._skewX),this._node.setSkewY(this._skewY),this._tween)&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY,180<_betweenSkewX&&(_betweenSkewX-=360),_betweenSkewX<-180&&(_betweenSkewX+=360),180<_betweenSkewY&&(_betweenSkewY-=360),_betweenSkewY<-180)&&(_betweenSkewY+=360)},_onApply:function(t){var e;0===this._betweenSkewX&&0===this._betweenSkewY||(e=this._skewX+t*this._betweenSkewX,t=this._skewY+t*this._betweenSkewY,this._node.setSkewX(e),this._node.setSkewY(t))},clone:function(){var t=new ccs.SkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t._cloneProperty(this),t},setSkewX:function(t){this._skewX=t},getSkewX:function(){return this._skewX},setSkewY:function(t){this._skewY=t},getSkewY:function(){return this._skewY},setType:function(t){this._type=t},getType:function(){return this._type},setCycle:function(t){this._cycle=t},getCycle:function(){return this._cycle}}),ccs.SkewFrame.create=function(){return new ccs.SkewFrame},ccs.RotationSkewFrame=ccs.SkewFrame.extend({distance:function(t,e,i,n){var r;return t=t<0?t+360:t,e=e<0?e+360:e,0==i?(r=Math.abs(e-t))<=360-r?t<=e?r:-r:t<=e?r-360:360-r:1==i?t<=e?e-t+360*n:360-(t-e)+360*n:2==i?t<=e?e-t-360-360*n:e-t-360*n:void 0},onEnter:function(t){this._node&&(this._node.setRotationX(this._skewX),this._node.setRotationY(this._skewY),this._tween)&&(this._betweenSkewX=t._skewX-this._skewX,this._betweenSkewY=t._skewY-this._skewY,180<this._betweenSkewX&&(this._betweenSkewX=this._betweenSkewX-360),this._betweenSkewX<-180&&(this._betweenSkewX=this._betweenSkewX+360),180<this._betweenSkewY&&(this._betweenSkewY=this._betweenSkewY-360),this._betweenSkewY<-180)&&(this._betweenSkewY=this._betweenSkewY+360)},_onApply:function(t){var e;!this._node||0===this._betweenSkewX&&0===this._betweenSkewY||(180<=(e=this._skewX+t*this._betweenSkewX)&&(e-=360),180<=(t=this._skewY+t*this._betweenSkewY)&&(t-=360),e<=-180&&(e+=360),t<=-180&&(t+=360),this._node.setRotationX(e),this._node.setRotationY(t))},clone:function(){var t=new ccs.RotationSkewFrame;return t.setSkewX(this._skewX),t.setSkewY(this._skewY),t.setType(this._type),t.setCycle(this._cycle),t._cloneProperty(this),t}}),ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame},ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._position=cc.p(0,0)},onEnter:function(t){this._node&&(this._node.setPosition(this._position),this._tween)&&(this._betweenX=t._position.x-this._position.x,this._betweenY=t._position.y-this._position.y)},_onApply:function(t){!this._node||0===this._betweenX&&0===this._betweenY||this._node.setPosition(this._position.x+this._betweenX*t,this._position.y+this._betweenY*t)},clone:function(){var t=new ccs.PositionFrame;return t.setPosition(this._position),t._cloneProperty(this),t},setPosition:function(t){this._position=t},getPosition:function(){return this._position},setX:function(t){this._position.x=t},getX:function(){return this._position.x},setY:function(t){this._position.y=t},getY:function(){return this._position.y}}),ccs.PositionFrame.create=function(){return new ccs.PositionFrame},ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1},onEnter:function(t){this._node&&(this._node.setScaleX(this._scaleX),this._node.setScaleY(this._scaleY),this._tween)&&(this._betweenScaleX=t._scaleX-this._scaleX,this._betweenScaleY=t._scaleY-this._scaleY)},_onApply:function(t){var e;!this._node||0===this._betweenScaleX&&0===this._betweenScaleY||(e=this._scaleX+this._betweenScaleX*t,t=this._scaleY+this._betweenScaleY*t,this._node.setScaleX(e),this._node.setScaleY(t))},clone:function(){var t=new ccs.ScaleFrame;return t.setScaleX(this._scaleX),t.setScaleY(this._scaleY),t._cloneProperty(this),t},setScale:function(t){this._scaleX=t,this._scaleY=t},setScaleX:function(t){this._scaleX=t},getScaleX:function(){return this._scaleX},setScaleY:function(t){this._scaleY=t},getScaleY:function(){return this._scaleY}}),ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame},ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._anchorPoint=cc.p(0,0)},onEnter:function(t){this._node&&this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var t=new ccs.AnchorPointFrame;return t.setAnchorPoint(this._anchorPoint),t._cloneProperty(this),t},setAnchorPoint:function(t){this._anchorPoint=t},getAnchorPoint:function(){return this._anchorPoint}}),ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame},ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2},ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this),this._enterWithName=!1,this._innerActionType=ccs.InnerActionType.LoopAction,this._startFrameIndex=0},onEnter:function(t){var e,i,n,r;this._node&&(e=this._node.getActionByTag(this._node.getTag()))&&(ccs.InnerActionType.SingleFrame===this._innerActionType?e.gotoFrameAndPause(this._singleFrameIndex):(i=this._startFrameIndex,n=this._endFrameIndex,this._enterWithName&&("-- ALL --"===this._animationName?(i=0,n=e.getDuration()):e.isAnimationInfoExists(this._animationName)?(i=(r=e.getAnimationInfo(this._animationName)).startIndex,n=r.endIndex):cc.log("Animation %s not exists!",this._animationName)),(r=this._timeline.getActionTimeline().getDuration()-this._frameIndex-n+i)<0&&(n+=r),ccs.InnerActionType.NoLoopAction===this._innerActionType?e.gotoFrameAndPlay(i,n,!1):ccs.InnerActionType.LoopAction===this._innerActionType&&e.gotoFrameAndPlay(i,n,!0)))},setAnimationName:function(t){this._animationName=t},setSingleFrameIndex:function(t){this._singleFrameIndex=t},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(t){this._enterWithName=t},getEnterWithName:function(){return this._enterWithName},clone:function(){var t=new ccs.InnerActionFrame;return t.setInnerActionType(this._innerActionType),t.setStartFrameIndex(this._startFrameIndex),t.setEnterWithName(this._enterWithName),t.setAnimationName(this._animationName),t.setSingleFrameIndex(this._singleFrameIndex),t._cloneProperty(this),t},setInnerActionType:function(t){this._innerActionType=t},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(t){this._startFrameIndex=t},getStartFrameIndex:function(){return this._startFrameIndex}}),ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame},ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._color=cc.color(255,255,255)},onEnter:function(t){this._node&&(this._node.setColor(this._color),this._tween)&&(t=t._color,this._betweenRed=t.r-this._color.r,this._betweenGreen=t.g-this._color.g,this._betweenBlue=t.b-this._color.b)},_onApply:function(t){var e;this._node&&this._tween&&(0!==this._betweenAlpha||0!==this._betweenRed||0!==this._betweenGreen||0!==this._betweenBlue)&&((e=cc.color(255,255,255)).r=this._color.r+this._betweenRed*t,e.g=this._color.g+this._betweenGreen*t,e.b=this._color.b+this._betweenBlue*t,this._node.setColor(e),null!==this._alpha)&&(e=this._alpha+this._betweenAlpha*t,this._node.setOpacity(e))},clone:function(){var t=new ccs.ColorFrame;return t.setColor(this._color),t._cloneProperty(this),t},setColor:function(t){this._color=t},getColor:function(){return this._color}}),ccs.ColorFrame.create=function(){return new ccs.ColorFrame},ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this),this._alpha=255},onEnter:function(t){this._node&&(this._node.setOpacity(this._alpha),this._tween)&&(this._betweenAlpha=t._alpha-this._alpha)},_onApply:function(t){this._node&&(t=this._alpha+this._betweenAlpha*t,this._node.setOpacity(t))},setAlpha:function(t){this._alpha=t},getAlpha:function(){return this._alpha},clone:function(){var t=new ccs.AlphaFrame;return t.setAlpha(this._alpha),t._cloneProperty(this),t}}),ccs.ZOrderFrame=ccs.Frame.extend({_zorder:0,onEnter:function(t){this._node&&this._node.setLocalZOrder(this._zorder)},clone:function(){var t=new ccs.ZOrderFrame;return t.setZOrder(this._zorder),t._cloneProperty(this),t},setZOrder:function(t){this._zorder=t},getZOrder:function(){return this._zorder}}),ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame},ccs.GuidePositionFrame=ccs.Frame.extend({onEnter:function(t){this._tag&&this._node&&null!=(guideline=this._timeline.getActionTimeline().getGuideLineByTag(this._tag))&&(this._node.setPosition(guideline.getPointByRate(this._rate)),this._nextRate=t._rate)},_onApply:function(t){0!=this._tag&&(guideline=this._timeline.getActionTimeline().getGuideLineByTag(this._tag),this._node)&&guideline&&(t=this._rate+(this._nextRate-this._rate)*t,this._node.setPosition(guideline.getPointByRate(t)))},setGuidelineTag:function(t){this._tag=t},getGuidelineTag:function(){return this._tag},setRate:function(t){this._rate=t},getRate:function(){return this._rate}}),ccs.GuidePositionFrame.create=function(){return new ccs.GuidePositionFrame},ccs.BlendFuncFrame=ccs.Frame.extend({ctor:function(){this._super(),this._blendFunc=null},onEnter:function(t,e){this._node&&this._blendFunc&&this._node.setBlendFunc(this._blendFunc)},clone:function(){var t=new ccs.BlendFuncFrame;return t.setBlendFunc(this._blendFunc),t._cloneProperty(this),t},setBlendFunc:function(t){t&&t.src&&t.dst&&(this._blendFunc=t)},getBlendFunc:function(){return this._blendFunc}}),ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame},ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[],this._currentKeyFrame=null,this._currentKeyFrameIndex=0,this._fromIndex=0,this._toIndex=0,this._betweenDuration=0,this._actionTag=0,this._ActionTimeline=null,this._node=null},_gotoFrame:function(t){0!==this._frames.length&&(this._binarySearchKeyFrame(t),this._apply(t))},_stepToFrame:function(t){0!==this._frames.length&&(this._updateCurrentKeyFrame(t),this._apply(t))},getFrames:function(){return this._frames},addFrame:function(t){this._frames.push(t),t.setTimeline(this)},insertFrame:function(t,e){this._frames.splice(e,0,t),t.setTimeline(this)},removeFrame:function(t){cc.arrayRemoveObject(this._frames,t),t.setTimeline(null)},setActionTag:function(t){this._actionTag=t},getActionTag:function(){return this._actionTag},setNode:function(t){for(var e=0;e<this._frames.length;e++)this._frames[e].setNode(t)},getNode:function(){return this._node},setActionTimeline:function(t){this._ActionTimeline=t},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var t=new ccs.Timeline;t._actionTag=this._actionTag;for(var e=0;e<this._frames.length;e++){var i=this._frames[e].clone();t.addFrame(i)}return t},_apply:function(t){this._currentKeyFrame&&(t=this._betweenDuration<=0?0:(t-this._currentKeyFrameIndex)/this._betweenDuration,this._currentKeyFrame.apply(t))},_binarySearchKeyFrame:function(t){var e=null,i=null,n=this._frames.length,r=!1;do{if(t<this._frames[0].getFrameIndex()){this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(r=!0),this._fromIndex=0,this._toIndex=0,e=i=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(t>=this._frames[n-1].getFrameIndex()){this._fromIndex=n-1,this._toIndex=0,e=i=this._frames[n-1],this._currentKeyFrameIndex=this._frames[n-1].getFrameIndex(),this._betweenDuration=0;break}for(var c,o=-1,s=0,a=n-1;s<=a;){if(c=Math.ceil((s+a)/2),t>=this._frames[c].getFrameIndex()&&t<this._frames[c+1].getFrameIndex()){o=c;break}this._frames[c].getFrameIndex()>t?a=c-1:s=c+1}}while(this._fromIndex=o,this._toIndex=1<n?o+1|0:0|o,e=this._frames[this._fromIndex],i=this._frames[this._toIndex],e=this._frames[o],i=this._frames[o+1],0===o&&this._currentKeyFrameIndex<e.getFrameIndex()&&(r=!0),this._currentKeyFrameIndex=e.getFrameIndex(),this._betweenDuration=i.getFrameIndex()-e.getFrameIndex(),0);!r&&this._currentKeyFrame==e||(this._currentKeyFrame=e,this._currentKeyFrame.onEnter(i))},_updateCurrentKeyFrame:function(t){if(60<t&&0,t<this._currentKeyFrameIndex||t>=this._currentKeyFrameIndex+this._betweenDuration){var e=null,i=null;do{var n=this._frames.length;if(t<this._frames[0].getFrameIndex()){e=i=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();break}if(t>=this._frames[n-1].getFrameIndex()){var r=this._frames[n-1].getFrameIndex();if(this._currentKeyFrameIndex>=r)return;t=r}for(;;){if(this._fromIndex=this._toIndex,e=this._frames[this._fromIndex],this._currentKeyFrameIndex=e.getFrameIndex(),this._toIndex=this._fromIndex+1,this._toIndex>=n&&(this._toIndex=0),i=this._frames[this._toIndex],t===e.getFrameIndex())break;if(t>e.getFrameIndex()&&t<i.getFrameIndex())break;e.isEnterWhenPassed()&&e.onEnter(i)}}while(this._betweenDuration=i.getFrameIndex()-e.getFrameIndex(),0);this._currentKeyFrame=e,this._currentKeyFrame.onEnter(i)}}}),ccs.Timeline.create=function(){return new ccs.Timeline},ccs._load=function(){function t(t,e,i){var n,r,c=cc.loader.getRes(t);return c?"json"!==(r=s(t).toLocaleLowerCase())&&"exportjson"!==r?cc.log("%s load error, must be json file",t):(e?n=o[e]:c.widgetTree?n=o.ccui:c.nodeTree||c.C||c.Content&&c.Content.Content?n=o.timeline:c.gameobjects&&(n=o.scene),n&&(r=c.Version||c.V,e=a(n,r))?e.parse(t,c,i)||null:(cc.log("Can't find the parser : %s",t),new cc.Node)):cc.log("%s does not exist",t)}var o={ccui:{},timeline:{},action:{},scene:{}},s=(t.registerParser=function(t,e,i){if(!t||!e||!i)return cc.log("register parser error");o[t]||(o[t]={}),o[t][e]=i},t.getParser=function(t,e){return t&&e?o[t]?o[t][e]:void 0:t?o[t]:o},function(t){t=t.match(e);return t&&t[1]?t[1]:null}),e=/\.([^\.]+)$/,i=/([^\.](\.\*)?)*$/,a=function(t,e){return t[e]||("*"===e?null:a(t,e.replace(i,"*")))};return t}(),ccs._parser=cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(t){t=t.match(this._dirnameReg);return t&&t[0]?t[0]:""},getClass:function(t){return t.classname},getNodeJson:function(t){return t.widgetTree},parse:function(t,e,i){i=i||this._dirname(t),this.pretreatment(e,i);var n=this.parseNode(this.getNodeJson(e),i,t);return n&&this.deferred(e,i,n,t),n},pretreatment:function(t,e,i){},deferred:function(t,e,i,n){},parseNode:function(t,e){var i=this.parsers[this.getClass(t)],n=null;return i?n=i.call(this,t,e):cc.log("Can't find the parser : %s",this.getClass(t)),n},registerParser:function(t,e){this.parsers[t]=e}}),ccs.load=function(t,e){var i={node:null,action:null};return i.node=ccs._load(t,null,e),i.action=ccs._load(t,"action",e),i.action&&-1===i.action.tag&&i.node&&(i.action.tag=i.node.tag),i},ccs.load.validate={},ccs.load.preload=!0,ccs.loadWithVisibleSize=function(t,e){t=ccs.load(t,e),e=cc.director.getVisibleSize();return t.node&&e&&(t.node.setContentSize(e.width,e.height),ccui.helper.doLayout(t.node)),t},ccs.actionTimelineCache={createAction:function(t){return ccs._load(t,"action")}},ccs.csLoader={createNode:function(t){return ccs._load(t)}},cc.loader.register(["json"],{}),ccs._load,ccs._parser,function(t){for(var e=new(ccs._parser.extend({getNodeJson:function(t){return t.C||t.Content.Content},parseNode:function(t,e,i){if(!t)return null;var n=t.GuideLines,r=(t=t.A||t.Animation,new ccs.ActionTimeline),c=(r.setDuration(t.D||t.Duration),r.setTimeSpeed(t.Speed||.5),t.T||t.Timelines);r.setGuideLines(n);for(var o=0;o<c.length;o++){var s,a=c[o],h=this.parsers[a[0]];h?s=h.call(this,a,e,r):cc.log("parser does not exist : %s",a[0]),s&&r.addTimeline(s)}return r},deferred:function(t,e,i,n){for(var r=(t.C||t.Content.Content).AnimationList,c=r?r.length:0,o=0;o<c;o++){var s=r[o],a={name:null,startIndex:null,endIndex:null};a.name=s.Name,a.startIndex=s.StartIndex,a.endIndex=s.EndIndex,i.addAnimationInfo(a)}}})),i=[{name:"Position",handle:function(t){var e=new ccs.PositionFrame,i=(t.P?t.P[0]:t.X)||0,t=(t.P?t.P[1]:t.Y)||0;return e.setPosition(cc.p(i,t)),e}},{name:"P",handle:function(t){var e=new ccs.PositionFrame,i=(t.P?t.P[0]:t.X)||0,t=(t.P?t.P[1]:t.Y)||0;return e.setPosition(cc.p(i,t)),e}},{name:"VisibleForFrame",handle:function(t){var e=new ccs.VisibleFrame,t=null!=t.V?t.V:t.Value;return e.setVisible(t),e}},{name:"Scale",handle:function(t){var e=new ccs.ScaleFrame,i=t.P?t.P[0]:t.X,t=t.P?t.P[1]:t.Y;return e.setScaleX(i),e.setScaleY(t),e}},{name:"Rotation",handle:function(t){var e=new ccs.RotationFrame,t=t.Rotation||t.Value||t.V||0;return e.setRotation(t),e}},{name:"Skew",handle:function(t){var e=new ccs.SkewFrame,i=t.P?t.P[0]:t.X,t=t.P?t.P[1]:t.Y;return e.setSkewX(i),e.setSkewY(t),e}},{name:"RotationSkew",handle:function(t){var e=new ccs.RotationSkewFrame,i=t.P?t.P[0]:t.X,n=t.P?t.P[1]:t.Y,t=t.T||0;return e.setSkewX(i),e.setSkewY(n),e.setType(t),e}},{name:"R",handle:function(t){var e=new ccs.RotationSkewFrame,i=t.P?t.P[0]:t.X,n=t.P?t.P[1]:t.Y,t=t.T||0;return e.setSkewX(i),e.setSkewY(n),e.setType(t),e}},{name:"Anchor",handle:function(t){var e=new ccs.AnchorPointFrame,i=t.P?t.P[0]:t.X,t=t.P?t.P[1]:t.Y;return e.setAnchorPoint(cc.p(i,t)),e}},{name:"AnchorPoint",handle:function(t){var e=new ccs.AnchorPointFrame,i=t.P?t.P[0]:t.X,t=t.P?t.P[1]:t.Y;return e.setAnchorPoint(cc.p(i,t)),e}},{name:"InnerAction",handle:function(t){var e=new ccs.InnerActionFrame,i=t.InnerActionType,t=t.StartFrame;return e.setInnerActionType(i),e.setStartFrameIndex(t),e}},{name:"CColor",handle:function(t){var e=new ccs.ColorFrame,t=t.Color;return(t=t||{}).R=void 0===t.R?255:t.R,t.G=void 0===t.G?255:t.G,t.B=void 0===t.B?255:t.B,e.setColor(cc.color(t.R,t.G,t.B)),e}},{name:"Alpha",handle:function(t){var e=new ccs.AlphaFrame,t=null!=t.V?t.V:t.Value;return e.setAlpha(t),e}},{name:"FileData",handle:function(t,e){}},{name:"ZOrder",handle:function(t){var e=new ccs.ZOrderFrame,t=null!=t.V?t.V:t.Value;return e.setZOrder(t),e}},{name:"GuidePosition",handle:function(t,e,i){var n=new ccs.GuidePositionFrame,r=t.Tag,i=i.getGuideLineByTag(r=r||0),t=(this._x=t.P?t.P[0]:t.X,this._y=t.P?t.P[1]:t.Y,i.getRateByPoint({x:this._x,y:this._y}));return n.setGuidelineTag(r),n.setRate(t),n}},{name:"ActionValue",handle:function(t){var e=new ccs.InnerActionFrame,i=t.T||t.InnerActionType||"LoopAction",n=t.CurrentAniamtionName||"-- ALL --",r=t.SingleFrameIndex||"0",t=t.I||0;return e.setFrameIndex(t),e.setInnerActionType(ccs.InnerActionType[i]),e.setSingleFrameIndex(r),e.setEnterWithName(!0),n&&e.setAnimationName(n),e}}],n=0;n<i.length;n++)!function(h){e.registerParser(h.name,function(t,e,i){var n=new ccs.Timeline,r=(n.setActionTag(t[1]),t[2]);if(r&&r.length)for(var c=0;c<r.length;c++){var o=r[c],s=h.handle(o,e,i),a=(s.setFrameIndex(o.I),null==o.T||o.T),a=(s.setTween(a),o.E||o.ED);a&&!function(t,e){t.setTweenType(-1);var i,n=[];e&&(i=!1,(i=4==e.length?!0:i)&&(n.push(0),n.push(0)),e.forEach(function(t){n.push(t)}),i&&(n.push(1),n.push(1)),t.setEasingParams(n))}(s,a),n.addFrame(s)}return n})}(i[n]);t.registerParser("action","2",e),t.registerParser("action","*",e)}(ccs._load),function(t,e){function a(t,e){return void 0===t?e:t}var r=new(e.extend({parse:function(t,e,i){var i=void 0!==i?i:this._dirname(t),n=(this.pretreatment(e,i,t),this.parseNode(this.getNodeJson(e),i));return this.deferred(e,i,n,t),n},getNodeJson:function(t){t=t.C||t.Content;return t.ObjectData||t.D||t.Content.ObjectData},getClass:function(t){return t.$||t.ctype}})),c=(r.generalAttributes=function(t,e){var i=e["#"]||e.Name,i=(null!=i&&t.setName(i),e.Pos),n=(null!=i&&(t.setPosition(cc.p(i[0]||0,i[1]||0)),t.setScaleX(i[2]),t.setScaleY(i[3]),s(t,{X:i[4],Y:i[5]}),null!=(n=i[6])&&t.setRotationX(n),null!=(n=i[7])&&t.setRotationY(n),.5==i[8]&&.5==i[9]||t.setAnchorPoint(cc.p(i[8],i[9]))),e.Size),i=(n&&s(t,n),e.A),n=(null!=(i=null==i?e.Alpha:i)&&t.setOpacity(i),t.setTag(e.Tag||0),e["@"]||e.ActionTag||0);t._actionTag=n,t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0)},r.parseChild=function(t,e,i){if(t&&e)for(var n=0;n<e.length;n++){var r,c,o=this.parseNode(e[n],i);o&&(t instanceof ccui.PageView?o instanceof ccui.Layout&&t.addPage(o):t instanceof ccui.ListView?o instanceof ccui.Widget&&t.pushBackCustomItem(o):(!(t instanceof ccui.Layout)&&o instanceof ccui.Widget&&o.getPositionType()===ccui.Widget.POSITION_PERCENT&&(r=o.getPositionPercent(),c=t.getAnchorPoint(),o.setPositionPercent(cc.p(r.x+c.x,r.y+c.y))),t.addChild(o)))}},r.initSingleNode=function(t){var e=new cc.Node,t=(this.generalAttributes(e,t),t.CColor);return null!=t&&e.setColor(h(t)),e},r.initSprite=function(t,e){var i,n=new cc.Sprite,e=(o(t.F||t.FileData,e,function(t,e){0===e?n.setTexture(t):1===e&&(e=cc.spriteFrameCache.getSpriteFrame(t))&&n.setSpriteFrame(e)}),t.BlendFunc),e=(t.BlendFunc&&(i=cc.BlendFunc.ALPHA_PREMULTIPLIED,void 0!==e.Src&&(i.src=e.Src),void 0!==e.Dst&&(i.dst=e.Dst),n.setBlendFunc(i)),t.FlipX&&n.setFlippedX(!0),t.FlipY&&n.setFlippedY(!0),this.generalAttributes(n,t),t.CColor);return null!=e&&n.setColor(h(e)),n},r.widgetAttributes=function(t,e,i){t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0),t.setUnifySizeEnabled(!1),t.ignoreContentAdaptWithSize(!1),!i&&e.Size&&s(t,e.Size);var n=e["#"]||e.Name,n=(n&&t.setName(n),e.Pos),i=(null!=n&&(i||s(t,{X:n[4],Y:n[5]}),t.setPosition(n[0]||0,n[1]||0),i=a(n[2],1),r=a(n[3],1),t.setScaleX(i),t.setScaleY(r),null!=(i=n[6])&&t.setRotationX(i),null!=(r=n[7])&&t.setRotationY(r),t.setAnchorPoint(cc.p(n[8],n[9]))),e["@"]||e.ActionTag||0),r=(t.setActionTag(i),e.A||e.Alpha),n=(null!=r&&t.setOpacity(r),t.setTag(e.Tag||0),e.CColor);null!=n&&t.setColor(h(n))},r.initText=function(t,e){var i=new ccui.Text,n=t.TouchScaleChangeAble,n=(null!=n&&i.setTouchScaleChangeEnabled(n),t.T||t.LabelText||""),n=(null!=(n=n.replace(/\\n/g,"\n"))&&i.setString(n),t.i||t.FontSize),n=(null!=n&&i.setFontSize(n),t.FontName),r=(null!=n&&i.setFontName(n),t.AreaWidth),c=t.areaHeight,o=(r&&c&&i.setTextAreaSize(cc.size(r,c)),t.HA||t.HorizontalAlignmentType||"HT_Left");switch(o){case"HT_Right":o=2;break;case"HT_Center":o=1;break;default:o=0}i.setTextHorizontalAlignment(o);var s=t.VerticalAlignmentType||"VT_Top";switch(s){case"VT_Bottom":s=2;break;case"VT_Center":s=1;break;default:s=0}i.setTextVerticalAlignment(s);var r=t.FontResource,c=(null!=r&&null!=(c=r.Path)&&(n=cc.sys.isNative?cc.path.join(cc.loader.resPath,e,c):(n=c.match(/([^\/]+)\.(\S+)/))?n[1]:"",i.setFontName(n)),(t.ShadowEnabled||t.ShadowColor)&&(r=t.Shadow[0],e=t.Shadow[1],i.enableShadow(h(t.ShadowColor),cc.size(a(r,2),a(e,-2)),t.ShadowBlurRadius||0)),t.IsCustomSize);i.ignoreContentAdaptWithSize(!(c=null==c?!0:c)),i.setUnifySizeEnabled(!1);n=(n=t.CColor)||{r:255,g:255,b:255,a:255};return t.CColor=null,i.setTextColor(h(n)),this.widgetAttributes(i,t,i.isIgnoreContentAdaptWithSize()),t.CColor=n,i},r.initImageView=function(t,e){var i,n,r,c=new ccui.ImageView;return o(t.F||t.FileData,e,function(t,e){c.loadTexture(t,e)}),o(t.ImageFileData,e,function(t,e){c.loadTexture(t,e)}),t.Scale9Enable||t.Scale9?(c.setScale9Enabled(!0),c.setUnifySizeEnabled(!1),c.ignoreContentAdaptWithSize(!1),e=t.Scale9OriginX||0,i=t.Scale9OriginY||0,n=t.Scale9Width||0,r=t.Scale9Height||0,t.Scale9&&(e=t.Scale9[0],i=t.Scale9[1],n=t.Scale9[2],r=t.Scale9[3]),c.setCapInsets(cc.rect(e,i,n,r))):(e=t.Size||{X:t.Pos[4],Y:t.Pos[5]},s(c,e)),this.widgetAttributes(c,t),c},r.initTextBMFont=function(t,e){var i=new ccui.TextBMFont;this.widgetAttributes(i,t);var n=(n=t.T||t.LabelText||"").replace("\\n","\n");return i.setString(n),n=t.F?{Path:"font/"+t.F+".fnt",Type:0}:t.LabelBMFontFile_CNB,o(n,e,function(t,e){cc.loader.getRes(t)||cc.log("%s need to be pre loaded",t),i.setFntFile(t)}),i.ignoreContentAdaptWithSize(!0),i},r.initProjectNode=function(t,e){var i=t.F?t.F[1]:t.FileData.Path;if(i){i=e+i;if(cc.loader.getRes(i))return e=ccs.load(i,e),r.generalAttributes(e.node,t),e.action&&e.node&&(e.action.tag=e.node.tag,e.node.runAction(e.action),e.action.gotoFrameAndPause(0)),e.node;cc.log("%s need to be preloaded",i)}},{}),o=function(t,e,i){var n,r;null!=t&&((t=(n=t.Path)?(r=0==t.Type?0:1,t.Plist):(r=t[0],n=t[1],t[2]+".plist"))&&(cc.loader.getRes(e+t)?(c[e+t]=!0,cc.spriteFrameCache.addSpriteFrames(e+t)):c[e+t]||cc.spriteFrameCache.getSpriteFrame(n)||cc.log("%s need to be preloaded",e+t)),0!==r?cc.spriteFrameCache.getSpriteFrame(n)?i(n,r):cc.log("failed to get spriteFrame: %s",n):i(e+n,r))},h=function(t){var e,i,n;if(t)return e=null!=t.R?t.R:255,i=null!=t.G?t.G:255,n=null!=t.B?t.B:255,t=null!=t.A?t.A:255,cc.color(e,i,n,t)},s=function(t,e){var i=e.X||0,n=e.Y||0;e&&t.setContentSize(cc.size(i,n))};[{name:"N",handle:r.initSingleNode},{name:"SingleNodeObjectData",handle:r.initSingleNode},{name:"NodeObjectData",handle:r.initSingleNode},{name:"LayerObjectData",handle:r.initSingleNode},{name:"GameNodeObjectData",handle:r.initSingleNode},{name:"GameLayerObjectData",handle:r.initSingleNode},{name:"SpriteObjectData",handle:r.initSprite},{name:"S",handle:r.initSprite},{name:"TextObjectData",handle:r.initText},{name:"TXT",handle:r.initText},{name:"ScrollViewObjectData",handle:r.initScrollView},{name:"ImageViewObjectData",handle:r.initImageView},{name:"IV",handle:r.initImageView},{name:"TextBMFontObjectData",handle:r.initTextBMFont},{name:"BMF",handle:r.initTextBMFont},{name:"ProjectNodeObjectData",handle:r.initProjectNode},{name:"PN",handle:r.initProjectNode}].forEach(function(n){r.registerParser(n.name,function(t,e){var i=n.handle.call(this,t,e);return this.parseChild(i,t.C||t.Children,e),i})}),t.registerParser("timeline","2",r),t.registerParser("timeline","*",r)}(ccs._load,ccs._parser);